*********create by fish 2015-10-16**********/

CREATE TABLE [dbo].[TKBL](
	[U_ID] [nvarchar](32) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[PSTATUS] [nvarchar](1) NULL,
	[CSTATUS] [nvarchar](1) NULL,
	[TRAN_TYPE] [nvarchar](1) NULL,
	[HOUSE_NO] [nvarchar](20) NULL,
	[MASTER_NO] [nvarchar](20) NULL,
	[REF_NO] [nvarchar](20) NULL,
	[BL_TYPE] [nvarchar](1) NULL,
	[BL_DATE] [datetime] NULL,
	[CLS_DATE] [datetime] NULL,
	[ETD] [datetime] NULL,
	[ETA] [datetime] NULL,
	[SO_NO] [nvarchar](20) NULL,
	[VESSEL1] [nvarchar](30) NULL,
	[VOYAGE1] [nvarchar](12) NULL,
	[VESSEL2] [nvarchar](30) NULL,
	[VOYAGE2] [nvarchar](12) NULL,
	[VESSEL3] [nvarchar](30) NULL,
	[VOYAGE3] [nvarchar](12) NULL,
	[POR_CD] [nvarchar](3) NULL,
	[POR_CNTY] [nvarchar](2) NULL,
	[POR_NAME] [nvarchar](30) NULL,
	[POL_CD] [nvarchar](3) NULL,
	[POL_CNTY] [nvarchar](2) NULL,
	[POL_NAME] [nvarchar](30) NULL,
	[VIA_CD] [nvarchar](3) NULL,
	[VIA_CNTY] [nvarchar](2) NULL,
	[VIA_NAME] [nvarchar](30) NULL,
	[POD_CD] [nvarchar](3) NULL,
	[POD_CNTY] [nvarchar](2) NULL,
	[POD_NAME] [nvarchar](30) NULL,
	[DEST_CD] [nvarchar](3) NULL,
	[DEST_CNTY] [nvarchar](2) NULL,
	[DEST_NAME] [nvarchar](30) NULL,
	[LOADING_FROM] [nvarchar](3) NULL,
	[LOADING_TO] [nvarchar](3) NULL,
	[QTY] [int] NULL,
	[QTYU] [nvarchar](3) NULL,
	[GW] [numeric](18, 2) NULL,
	[GWU] [nvarchar](1) NULL,
	[CBM] [numeric](18, 2) NULL,
	[CNT20] [nvarchar](5) NULL,
	[CNT40] [nvarchar](5) NULL,
	[CNT40HQ] [nvarchar](5) NULL,
	[CNT_TYPE] [nvarchar](5) NULL,
	[CNT_NUMBER] [nvarchar](5) NULL,
	[CUR] [nvarchar](3) NULL,
	[FRT_PC] [nvarchar](2) NULL,
	[OTH_PC] [nvarchar](2) NULL,
	[GOODS] [nvarchar](300) NULL,
	[MARKS] [nvarchar](300) NULL,
	[PICKUP_PORT] [nvarchar](5) NULL,
	[REGION] [nvarchar](1) NULL,
	[STATE] [nvarchar](5) NULL,
	[DELIVERY_PORT] [nvarchar](5) NULL,
	[TRUCK_TYPE] [nvarchar](10) NULL,
	[DRIVER] [nvarchar](20) NULL,
	[DRIVER_TEL] [nvarchar](20) NULL,
	[TRUCK_NO] [nvarchar](20) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](10) NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
 CONSTRAINT [PK_TKBL] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
) ON [PRIMARY]


CREATE TABLE [dbo].[TKBLPT](
	[SHIPMENT_ID] [nvarchar](20) NOT NULL,
	[PARTY_TYPE] [nvarchar](10) NOT NULL,
	[TYPE_DESCP] [nvarchar](10) NULL,
	[ORDER_BY] [nvarchar](3) NULL,
	[PARTY_NO] [nvarchar](10) NOT NULL,
	[PARTY_NAME] [nvarchar](70) NULL,
	[PART_ADDR] [nvarchar](140) NULL,
	[PARTY_ATTN] [nvarchar](20) NULL,
	[PARTY_TEL] [nvarchar](20) NULL,
	[PARTY_MAIL] [nvarchar](100) NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NOT NULL,
	[CMP] [nvarchar](10) NOT NULL,
	[STN] [nvarchar](10) NOT NULL,
	[DEP] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_TKBLPT] PRIMARY KEY CLUSTERED 
(
	[SHIPMENT_ID] ASC,
	[PARTY_TYPE] ASC,
	[PARTY_NO] ASC,
	[GROUP_ID] ASC,
	[CMP] ASC,
	[STN] ASC,
	[DEP] ASC
)ON [PRIMARY]

CREATE TABLE [dbo].[TKBLST](
	[SHIPMENT_ID] [nvarchar](20) NOT NULL,
	[STS_CD] [nvarchar](5) NOT NULL,
	[STS_DESCP] [nvarchar](30) NULL,
	[EVEN_DATE] [datetime] NOT NULL,
	[LOCATION] [nvarchar](5) NULL,
	[EVEN_TMG] [datetimeoffset](0) NULL,
	[REMARK] [nvarchar](50) NULL,
	[CNTR_NO] [nvarchar](12) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NOT NULL,
	[CMP] [nvarchar](10) NOT NULL,
	[STN] [nvarchar](10) NOT NULL,
	[DEP] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_TKBLST] PRIMARY KEY CLUSTERED 
(
	[SHIPMENT_ID] ASC,
	[STS_CD] ASC,
	[EVEN_DATE] ASC,
	[GROUP_ID] ASC,
	[CMP] ASC,
	[STN] ASC,
	[DEP] ASC
) ON [PRIMARY]

CREATE TABLE [dbo].[TKEVD](
	[EVEN_NO] [nvarchar](32) NOT NULL,
	[PROCESS_DATE] [datetime] NULL,
	[NOTIFY_MAIL] [nvarchar](100) NULL,
	[STATUS] [nvarchar](1) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[U_ID] [nvarchar](32) NOT NULL,
 CONSTRAINT [PK_TKEVD_1] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
) ON [PRIMARY]

CREATE TABLE [dbo].[TKEVM](
	[EVEN_NO] [nvarchar](32) NOT NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[TRAN_MODE] [nvarchar](1) NULL,
	[BL_NO] [nvarchar](20) NULL,
	[NOTIFY_TO] [nvarchar](50) NULL,
	[NOTIFY_NM] [nvarchar](70) NULL,
	[NOTIFY_CD] [nvarchar](5) NULL,
	[NOTIFY_DESCP] [nvarchar](30) NULL,
	[START_HOUR] [numeric](3, 0) NULL,
	[NOTIFY_DATE] [datetime] NULL,
	[NOTIFY_FORMAT] [nvarchar](10) NULL,
	[NOTIFY_TIMES] [numeric](1, 0) NULL,
	[PROCESS_TIMES] [numeric](1, 0) NULL,
	[NOTIFY_PERIOD] [numeric](5, 0) NULL,
	[REQUEST_CD] [nvarchar](5) NULL,
	[REQUEST_DESCP] [nvarchar](30) NULL,
	[STATUS] [nvarchar](1) NULL,
	[REMARK] [nvarchar](100) NULL,
	[CREATE_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[GROUP_ID] [nvarchar](10) NOT NULL,
	[CMP] [nvarchar](10) NOT NULL,
	[STN] [nvarchar](10) NOT NULL,
	[DEP] [nvarchar](10) NOT NULL,
 CONSTRAINT [PK_TKEVM] PRIMARY KEY CLUSTERED 
(
	[EVEN_NO] ASC,
	[GROUP_ID] ASC,
	[CMP] ASC,
	[STN] ASC,
	[DEP] ASC
) ON [PRIMARY]

CREATE TABLE [dbo].[TKPDD](
	[U_ID] [nvarchar](32) NOT NULL,
	[DOC_TYPE] [nchar](10) NOT NULL,
	[DOC_DESCP] [nchar](30) NULL,
	[STS_DESCP] [nchar](30) NULL,
	[REMARK] [nchar](50) NULL,
	[CREATE_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
 CONSTRAINT [PK_TKPDD] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC,
	[DOC_TYPE] ASC
) ON [PRIMARY]


CREATE TABLE [dbo].[TKPDM](
	[U_ID] [nvarchar](32) NOT NULL,
	[TRAN_MODE] [nvarchar](1) NOT NULL,
	[TERM] [nvarchar](5) NOT NULL,
	[FREIGHT_TERM] [nvarchar](1) NOT NULL,
	[PARTY_TYPE] [nvarchar](10) NOT NULL,
	[PARTY_DESCP] [nvarchar](20) NULL,
	[STS_CD] [nvarchar](5) NOT NULL,
	[STS_DESCP] [nvarchar](30) NULL,
	[REMARK] [nvarchar](50) NULL,
	[CREATE_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[GROUP_ID] [nvarchar](10) NOT NULL,
	[CMP] [nvarchar](10) NOT NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
 CONSTRAINT [PK_TKPDM] PRIMARY KEY CLUSTERED 
(
	[TRAN_MODE] ASC,
	[TERM] ASC,
	[FREIGHT_TERM] ASC,
	[PARTY_TYPE] ASC,
	[STS_CD] ASC,
	[GROUP_ID] ASC,
	[CMP] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [IX_TKPDM] UNIQUE NONCLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]


CREATE TABLE [dbo].[TKPEM](
	[U_ID] [nvarchar](32) NOT NULL,
	[PARTY_TYPE] [nvarchar](10) NULL,
	[PARTY_DESCP] [nvarchar](30) NULL,
	[NOTIFY_CD] [nvarchar](5) NULL,
	[NOTIFY_DESCP] [nvarchar](30) NULL,
	[START_HOUR] [numeric](3, 0) NULL,
	[NOTIFY_FORMAT] [nvarchar](10) NULL,
	[NOTIFY_TIMES] [numeric](1, 0) NULL,
	[NOTIFY_PERIOD] [numeric](5, 0) NULL,
	[REQUEST_CD] [nvarchar](5) NULL,
	[REQUEST_DESCP] [nvarchar](30) NULL,
	[REMARK] [nvarchar](100) NULL,
	[CREATE_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[SEQ_NO] [int] IDENTITY(1,1) NOT NULL,
 CONSTRAINT [PK_TKPEM] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [IX_TKPEM] UNIQUE NONCLUSTERED 
(
	[CMP] ASC,
	[GROUP_ID] ASC,
	[STN] ASC,
	[SEQ_NO] ASC,
	[PARTY_TYPE] ASC,
	[REQUEST_CD] ASC,
	[NOTIFY_CD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[TKRUD](
	[U_ID] [nvarchar](32) NOT NULL,
	[SEQ_NO] [nvarchar](5) NOT NULL,
	[STS_CD] [nvarchar](5) NOT NULL,
	[STS_DESCP] [nvarchar](30) NULL,
	[NSTS_CD] [nvarchar](5) NULL,
	[NSTS_DESCP] [nvarchar](30) NULL,
	[LOCATION] [nvarchar](5) NULL,
	[SEND_TYPE] [nvarchar](10) NULL,
	[SEND_DESCP] [nvarchar](30) NULL,
	[MAIL_TO] [nvarchar](100) NULL,
 CONSTRAINT [PK_TKRUD] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC,
	[SEQ_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[TKRUM](
	[U_ID] [nvarchar](32) NOT NULL,
	[TRAN_MODE] [nvarchar](1) NULL,
	[TERM] [nvarchar](5) NULL,
	[POL] [nvarchar](5) NULL,
	[VIA] [nvarchar](5) NULL,
	[POD] [nvarchar](5) NULL,
	[DLV] [nvarchar](5) NULL,
	[CARRIER] [nvarchar](10) NULL,
	[SHIP_TO] [nvarchar](10) NULL,
	[TT] [nvarchar](20) NULL,
	[REMARK] [nvarchar](50) NULL,
	[CREATE_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
 CONSTRAINT [PK_TKRUM] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]


INSERT INTO BSCODE(CD_TYPE,CD,CD_DESCP,GROUP_ID,CMP,STN) SELECT 'PT',DP_TYPE,DP_DESCP,'SD','SD','DLC' FROM EDDPTYPE WHERE DP='P'
/********END SQL******/

/******** Sql update by Tim 2016.01.18 *********/
ALTER TABLE SMDNP ADD DOWN_FLAG NVARCHAR(1)
UPDATE SMDNP SET DOWN_FLAG = ’N’

ALTER TABLE SYS_ACCT ADD CMP_PRI NVARCHAR(100)
ALTER TABLE SMWH DROP COLUMN STN
ALTER TABLE SYS_ACCT DROP COLUMN MODI_PW_DATE
ALTER TABLE SYS_ACCT ADD MODI_PW_DATE NUMERIC(5,0)
ALTER TABLE TKSTSCD ADD ORDER_BY NUMERIC(5,0)
ALTER TABLE BSCODE ADD ORDER_BY NUMERIC(5,0)
ALTER TABLE SMSM ADD COMBINE_INFO NVARCHAR(100)
ALTER TABLE SMSM ADD DN_ETD DATE
ALTER TABLE SMSM ADD CFT_CHECK NVARCHAR(1)
ALTER TABLE SMSM ADD GVALUE NUMERIC(18,2)

ALTER TABLE SMPTY
ALTER COLUMN PARTY_TYPE NVARCHAR(120)

ALTER TABLE SMSM ADD TRACK_WAY NVARCHAR(20)
ALTER TABLE SMSM ADD DEEP_PROCESS NVARCHAR(1)
ALTER TABLE SMSM ADD BAND_TYPE NVARCHAR(1)
ALTER TABLE SMSM ADD PLT_NO NVARCHAR(20)
ALTER TABLE SMSM ADD ETT NUMERIC(3,0)
ALTER TABLE SMSM ADD ATT NUMERIC(3,0)
ALTER TABLE SMSM ADD DTT NUMERIC(3,0)
ALTER TABLE SMSM ADD AQTY NUMERIC(12,0)
ALTER TABLE SMSM ADD DQTY NUMERIC(12,0)
ALTER TABLE SMSM ADD FQTY NUMERIC(12,0)
ALTER TABLE SMSM ADD FDQTY NUMERIC(12,0)
ALTER TABLE SMSM ADD NDQTY NUMERIC(12,0)
ALTER TABLE SMSM ADD SEPARATE NVARCHAR(1)
ALTER TABLE SMQTD ADD INCOTERM NVARCHAR(3)

ALTER TABLE SMQTM ADD PERIOD NVARCHAR(1)
ALTER TABLE SMDNP
ALTER COLUMN PRODUCT_LINE NVARCHAR(20)

ALTER TABLE SMRV ADD REVESE_TO NUMERIC(2,0)

EXEC sp_rename  'SMRV.REVERSE_NO', 'RESERVE_NO', 'COLUMN';
EXEC sp_rename  'SMRV.RESERVE_DATE', 'ORDER_DATE', 'COLUMN';
EXEC sp_rename  'SMRV.RESERVE_BY', 'ORDER_BY', 'COLUMN';
EXEC sp_rename  'SMRV.REVESE_DATE', 'RESERVE_DATE', 'COLUMN';
EXEC sp_rename  'SMRV.REVESE_FROM', 'RESERVE_FROM', 'COLUMN';
EXEC sp_rename  'SMRV.REVESE_TDATE', 'RESERVE_TDATE', 'COLUMN';
EXEC sp_rename  'SMRV.REVESE_TO', 'RESERVE_TO', 'COLUMN';
EXEC sp_rename  'SMRVD.REVERSE_DATE', 'RESERVE_DATE', 'COLUMN';
ALTER TABLE SMRV ADD RESERVE_HOUR NUMERIC(3,0)

ALTER TABLE BSSTATE
ALTER COLUMN CNTRY_NM NVARCHAR(30)

ALTER TABLE SMPTY
ALTER COLUMN ZIP NVARCHAR(6)

ALTER TABLE SMSM ADD PORT NVARCHAR(5)
ALTER TABLE SMSM ADD PORT_NM NVARCHAR(30)
ALTER TABLE SMRV ADD TEMP_GATENO NVARCHAR(3)

ALTER TABLE SMDN DROP COLUMN AMOUNT2
ALTER TABLE SMDN DROP COLUMN AMOUNT3
ALTER TABLE SMDN DROP COLUMN RELATION_INFO
ALTER TABLE SMDN DROP COLUMN REF_PART
ALTER TABLE SMDN DROP COLUMN PREPARE_RMK
ALTER TABLE SMDN DROP COLUMN AC_REMARK
ALTER TABLE SMDN DROP COLUMN SLOC
ALTER TABLE SMDN DROP COLUMN CNTR_TYPE
ALTER TABLE SMDN DROP COLUMN CNTR_DESCP
ALTER TABLE SMDNP DROP COLUMN VALUE2
ALTER TABLE SMDNP DROP COLUMN VALUE3
ALTER TABLE SMDNP DROP COLUMN CON2
ALTER TABLE SMDNP DROP COLUMN CON3
ALTER TABLE SMDNP DROP COLUMN CUR2
ALTER TABLE SMDNP DROP COLUMN CUR3
ALTER TABLE SMDNP DROP COLUMN CON1
ALTER TABLE SMDNP DROP COLUMN PRINT_REMARK
ALTER TABLE SMDNP ADD REF_PART NVARCHAR(20)
ALTER TABLE SMDNP ADD PREPARE_RMK NVARCHAR(20)
ALTER TAABLE SMDNP ADD SLOC NVARCHAR(30)

ALTER TABLE SMDN ADD CNT20 NUMERIC(5,0)
ALTER TABLE SMDN ADD CNT40 NUMERIC(5,0)
ALTER TABLE SMDN ADD CNT40HQ NUMERIC(5,0)
ALTER TABLE SMDN ADD CNT_TYPE NVARCHAR(5)
ALTER TABLE SMDN ADD CNT_NUMBER NUMERIC(5,0)

ALTER TABLE SMDN DROP COLUMN CNEE1_CD
ALTER TABLE SMDN DROP COLUMN CNEE1_NM
ALTER TABLE SMDN DROP COLUMN CNEE2_CD
ALTER TABLE SMDN DROP COLUMN CNEE2_NM
ALTER TABLE SMDN DROP COLUMN NOTIFY1_NO
ALTER TABLE SMDN DROP COLUMN NOTIFY1_NM
ALTER TABLE SMDN DROP COLUMN NOTIFY2_NO
ALTER TABLE SMDN DROP COLUMN NOTIFY2_NM
ALTER TABLE SMDN DROP COLUMN CA_CD
ALTER TABLE SMDN DROP COLUMN CA_NAME
ALTER TABLE SMDN DROP COLUMN BA_CD
ALTER TABLE SMDN DROP COLUMN BA_NM
ALTER TABLE SMDN DROP COLUMN FW_CD
ALTER TABLE SMDN DROP COLUMN FW_NM
ALTER TABLE SMDN DROP COLUMN BK_CD
ALTER TABLE SMDN DROP COLUMN BK_NM
ALTER TABLE SMDN DROP COLUMN PK_CD
ALTER TABLE SMDN DROP COLUMN PK_NM
ALTER TABLE SMPTY ALTER COLUMN PARTY_ATTN NVARCHAR(40)
/******** End Sql *********/

ALTER TABLE SMSID ADD U_FID uniqueidentifier

ALTER TABLE SMSIM
ALTER COLUMN INV_FLOW NVARCHAR(50)
/******** End Sql *********/

/************add by will 2016/1/18**********/
ALTER TABLE SMDN ADD PORT_POL NAVRCHAR(4);
ALTER TABLE SMDN ADD PORT_POLNM NAVRCHAR(30);

ALTER TABLE SMDN DROP COLUMN INCOTERM_CD2;   
ALTER TABLE SMDN DROP COLUMN INCOTERM_DESCP2;   

CREATE TABLE [dbo].[TPVPORT](
	[FLAG] [nvarchar](1) NULL,
	[CNTY] [nvarchar](2) NULL,
	[CNTY_NM] [nvarchar](30) NULL,
	[PORT] [nvarchar](6) NULL,
	[PORT_NM] [nvarchar](30) NULL,
	[PROLINK_CD] [nvarchar](5) NULL,
	[REMARK] [nvarchar](70) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY];

ALTER TABLE SMSM ADD PORT_CD NVARCHAR(5);
ALTER TABLE SMSM ADD PORT_NM NVARCHAR(30);
/************end by will 2016/1/18**********/

/************begin by will 2016/1/18**********/
ALTER TABLE SYS_ACCT ADD SAP_ID NVARCHAR(20);
ALTER TABLE SYS_ACCT ADD CARD_NO NVARCHAR(20);

 ALTER TABLE SMDNP DROP COLUMN PLT_NO;
 ALTER TABLE SMDNP DROP COLUMN PLT_PER_QTY;
 ALTER TABLE SMDNP DROP COLUMN PLT_NW;
 ALTER TABLE SMDNP DROP COLUMN PLT_GW;
 ALTER TABLE SMDNP DROP COLUMN CARGO_TYPE;
 /************end by will 2016/1/18**********/


/************add by Tim 2016/1/19**********/
ALTER TABLE SMSID ADD PKG_INS NVARCHAR(300)
ALTER TABLE SMSID ADD U_FID uniqueidentifier

EXEC sp_rename  'SMSID.FOWARDER1', 'FORWARDER1', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER1_NM', 'FORWARDER1_NM', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER2', 'FORWARDER2', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER2_NM', 'FORWARDER2_NM', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER3', 'FORWARDER3', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER3_NM', 'FORWARDER3_NM', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER4', 'FORWARDER4', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER4_NM', 'FORWARDER4_NM', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER5', 'FORWARDER5', 'COLUMN';
EXEC sp_rename  'SMSID.FOWARDER5_NM', 'FORWARDER5_NM', 'COLUMN';
EXEC sp_rename  'SMSID.SHPE_NM', 'SHPR_NM', 'COLUMN';
/************end by Tim 2016/1/19**********/

  /************ADD by will 2016/1/19**********/
 ALTER TABLE SMDN ADD STATUS NVARCHAR(1);
 ALTER TABLE SMDN ADD POST_FLAG NVARCHAR(1);
 /************end by will 2016/1/19**********/

 /************add by Tim 2016/1/19**********/
	ALTER TABLE SMSIM
	ALTER COLUMN INV_FLOW NVARCHAR(50)

/************end by Tim 2016/1/19**********/

 /************add by Tim 2016/1/19**********/
ALTER TABLE SMINP ADD IPART_NO NVARCHAR(100)
ALTER TABLE SMIND ADD INVOICE_TYPE NVARCHAR(1)


/************end by Tim 2016/1/19**********/

ALTER TABLE SMIND
ALTER COLUMN IPART_NO NVARCHAR(100)

 /************add by Tim 2016/1/20**********/
SELECT     dbo.SMDN.APPROVE_TO, dbo.SMDN.SHIPMENT_ID, SMSM_1.STATUS, dbo.SMDN.GROUP_ID, dbo.SMDN.CMP, dbo.SMDN.DN_NO, dbo.SMDNP.U_ID, 
                      SMSM_1.SHIPMENT_INFO, dbo.SMDNP.IPART_NO, dbo.SMDNP.JOB_NO, dbo.SMDNP.JQTY, dbo.SMDNP.PQTY, dbo.SMDNP.CNTR_STD_QTY, 
                      SMSM_1.CNT_NUMBER, SMSM_1.CNT_TYPE, dbo.SMDNP.PRODUCT_LINE, dbo.SMDNP.IQTY, dbo.SMDNP.WQTY,
                          (SELECT     TOP (1) dbo.SMSMPT.PARTY_NO
                            FROM          dbo.SMSM INNER JOIN
                                                   dbo.SMSMPT ON dbo.SMSM.SHIPMENT_ID = dbo.SMSMPT.SHIPMENT_ID
                            WHERE      (dbo.SMSMPT.PARTY_TYPE = 'CA')) AS CA_NO,
                          (SELECT     TOP (1) SMSMPT_3.PARTY_NAME
                            FROM          dbo.SMSM AS SMSM_4 INNER JOIN
                                                   dbo.SMSMPT AS SMSMPT_3 ON SMSM_4.SHIPMENT_ID = SMSMPT_3.SHIPMENT_ID
                            WHERE      (SMSMPT_3.PARTY_TYPE = 'CA')) AS CA_NM,
                          (SELECT     TOP (1) SMSMPT_2.PARTY_NO
                            FROM          dbo.SMSM AS SMSM_3 INNER JOIN
                                                   dbo.SMSMPT AS SMSMPT_2 ON SMSM_3.SHIPMENT_ID = SMSMPT_2.SHIPMENT_ID
                            WHERE      (SMSMPT_2.PARTY_TYPE = 'PT')) AS TK_NO,
                          (SELECT     TOP (1) SMSMPT_1.PARTY_NAME
                            FROM          dbo.SMSM AS SMSM_2 INNER JOIN
                                                   dbo.SMSMPT AS SMSMPT_1 ON SMSM_2.SHIPMENT_ID = SMSMPT_1.SHIPMENT_ID
                            WHERE      (SMSMPT_1.PARTY_TYPE = 'PT')) AS TK_NM, dbo.SMDNP.OPART_NO, dbo.SMDNP.QTYU, dbo.SMDNP.UNIT_PRICE1, dbo.SMDNP.PKG_NUM, 
                      dbo.SMDNP.CBM, dbo.SMDNP.GW, dbo.SMDNP.DOWN_FLAG, dbo.SMDNP.U_ID AS Expr1
FROM         dbo.SMDN INNER JOIN
                      dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID INNER JOIN
                      dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID
 /************end by Tim 2016/1/20**********/

 CREATE TABLE [dbo].[SMEXM](
	[CMP] [nvarchar](10) NOT NULL,
	[CMP_NM] [nvarchar](70) NOT NULL,
	[EXPRESS] [nvarchar](10) NOT NULL,
	[EX_NO] [nvarchar](20) NOT NULL,
	[PW_ID] [nvarchar](20) NOT NULL,
	[SEND_ID] [nvarchar](30) NULL,
	[RCV_ID] [nvarchar](30) NULL,
	[REMARK] [nvarchar](50) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL
) ON [PRIMARY]

/************add by FISH 2016/1/20 **********/
ALTER TABLE SMQTM ALTER COLUMN SERVICE_MODE NVARCHAR(10)
ALTER TABLE SMRQD ALTER COLUMN NOTIFY_DATE DATETIME

ALTER TABLE SMRQD ALTER COLUMN REMARK NVARCHAR(1000)
ALTER TABLE SMQTM ALTER COLUMN REMARK NVARCHAR(1000)
ALTER TABLE SMQTM ALTER COLUMN QUOT_RMK NVARCHAR(1000)
ALTER TABLE SMQTD ALTER COLUMN STATE NVARCHAR(2)
/************end by fish 2016/1/20**********/



/************add by Tim 2016/1/21**********/
	ALTER TABLE SMSIM
	ALTER COLUMN REMARK NVARCHAR(200)

	ALTER TABLE SMSIM ADD MODEL_NAME NVARCHAR(200)
/************end by Tim 2016/1/21**********/

/************add by Tim 2016/1/21**********/
ALTER TABLE SMRV
ALTER COLUMN RESERVE_DATE DATE
/************end by Tim 2016/1/21**********/

/************add by Tim 2016/1/22**********/
ALTER TABLE SMRV
ALTER COLUMN ORDER_DATE DATETIME

ALTER TABLE SMRV
ALTER COLUMN CONFIRM_DATE DATETIME

ALTER TABLE SMRV ADD SEAL_BY NVARCHAR(20)
ALTER TABLE SMRV ADD IN_BY NVARCHAR(20)
ALTER TABLE SMRV ADD OUT_BY NVARCHAR(20)
ALTER TABLE SMWHGT ADD RESERVE_NO NVARCHAR(20)
ALTER TABLE SMRV ADD IN_DATE DATETIME
ALTER TABLE SMRV ADD OUT_DATE DATETIME
/************END by Tim 2016/1/22**********/

/************add by Will 2016/1/21**********/
CREATE TABLE [dbo].[SMACTN](
	[CMP] [nvarchar](10) NULL,
	[U_ID] [uniqueidentifier] NOT NULL,
	[CMP_NM] [nvarchar](70) NULL,
	[SA_SP] [nvarchar](5) NULL,
	[BU] [nvarchar](4) NULL,
	[SOLD_TO] [nvarchar](10) NULL,
	[ATRAN_TYPE] [nvarchar](1) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
 CONSTRAINT [PK_SMACTN] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[SMAL](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[TRAN_TYPE] [nvarchar](1) NULL,
	[FREIGHT_TERM] [nvarchar](2) NULL,
	[TRANSACTE_MODE] [nvarchar](2) NULL,
	[INCOTERM_CD] [nvarchar](3) NULL,
	[CONN_CD] [nvarchar](30) NULL,
	[CONN_NM] [nvarchar](70) NULL,
	[POD_CD] [nvarchar](5) NULL,
	[POD_NM] [nvarchar](30) NULL,
	[PARTY_TYPE] [nvarchar](300) NULL,
	[LSP_CD] [nvarchar](30) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[REMARK] [nvarchar](500) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[TERMINAL_CD] [nvarchar](30) NULL,
	[TERMINAL_NM] [nvarchar](70) NULL,
 CONSTRAINT [PK_SMAL] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/************end by Will 2016/1/21**********/

/************add by FISH 2016/1/21  18:02**********/
CREATE TABLE [TKSTMP](
	[U_ID] [uniqueidentifier] NOT NULL,
	[CUST_CD] [nvarchar](10) NULL,
	[CUST_NM] [nvarchar](20) NULL,
	[SEQ_NO] [int] NULL,
	[CSTS_CD] [nvarchar](5) NULL,
	[CSTS_DESCP] [nvarchar](30) NULL,
	[STS_CD] [nvarchar](5) NULL,
	[STS_DESCP] [nvarchar](30) NULL,
	[REMARK] [nvarchar](100) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
 CONSTRAINT [PK_TKSTMP] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)
) ON [PRIMARY]

/************end by fish 2016/1/21**********/

/************add by Tim 2016/1/23  10:52**********/
ALTER TABLE SMWH ADD U_ID NVARCHAR(50)
ALTER TABLE SMWHGT ADD U_ID NVARCHAR(50)
ALTER TABLE SMWHGT ADD U_FID NVARCHAR(50)
UPDATE SMWH SET U_ID='B75EA749-D140-4404-8A20-1E942B5E3B72' WHERE WS_CD='W1'
UPDATE SMWHGT SET U_ID='4897FB33-0F85-452C-8F12-C64873A3E7AE' WHERE WS_CD='W2'
UPDATE SMWHGT SET U_FID='B75EA749-D140-4404-8A20-1E942B5E3B72' WHERE WS_CD='W1'
UPDATE SMWHGT SET U_FID='4897FB33-0F85-452C-8F12-C64873A3E7AE' WHERE WS_CD='W2'
ALTER TABLE SMWH 
ALTER COLUMN STN NVARCHAR(10) NULL
ALTER TABLE SMWH DROP COLUMN STN
/************END by TIM 2016/1/23  10:52**********/

/************add by Tim 2016/1/26  13:59**********/
ALTER TABLE SMINP ADD CNTR_NO NVARCHAR(20)
ALTER TABLE SMINP ADD PO_NO NVARCHAR(35)
ALTER TABLE SMINP ADD PART_NO NVARCHAR(35)
ALTER TABLE SMINP ADD UNIT_PRICE NUMERIC(18,6)
ALTER TABLE SMINP ADD AMT NUMERIC(18,2)
ALTER TABLE SMINP
ALTER COLUMN IPART_NO NVARCHAR(35)
ALTER TABLE SMINP
ALTER COLUMN OPART_NO NVARCHAR(35)
ALTER TABLE SMIND
ALTER COLUMN PO_NO NVARCHAR(35)
ALTER TABLE SMDN ADD OUT_DATE date;
/************END by Tim 2016/1/23  13:59**********/
/************END by Tim 2016/1/23  13:59**********/


/************add by Will 2016/1/26  10:52**********/
CREATE TABLE [dbo].[SMPOST](
    [U_ID] [uniqueidentifier] NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[CMP_NM] [nvarchar](70) NULL,
	[DN_TYPE]  [nvarchar](10) NULL,
	[BU] [nvarchar](10) NULL,
	[CHANNEL_CD] [nvarchar](2) NULL,
	[CENT_DECL] [nvarchar](1) NULL,
	[DEEP_PROCESS] [nvarchar](1) NULL,
	[BAND_TYPE] [nvarchar](10) NULL,
	[INCOTERM] [nvarchar](10) NULL,
	[PARTY_FCTYPE] [nvarchar](10) NULL,
	[IS_OUTDATE] [nvarchar](1) NULL,
	[IS_BROKER] [nvarchar](1) NULL,
	[IS_ATA] [nvarchar](1) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
 CONSTRAINT [PK_SMPOST] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY];
ALTER TABLE SMWHGT ADD U_ID NVARCHAR(50);

ALTER TABLE SMSM ALTER COLUMN DN_NO NVARCHAR(100) NULL;
ALTER TABLE SMDN ADD POST_FLAG NVARCHAR(1);
/************END by Will 2016/1/26  10:52**********/
/************add by king 2016/1/27  11:11**********/
 ALTER TABLE [SYS_ACCT]
 ADD FAIL_COUNT int
 /************END by king 2016/1/27  11:11**********/


 /************add by TIM 2016/1/27  20:11**********/
 ALTER TABLE SMRV ADD SEAL_DATE DATETIME
 ALTER TABLE SMRV ADD TRUCK_CNTRNO NVARCHAR(12)
 ALTER TABLE SMRV ADD TRUCK_SEALNO NVARCHAR(20)
 ALTER TABLE SMRV ADD S_CODE NVARCHAR(20)
 /************END by TIM 2016/1/27  20:11**********/


 /************add by TIM 2016/1/27  23:11**********/
ALTER VIEW V_CMSUMMARY
AS
SELECT     dbo.SMDN.APPROVE_TO, dbo.SMDN.SHIPMENT_ID, SMSM_1.STATUS, dbo.SMDN.GROUP_ID, dbo.SMDN.CMP, dbo.SMDN.DN_NO, dbo.SMDNP.U_ID, 
                      SMSM_1.SHIPMENT_INFO, dbo.SMDNP.IPART_NO, dbo.SMDNP.JOB_NO, dbo.SMDNP.JQTY, dbo.SMDNP.PQTY, dbo.SMDNP.CNTR_STD_QTY, 
                      SMSM_1.CNT_NUMBER, SMSM_1.CNT_TYPE, dbo.SMDNP.PRODUCT_LINE, dbo.SMDNP.IQTY, dbo.SMDNP.WQTY,
                          (SELECT     TOP (1) dbo.SMSMPT.PARTY_NO
                            FROM          dbo.SMSM INNER JOIN
                                                   dbo.SMSMPT ON dbo.SMSM.SHIPMENT_ID = dbo.SMSMPT.SHIPMENT_ID
                            WHERE      (dbo.SMSMPT.PARTY_TYPE = 'CA')) AS CA_NO,
                          (SELECT     TOP (1) SMSMPT_3.PARTY_NAME
                            FROM          dbo.SMSM AS SMSM_4 INNER JOIN
                                                   dbo.SMSMPT AS SMSMPT_3 ON SMSM_4.SHIPMENT_ID = SMSMPT_3.SHIPMENT_ID
                            WHERE      (SMSMPT_3.PARTY_TYPE = 'CA')) AS CA_NM,
                          (SELECT     TOP (1) SMSMPT_2.PARTY_NO
                            FROM          dbo.SMSM AS SMSM_3 INNER JOIN
                                                   dbo.SMSMPT AS SMSMPT_2 ON SMSM_3.SHIPMENT_ID = SMSMPT_2.SHIPMENT_ID
                            WHERE      (SMSMPT_2.PARTY_TYPE = 'PT')) AS TK_NO,
                          (SELECT     TOP (1) SMSMPT_1.PARTY_NAME
                            FROM          dbo.SMSM AS SMSM_2 INNER JOIN
                                                   dbo.SMSMPT AS SMSMPT_1 ON SMSM_2.SHIPMENT_ID = SMSMPT_1.SHIPMENT_ID
                            WHERE      (SMSMPT_1.PARTY_TYPE = 'PT')) AS TK_NM, dbo.SMDNP.OPART_NO, dbo.SMDNP.QTYU, dbo.SMDNP.UNIT_PRICE1, dbo.SMDNP.PKG_NUM, 
                      dbo.SMDNP.CBM, dbo.SMDNP.GW, dbo.SMDNP.DOWN_FLAG, dbo.SMDNP.U_ID AS Expr1
FROM         dbo.SMDN INNER JOIN
                      dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID INNER JOIN
                      dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID
/************END by TIM 2016/1/27  23:11**********/

 /************add by TIM 2016/1/29  09:11**********/
 ALTER TABLE SYS_ACCT ADD CREATE_BY NVARCHAR(20)
 ALTER TABLE SYS_ACCT ADD CREATE_DATE DATETIME

  /************end by TIM 2016/1/29  09:11**********/



 /************add by TIM 2016/2/01  09:11**********/
ALTER TABLE SMRV ADD TEMP_WSCD NVARCHAR(10)
ALTER TABLE SMRV ADD TEMP_RDATE DATE
ALTER TABLE SMRV ADD TEMP_RFROM NUMERIC(2,0)
ALTER TABLE SMRV ADD TEMP_RH NUMERIC(3,0)
ALTER TABLE SMRV ADD SHIPMENT_ID NVARCHAR(20)
 /************END by TIM 2016/2/01  09:11**********/

   /************add by Will 2016/2/1  ***************/
 ALTER TABLE SYS_ACCT ADD RC NVARCHAR(10);
 ALTER TABLE SMFCC ALTER COLUMN POL NVARCHAR(5) NULL;
 ALTER TABLE SMCNP ADD POL NVARCHAR(5);
/************End by Will 2016/2/1  ***************/

ALTER TABLE SMSM ADD INV_FLOW NVARCHAR(50);
ALTER TABLE SMSID
ALTER COLUMN INV_FLOW NVARCHAR(50)

/************add by Tim 2016/2/14  ***************/
ALTER TABLE SMEXM ADD WEB_URL NVARCHAR(200)
ALTER TABLE SMEXM ADD EDI_MODE NVARCHAR(20)
INSERT INTO BSCODE_KIND (GROUP_ID, CD_TYPE, CD_DESCP, CMP, STN)VALUES('TPV','TEDI','EDI Function', 'FQ', '*');
/************END by Tim 2016/2/14  ***************/

 /************add by FISH 2016/2/14  23:41**********/
 ALTER TABLE SMQTD ADD SERVICE_MODE NVARCHAR(10)
 ALTER TABLE TKBLST ALTER COLUMN STS_DESCP NVARCHAR(100)
  /************end by FISH 2016/2/14  23:41**********/


/************add by Will 2016/2/15 10:36 ***************/
ALTER TABLE SMSM ADD CORDER NVARCHAR(1);
ALTER TABLE SMSM ADD BORDER NVARCHAR(1);
/************END by Will 2016/2/15  ***************/


/************add by Will 2016/2/15 10:36 ***************/
ALTER TABLE SMSM ADD CORDER NVARCHAR(1);
ALTER TABLE SMSM ADD BORDER NVARCHAR(1);
ALTER TABLE SMSM ADD TORDER NVARCHAR(1);
/************END by Will 2016/2/15  ***************/

/************add by Tim 2016/2/15 10:36 ***************/
ALTER TABLE SMRV ADD LTRUCK_NO NVARCHAR(20)
ALTER TABLE SMRV ADD LDRIVER NVARCHAR(20)
ALTER TABLE SMRV ADD LTEL NVARCHAR(20)
ALTER TABLE SMRV ADD QTY NUMERIC(12)
ALTER TABLE SMRV ADD QTYU NVARCHAR(3)
ALTER TABLE SMRV ADD NW NUMERIC(12,3)
ALTER TABLE SMRV ADD NWU NVARCHAR(3)
ALTER TABLE SMRV ADD GW NUMERIC(12,3)
ALTER TABLE SMRV ADD GWU NVARCHAR(3)
ALTER TABLE SMRV ADD CBM NUMERIC(12,4)
ALTER TABLE SMEXM ADD MSG_CODE NVARCHAR(20)
ALTER TABLE SMRV ADD LODING_FROM NVARCHAR(5)
ALTER TABLE SMRV ADD LODING_TO NVARCHAR(5)
EXEC sp_RENAME 'SMRV.CNTY_TYPE', 'CNTR_TYPE', 'COLUMN'
/************END by Tim 2016/2/15 10:36 ***************/


/************add by TIM 2016/02/15  19:27**********/
ALTER VIEW V_CMSUMMARY
SELECT dbo.SMDN.APPROVE_TO
	,dbo.SMDN.SHIPMENT_ID
	,SMSM_1.STATUS
	,dbo.SMDN.GROUP_ID
	,dbo.SMDN.CMP
	,dbo.SMDN.DN_NO
	,dbo.SMDNP.U_ID
	,SMSM_1.SHIPMENT_INFO
	,dbo.SMDNP.IPART_NO
	,dbo.SMDNP.JOB_NO
	,dbo.SMDNP.JQTY
	,dbo.SMDNP.PQTY
	,dbo.SMDNP.CNTR_STD_QTY
	,SMSM_1.CNT_NUMBER
	,SMSM_1.CNT_TYPE
	,dbo.SMDNP.PRODUCT_LINE
	,dbo.SMDNP.IQTY
	,dbo.SMDNP.WQTY
	,SMSM_1.TORDER
	,(
		SELECT TOP (1) dbo.SMSMPT.PARTY_NO
		FROM dbo.SMSM
		INNER JOIN dbo.SMSMPT ON dbo.SMSM.SHIPMENT_ID = dbo.SMSMPT.SHIPMENT_ID
		WHERE (dbo.SMSMPT.PARTY_TYPE = 'CA')
		) AS CA_NO
	,(
		SELECT TOP (1) SMSMPT_3.PARTY_NAME
		FROM dbo.SMSM AS SMSM_4
		INNER JOIN dbo.SMSMPT AS SMSMPT_3 ON SMSM_4.SHIPMENT_ID = SMSMPT_3.SHIPMENT_ID
		WHERE (SMSMPT_3.PARTY_TYPE = 'CA')
		) AS CA_NM
	,(
		SELECT TOP (1) SMSMPT_2.PARTY_NO
		FROM dbo.SMSM AS SMSM_3
		INNER JOIN dbo.SMSMPT AS SMSMPT_2 ON SMSM_3.SHIPMENT_ID = SMSMPT_2.SHIPMENT_ID
		WHERE (SMSMPT_2.PARTY_TYPE = 'PT')
		) AS TK_NO
	,(
		SELECT TOP (1) SMSMPT_1.PARTY_NAME
		FROM dbo.SMSM AS SMSM_2
		INNER JOIN dbo.SMSMPT AS SMSMPT_1 ON SMSM_2.SHIPMENT_ID = SMSMPT_1.SHIPMENT_ID
		WHERE (SMSMPT_1.PARTY_TYPE = 'PT')
		) AS TK_NM
	,dbo.SMDNP.OPART_NO
	,dbo.SMDNP.QTYU
	,dbo.SMDNP.UNIT_PRICE1
	,dbo.SMDNP.PKG_NUM
	,dbo.SMDNP.CBM
	,dbo.SMDNP.GW
	,dbo.SMDNP.DOWN_FLAG
	,dbo.SMDNP.U_ID AS Expr1
FROM dbo.SMDN
INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID
/************END by TIM 2016/02/15  19:27**********/

/************ADD by TIM 2016/02/15  19:51**********/
DROP TABLE SMSIM
CREATE TABLE [dbo].[SMSIM](
	[U_ID] [uniqueidentifier] NOT NULL,
	[PROFILE] [nvarchar](10) NULL,
	[CMP] [NVARCHAR](10) NULL,
	[CMP_NM][NVARCHAR](70) NULL,
	[CUST_CD] [nvarchar](10) NULL,
	[CUST_NM] [nvarchar](70) NULL,
	[PROFILE_NM] [nvarchar](200) NULL,
	[INV_FLOW] [nvarchar](200) NULL,
	[MODEL_NAME] [nvarchar](200) NULL,
	[STN] [NVARCHAR](10) NULL,
	[STN_NM][NVARCHAR](70) NULL,
	[BL_TYPE][NVARCHAR](1) NULL,
	[SELLER] [nvarchar](10) NULL,
	[SELLER_NM] [nvarchar](70) NULL,
	[BUYER1] [nvarchar](10) NULL,
	[BUYER1_NM] [nvarchar](70) NULL,
	[INCOTERM1] [nvarchar](3) NULL,
	[BUYER2] [nvarchar](10) NULL,
	[BUYER2_NM] [nvarchar](70) NULL,
	[INCOTERM2] [nvarchar](3) NULL,
	[BUYER3] [nvarchar](10) NULL,
	[BUYER3_NM] [nvarchar](70) NULL,
	[INCOTERM3] [nvarchar](3) NULL,
	[BUYER4] [nvarchar](10) NULL,
	[BUYER4_NM] [nvarchar](70) NULL,
	[INCOTERM4] [nvarchar](3) NULL,
	[BUYER5] [nvarchar](10) NULL,
	[BUYER5_NM] [nvarchar](70) NULL,
	[INCOTERM5] [nvarchar](3) NULL,
	[DEST] [nvarchar](5) NULL,
	[CNEE_CD] [nvarchar](10) NULL,
	[CNEE_NM] [nvarchar](70) NULL,
	[SHPR_CD] [nvarchar](10) NULL,
	[SHPR_NM] [nvarchar](70) NULL,
	[SHIPPING_MODE] [nvarchar](4) NULL,
	[SHIPPING_NM] [nvarchar](30) NULL,
	[NOTIFY1] [nvarchar](10) NULL,
	[NOTIFY1_NM] [nvarchar](70) NULL,
	[NOTIFY2] [nvarchar](10) NULL,
	[NOTIFY2_NM] [nvarchar](70) NULL,
	[NOTIFY3] [nvarchar](10) NULL,
	[NOTIFY3_NM] [nvarchar](70) NULL,
	[CARRIER1] [nvarchar](10) NULL,
	[CARRIER_NM1] [nvarchar](70) NULL,
	[CONTACT_NO1] [nvarchar](30) NULL,
	[LSP_NO1] [nvarchar](10) NULL,
	[LSP_NM1] [nvarchar](70) NULL,
	[LSP_INFO1] [nvarchar](30) NULL,
	[CARRIER2] [nvarchar](10) NULL,
	[CARRIER_NM2] [nvarchar](70) NULL,
	[CONTACT_NO2] [nvarchar](30) NULL,
	[LSP_NO2] [nvarchar](10) NULL,
	[LSP_NM2] [nvarchar](70) NULL,
	[LSP_INFO2] [nvarchar](30) NULL,
	[CARRIER3] [nvarchar](10) NULL,
	[CARRIER_NM3] [nvarchar](70) NULL,
	[CONTACT_NO3] [nvarchar](30) NULL,
	[LSP_NO3] [nvarchar](10) NULL,
	[LSP_NM3] [nvarchar](70) NULL,
	[LSP_INFO3] [nvarchar](30) NULL,
	[CC_CD] [nvarchar](10) NULL,
	[CC_NM] [nvarchar](70) NULL,
	[DT_CD] [nvarchar](10) NULL,
	[DT_NM] [nvarchar](70) NULL,
	[COMMODITY] [nvarchar](300) NULL,
	[BILL_TYPE] [nvarchar](40) NULL,
	[COMBINE] [nvarchar](1) NULL,
	[LC] [nvarchar](1) NULL,
	[FCL_LCL] [nvarchar](3) NULL,
	[DOC1] [nvarchar](10) NULL,
	[MAIL_GROUP1] [nvarchar](100) NULL,
	[DOC2] [nvarchar](10) NULL,
	[MAIL_GROUP2] [nvarchar](100) NULL,
	[DOC3] [nvarchar](10) NULL,
	[MAIL_GROUP3] [nvarchar](100) NULL,
	[DOC4] [nvarchar](10) NULL,
	[MAIL_GROUP4] [nvarchar](100) NULL,
	[DOC5] [nvarchar](10) NULL,
	[MAIL_GROUP5] [nvarchar](100) NULL,
	[SHIPPING_MARK] [nvarchar](300) NULL,
	[BL_REMARK1] [nvarchar](300) NULL,
	[BL_REMARK2] [nvarchar](300) NULL,
	[BL_REMARK3] [nvarchar](300) NULL,
	[BL_REMARK4] [nvarchar](300) NULL,
	[BL_REMARK5] [nvarchar](300) NULL,
	[INV_REMARK1] [nvarchar](300) NULL,
	[INV_REMARK2] [nvarchar](300) NULL,
	[INV_REMARK3] [nvarchar](300) NULL,
	[INV_REMARK4] [nvarchar](300) NULL,
	[INV_REMARK5] [nvarchar](300) NULL,
	[PK_REMARK1] [nvarchar](300) NULL,
	[PK_REMARK2] [nvarchar](300) NULL,
	[PK_REMARK3] [nvarchar](300) NULL,
	[PK_REMARK4] [nvarchar](300) NULL,
	[PK_REMARK5] [nvarchar](300) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DEP] [nvarchar](10) NULL,
	[CREATE_EXT] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMSIM] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
/************END by TIM 2016/02/15  19:51**********/


/************add by Will 2016/2/15 10:36 ***************/
ALTER TABLE SMDN ADD LOADING_FROM NVARCHAR(5);
ALTER TABLE SMDN ADD LOADING_TO NVARCHAR(5);
ALTER TABLE SMDN ADD PROFILE_CD NVARCHAR(10);
ALTER TABLE SMSM ADD LOADING_FROM NVARCHAR(5);
ALTER TABLE SMSM ADD LOADING_TO NVARCHAR(5);
/************END by Will 2016/2/15  ***************/

/************add by FISH 2016/2/16 9:02 ***************/
ALTER TABLE SMRQM ADD LOADING_FROM NVARCHAR(5);
ALTER TABLE SMRQM ADD LOADING_TO NVARCHAR(5);
ALTER TABLE SMQTM ADD LOADING_FROM NVARCHAR(5);
ALTER TABLE SMQTM ADD LOADING_TO NVARCHAR(5);
ALTER TABLE SMQTD ADD LOADING_FROM NVARCHAR(5);
ALTER TABLE SMQTD ADD LOADING_TO NVARCHAR(5);

 ALTER TABLE TKPMG ALTER COLUMN MAIL_ID NVARCHAR(500);
 /************END by FISH 2016/2/16 9:02 ***************/

 /************add by KING 2016/2/16 13:02 ***************/
 ALTER TABLE SYS_ACCT_ROLE 
ADD RCMP NVARCHAR(20)
ALTER TABLE SYS_ACCT_ROLE 
ADD RSTN NVARCHAR(20)

ALTER TABLE SYS_ROLE_OBJ_PMS 
ALTER COLUMN FOBJ_ID NVARCHAR(100)

update [SYS_ACCT_ROLE] SET 
[RCMP] = (SELECT TOP 1 CMP FROM SYS_ROLE WHERE FID = FROLE_ID),
[RSTN] = (SELECT TOP 1 STN FROM SYS_ROLE WHERE FID = FROLE_ID)

 /************END by KING 2016/2/16 13:02 ***************/
  ALTER TABLE SMFCC ADD LSP_CD NVARCHAR(10);
  ALTER TABLE SMFCC ADD ORDER_BY NVARCHAR(10);
  ALTER TABLE SMDLSPR ADD CUSTOMER_NM NVARCHAR(70);

/************add by Tim 2016/2/17 21:02 ***************/
ALTER TABLE SMRV ADD TRUCKER_NM NVARCHAR(70)
ALTER TABLE SMRV ADD LTRUCKER_NM NVARCHAR(70)
ALTER TABLE SMRV
ALTER COLUMN DN_NO NVARCHAR(100)
/************end by Tim 2016/2/17 21:02 ***************/

/************add by Tim 2016/2/18 13:02 ***************/
ALTER TABLE SMSM ADD SH_CD NVARCHAR(10)
ALTER TABLE SMSM ADD SH_NM NVARCHAR(70)
ALTER TABLE SMSM ADD CS_CD NVARCHAR(10)
ALTER TABLE SMSM ADD CS_NM NVARCHAR(70)
ALTER TABLE SMSM ADD PT_CD NVARCHAR(10)
ALTER TABLE SMSM ADD PT_NM NVARCHAR(70)
ALTER TABLE SMSM ADD DT_CD NVARCHAR(10)
ALTER TABLE SMSM ADD DT_NM NVARCHAR(70)

ALTER TABLE TKBL ADD SH_CD NVARCHAR(10)
ALTER TABLE TKBL ADD SH_NM NVARCHAR(70)
ALTER TABLE TKBL ADD CS_CD NVARCHAR(10)
ALTER TABLE TKBL ADD CS_NM NVARCHAR(70)
ALTER TABLE TKBL ADD SP_CD NVARCHAR(10)
ALTER TABLE TKBL ADD SP_NM NVARCHAR(70)
ALTER TABLE TKBL ADD AG_CD NVARCHAR(10)
ALTER TABLE TKBL ADD AG_NM NVARCHAR(70)

ALTER TABLE SMDN ADD AG_CD NVARCHAR(10)
ALTER TABLE SMDN ADD AG_NM NVARCHAR(70)
ALTER TABLE SMDN ADD WE_CD NVARCHAR(10)
ALTER TABLE SMDN ADD WE_NM NVARCHAR(70)
ALTER TABLE SMDN ADD ZE_CD NVARCHAR(10)
ALTER TABLE SMDN ADD ZE_NM NVARCHAR(70)
ALTER TABLE SMDN ADD FC_CD NVARCHAR(10)
ALTER TABLE SMDN ADD FC_NM NVARCHAR(70)
ALTER TABLE SMDN ADD RE_CD NVARCHAR(10)
ALTER TABLE SMDN ADD RE_NM NVARCHAR(70)
ALTER TABLE SMDN ADD RO_CD NVARCHAR(10)
ALTER TABLE SMDN ADD RO_NM NVARCHAR(70)
/************end by Tim 2016/2/18 13:02 ***************/

ALTER TABLE SMDLSPR ADD TRACK_WAY NVARCHAR(20);
ALTER TABLE SMDLSPR ADD DELIVERY_PORTNM NVARCHAR(70);
ALTER TABLE SMSM ADD PAYTERM_CD NVARCHAR(10);
ALTER TABLE SMSM ADD PAYTERM_NM NVARCHAR(70);
ALTER TABLE SMDN ADD PAYTERM_CD NVARCHAR(10);
ALTER TABLE SMDN ADD PAYTERM_NM NVARCHAR(70);
ALTER TABLE SMDN ADD CAR_TYPE NVARCHAR(10);


/************add by fish 2016/2/19 11:16 ***************/
ALTER TABLE SMQTM ADD RLOCATION_NM NVARCHAR(30)
/************end by fish 2016/2/19 11:16 ***************/

/************ADD by Tim 2016/2/19 13:02 ***************/
ALTER TABLE SMCHG ADD CMP_NM NVARCHAR(70)
ALTER TABLE SMCHG ADD TRAN_TYPE_DESCP NVARCHAR(70)
/************END by Tim 2016/2/19 13:02 ***************/

/************add by fish 2016/2/19 13:16 ***************/
CREATE TABLE [dbo].[TKCSTS](
	[U_ID] [nvarchar](32) NOT NULL,
	[U_FID] [nvarchar](32) NOT NULL,
	[SEQ_NO] [numeric](5, 0) IDENTITY(1,1) NOT NULL,
	[PARTY_NO] [nvarchar](10) NOT NULL,
	[STS_CD] [nvarchar](3) NOT NULL,
	[REMARK] [nvarchar](30) NULL,
	[LIGHT_SEQ] [nvarchar](2) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[STS_DESCP] [nvarchar](80) NULL,
	[INPUT_VIEW] [nvarchar](1) NULL,
 CONSTRAINT [PK_TKCSTS] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC,
	[U_FID] ASC,
	[SEQ_NO] ASC
) )ON [PRIMARY]

 ALTER TABLE TKBLPT ALTER COLUMN TYPE_DESCP NVARCHAR(30)

 ALTER TABLE TKPDM ALTER COLUMN TERM NVARCHAR(5) NULL
 ALTER TABLE TKPDM ALTER COLUMN FREIGHT_TERM NVARCHAR(1) NULL
/************end by fish 2016/2/19 13:16 ***************/

/************ADD by TIM 2016/2/20 13:16 ***************/
ALTER TABLE BSTRUCKC ADD U_FID NVARCHAR(50)
ALTER TABLE BSTRUCKD ADD U_FID NVARCHAR(50)
/************END by TIM 2016/2/20 13:16 ***************/


/************ADD by TIM 2016/2/22 13:16 ***************/
ALTER VIEW V_IPQ02
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   (SELECT PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
       (SELECT CNTR_NO FROM SMRV WHERE SHIPMENT_ID=A.SHIPMENT_ID ) CNTR_NO,
       (SELECT SEAL_NO1 FROM SMRV WHERE SHIPMENT_ID=A.SHIPMENT_ID ) SEAL_NO1
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO

ALTER VIEW V_IPQ01
AS
SELECT A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE,
       A.MARKS, 
       C.CASE_NO, C.CASE_NUM, C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW,
       C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.U_FID, C.QTYU,
       (SELECT PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
       (SELECT CNTR_NO FROM SMRV WHERE SHIPMENT_ID=A.SHIPMENT_ID ) CNTR_NO,
       (SELECT SEAL_NO1 FROM SMRV WHERE SHIPMENT_ID=A.SHIPMENT_ID ) SEAL_NO1
FROM SMINM A LEFT JOIN SMINP C ON A.U_ID=C.U_FID
             LEFT JOIN SMDN B ON A.DN_NO=B.DN_NO
/************END by TIM 2016/2/22 13:16 ***************/

ALTER TABLE SMSM ADD BROKER_USER NVARCHAR(10);


ALTER TABLE SMINM ADD COMBINE_INFO NVARCHAR(100)
ALTER TABLE SMINM ADD VESSEL_NM NVARCHAR(70)
ALTER TABLE SMINM 
ALTER COLUMN SO_NO NVARCHAR(20)

CREATE VIEW [dbo].[V_FCL01] AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, --C.PARTY_FAX,
(SELECT CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.U_ID=B.U_FID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO

/************ADD by FISH 2016/2/23 19:23 ***************/
ALTER TABLE SMQTD ALTER COLUMN [STATE] NVARCHAR(2)
/************END by FISH 2016/2/23 19:23 ***************/

/************ADD by Jones 2016/2/23 23/13 ***************/
CREATE VIEW [dbo].[V_FCL01] AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, --C.PARTY_FAX,
(SELECT CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO
/************END by Jones 2016/2/23 23/13 ***************/

ALTER TABLE SMRVM ADD RESERVE_NO NVARCHAR(20)
/************END by Jones 2016/2/23 23/13 ***************/

/*********ADD by will 2016/2/24 ************/
ALTER TABLE SMLSPR ADD PARTY_TYPE NVARCHAR(10);
/*********END by will 2016/2/24 ************/

ALTER TABLE SMDND ADD SHIPMENT_ID NVARCHAR(20)
ALTER TABLE SMDND
ALTER COLUMN CALL_DATE DATETIME

ALTER TABLE SMRV ADD IS_BATCH NVARCHAR(1)

/**********ADD BY WILL 2016/2/25***********/
 ALTER TABLE  APPROVE_FLOW_D ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  APPROVE_FLOW_M ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  APPROVE_RECORD ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSCITY ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSCNTY ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSCODE ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSCODE_KIND ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSCUR ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSECITY ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSERATE ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSEXR ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  BSTPORT ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  EDDPTYPE ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  GFMESSAGE ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  IPGOODS ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  IPPART ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMACTN ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMBIM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMCHG ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMCNP ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMCNU ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMDLSPR ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMDN ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMDN_backup ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMEXM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMFCM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMINM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMLSPR ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMPOST ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMPTY ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMQTM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMRQM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMRV ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMSM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SMWH ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SYS_CMP ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SYS_NOTICE ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  SYS_NOTICE_RECORD ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TK_CMP ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKBL ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKBL_TEMP ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKBLPT ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKBLST ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKCSTS ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKEVD ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKEVM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKPDD ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKPDM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKPEM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKPMG ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKRUM ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKSTMP ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TKSTSCD ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TMEXP ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  TPVPORT ALTER COLUMN CREATE_BY NVARCHAR(30);
  ALTER TABLE  ZZBSCITY ALTER COLUMN CREATE_BY NVARCHAR(30);

   ALTER TABLE  APPROVE_FLOW_D ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  APPROVE_FLOW_M ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  APPROVE_RECORD ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSCITY ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSCNTY ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSCODE ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSCODE_KIND ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSCUR ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSECITY ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSERATE ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSEXR ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  BSTPORT ALTER COLUMN MODIFY_BY NVARCHAR(30);
  --ALTER TABLE  EDDPTYPE ALTER COLUMN MODIFY_BY NVARCHAR(30);
  --ALTER TABLE  GFMESSAGE ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  IPGOODS ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  IPPART ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMACTN ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMBIM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMCHG ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMCNP ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMCNU ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMDLSPR ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMDN ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMDN_backup ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMEXM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMFCM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMINM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMLSPR ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMPOST ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMPTY ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMQTM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMRQM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  --ALTER TABLE  SMRV ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMSM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SMWH ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SYS_CMP ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  SYS_NOTICE ALTER COLUMN MODIFY_BY NVARCHAR(30);
  --ALTER TABLE  SYS_NOTICE_RECORD ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TK_CMP ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKBL ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKBL_TEMP ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKBLPT ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKBLST ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKCSTS ALTER COLUMN MODIFY_BY NVARCHAR(30);
  --ALTER TABLE  TKEVD ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKEVM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKPDD ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKPDM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKPEM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKPMG ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKRUM ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKSTMP ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TKSTSCD ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TMEXP ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  TPVPORT ALTER COLUMN MODIFY_BY NVARCHAR(30);
  ALTER TABLE  ZZBSCITY ALTER COLUMN MODIFY_BY NVARCHAR(30);
  /**********END BY WILL 2016/2/25***********/

ALTER TABLE SMINP ADD VEN_CD NVARCHAR(20)
ALTER TABLE SMINP ADD VEN_NM NVARCHAR(100)
ALTER TABLE SMINP ADD VEN_ADDR NVARCHAR(300)
ALTER TABLE SMINP ADD PLA_NO NVARCHAR(10)
ALTER TABLE SMINP ADD PLA_SIZE NVARCHAR(20)
ALTER TABLE SMINP ADD NWU NVARCHAR(5)
ALTER TABLE SMINP ADD GWU NVARCHAR(5)
ALTER TABLE SMINP ADD CBMU NVARCHAR(5)
ALTER TABLE SMINP ADD NCM_NO NVARCHAR(10)


/**********ADD BY JONES 2016/3/2***********/
ALTER TABLE SMINP ADD NCM_NO NVARCHAR(10)
CREATE TABLE [dbo].[SMEX_ACCT](
	[U_ID] [nvarchar](50) NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[CMP_NM] [nvarchar](70) NULL,
	[IO] [nvarchar](1) NULL,
	[EXPRESS_CD] [nvarchar](10) NULL,
	[EXPRESS_NM] [nvarchar](70) NULL,
	[AC_NO] [nvarchar](30) NULL,
	[REMARK] [nvarchar](100) NULL,
 CONSTRAINT [PK_SMEX_ACCT] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]AS

ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, --C.PARTY_FAX,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM,
       A.MARKS, A.SHIPMENT_ID,
       C.CASE_NO, C.CASE_NUM, C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW,
       C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.U_FID, C.QTYU,
       D.CNTR_NO, D.SEAL_NO1,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1
FROM SMINM A LEFT JOIN SMINP C ON A.SHIPMENT_ID=C.SHIPMENT_ID
             LEFT JOIN SMDN B ON A.DN_NO=B.DN_NO
             LEFT JOIN SMRV D ON D.SHIPMENT_ID=A.SHIPMENT_ID 

ALTER VIEW [dbo].[V_IPQ02]
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   D.CNTR_NO, D.SEAL_NO1, A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID,
	   (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO
             LEFT JOIN SMRV D ON D.SHIPMENT_ID=A.SHIPMENT_ID

ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.PAY_TERM_CD, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.SHIPMENT_ID = B.SHIPMENT_ID

ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.PAY_TERM_CD, A.PAY_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO,  
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.SHIPMENT_ID=B.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.SHIPMENT_ID=B.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.PAY_TERM_CD, A.PAY_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, 
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.SHIPMENT_ID=B.SHIPMENT_ID
/**********END BY JONES 2016/3/2***********/

/**********ADD BY FISH 2016/3/2 18：42***********/
 ALTER TABLE SMQTD ADD CUT_OFF NVARCHAR(50);
 ALTER TABLE SMQTD ADD ETD NVARCHAR(50);
 /**********END BY FISH 2016/3/2  18：42***********/

ALTER TABLE SMSMPT ALTER COLUMN PARTY_TEL NVARCHAR(50) NULL
ALTER TABLE SMDNPT ALTER COLUMN TEL NVARCHAR(50) NULL
ALTER TABLE TKBLPT ALTER COLUMN PARTY_TEL NVARCHAR(50) NULL


/**********ADD BY TIM 2016/3/3 18：42***********/
CREATE TABLE [dbo].[BSLCPOL](
	[U_ID] [nvarchar](50) NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[POL] [nvarchar](5) NULL,
	[POL_DESCP] [nvarchar](30) NULL,
	[REMARK] [nvarchar](50) NULL,
 CONSTRAINT [PK_BSLCPOL] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

ALTER TABLE SMSIM ADD PO_HEADER NVARCHAR(20)
ALTER TABLE SMSIM ADD MODEL_HEADER NVARCHAR(20)
ALTER TABLE SMSIM ADD PKG_DESCP NVARCHAR(1)
/**********END BY TIM 2016/3/3 18：42***********/


  /**********KING的  已加***********/
 CREATE TABLE [dbo].[SMPOM](
 [U_ID] [uniqueidentifier] NOT NULL,
 [PO_NO] [nvarchar](30) NULL,
 [CREADY_DATE] [date] NULL,
 [FSHIPPING_DATE] [date] NULL,
 [ETD] [date] NULL,
 [STATUS] [nvarchar](1) NULL,
 [BUYER_CD] [nvarchar](10) NULL,
 [BUYER_NM] [nvarchar](70) NULL,
 [BUYER_ADDR] [nvarchar](140) NULL,
 [BUYER_MAIL] [nvarchar](100) NULL,
 [SUPPLIER_CD] [nvarchar](10) NULL,
 [SUPPLIER_NM] [nvarchar](70) NULL,
 [SUPPLIER_ADDR] [nvarchar](140) NULL,
 [SUPPLIER_MAIL] [nvarchar](100) NULL,
 [SUPPLIER_TEL] [nvarchar](40) NULL,
 [SUPPLIER_FAX] [nvarchar](40) NULL,
 [SUPPLIER_ATTN] [nvarchar](40) NULL,
 [INCOTERM] [nvarchar](5) NULL,
 [INCOTERM_DESCP] [nvarchar](30) NULL,
 [DELIVERY_WAY] [nvarchar](1) NULL,
 [QTY] [numeric](12, 0) NULL,
 [QTYU] [nvarchar](3) NULL,
 [OQTY] [numeric](12, 0) NULL,
 [DQTY] [numeric](12, 0) NULL,
 [BQTY] [numeric](12, 0) NULL,
 [FROM_NM] [nvarchar](30) NULL,
 [TO_NM] [nvarchar](30) NULL,
 [ORIGIN_LSP] [nvarchar](10) NULL,
 [ORIGIN_LNM] [nvarchar](70) NULL,
 [DEST_LSP] [nvarchar](10) NULL,
 [DEST_LNM] [nvarchar](70) NULL,
 [MARKS] [nvarchar](1000) NULL,
 [COMMODITY] [nvarchar](1000) NULL,
 [SI_INFO] [nvarchar](1000) NULL,
 [REMARK] [nvarchar](1000) NULL,
 [GROUP] [nvarchar](10) NULL,
 [STN] [nvarchar](10) NULL,
 [CMP] [nvarchar](10) NULL,
 [CREATE_BY] [nvarchar](20) NULL,
 [CREATE_DATE] [datetime] NULL,
 [MODIFY_BY] [nvarchar](20) NULL,
 [MODIFY_DATE] [datetime] NULL,
 [FREIGHT_TERM] [nvarchar](10) NULL,
 [FROM_CD] [nvarchar](5) NULL,
 [TO_CD] [nvarchar](5) NULL,
PRIMARY KEY CLUSTERED 
(
 [U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]


CREATE TABLE [dbo].[SMPOD](
 [U_ID] [uniqueidentifier] NOT NULL,
 [BUYER_CD] [nvarchar](10) NULL,
 [SEQ_NO] [numeric](5, 0) NULL,
 [BPART_NO] [nvarchar](20) NULL,
 [SPART_NO] [nvarchar](20) NULL,
 [DESCRIPTION] [nvarchar](100) NULL,
 [BRAND] [nvarchar](30) NULL,
 [REF_NO1] [nvarchar](30) NULL,
 [REF_NO2] [nvarchar](30) NULL,
 [REF_NO3] [nvarchar](30) NULL,
 [QTY] [numeric](12, 0) NULL,
 [QTYU] [nvarchar](3) NULL,
 [OQTY] [numeric](12, 0) NULL,
 [DQTY] [numeric](12, 0) NULL,
 [BQTY] [numeric](12, 0) NULL,
 [REMARK] [nvarchar](100) NULL,
 [BKQTY] [numeric](12, 0) NULL,
 [PO_NO] [nvarchar](20) NULL,
 [U_FID] [uniqueidentifier] NULL,
 [CREATE_DATE] [datetime] NULL,
 [MODIFY_DATE] [datetime] NULL,
 [SUPPLIER_CD] [nvarchar](10) NULL,
PRIMARY KEY CLUSTERED 
(
 [U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
 /**********END KING的  已加***********/

 /**********ADD BY FISH 2016/3/3 16:25***********/
 ALTER TABLE SMQTD ALTER COLUMN REMARK NVARCHAR(500);
 ALTER TABLE SMRQM ADD REGION NVARCHAR(2);
 /**********END BY FISH 2016/3/3 16:25***********/

 /**********ADD BY Tim 2016/3/4 16:25***********/
 ALTER TABLE TPVPORT ADD TRUCK_PORT NVARCHAR(6)
 /**********ADD BY Tim 2016/3/4 16:25***********/

 /**********ADD BY Jones 2016/3/4 15:06***********/
 ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, A.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, D.CNTR_NO, D.SEAL_NO1, C.U_FID AS PU_FID, A.INCOTERM, A.PAY_TERM_CD,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDN AS B ON A.DN_NO = B.DN_NO LEFT OUTER JOIN
                            dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

GO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   D.CNTR_NO, D.SEAL_NO1, A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO
             LEFT JOIN SMRV D ON D.SHIPMENT_ID=A.SHIPMENT_ID

GO


ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.PAY_TERM_CD, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       D.CNTR_NO, D.SEAL_NO1, B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

GO


ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.PAY_TERM_CD, A.PAY_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, --B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       D.CNTR_NO, D.SEAL_NO1,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID






GO


ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID,
       D.CNTR_NO, D.SEAL_NO1,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID


GO


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.PAY_TERM_CD, A.PAY_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       D.CNTR_NO, D.SEAL_NO1,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID


GO
 /**********END BY Jones 2016/3/4 15:06***********/

  /**********add BY fish 2016/3/7 21:44***********/
  ALTER TABLE SYS_ACCT ALTER COLUMN U_PASSWORD NVARCHAR(100);
  /**********END BY fish 2016/3/7 21:44***********/

  /**********add BY fish 2016/3/8 16:26***********/
  ALTER TABLE SYS_ACCT ALTER COLUMN U_PASSWORD NVARCHAR(100);
  ALTER TABLE SYS_ACCT ADD IS_MD5 NVARCHAR(1);

  ALTER TABLE SMRQM ALTER COLUMN GWU NVARCHAR(5);
  /**********END BY fish 2016/3/8 16:26***********/  /**********END BY fish 2016/3/7 21:44***********/

/**********add BY Tim 2016/3/8 21:44***********/
	ALTER TABLE SMRV ADD TRAN_TYPE NVARCHAR(1)
	ALTER TABLE SMRV ADD CARGO_TYPE NVARCHAR(1)
	ALTER TABLE SMRV ADD CUT_PORT_DATE DATE
/**********END BY Tim 2016/3/8 21:44***********/


/**********add BY Tim 2016/3/10 21:44***********/
UPDATE SYS_ROLE_OBJ_PMS SET FOBJ_ID = REPLACE(FOBJ_ID, 'SYS_', '');
/**********END BY Tim 2016/3/10 21:44***********/

/**********add BY Tim 2016/3/10 21:44***********/
ALTER TABLE SMSIM ADD PART_HEADER NVARCHAR(20)
ALTER VIEW V_CMSUMMARY AS
SELECT dbo.SMDN.APPROVE_TO
	,dbo.SMDN.SHIPMENT_ID
	,SMSM_1.STATUS
	,dbo.SMDN.GROUP_ID
	,dbo.SMDN.CMP
	,dbo.SMDN.DN_NO
	,dbo.SMDNP.U_ID
	,SMSM_1.SHIPMENT_INFO
	,dbo.SMDNP.IPART_NO
	,dbo.SMDNP.JOB_NO
	,dbo.SMDNP.JQTY
	,dbo.SMDNP.PQTY
	,dbo.SMDNP.CNTR_STD_QTY
	,SMSM_1.CNT_NUMBER
	,SMSM_1.CNT_TYPE
	,dbo.SMDNP.PRODUCT_LINE
	,dbo.SMDNP.IQTY
	,dbo.SMDNP.WQTY
	,SMSM_1.TORDER
	,(
		SELECT TOP (1) dbo.SMSMPT.PARTY_NO
		FROM dbo.SMSM
		INNER JOIN dbo.SMSMPT ON dbo.SMSM.SHIPMENT_ID = dbo.SMSMPT.SHIPMENT_ID
		WHERE (dbo.SMSMPT.PARTY_TYPE = 'FS')
		) AS CA_NO
	,(
		SELECT TOP (1) SMSMPT_3.PARTY_NAME
		FROM dbo.SMSM AS SMSM_4
		INNER JOIN dbo.SMSMPT AS SMSMPT_3 ON SMSM_4.SHIPMENT_ID = SMSMPT_3.SHIPMENT_ID
		WHERE (SMSMPT_3.PARTY_TYPE = 'FS')
		) AS CA_NM
	,(
		SELECT TOP (1) SMSMPT_2.PARTY_NO
		FROM dbo.SMSM AS SMSM_3
		INNER JOIN dbo.SMSMPT AS SMSMPT_2 ON SMSM_3.SHIPMENT_ID = SMSMPT_2.SHIPMENT_ID
		WHERE (SMSMPT_2.PARTY_TYPE = 'CR')
		) AS TK_NO
	,(
		SELECT TOP (1) SMSMPT_1.PARTY_NAME
		FROM dbo.SMSM AS SMSM_2
		INNER JOIN dbo.SMSMPT AS SMSMPT_1 ON SMSM_2.SHIPMENT_ID = SMSMPT_1.SHIPMENT_ID
		WHERE (SMSMPT_1.PARTY_TYPE = 'CR')
		) AS TK_NM
	,dbo.SMDNP.OPART_NO
	,dbo.SMDNP.QTYU
	,dbo.SMDNP.UNIT_PRICE1
	,dbo.SMDNP.PKG_NUM
	,dbo.SMDNP.CBM
	,dbo.SMDNP.GW
	,dbo.SMDNP.DOWN_FLAG
	,dbo.SMDNP.U_ID AS Expr1
FROM dbo.SMDN
INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID
/**********END BY Tim 2016/3/10 21:44***********/


/**********add BY Jones 2016/3/14 16:30***********/
ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, --C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
GO
/**********END BY Jones 2016/3/14 16:30***********/

/**********add BY Jones 2016/3/14 16:46***********/
ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.PAY_TERM_CD, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       D.CNTR_NO, D.SEAL_NO1, B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO, B.PLA_SIZE, A.CMDTY_CD, A.CMDTY_DESCP,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

GO
/**********END BY Jones 2016/3/14 16:46***********/

/**********add BY Jones 2016/3/14 17:18***********/
ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.PAY_TERM_CD, A.PAY_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, B.VEN_NM, --B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       D.CNTR_NO, D.SEAL_NO1, B.TTL_NW, B.TTL_GW, B.TTL_CBM, A.CUR, A.TTL_CBM AS M_TTL_CBM, A.TTL_GW AS M_TTL_GW,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

GO
/**********END BY Jones 2016/3/14 17:18***********/

/**********add BY Jones 2016/3/14 17:24***********/
ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID,
       D.CNTR_NO, D.SEAL_NO1, A.TTL_VALUE,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

GO
/**********END BY Jones 2016/3/14 17:24***********/

/**********add BY Jones 2016/3/14 17:30***********/
ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.PAY_TERM_CD, A.PAY_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       D.CNTR_NO, D.SEAL_NO1, A.TTL_VALUE,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID
GO
/**********END BY Jones 2016/3/14 17:30***********/


/**********add BY Jones 2016/3/14 17:37***********/
ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   D.CNTR_NO, D.SEAL_NO1, A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD, A.TTL_VALUE,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO
             LEFT JOIN SMRV D ON D.SHIPMENT_ID=A.SHIPMENT_ID
GO

/**********END BY Jones 2016/3/14 17:37***********/

/**********add BY Jones 2016/3/14 22:48***********/
ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID

GO
/**********END BY Jones 2016/3/14 22:48***********/


/**********ADD BY Tim 2016/3/14 17:37***********/
ALTER TABLE SMIND ADD TTL_NW NUMERIC(12,3)
ALTER TABLE SMIND ADD TTL_GW NUMERIC(12,3)
ALTER TABLE SMIND ADD TTL_CBM NUMERIC(12,4)
ALTER TABLE SMIND ADD VEN_NM NVARCHAR(100)

ALTER VIEW V_CMSUMMARY AS
SELECT dbo.SMDN.APPROVE_TO
	,dbo.SMDN.SHIPMENT_ID
	,SMSM_1.COMBINE_INFO
	,SMSM_1.STATUS
	,dbo.SMDN.GROUP_ID
	,dbo.SMDN.CMP
	,dbo.SMDN.DN_NO
	,dbo.SMDNP.U_ID
	,dbo.SMDN.CARGO_TYPE
	,SMSM_1.CUT_PORT_DATE
	,SMSM_1.PORT_DATE
	,SMSM_1.TRAN_TYPE
	,SMSM_1.STATE
	,SMSM_1.SHIPMENT_INFO
	,SMSM_1.Remark
	,SMSM_1.CUR
	,dbo.SMDNP.IPART_NO
	,dbo.SMDNP.JOB_NO
	,dbo.SMDNP.JQTY
	,dbo.SMDNP.PQTY
	,dbo.SMDNP.QTY
	,dbo.SMDN.SEAL_QTY
	,SMSM_1.CNT_NUMBER
	,SMSM_1.CNT_TYPE
	,dbo.SMDNP.PRODUCT_LINE
	,dbo.SMDNP.IQTY
	,dbo.SMDNP.WQTY
	,dbo.SMDNP.CNTR_STD_QTY
	,SMSM_1.TORDER
	,(
		SELECT TOP (1) dbo.SMSMPT.PARTY_NO
		FROM dbo.SMSMPT
		WHERE (dbo.SMSMPT.PARTY_TYPE = 'FS' AND SHIPMENT_ID=SMSM_1.SHIPMENT_ID)
		) AS CA_NO
	,(
		SELECT TOP (1) SMSMPT.PARTY_NAME
		FROM dbo.SMSMPT
		WHERE (dbo.SMSMPT.PARTY_TYPE = 'FS' AND SHIPMENT_ID=SMSM_1.SHIPMENT_ID)
		) AS CA_NM
	,(
		SELECT TOP (1) SMSMPT.PARTY_NO
		FROM dbo.SMSMPT
		WHERE (dbo.SMSMPT.PARTY_TYPE = 'CR' AND SHIPMENT_ID=SMSM_1.SHIPMENT_ID)
		) AS TK_NO
	,(
		SELECT TOP (1) SMSMPT.PARTY_NAME
		FROM dbo.SMSMPT
		WHERE (dbo.SMSMPT.PARTY_TYPE = 'CR' AND SHIPMENT_ID=SMSM_1.SHIPMENT_ID)
		) AS TK_NM
	,dbo.SMDNP.OPART_NO
	,dbo.SMDNP.QTYU
	,dbo.SMDNP.UNIT_PRICE1
	,dbo.SMDNP.UNIT_PRICE1 AS PRICE
	,dbo.SMDNP.PKG_NUM
	,dbo.SMDNP.CBM
	,dbo.SMDNP.GW
	,dbo.SMDNP.DOWN_FLAG
	,dbo.SMDNP.U_ID AS Expr1
FROM dbo.SMDN
INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID AND (TORDER='S' OR TORDER='C')

ALTER TABLE SMRV ADD CNT_NUMBER NUMERIC(5,0)
ALTER TABLE SMRV ADD CNT_TYPE NVARCHAR(5)
/**********END BY Tim 2016/3/14 17:37***********/

/**********ADD BY Tim 2016/3/15 17:37***********/
ALTER TABLE SMRV ADD TARE_WEIGHT NUMERIC(12,3)
ALTER TABLE SMRV ADD TWU NVARCHAR(3)
ALTER TABLE SMRV ADD TTL_VGM NUMERIC(12,3)
/**********END BY Tim 2016/3/15 17:37***********/

/**********add BY Will 2016/3/15 18:40 ***********/
ALTER TABLE APPROVE_RECORD ADD NOTICE_MAIL NVARCHAR(300);
ALTER TABLE APPROVE_RECORD ADD NOTICE_TO NVARCHAR(30);
ALTER TABLE SMDN ADD APPROVE_USER NVARCHAR(30);
ALTER TABLE SMSM ALTER COLUMN CUT_PORT_DATE DATETIME;
ALTER TABLE SMSM ALTER COLUMN RCV_DATE DATETIME;
ALTER TABLE SMSM ALTER COLUMN CUSTOMS_DATE DATETIME;
ALTER TABLE SMSM ALTER COLUMN PORT_RLS_DATE DATETIME;
ALTER TABLE SMDN ADD SH_CD NVARCHAR(10);
ALTER TABLE SMDN ADD SH_NM NVARCHAR(70);
ALTER TABLE SMDN ADD CS_CD NVARCHAR(10);
ALTER TABLE SMDN ADD CS_NM NVARCHAR(70);
ALTER TABLE SMDN ADD NT_CD NVARCHAR(10);
ALTER TABLE SMDN ADD NT_NM NVARCHAR(70);
/**********End BY Will 2016/3/15 18:40 ***********/

/**********add BY FISH 2016/3/15 20:40 ***********/
ALTER TABLE TKBL ADD FC_CD NVARCHAR(10);
ALTER TABLE TKBL ADD FC_NM NVARCHAR(70);
/**********End BY FISH 2016/3/15 20:40 ***********/

/**********add BY FISH 2016/3/16 11:41 ***********/
 ALTER TABLE  APPROVE_RECORD ALTER COLUMN APPROVE_BY NVARCHAR(30);
 /**********End BY FISH 2016/3/16 11:41 ***********/

/**********add BY TIM 2016/3/16 20:40 ***********/
ALTER TABLE SMRV ADD DRIVER_ID NVARCHAR(30);
ALTER TABLE BSTRUCKD ADD DRIVER_ID NVARCHAR(30);

CREATE TABLE [dbo].[BSCAA](
	[U_ID] [nvarchar](50) NOT NULL,
	[U_FID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[CARRIER] [nvarchar](10) NULL,
	[AREA] [nvarchar](5) NULL,
	[PORT] [nvarchar](5) NULL,
	[PORT_DESCP] [nvarchar](70) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_BSCAA] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC,
	[U_FID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[SMFSC](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[CMP_NM] [nvarchar](70) NULL,
	[CARRIER] [nvarchar](10) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[AREA] [nvarchar](5) NULL,
	[EFFECT_DATE] [date] NULL,
	[GP20] [numeric](18, 2) NULL,
	[GP40] [numeric](18, 2) NULL,
	[HQ40] [numeric](18, 2) NULL,
	[OTH_RATE] [numeric](18, 2) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMFSC] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/**********End BY TIM 2016/3/16 20:40 ***********/

/**********add BY fish 2016/3/16 22:40 ***********/
CREATE TABLE [SMGSTD](
	[U_ID] [nvarchar](36) NOT NULL,
	[U_FID] [nvarchar](36) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STS_CD] [nvarchar](5) NULL,
	[STS_DESCP] [nvarchar](30) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[VIEW_OP] [nvarchar](1) NULL,
	[UPLOAD_OP] [nvarchar](1) NULL,
 CONSTRAINT [PK_SMGSTD] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [SMGSTM](
	[U_ID] [nvarchar](36) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[PARTY_TYPE] [nvarchar](10) NULL,
	[PARTY_DESCP] [nvarchar](30) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMGSTM] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/**********End BY fish 2016/3/16 22:40 ***********/



/**********add BY Harry 2016/3/17 15:20 ***********/

INSERT INTO BSCODE_KIND(GROUP_ID, CD_TYPE, CD_DESCP,CMP,STN)
VALUES ('TPV','AST','異常種類','FQ','*');

INSERT INTO BSCODE_KIND(GROUP_ID, CD_TYPE, CD_DESCP,CMP,STN)
VALUES ('TPV','ASR','異常原因','FQ','*');

CREATE TABLE [dbo].[SMBID](
	[U_ID] [uniqueidentifier] NOT NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[DEBIT_NO] [nvarchar](20) NULL,
	[VAT_NO] [nvarchar](50) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[BILL_TO] [nvarchar](10) NULL,
	[BL_NO] [nvarchar](20) NULL,
	[STATUS] [nvarchar](1) NULL,
	[CHG_CD] [nvarchar](10) NULL,
	[CHG_DESCP] [nvarchar](30) NULL,
	[OCUR] [nvarchar](3) NULL,
	[QUNIT_PRICE] [numeric](18,6) NULL,
	[QCHG_UNIT] [nvarchar](3) NULL,
	[QQTY] [numeric](12,4) NULL,
	[QAMT] [numeric](18,2) NULL,
	[QTAX] [numeric](5,2) NULL,
	[CUR] [nvarchar](3) NULL,
	[UNIT_PRICE] [numeric](18,6) NULL,
	[CHG_UNIT] [nvarchar](3) NULL,
	[QTY] [numeric](12,4) NULL,
	[BAMT] [numeric](18,2) NULL,
	[TAX] [numeric](5,2) NULL,
	[REMARK] [nvarchar](50) NULL,
	[CHECK_DESCP] [nvarchar](30) NULL,
	[COST_CENTER] [nvarchar](10) NULL,
	[PROFIT_CENTER] [nvarchar](10) NULL,
 CONSTRAINT [PK_SMBID] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
) ON [PRIMARY])

/**********End BY Harry 2016/3/17 15:20 ***********/
/**********begin by will 2016/3/17 18:59**********/
ALTER TABLE SMSM ADD CAR_TYPE1 NVARCHAR(10);
ALTER TABLE SMSM ADD CAR_TYPE2 NVARCHAR(10);
ALTER TABLE SMSM ADD CAR_QTY numeric(6,0);
ALTER TABLE SMSM ADD CAR_QTY1 numeric(6,0);
ALTER TABLE SMSM ADD CAR_QTY2 numeric(6,0);
/**********end by will 2016/3/17 18:59**********/
/**********START BY TIM 2016/3/18 15:20 ***********/
ALTER TABLE SMRV ADD PORT_DATE DATETIME
/**********End BY TIM 2016/3/18 15:20 ***********/

/**********add BY Harry 2016/3/18 11:40 ***********/
ALTER TABLE SMPOD ADD SUPPLIER_NM NVARCHAR(70)
/**********end by will 2016/3/18 11:40**********/

/**********begin by king 2016/3/18 13:43**********/
  ALTER TABLE [SYS_LAYOUT]
  ALTER COLUMN [ID] NVARCHAR(50)
/**********end by king 2016/3/18 13:43**********/

/**********add BY Will 2016/3/20 16:26 ***********/
ALTER TABLE SMDN ADD TRANSACTE_MODE NVARCHAR(2);
ALTER TABLE SMSM ADD TRANSACTE_MODE NVARCHAR(2);
/**********end BY Will 2016/3/20 16:26 ***********/

/**********add BY Tim 2016/3/21 16:26 ***********/
ALTER TABLE SMINM ADD FOB_VALUE NUMERIC(18,2)
/**********end BY Tim 2016/3/21 16:26 ***********/

/**********add BY Will 2016/3/21 16:26 ***********/
CREATE TABLE [dbo].[SMCUFT](
	[U_ID] [nvarchar](50) NOT NULL,
	[U_FID] [nvarchar](50) NOT NULL,
	[DN_NO] [nvarchar](20) NULL,
	[L] [numeric](10, 2) NULL,
	[W] [numeric](10, 2) NULL,
	[H] [numeric](10, 2) NULL,
	[PKG] [numeric](10, 2) NULL,
	[PKG_UNIT] [nvarchar](10) NULL,
	[CUFT] [numeric](16, 4) NULL,
	[VW] [numeric](16, 4) NULL,
 CONSTRAINT [PK_SMCUFT] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/**********end BY Will 2016/3/21 16:26 ***********/


/**********end BY Will 2016/3/21 16:26 ***********/

/**********add BY King 2016/3/22 09:57 ***********/
  ALTER TABLE BSCITY
  ALTER COLUMN GM NVARCHAR(6)

  UPDATE bscity SET
  GM = null

  UPDATE bscity SET
  GM = ISNULL((SELECT TOP 1 [countryData].[UTC time offset] FROM [countryData] WHERE [countryData].[Country or territory] LIKE '%'+PORT_NM+'%'  ),0)
  UPDATE bscity SET
  GM = (SELECT TOP 1 [countryData].[UTC time offset] FROM [countryData] WHERE [countryData].[Country or territory] LIKE '%'+(SELECT TOP 1 BSCNTY.CNTRY_NM FROM BSCNTY WHERE BSCNTY.CNTRY_CD = bscity.CNTRY_CD )+'%'  )
  WHERE GM is null
  /**********end BY King 2016/3/22 09:57 ***********/
/**********end BY Will 2016/3/21 16:26 ***********/

/**********add BY Harry 2016/3/18 11:40 ***********/
CREATE TABLE [dbo].[EXPRELA](
	[U_ID] [uniqueidentifier] NULL,
	[EXP_TYPE] [nvarchar](3) NULL,
	[EXP_REASON] [nvarchar](10) NULL,
	[EXP_DESCP] [nvarchar](100) NULL
) ON [PRIMARY]
/**********end BY Harry 2016/3/21 11:40 ***********/



INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('RFQ_NO', 'XM', '*', 'TPV', '2015-12-15 14:35', ';XM;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('RFQ_NO',1,'20151214','CMP','公司',2,'XM','XM','*','TPV'),
('RFQ_NO',2,'20151214','CONST','常量',1,'A','XM','*','TPV'),
('RFQ_NO',3,'20151214','YY','年度',2,'YY','XM','*','TPV'),
('RFQ_NO',4,'20151214','MM','月份',2,'MM','XM','*','TPV'),
('RFQ_NO',5,'20151214','NO','流水號',6,NULL,'XM','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('RFQ_NO', '询价自动编号', '20151214', 'XM', '*', 'TPV')

UPDATE SCS_AUTONO_ITEM SET CODE_CONTENT='Q' WHERE RULE_CODE='QUOT_NO' AND CODE='CONST'
UPDATE SCS_AUTONO_ITEM SET CODE_CONTENT='B' WHERE RULE_CODE='SMRV_NO' AND CODE='CONST'

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('QUOT_NO', 'XM', '*', 'TPV', '2016-01-01 14:35', ';XM;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('QUOT_NO',1,'20160101','CMP','公司',2,'XM','XM','*','TPV'),
('QUOT_NO',2,'20160101','CONST','常量',1,'Q','XM','*','TPV'),
('QUOT_NO',3,'20160101','YY','年度',2,'YY','XM','*','TPV'),
('QUOT_NO',4,'20160101','MM','月份',2,'MM','XM','*','TPV'),
('QUOT_NO',5,'20160101','NO','流水號',6,NULL,'XM','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('QUOT_NO', '询价自动编号', '20160101', 'XM', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('BAT_NO', 'FQ', '*', 'TPV', '2016-01-01 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('BAT_NO',1,'20160101','CMP','公司',2,'FQ','FQ','*','TPV'),
('BAT_NO',2,'20160101','CONST','常量',2,'LT','FQ','*','TPV'),
('BAT_NO',3,'20160101','YY','年度',2,'YY','FQ','*','TPV'),
('BAT_NO',4,'20160101','MM','月份',2,'MM','FQ','*','TPV'),
('BAT_NO',5,'20160101','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('BAT_NO', '預約批次號', '20160101', 'FQ', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('TK_NO', 'FQ', '*', 'TPV', '2016-01-01 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('TK_NO',1,'20160101','CMP','公司',2,'FQ','FQ','*','TPV'),
('TK_NO',2,'20160101','CONST','常量',2,'ET','FQ','*','TPV'),
('TK_NO',3,'20160101','YY','年度',2,'YY','FQ','*','TPV'),
('TK_NO',4,'20160101','MM','月份',2,'MM','FQ','*','TPV'),
('TK_NO',5,'20160101','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('TK_NO', '預約批次號', '20160101', 'FQ', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('RV_NO', 'FQ', '*', 'TPV', '2016-01-01 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('RV_NO',1,'20160101','CMP','公司',2,'FQ','FQ','*','TPV'),
('RV_NO',2,'20160101','CONST','常量',2,'R','FQ','*','TPV'),
('RV_NO',3,'20160101','YY','年度',2,'YY','FQ','*','TPV'),
('RV_NO',4,'20160101','MM','月份',2,'MM','FQ','*','TPV'),
('RV_NO',5,'20160101','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('RV_NO', '預約批次號', '20160101', 'FQ', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('SMRV_NO', 'FQ', '*', 'TPV', '2016-01-01 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('SMRV_NO',1,'20160101','CMP','公司',2,'FQ','FQ','*','TPV'),
('SMRV_NO',2,'20160101','CONST','常量',2,'B','FQ','*','TPV'),
('SMRV_NO',3,'20160101','YY','年度',2,'YY','FQ','*','TPV'),
('SMRV_NO',4,'20160101','MM','月份',2,'MM','FQ','*','TPV'),
('SMRV_NO',5,'20160101','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('SMRV_NO', '預約批次號', '20160101', 'FQ', '*', 'TPV')


/**********add BY FISH 2016/3/22 15:40 ***********/
ALTER TABLE EVEN_TASK ALTER COLUMN MAIL_TO NVARCHAR(500);
ALTER TABLE MAIL_LOG ALTER COLUMN MAIL_TO NVARCHAR(500);
/**********end BY FISH 2016/3/22 15:40 ***********/


/**********add BY Harry 2016/3/22 19:05 ***********/

ALTER TABLE EXPRELA ADD MODIFY_BY nvarchar(30)
ALTER TABLE EXPRELA ADD	MODIFY_DATE datetime
ALTER TABLE EXPRELA ADD CREATE_BY nvarchar(30)
ALTER TABLE EXPRELA ADD CREATE_DATE datetime

/**********end BY Harry 2016/3/22 19:05 ***********/


/**********add BY Jones 2016/3/25 17:23 ***********/

ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.DN_NO=A.DN_NO) DN_AMT
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD


GO


/**********add BY Harry 2016/3/23 19:05 ***********/
ALTER TABLE SMRV ADD LDRIVER_ID NVARCHAR(30) 
ALTER TABLE SMRVM ADD BAT_NO NVARCHAR(20)
ALTER TABLE SMRV ADD EPT_IDATE datetime
ALTER TABLE SMRV ADD EPT_ODATE datetime
ALTER TABLE SMINM
ALTER COLUMN PLTU NVARCHAR(20)
/**********end BY Harry 2016/3/23 19:05 ***********/



/***********add BY Jones 2016/3/26 17:23 ***********/

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, A.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, D.CNTR_NO, D.SEAL_NO1, C.U_FID AS PU_FID, A.INCOTERM, A.PAY_TERM_CD, C.PART_NO,
                            D.CNTY_TYPE,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDN AS B ON A.DN_NO = B.DN_NO LEFT OUTER JOIN
                            dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID
GO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   D.CNTR_NO, D.SEAL_NO1, A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD, A.TTL_VALUE, D.CNTY_TYPE,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO
             LEFT JOIN SMRV D ON D.SHIPMENT_ID=A.SHIPMENT_ID

GO


/***********END BY Jones 2016/3/26 17:23 ***********/

**********Begin BY Will 2016/3/27 11:23 ***********/
ALTER TABLE SMDN ADD MEMO NVARCHAR(300);
ALTER TABLE SMSM ADD COMBIN_SHIPMENT NVARCHAR(120);
**********END BY Will 2016/3/27 11:23 ***********/


/**********add BY Harry 2016/3/28 11:20 ***********/
ALTER TABLE TMEXP ADD EXP_CD nvarchar(10)
/**********end BY Harry 2016/3/28 11:20 ***********/


**********add BY Jones 2016/3/28 22:54 ***********/
ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.DN_NO=A.DN_NO) AMOUNT1,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD

**********end BY Jones 2016/3/28 22:54 ***********/


/**********add BY Harry 2016/3/29 17:00 ***********/
ALTER TABLE SMPOM ADD GROUP_ID nvarchar(10)
ALTER TABLE SMPOD ADD SPQTY numeric(12,0)
/**********end BY Harry 2016/3/29 17:00 ***********/
/**
 * add by Tim 2015.03.29 15:30
 */
ALTER TABLE SMPTY ADD PIC NVARCHAR(200)


/**********add BY Harry 2016/3/29 18:00 ***********/
ALTER TABLE TMEXP ADD EXP_OBJ nvarchar(50)
ALTER TABLE TMEXP ADD EXP_REASON nvarchar(10)
ALTER TABLE TMEXP ADD EXP_DESCP nvarchar(100)
/**********end BY Harry 2016/3/29 18:00 ***********/


/**********add BY Will 2016/3/30 16:40 ***********/
ALTER TABLE SMDN ADD COST_CENTER NVARCHAR(20); 
ALTER TABLE SMSM ADD COST_CENTER NVARCHAR(20); 
ALTER TABLE SMSM ADD PGW NUMERIC(18,2);
ALTER TABLE SMSM ADD PCBM NUMERIC(18,2);
/**********end BY Will 2016/3/30 16:40 ***********/


/**********add BY Harry 2016/3/30 18:00 ***********/
ALTER TABLE EXPRELA ADD IS_RELIEVE nvarchar(1)
/**********end BY Harry 2016/3/30 18:00 ***********/


/**********add BY Jones 2016/3/30 18:09 ***********/

ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.DN_NO=A.DN_NO) AMOUNT1,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD

/**********end BY Jones 2016/3/30 18:09 ***********/

/**********add BY Tim 2016/04/01 18:09 ***********/
CREATE TABLE [dbo].[SMCC](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[COMPANY] [nvarchar](10) NULL,
	[COST_CENTER] [nvarchar](10) NULL,
	[SHORT_DESCP] [nvarchar](20) NULL,
	[DESCP] [nvarchar](70) NULL,
	[PRINCIPAL] [nvarchar](30) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMCC] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/**********add BY Tim 2016/04/01 18:09 ***********/

/**********add BY Jones 2016/04/01 18:02 ***********/

ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PART_ADDR2, B.PART_ADDR3, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.DN_NO=A.DN_NO) AMOUNT1,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD

/**********add BY Jones 2016/04/01 18:02 ***********/

/**********add BY Jones 2016/04/03 14:02 ***********/

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, A.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, D.CNTR_NO, D.SEAL_NO1, C.U_FID AS PU_FID, A.INCOTERM, A.PAY_TERM_CD, C.PART_NO,
                            D.CNTY_TYPE, B.MEMO,
                                (SELECT          TOP (1) PIC
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PIC,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR3, 
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
                                (SELECT          TOP (1) PART_ADDR1 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.STN )) TITLE_ADDR1,
	                            (SELECT          TOP (1) PARTY_NAME 
	                              FROM               dbo.SMPTY 
	                              WHERE           (PARTY_NO=B.STN )) TITLE_NAME
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDN AS B ON A.DN_NO = B.DN_NO LEFT OUTER JOIN
                            dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, A.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   D.CNTR_NO, D.SEAL_NO1, A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD, A.TTL_VALUE, D.CNTY_TYPE,
	   C.MEMO, 
	   (SELECT TOP (1) PIC FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO
             LEFT JOIN SMRV D ON D.SHIPMENT_ID=A.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.PAY_TERM_CD, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       D.CNTR_NO, D.SEAL_NO1, B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO, B.PLA_SIZE, A.CMDTY_CD, A.CMDTY_DESCP,
       (SELECT TOP 1 PIC FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS PIC,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.PAY_TERM_CD, A.PAY_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, B.VEN_NM, --B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       D.CNTR_NO, D.SEAL_NO1, B.TTL_NW, B.TTL_GW, B.TTL_CBM, A.CUR, A.TTL_CBM AS M_TTL_CBM, A.TTL_GW AS M_TTL_GW,
(SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) PIC,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID,
       D.CNTR_NO, D.SEAL_NO1, A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) PIC,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.PAY_TERM_CD, A.PAY_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       D.CNTR_NO, D.SEAL_NO1, A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) PIC,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

/**********add BY Jones 2016/04/03 14:02 ***********/

/******** add by will 2016/04/05 15:26********/
ALTER TABLE SMSM ADD BROKER_TIMES NUMERIC(6,0);
ALTER TABLE SMSM ADD BOOKING_TIMES NUMERIC(6,0);
/******** end by will 2016/04/05 15:26********/

/**********add BY Jones 2016/04/03 14:02 ***********/

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, A.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, D.CNTR_NO, D.SEAL_NO1, C.U_FID AS PU_FID, A.INCOTERM, A.PAY_TERM_CD, C.PART_NO,
                            D.CNTY_TYPE, B.MEMO, A.TTL_PLT, 
                                (SELECT          TOP (1) CD_DESCP
                                  FROM               dbo.BSCODE
                                  WHERE           CD = A.PLTU) AS TTL_PLT_DESCP,
                                (SELECT          TOP (1) PIC
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PIC,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR3, 
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
                                (SELECT          TOP (1) PART_ADDR1 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.STN )) TITLE_ADDR1,
	                            (SELECT          TOP (1) PARTY_NAME 
	                              FROM               dbo.SMPTY 
	                              WHERE           (PARTY_NO=B.STN )) TITLE_NAME
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDN AS B ON A.DN_NO = B.DN_NO LEFT OUTER JOIN
                            dbo.SMRV AS D ON D.SHIPMENT_ID = A.SHIPMENT_ID

/**********end BY Jones 2016/04/03 14:02 ***********/
ALTER TABLE SMDNP ALTER COLUMN UL NVARCHAR(100);


/**********add BY Jones 2016/04/08 16:57 ***********/

ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PART_ADDR2, B.PART_ADDR3, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID=A.SHIPMENT_ID) AMOUNT1,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD

/**********end BY Jones 2016/04/08 16:57 ***********/


CREATE VIEW V_CMEXCEL AS
SELECT '' AS 'USE_DATE',
	PRODUCT_LINE,
	IPART_NO,
	JQTY,
	JOB_NO,
	'' AS RESERVE_HOUR,
	'' AS 'REMARK1',
	'' AS LQTY,
	'' AS 'CARRIER',
	'' AS 'TRUCKER',
	'' AS 'CNT_TYPE',
	'' AS 'CNT_NUMBER',
	DN_NO,
	'' AS 'REMARK2',
	'' AS 'CUST_CD',
	'' AS 'CNTR_NO',
	'' AS 'TRUCK_NO',
	DOWN_FLAG
FROM SMDNP
/**********end BY buru 2016/04/09 18:00 ***********/

ALTER TABLE SMSM ADD ATA_D DATETIME

/**********add BY Tim 2016/04/09 16:57 ***********/
ALTER TABLE SMINM ADD BANK_MSG NVARCHAR(100)
/**********add BY Tim 2016/04/09 16:57 ***********/

/**********add BY Tim 2016/04/10 16:57 ***********/
DROP TABLE IPGOODS
DROP TABLE IPGOODSC
DROP TABLE IPPART
DROP TABLE IPPARTD

DELETE FROM SMINM WHERE CREATE_DATE <= '2016/04/04'
DELETE FROM SMIND WHERE NOT EXISTS  (SELECT 1 FROM SMINM WHERE SMINM.U_ID=SMIND.U_FID)
DELETE FROM SMINP WHERE NOT EXISTS  (SELECT 1 FROM SMINM WHERE SMINM.U_ID=SMINP.U_FID)

DELETE FROM SMRV WHERE CREATE_DATE <= '2016/04/04'
DELETE FROM SMRVD WHERE RESERVE_DATE <= '2016/04/04'
UPDATE SMWHGT SET CNTR_NO='', RESERVE_NO=''
DELETE FROM TKBL WHERE CREATE_DATE<'2016-04-05'
DELETE FROM TKBLST WHERE NOT EXISTS  (SELECT 1 FROM TKBL WHERE TKBL.U_ID=TKBLST.U_ID)
DELETE FROM TKBLPT WHERE NOT EXISTS  (SELECT 1 FROM TKBL WHERE TKBL.U_ID=TKBLPT.U_ID)
DELETE FROM TKBLCNTR WHERE NOT EXISTS  (SELECT 1 FROM TKBL WHERE TKBL.U_ID=TKBLCNTR.JOB_NO)

DELETE FROM TKEVM WHERE CREATE_DATE<'2016-04-05'
DELETE FROM TKEVD WHERE NOT EXISTS (SELECT 1 FROM TKEVM WHERE TKEVM.EVEN_NO=TKEVD.EVEN_NO)

DELETE FROM  MAIL_LOG
DELETE FROM  EVEN_LOG
DELETE FROM  EVEN_TASK WHERE CREATE_DATE<'2016-04-05'

DELETE FROM SMDN WHERE CREATE_DATE <'2016-04-05'
DELETE FROM SMDNP WHERE NOT EXISTS  (SELECT 1 FROM SMDN WHERE SMDN.DN_NO=SMDNP.DN_NO)
DELETE FROM SMDNS WHERE NOT EXISTS  (SELECT 1 FROM SMDN WHERE SMDN.DN_NO=SMDNS.DN_NO)
DELETE FROM SMDNPT  WHERE NOT EXISTS  (SELECT 1 FROM SMDN WHERE SMDN.DN_NO=SMDNPT.DN_NO)
DELETE FROM SMDND WHERE NOT EXISTS  (SELECT 1 FROM SMDN WHERE SMDN.DN_NO=SMDND.DN_NO)
DELETE FROM SMSM WHERE CREATE_DATE <'2016-04-05'
DELETE FROM SMSMPT WHERE NOT EXISTS  (SELECT 1 FROM SMSM WHERE SMSM.SHIPMENT_ID=SMSMPT.SHIPMENT_ID)
DELETE FROM APPROVE_RECORD WHERE CREATE_DATE <'2016-04-05'
/**********add BY Tim 2016/04/10 16:57 ***********/

ALTER TABLE SMINM
ALTER COLUMN CMDTY_CD NVARCHAR(300)
/**********add BY Tim 2016/04/10 16:57 ***********/

/**********add BY FISH 2016/04/11 15:12 ***********/
exec sp_rename 'SMBID.OCUR' ,'QCUR'
/**********add BY FISH 2016/04/11 15:12 ***********/

ALTER TABLE SMDNP ADD INTERFACE_CD NVARCHAR(100);
ALTER TABLE SMWHGT
ALTER COLUMN GATE_NO NVARCHAR(5)
ALTER TABLE SMDNP ADD INTERFACE_CD NVARCHAR(100);


/**********add BY Jones 2016/04/12 10:43 ***********/

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.PAY_TERM_CD, C.PART_NO,
                            A.TTL_PLT,
                                (SELECT          TOP (1) CD_DESCP
                                  FROM               dbo.BSCODE
                                  WHERE           CD = A.PLTU) AS TTL_PLT_DESCP,
                                (SELECT          TOP (1) PIC
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = B.PLANT)
                                  AND              STATUS='U') AS PIC,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR3, 
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
                                (SELECT          TOP (1) PART_ADDR1 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.PLANT )) TITLE_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.PLANT )) TITLE_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.PLANT )) TITLE_ADDR3,     
	                            (SELECT          TOP (1) PARTY_NAME 
	                              FROM               dbo.SMPTY 
	                              WHERE           (PARTY_NO=B.PLANT )) TITLE_NAME,
	                            (SELECT          TOP (1) PARTY_NAME
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_NAME,
	                            (SELECT          TOP (1) PART_ADDR
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR,
	                            (SELECT          TOP (1) PART_ADDR2
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR2,
	                            (SELECT          TOP (1) PART_ADDR3
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR3,
	                            (SELECT          TOP (1) PARTY_NAME
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_NAME,
	                            (SELECT          TOP (1) PART_ADDR
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR,
	                            (SELECT          TOP (1) PART_ADDR2
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR2,
	                            (SELECT          TOP (1) PART_ADDR3
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR3,
	                            (SELECT          TOP (1) CNTRY_NM
	                              FROM               dbo.BSCNTY
	                              WHERE           (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2)
	                              AND              GROUP_ID=A.GROUP_ID
	                              AND              CMP=A.CMP)) AS CNTRY_NM,
	                            (SELECT          TOP (1) MEMO
	                              FROM               dbo.SMDN
	                              WHERE              (DN_NO=A.DN_NO)) AS MEMO,
	                            (SELECT          TOP (1) GOODS      
	                              FROM               dbo.SMDN  
	                              WHERE              (DN_NO=A.DN_NO)) AS DN_GOODS	               
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDNP AS B ON A.DN_NO = B.DN_NO 


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD, A.TTL_VALUE,
	   A.TTL_PLT,
	   (SELECT TOP (1) PIC FROM SMPTY WHERE PARTY_NO=A.SHPR_CD AND STATUS='U') PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDNP C ON A.DN_NO=C.DN_NO

/**********end BY Jones 2016/04/12 10:43 ***********/


/**********add BY Tim 2016/04/12 10:43 ***********/
ALTER TABLE SMWHGT
ALTER COLUMN GATE_NO NVARCHAR(5)

ALTER TABLE SMBID ADD U_FID NVARCHAR(50)

ALTER TABLE SMINM
ALTER COLUMN DLV_WAY NVARCHAR(30)
/**********end BY Tim 2016/04/12 10:43 ***********//**********end BY Jones 2016/04/12 10:43 ***********/

/**********add BY FISH 2016/04/12 19:22 ***********/
ALTER TABLE SMBID ADD U_FID uniqueidentifier
ALTER TABLE SMBID ALTER COLUMN QCHG_UNIT NVARCHAR(10)
ALTER TABLE SMBID ALTER COLUMN CHG_UNIT NVARCHAR(10)
/**********end BY FISH 2016/04/12 19:22 ***********/


/**********add BY Jones 2016/04/13 10:50 ***********/

ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD, A.TTL_VALUE,
	   A.TTL_PLT,
	   (SELECT TOP (1) PIC FROM SMPTY WHERE PARTY_NO=C.PLANT AND STATUS='U') PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.PLANT ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDNP C ON A.DN_NO=C.DN_NO

ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT C.PLANT, A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.PAY_TERM_CD, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO, B.PLA_SIZE, A.CMDTY_CD, A.CMDTY_DESCP,
       (SELECT TOP 1 PIC FROM dbo.SMPTY WHERE PARTY_NO = C.PLANT AND STATUS='U') AS PIC,
       (SELECT TOP 1 PARTY_NAME FROM dbo.SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMDNP AS C ON C.DN_NO = A.DN_NO

ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.PAY_TERM_CD, A.PAY_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, B.VEN_NM, --B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       B.TTL_NW, B.TTL_GW, B.TTL_CBM, A.CUR, A.TTL_CBM AS M_TTL_CBM, A.TTL_GW AS M_TTL_GW,
(SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.PLANT AND STATUS='U') PIC,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_NAME,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR3,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDNP C ON C.DN_NO = A.DN_NO

ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID,
       A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.PLANT AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDNP C ON C.DN_NO = A.DN_NO

ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.PAY_TERM_CD, A.PAY_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.PLANT AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.PLANT)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.PLANT)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDNP C ON C.DN_NO = A.DN_NO

/**********end BY Jones 2016/04/13 10:50 ***********/


/**********add BY HARRY 2016/04/13 16:50 ***********/
CREATE TABLE [dbo].[SMBD](
 [U_ID] [uniqueidentifier] NOT NULL,
 [GROUP_ID] [nvarchar](10) NULL,
 [CMP] [nvarchar](10) NULL,
 [STN] [nvarchar](10) NULL,
 [DEP] [nvarchar](10) NULL,
 [DN_NO] [nvarchar](20) NULL,
 [ETD] [datetime] NULL,
 [COMBINE_INFO] [nvarchar](100) NULL,
 [SHIPMENT_ID] [nvarchar](20) NULL,
 [STATUS] [nvarchar](1) NULL,
 [GOODS] [nvarchar](300) NULL,
 [MARKS] [nvarchar](300) NULL,
 [INSTRUCTION] [nvarchar](300) NULL,
 [PICKUP_WMS][nvarchar](10) NULL,
 [PICKUP_WMS_NM][nvarchar](70) NULL,
 [PICKUP_WMS_DATE] [datetime] NULL,
 [QTY] [numeric](12, 0) NULL,
 [QTYU][nvarchar](3) NULL,
 [NW] [numeric](18, 2) NULL,
 [GW] [numeric](18, 2) NULL,
 [GWU][nvarchar](1) NULL,
 [CBM] [numeric](18, 2) NULL,
 [TRAN_TYPE] [nvarchar](1) NULL,
 [TRUCK_TYPE] [nvarchar](10) NULL,
 [CARGO_TYPE] [nvarchar](10) NULL,
 [SHPR_CD] [nvarchar](10) NULL,
 [SHPR_NM] [nvarchar](70) NULL,
 [CNEE_CD] [nvarchar](10) NULL,
 [CNEE_NM] [nvarchar](70) NULL,
 [NOTIFY_CD] [nvarchar](10) NULL,
 [NOTIFY_NM] [nvarchar](70) NULL,
 [PICKUP_PORT] [nvarchar](5) NULL,
 [PICKUP_NM] [nvarchar](30) NULL,
 [REGION] [nvarchar](1) NULL,
 [STATE] [nvarchar](5) NULL,
 [DELIVERY_PORT] [nvarchar](5) NULL,
 [DELIVERY_NM] [nvarchar](30) NULL,
 [CREATE_BY] [nvarchar](20) NULL,
 [CREATE_DEP] [nvarchar](10) NULL,
 [CREATE_EXT] [nvarchar](10) NULL,
 [CREATE_DATE] [datetime] NULL,
 [MODIFY_BY] [nvarchar](10) NULL,
 [MODIFY_DATE] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
 [U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]



CREATE TABLE [dbo].[SMBDD](
 [U_ID] [uniqueidentifier] NOT NULL,
 [SHIPMENT_ID] [nvarchar](20) NULL,
 [IPART_NO] [nvarchar](18) NULL,
 [OPART_NO] [nvarchar](18) NULL,
 [GOODS_DESCP] [nvarchar](40) NULL,
 [QTY] [numeric](12, 0) NULL,
 [QTYU][nvarchar](3) NULL,
 [CBM] [numeric](8, 4) NULL,
 [UCBM] [numeric](12, 6) NULL,
 [NW] [numeric](18, 2) NULL,
 [GW] [numeric](18, 2) NULL,
 [GWU][nvarchar](1) NULL,
PRIMARY KEY CLUSTERED 
(
 [U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/**********end BY HARRY 2016/04/13 16:50 ***********/


/**********ADD BY Tim 2016/04/12 19:22 ***********/
ALTER VIEW V_CMEXCEL AS
SELECT '' AS 'USE_DATE',
	SMDNP.PRODUCT_LINE,
	SMDNP.IPART_NO,
	SMDNP.JQTY,
	SMDNP.JOB_NO,
	'' AS RESERVE_HOUR,
	'' AS 'REMARK1',
	'' AS LQTY,
	'' AS 'CARRIER',
	'' AS 'TRUCKER',
	'' AS 'CNT_TYPE',
	'' AS 'CNT_NUMBER',
	SMDNP.DN_NO,
	'' AS 'REMARK2',
	'' AS 'CUST_CD',
	'' AS 'CNTR_NO',
	'' AS 'TRUCK_NO',
	DOWN_FLAG,
	SMSM.TORDER 
FROM SMDNP
INNER JOIN SMSM ON SMSM.DN_NO=SMDNP.DN_NO
WHERE SMSM.TORDER='S'

ALTER TABLE SMFSC ADD CUR NVARCHAR(3)
ALTER TABLE SMFSC ADD FAREA NVARCHAR(5)
CREATE VIEW VBSCAA AS
SELECT CARRIER, AREA, (SELECT TOP 1 CD_DESCP FROM BSCODE WHERE CD_TYPE='TCAR' AND BSCODE.CD=BSCAA.CARRIER) AS CARRIER_NM, (SELECT TOP 1 CD_DESCP FROM BSCODE WHERE BSCODE.CD=BSCAA.AREA AND CD_TYPE='TRGN') AS AREA_NM
FROM BSCAA GROUP BY CARRIER, AREA
/**********end BY Tim 2016/04/12 19:22 ***********/

/**********ADD BY FISH 2016/04/13 23:31 ***********/
ALTER TABLE SMBID ALTER COLUMN QCHG_UNIT NVARCHAR(10)
ALTER TABLE SMBID ALTER COLUMN CHG_UNIT NVARCHAR(10)
/**********end BY FISH 2016/04/13 23:31 ***********/

/**********ADD BY Tim 2016/04/13 23:31 ***********/
ALTER TABLE SMRV
ALTER COLUMN PICK_DATE DATE
/**********ADD BY Tim 2016/04/13 23:31 ***********/


/**********ADD BY FISH 2016/04/14 19:36 ***********/
ALTER TABLE SMBID ADD QUOT_ID uniqueidentifier
ALTER TABLE TKPEM ADD PARTY_NO NVARCHAR(10)
ALTER TABLE TKPEM ADD PARTY_NAME NVARCHAR(100)
/**********end BY FISH 2016/04/14 19:36 ***********/

/********* ADD BY WILL 2016/04/14 23:41 *******/
ALTER TABLE SMSM ADD CUT_BL_DATE DATETIME;
ALTER TABLE SMDN ADD LGOODS NVARCHAR(300);
ALTER TABLE SMSM ADD LGOODS NVARCHAR(300);
ALTER TABLE SMSM ADD BL_RMK NVARCHAR(500);   
ALTER TABLE SMDN ADD BAND_DESCP NVARCHAR(30);
/**********end BY WILL 2016/04/14 23:41 ***********/


/**********ADD BY FISH 2016/04/15 09:36 ***********/
UPDATE SMRQM SET CREATE_DEP=(SELECT TOP 1 DEP FROM SYS_ACCT WHERE SYS_ACCT.U_ID=SMRQM.CREATE_BY 
AND SYS_ACCT.GROUP_ID=SMRQM.GROUP_ID AND SYS_ACCT.CMP=SMRQM.CMP) WHERE CREATE_DEP IS NULL

UPDATE SMRQM SET CREATE_EXT=(SELECT TOP 1 U_EXT FROM SYS_ACCT WHERE SYS_ACCT.U_ID=SMRQM.CREATE_BY 
AND SYS_ACCT.GROUP_ID=SMRQM.GROUP_ID AND SYS_ACCT.CMP=SMRQM.CMP) WHERE CREATE_EXT IS NULL
/**********end BY FISH 2016/04/15 09:36 ***********/
/**********end BY WILL 2016/04/14 23:41 ***********/

/********* ADD BY Tim 2016/04/14 23:41 *******/
ALTER VIEW V_CMEXCEL AS
SELECT '' AS 'USE_DATE',
	SMDNP.U_ID,
	PRODUCT_LINE,
	IPART_NO,
	JQTY,
	JOB_NO,
	'' AS RESERVE_HOUR,
	'' AS 'REMARK1',
	SMSM.QTY,
	SMSM.CARRIER_NM AS 'CARRIER',
	(SELECT TOP 1 PARTY_NAME FROM SMSMPT WHERE SMSMPT.SHIPMENT_ID=SMSM.SHIPMENT_ID AND PARTY_TYPE='CR') AS TRUCKER,
	'CNT_TYPE' =
		CASE 
			WHEN (SMDN.CNT20 > 0) THEN '20GP*' + convert(varchar(10),SMDN.CNT20) + ' '
			ELSE ''
		END+CASE 
			WHEN (SMDN.CNT40 > 0) THEN '40GP*' + convert(varchar(10),SMDN.CNT40) + ' '
			ELSE ''
		END+CASE
			WHEN (SMDN.CNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMDN.CNT40HQ) + ' '
			ELSE ''
		END
	,'' AS 'CNT_NUMBER',
	SMDNP.DN_NO,
	SMDN.AC_REMARK AS 'REMARK2',
	'' AS 'CUST_CD',
	'' AS 'CNTR_NO',
	'' AS 'TRUCK_NO',
	SMDN.CREATE_BY,
	SMDNP.DOWN_FLAG
FROM SMDNP
INNER JOIN SMDN ON SMDNP.DN_NO=SMDN.DN_NO
INNER JOIN SMSM ON SMSM.DN_NO=SMDNP.DN_NO AND SMSM.TORDER='S'
/********* end BY Tim 2016/04/14 23:41 *******/
/**********end BY FISH 2016/04/15 09:36 ***********/

/**********ADD BY JONES 2016/04/15 17:09 ***********/

ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PART_ADDR2, B.PART_ADDR3, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID=A.SHIPMENT_ID) AMOUNT1,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='FS') FS_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='SP') SP_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD


ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.PAY_TERM_CD, C.PART_NO,
                            A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
                                (SELECT          TOP (1) CD_DESCP
                                  FROM               dbo.BSCODE
                                  WHERE           CD = A.PLTU) AS TTL_PLT_DESCP,
                                (SELECT          TOP (1) PIC
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = B.BU)
                                  AND              STATUS='U') AS PIC,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR3, 
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
                                (SELECT          TOP (1) PART_ADDR1 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.BU )) TITLE_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.BU )) TITLE_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.BU )) TITLE_ADDR3,     
	                            (SELECT          TOP (1) PARTY_NAME 
	                              FROM               dbo.SMPTY 
	                              WHERE           (PARTY_NO=B.BU )) TITLE_NAME,
	                            (SELECT          TOP (1) PARTY_NAME
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_NAME,
	                            (SELECT          TOP (1) PART_ADDR
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR,
	                            (SELECT          TOP (1) PART_ADDR2
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR2,
	                            (SELECT          TOP (1) PART_ADDR3
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR3,
	                            (SELECT          TOP (1) PARTY_NAME
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_NAME,
	                            (SELECT          TOP (1) PART_ADDR
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR,
	                            (SELECT          TOP (1) PART_ADDR2
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR2,
	                            (SELECT          TOP (1) PART_ADDR3
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR3,
	                            (SELECT          TOP (1) CNTRY_NM
	                              FROM               dbo.BSCNTY
	                              WHERE           (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2)
	                              AND              GROUP_ID=A.GROUP_ID
	                              AND              CMP=A.CMP)) AS CNTRY_NM,
	                            (SELECT          TOP (1) MEMO
	                              FROM               dbo.SMDN
	                              WHERE              (DN_NO=A.DN_NO)) AS MEMO,
	                            (SELECT          TOP (1) GOODS      
	                              FROM               dbo.SMDN  
	                              WHERE              (DN_NO=A.DN_NO)) AS DN_GOODS	               
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDN AS B ON A.DN_NO = B.DN_NO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.PAY_DESCP, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.PAY_TERM_CD, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,
	   (SELECT TOP (1) PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO


ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT C.PLANT, A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.PAY_TERM_CD, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO, B.PLA_SIZE, A.CMDTY_CD, A.CMDTY_DESCP,
       (SELECT TOP 1 PIC FROM dbo.SMPTY WHERE PARTY_NO = C.BU AND STATUS='U') AS PIC,
       (SELECT TOP 1 PARTY_NAME FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMDN AS C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.PAY_TERM_CD, A.PAY_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, B.VEN_NM, --B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       B.TTL_NW, B.TTL_GW, B.TTL_CBM, A.CUR, A.TTL_CBM AS M_TTL_CBM, A.TTL_GW AS M_TTL_GW,
(SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_NAME,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR3,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID,
       A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.PAY_TERM_CD, A.PAY_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO

/**********END BY JONES 2016/04/15 17:09 ***********/

/********* ADD BY WILL 2016/04/16 23:41 *******/
ALTER TABLE SMSM ADD CUT_BL_DATE DATETIME;
ALTER TABLE SMDN ADD LGOODS NVARCHAR(300);
ALTER TABLE SMSM ADD LGOODS NVARCHAR(300);
ALTER TABLE SMSM ADD BL_RMK NVARCHAR(500);   
ALTER TABLE SMDN ADD BAND_DESCP NVARCHAR(30);
ALTER TABLE SMDN ADD TRADE_TERM NVARCHAR(3);
ALTER TABLE SMDN ADD TRADETERM_DESCP NVARCHAR(30);
ALTER TABLE SMSM ADD TRADE_TERM NVARCHAR(3);
ALTER TABLE SMSM ADD TRADETERM_DESCP NVARCHAR(30);
ALTER TABLE SMDN ALTER COLUMN BAND_TYPE NVARCHAR(5)
/**********end BY WILL 2016/04/16 23:41 ***********/

/**********END BY JONES 2016/04/15 17:09 ***********/
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES ('TPV', 'TIR', '保费费率','FQ', '*')
ALTER TABLE SMINM ADD FOB_VALUE NUMERIC(18,2)
ALTER TABLE SMINM ADD LGOODS NVARCHAR(300)
ALTER TABLE SMRV ADD PUT_DATE DATETIME
ALTER TABLE SMINM ADD TRANSACTE_MODE NVARCHAR(2)
EXEC sp_RENAME 'SMINM.PAY_TERM_CD', 'TRADE_TERM', 'COLUMN'
EXEC sp_RENAME 'SMINM.PAY_DESCP', 'TRADETERM_DESCP', 'COLUMN'
ALTER TABLE SMINM
ALTER COLUMN BANK_MSG NVARCHAR(300)

/********* ADD BY fish 2016/04/16 17:24 *******/
ALTER TABLE SMQTM ALTER COLUMN REMARK NVARCHAR(MAX)
ALTER TABLE SMRQM ALTER COLUMN REMARK NVARCHAR(MAX)
ALTER TABLE SMBIM ADD PARTY_TYPE NVARCHAR(5);

ALTER TABLE SMBIM ADD VOID_FLAG NVARCHAR(1);  
/**********end BY fish 2016/04/16 17:24 ***********/

ALTER TABLE APPROVE_RECORD ADD VOID_LOOP INT;
  ALTER TABLE APPROVE_RECORD ADD AFD_ROLE nvarchar(10);


/********** ADD BY Jonrs 2016/04/17 17:27 **********/

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT          A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
                            A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
                             A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
                             A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
                            A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
                            A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID, C.CASE_NO, C.CASE_NUM, 
                            C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
                            C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.TRADETERM_DESCP, C.PART_NO,
                            A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
                                (SELECT          TOP (1) CD_DESCP
                                  FROM               dbo.BSCODE
                                  WHERE           CD = A.PLTU) AS TTL_PLT_DESCP,
                                (SELECT          TOP (1) PIC
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = B.BU)
                                  AND              STATUS='U') AS PIC,
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.SHPR_CD)) AS PART_ADDR3, 
                                (SELECT          TOP (1) PART_ADDR1
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR,
                                (SELECT          TOP (1) PART_ADDR2
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY
                                  WHERE           (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
                                (SELECT          TOP (1) PART_ADDR1 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.BU )) TITLE_ADDR1,
                                (SELECT          TOP (1) PART_ADDR2 
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.BU )) TITLE_ADDR2,
                                (SELECT          TOP (1) PART_ADDR3
                                  FROM               dbo.SMPTY 
                                  WHERE           (PARTY_NO=B.BU )) TITLE_ADDR3,     
	                            (SELECT          TOP (1) PARTY_NAME 
	                              FROM               dbo.SMPTY 
	                              WHERE           (PARTY_NO=B.BU )) TITLE_NAME,
	                            (SELECT          TOP (1) PARTY_NAME
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_NAME,
	                            (SELECT          TOP (1) PART_ADDR
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR,
	                            (SELECT          TOP (1) PART_ADDR2
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR2,
	                            (SELECT          TOP (1) PART_ADDR3
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='AG') AS Sodl_ADDR3,
	                            (SELECT          TOP (1) PARTY_NAME
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_NAME,
	                            (SELECT          TOP (1) PART_ADDR
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR,
	                            (SELECT          TOP (1) PART_ADDR2
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR2,
	                            (SELECT          TOP (1) PART_ADDR3
	                              FROM               dbo.SMDNPT
	                              WHERE           (DN_NO=A.DN_NO )
	                              AND              PARTY_TYPE='WE') AS Shi_ADDR3,
	                            (SELECT          TOP (1) CNTRY_NM
	                              FROM               dbo.BSCNTY
	                              WHERE           (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2)
	                              AND              GROUP_ID=A.GROUP_ID
	                              AND              CMP=A.CMP)) AS CNTRY_NM,
	                            (SELECT          TOP (1) MEMO
	                              FROM               dbo.SMDN
	                              WHERE              (DN_NO=A.DN_NO)) AS MEMO,
	                            (SELECT          TOP (1) GOODS      
	                              FROM               dbo.SMDN  
	                              WHERE              (DN_NO=A.DN_NO)) AS DN_GOODS	               
FROM              dbo.SMINM AS A LEFT OUTER JOIN
                            dbo.SMINP AS C ON A.U_ID = C.U_FID LEFT OUTER JOIN
                            dbo.SMDN AS B ON A.DN_NO = B.DN_NO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,
	   (SELECT TOP (1) PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.BU ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO


ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT C.PLANT, A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.TRADE_TERM, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO, B.PLA_SIZE, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADETERM_DESCP,
       (SELECT TOP 1 PIC FROM dbo.SMPTY WHERE PARTY_NO = C.BU AND STATUS='U') AS PIC,
       (SELECT TOP 1 PARTY_NAME FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMDN AS C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, B.VEN_NM, --B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       B.TTL_NW, B.TTL_GW, B.TTL_CBM, A.CUR, A.TTL_CBM AS M_TTL_CBM, A.TTL_GW AS M_TTL_GW,
(SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_NAME,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR3,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO



ALTER VIEW [dbo].[V_IPQ05] AS
Select A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       B.CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


/********** END BY Jonrs 2016/04/17 17:27 **********/



/********** ADD BY Jonrs 2016/04/18 15:22 **********/

ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.U_ID, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       A.CMP AS LOCATION, B.QTYU, C.FREIGHT_TERM AS FREIGHTTERM, Convert(nvarchar(12),B.QTY)+B.QTYU AS QTYUU,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.BU AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.BU)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO

/********** END BY Jonrs 2016/04/18 15:22 **********//********** END BY Jonrs 2016/04/17 17:27 **********/


/********** ADD BY WILL 2016/04/19 13:02 **********/
ALTER TABLE SMBD ALTER COLUMN GWU NVARCHAR(10)
ALTER TABLE SMBDD ADD U_FID NVARCHAR(40);
ALTER TABLE SMBDD ALTER COLUMN UCBM NVARCHAR(5);
/********** END BY WILL 2016/04/19 13:02 **********/

/********** ADD BY TIM 2016/04/19 13:02 **********/
ALTER TABLE SMINM ADD COMBINE_FLAG NVARCHAR(1)
ALTER TABLE SMINP ADD PROD_DESCP NVARCHAR(50)
ALTER TABLE SMINP ADD SHIPPING_MARK TEXT
ALTER TABLE SMINP ADD PLACE NVARCHAR(20)
ALTER TABLE SMINP ADD SMODEL NVARCHAR(20)
ALTER TABLE SMINP ADD PART_NUM NVARCHAR(20)
ALTER TABLE SMINP ADD MODEL NVARCHAR(20)
/********** END BY TIM 2016/04/19 13:02 **********/

ALTER TABLE SMSM ADD BAND_DESCP NVARCHAR(30);
ALTER TABLE SMDN ADD BAND_CD NVARCHAR(30);
ALTER TABLE SMSM ADD BAND_CD NVARCHAR(30);
ALTER TABLE SMBD ALTER COLUMN GWU NVARCHAR(10);
 ALTER TABLE SMBDD ADD GW_AVG NUMERIC(12,4);
 ALTER TABLE SMBDD ADD NW_AVG NUMERIC(12,4);
 ALTER TABLE SMBDD ADD CBM_AVG NUMERIC(12,4);
  ALTER TABLE SMBDD ADD U_FID NVARCHAR(40);


  /********** ADD BY fish 2016/04/19 22:10 **********/
  ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PART_ADDR2, B.PART_ADDR3, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID=A.SHIPMENT_ID) AMOUNT1,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME1,
(SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME2,
(SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME3,
(SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME4,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='FS') FS_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='SP') SP_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD

ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT  A.INVOICE_RMK,A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
        A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
        A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
        A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
        A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
        A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID,ISNULL(C.CASE_NO,C.PLA_NO) AS CASE_NO, C.CASE_NUM, 
        C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
        C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.TRADETERM_DESCP, C.PART_NO,
        A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
       (SELECT TOP (1) CD_DESCP FROM BSCODE WHERE CD = A.PLTU) AS TTL_PLT_DESCP,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR3, 
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR3,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR3,     
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.STN ) AS  TITLE_NAME,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM FROM BSCNTY WHERE (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP)) AS CNTRY_NM,
	   (SELECT TOP (1) MEMO FROM SMDN WHERE DN_NO=A.DN_NO) AS MEMO,
	   (SELECT TOP (1) GOODS FROM SMDN WHERE DN_NO=A.DN_NO) AS DN_GOODS	               
FROM SMINM AS A 
     LEFT OUTER JOIN SMINP AS C ON A.U_ID = C.U_FID 
	 LEFT OUTER JOIN SMDN AS B ON A.DN_NO = B.DN_NO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT C.PAY_TERM_CD,C.PAY_DESCP,A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

	   (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO


ALTER VIEW [dbo].[V_IPQ03] AS 
SELECT C.PLANT, A.U_ID, A.INVOICE_TYPE, A.DN_NO, A.PO_NO, A.INV_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, 
       A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, 
       A.TRADE_TERM, A.CNTRY_DESCP, A.DLV_WAY, A.INV_DATE, A.TTL_PLT AS M_TTL_PLT, A.TTL_GW AS M_TTL_GW,
       B.CASE_NUM, B.GOODS_DESCP, B.QTY, B.QTYU, B.NW, B.GW, B.CBM, B.CASE_NO, B.U_FID AS PU_FID, B.SEQ_NO,
       B.IPART_NO, B.VEN_NM, B.VEN_CD, B.VEN_ADDR, B.NCM_NO, B.PLA_SIZE, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADETERM_DESCP,
       (SELECT TOP 1 PIC FROM dbo.SMPTY WHERE PARTY_NO = C.STN AND STATUS='U') AS PIC,
       (SELECT TOP 1 PARTY_NAME FROM dbo.SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHPR_CD)) AS SHPR_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.CNEE_CD)) AS CNEE_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.NOTIFY_NO)) AS NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.SHIP_TO)) AS SHIP_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_TEL,
       (SELECT TOP 1 PARTY_FAX  FROM dbo.SMPTY WHERE (PARTY_NO = A.BILL_TO)) AS BILL_FAX
FROM dbo.SMINM AS A LEFT OUTER JOIN
     dbo.SMINP AS B ON A.U_ID = B.U_FID LEFT OUTER JOIN
     dbo.SMDN AS C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ04] AS
SELECT A.DN_NO, A.INVOICE_TYPE, A.U_ID, B.U_ID AS D_UID, A.SHPR_CD, A.SHPR_NM, A.INV_NO, A.PO_NO, A.INV_DATE, A.SHIP_TO, A.SHIP_NM, A.BILL_TO, A.BILL_NM,
       A.VAT_NO, A.NOTIFY_NO, A.NOTIFY_NM, A.CNTRY_DESCP, A.BL_NO, A.TTL_GW AS M_TTL_GR, B.PART_NO, A.TTL_VALUE,
       A.CNEE_CD, A.CNEE_NM, A.SO_NO, A.DLV_WAY, A.CMDTY_CD, A.CMDTY_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       B.GOODS_DESCP, B.QTY, B.QTYU, B.UNIT_PRICE1, B.AMT, B.IHS_CODE, A.ISSUE_FEE, A.FREIGHT_FEE, A.CREATE_BY, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.INCOTERM, A.INCOTERM_DESCP, B.SEQ_NO, B.U_FID AS IU_FID, B.IPART_NO, B.VEN_NM, --B.VEN_CD, B.VEN_ADDR, B.NCM_NO,
       B.TTL_NW, B.TTL_GW, B.TTL_CBM, A.CUR, A.TTL_CBM AS M_TTL_CBM, A.TTL_GW AS M_TTL_GW,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

(SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
(SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
(SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
(SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
(SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
(SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
(SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX
FROM SMINM A
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ05] AS
Select B.OPART_NO,B.PROD_DESCP,B.IPART_NO,A.U_ID, A.DLV_WAY,A.TTL_PLT,A.PLTU,A.PKG_UNIT_DESC, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       ISNULL(B.CASE_NO,B.PLA_NO) AS CASE_NO,, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE, A.CUR, A.CMP AS LOCATION, B.TTL_QTY AS TTLQTY,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT B.OPART_NO,B.IPART_NO,B.BRAND,C.PAY_TERM_CD,C.PAY_DESCP,A.CMDTY_CD,A.U_ID,A.LGOODS, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       A.CMP AS LOCATION, B.QTYU, C.FREIGHT_TERM AS FREIGHTTERM, Convert(nvarchar(12),B.QTY)+B.QTYU AS QTYUU,
       A.DLV_WAY,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO
 /********** END BY fish 2016/04/19 22:10 **********/

ALTER TABLE SMBD ALTER COLUMN REGION NVARCHAR(10)








ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT  A.INVOICE_RMK,A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
        A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
        A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
        A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
        A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
        A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID,ISNULL(C.CASE_NO,C.PLA_NO) AS CASE_NO, C.CASE_NUM, 
        C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
        C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.TRADETERM_DESCP, C.PART_NO,
        A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
       (SELECT TOP (1) CD_DESCP FROM BSCODE WHERE CD = A.PLTU) AS TTL_PLT_DESCP,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR3, 
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR3,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR3,     
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.STN ) AS  TITLE_NAME,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM FROM BSCNTY WHERE (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP)) AS CNTRY_NM,
	   (SELECT TOP (1) MEMO FROM SMDN WHERE DN_NO=A.DN_NO) AS MEMO,
	   (SELECT TOP (1) GOODS FROM SMDN WHERE DN_NO=A.DN_NO) AS DN_GOODS	               
FROM SMINM AS A 
     LEFT OUTER JOIN SMINP AS C ON A.U_ID = C.U_FID 
	 LEFT OUTER JOIN SMDN AS B ON A.DN_NO = B.DN_NO

 ALTER VIEW [dbo].[V_IPQ05] AS
Select B.OPART_NO,B.PROD_DESCP,B.IPART_NO,A.U_ID, A.DLV_WAY,A.TTL_PLT,A.PLTU,A.PKG_UNIT_DESC, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       ISNULL(B.CASE_NO,B.PLA_NO) AS CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE, A.CUR, A.CMP AS LOCATION, B.TTL_QTY AS TTLQTY,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


/********** ADD BY TIM 2016/04/20 15:22 **********/
ALTER TABLE SMWH
ALTER COLUMN PRODUCT_LINE NVARCHAR(40)



/********** ADD BY fish 2016/04/20 22:10 **********/
ALTER TABLE SMBD ALTER COLUMN REGION NVARCHAR(10)


ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT  A.INVOICE_RMK,A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
        A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
        A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
        A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
        A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
        A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID,ISNULL(C.CASE_NO,C.PLA_NO) AS CASE_NO, C.CASE_NUM, 
        C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
        C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.TRADETERM_DESCP, C.PART_NO,
        A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
       (SELECT TOP (1) CD_DESCP FROM BSCODE WHERE CD = A.PLTU) AS TTL_PLT_DESCP,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR3, 
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR3,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR3,     
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.STN ) AS  TITLE_NAME,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM FROM BSCNTY WHERE (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP)) AS CNTRY_NM,
	   (SELECT TOP (1) MEMO FROM SMDN WHERE DN_NO=A.DN_NO) AS MEMO,
	   (SELECT TOP (1) GOODS FROM SMDN WHERE DN_NO=A.DN_NO) AS DN_GOODS	               
FROM SMINM AS A 
     LEFT OUTER JOIN SMINP AS C ON A.U_ID = C.U_FID 
	 LEFT OUTER JOIN SMDN AS B ON A.DN_NO = B.DN_NO

 ALTER VIEW [dbo].[V_IPQ05] AS
Select B.OPART_NO,B.PROD_DESCP,B.IPART_NO,A.U_ID, A.DLV_WAY,A.TTL_PLT,A.PLTU,A.PKG_UNIT_DESC, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       ISNULL(B.CASE_NO,B.PLA_NO) AS CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE, A.CUR, A.CMP AS LOCATION, B.TTL_QTY AS TTLQTY,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO

/********** END BY fish 2016/04/20 22:10 **********/ALTER COLUMN PRODUCT_LINE NVARCHAR(40)

ALTER TABLE SMRV
ALTER COLUMN CUT_PORT_DATE DATETIME

ALTER TABLE SMRV
ALTER COLUMN APORT_DATE DATETIME

ALTER TABLE SMRV
ALTER COLUMN ATD DATE
/********** ADD BY TIM 2016/04/20 15:22 **********/

ALTER TABLE SMDN ADD DN_RMARK NVARCHAR(300); 
ALTER TABLE SMBD ADD TRAN_MODE NVARCHAR(10); 
ALTER TABLE SMBD ADD TRANMODE_DESCP NVARCHAR(20); 
ALTER TABLE SMSM ALTER COLUMN BL_WIN NVARCHAR(40);
ALTER TABLE SMBD ADD SHIPTO_CD NVARCHAR(10); 
ALTER TABLE SMBD ADD SHIPTO_NM NVARCHAR(70); 
ALTER TABLE SMBD ADD BILLTO_CD NVARCHAR(10); 
ALTER TABLE SMBD ADD BILLTO_NM NVARCHAR(70); 


/********** START BY king 2016/04/22 09:06 **********/
千萬不要幫我更上去 我自己更

INSERT INTO [dbo].[BSCODE_KIND]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[MODIFY_BY]
           ,[DEP])
     VALUES
           ('TPV'
           ,'TMG'
           ,'寄信群組類別'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'MANA10'
           ,'*')


INSERT INTO [dbo].[BSCODE]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[ORDER_BY])
     VALUES
           ('TPV'
           ,'TMG'
           ,'A'
           ,'Air'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'0'),
		    ('TPV'
           ,'TMG'
           ,'B'
           ,'报关'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'1'),
		    ('TPV'
           ,'TMG'
           ,'C'
           ,'叫车'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'2'),
		    ('TPV'
           ,'TMG'
           ,'D'
           ,'国内快递'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'3'),
		    ('TPV'
           ,'TMG'
           ,'E'
           ,'Express'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'4'),
		    ('TPV'
           ,'TMG'
           ,'F'
           ,'FCL'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'5'),
		    ('TPV'
           ,'TMG'
           ,'L'
           ,'LCL'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'6'),
		    ('TPV'
           ,'TMG'
           ,'Q'
           ,'询报价'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'7'),
		    ('TPV'
           ,'TMG'
           ,'R'
           ,'Rail Road'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'8'),
		    ('TPV'
           ,'TMG'
           ,'T'
           ,'内贸'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'9'),
		    ('TPV'
           ,'TMG'
           ,'U'
           ,'Tracking'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'10')


		        DELETE 
  FROM [ESHIPPING].[dbo].[TKPMG] WHERE GROUP_ID != 'TPV' OR CMP is null



  	  UPDATE [ESHIPPING].[dbo].[TKPMG] SET 
				  [NAME] = 'TEMP',
				  MAIL_ID = (  select 
    STUFF(ISNULL((SELECT ';' + x.[MAIL_ID]
                      FROM [TKPMG] x
                     WHERE  x.CMP = t.CMP
                   FOR XML PATH ('')), '1'), 1, 1, '')
				 FROM [ESHIPPING].[dbo].[TKPMG] t
				 WHERE t.CMP = p.CMP
				  GROUP BY t.CMP
				  )
				  FROM [ESHIPPING].[dbo].[TKPMG] p 


				  INSERT INTO [dbo].[TKPMG]
           ([GROUP_ID]
           ,[CMP]
           ,[STN]
           ,[DEP]
           ,[SEQ_NO]
           ,[NAME]
           ,[MAIL_ID]
           ,[REMARK]
           ,[CREATE_DATE]
           ,[CREATE_BY]
           ,[MODIFY_DATE]
           ,[MODIFY_BY])
SELECT DISTINCT
[TKPMG].GROUP_ID,
[TKPMG].CMP,
[TKPMG].STN,
[TKPMG].DEP,
[TKPMG].SEQ_NO,
BSCODE.CD AS NAME,
[TKPMG].MAIL_ID,
'',
GETDATE(),
'',
GETDATE(),
''
FROM [dbo].[TKPMG] LEFT JOIN BSCODE ON CD_TYPE = 'TMG'-- GROUP BY [TKPMG].GROUP_ID,[TKPMG].CMP,[TKPMG].STN,[TKPMG].DEP,BSCODE.CD

DELETE FROM [dbo].[TKPMG] WHERE NAME = 'TEMP'

ALTER TABLE TKPMG 
ALTER COLUMN U_ID VARCHAR(50)

UPDATE TKPMG SET
U_ID = LOWER( REPLACE ( NEWID() , '-' , '' ))

ALTER TABLE TKPMG 
ALTER COLUMN U_ID NVARCHAR(50)
/********** END BY king 2016/04/22 09:06 **********/
/********** BEGIN BY Will 2016/04/23 10:26 **********/
ALTER TABLE SMSM ADD DRAFT_BL_WIN NVARCHAR(40);--提单通知人
ALTER TABLE SMSM ADD BLNOTIFY_DATE DATETIME;	--提单通知时间
/********** END BY Will 2016/04/23 10:26 **********/
/********** END BY king 2016/04/22 09:06 **********/


/********** ADD BY TIM 2016/04/23 09:06 **********/
ALTER TABLE SMINM ADD PACKING_FROM NVARCHAR(1)
ALTER TABLE SMIND ADD PROD_DESCP NVARCHAR(50)
ALTER TABLE SMINP ADD IHS_CODE NVARCHAR(20)
ALTER TABLE SMINP ADD CNTRY_ORN NVARCHAR(30)
ALTER TABLE SMINM ADD TTL_PQTY NUMERIC(12,0)
/********** END BY TIM 2016/04/23 09:06 **********/
/********** ADD BY KING 2016/04/23 13:06 **********/
ALTER TABLE SYS_ACCT ADD TCMP NVARCHAR(500)

INSERT INTO [dbo].[BSCODE_KIND]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[MODIFY_BY]
           ,[DEP])
     VALUES
           ('TPV'
           ,'TCMP'
           ,'DN公司權限'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'MANA10'
           ,'*')
/********** END BY KING 2016/04/23 13:06 **********/


/********** add BY fish 2016/04/24 09:06 **********/
ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PART_ADDR2, B.PART_ADDR3, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
B.ORDER_BY, 
(SELECT TOP 1 SHPR_NM FROM SMSIM WHERE SMSIM.[PROFILE]=A.PROFILE_CD) AS SHPR_NM,
(SELECT TOP 1 ISNULL(CD_DESCP,A.PKG_UNIT) FROM BSCODE WHERE  BSCODE.CD_TYPE='UB' AND  BSCODE.CD=A.PKG_UNIT AND  BSCODE.GROUP_ID=A.GROUP_ID) PKG_UNIT_UB,
(SELECT TOP 1 TAX_NO FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) TAX_NO,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID=A.SHIPMENT_ID) AMOUNT1,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME1,
(SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME2,
(SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME3,
(SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME4,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='FS') FS_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='SP') SP_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD
/********** END BY fish 2016/04/24 09:06 **********/
ALTER TABLE SMSM ADD  CENT_DECL NVARCHAR(1);



/********** ADD BY fish 2016/04/24 12:45 **********/
ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT C.PAY_TERM_CD,C.PAY_DESCP,A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

	   (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO
/********** ENDS BY fish 2016/04/24 12:45 **********/

/********** ADD BY fish 2016/04/24 18:14 **********/
ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT  C.IHS_CODE,A.INVOICE_RMK,A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
        A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
        A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
        A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
        A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
        A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID,ISNULL(C.CASE_NO,C.PLA_NO) AS CASE_NO, C.CASE_NUM, 
        C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
        C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.TRADETERM_DESCP, C.PART_NO,
        A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
       (SELECT TOP (1) CD_DESCP FROM BSCODE WHERE CD = A.PLTU) AS TTL_PLT_DESCP,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR3, 
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR3,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR3,     
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.STN ) AS  TITLE_NAME,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM FROM BSCNTY WHERE (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP)) AS CNTRY_NM,
	   (SELECT TOP (1) MEMO FROM SMDN WHERE DN_NO=A.DN_NO) AS MEMO,
	   (SELECT TOP (1) GOODS FROM SMDN WHERE DN_NO=A.DN_NO) AS DN_GOODS	               
FROM SMINM AS A 
     LEFT OUTER JOIN SMINP AS C ON A.U_ID = C.U_FID 
	 LEFT OUTER JOIN SMDN AS B ON A.DN_NO = B.DN_NO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT B.OHS_CODE,B.PROD_DESCP,C.PAY_TERM_CD,C.PAY_DESCP,A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

	   (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO

ALTER VIEW [dbo].[V_IPQ05] AS
Select B.IHS_CODE,B.OPART_NO,B.PROD_DESCP,B.IPART_NO,A.U_ID, A.DLV_WAY,A.TTL_PLT,A.PLTU,A.PKG_UNIT_DESC, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       ISNULL(B.CASE_NO,B.PLA_NO) AS CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE, A.CUR, A.CMP AS LOCATION, B.TTL_QTY AS TTLQTY,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO

ALTER VIEW [dbo].[V_IPQ06] AS
SELECT B.IHS_CODE,B.OHS_CODE,B.PROD_DESCP,A.TRANSACTE_MODE,(CASE  A.TRANSACTE_MODE WHEN 'A' THEN '一般貿易' WHEN 'B' THEN '进料对口' WHEN 'C' THEN '进料复出' WHEN 'O' THEN '其它' ELSE '' END) AS TRANSACTE_MODENAME,
       B.OPART_NO,B.IPART_NO,B.BRAND,C.PAY_TERM_CD,C.PAY_DESCP,A.CMDTY_CD,A.U_ID,A.LGOODS, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       A.CMP AS LOCATION, B.QTYU, C.FREIGHT_TERM AS FREIGHTTERM, Convert(nvarchar(12),B.QTY)+B.QTYU AS QTYUU,
       A.DLV_WAY,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO

ALTER TABLE TKPMG ALTER COLUMN MAIL_ID NVARCHAR(1000)
/********** ENDS BY fish 2016/04/24 18:14 **********/


/********** add BY fish 2016/04/24 22:47 **********/
ALTER VIEW [dbo].[V_IPQ01]
AS
SELECT  C.IHS_CODE,A.INVOICE_RMK,A.U_ID, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, 
        A.NOTIFY_NM, A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP,
        A.TO_CD, A.TO_DESCP, A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO,
        A.SO_NO, C.PO_NO, A.REF_NO, A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, 
        A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, 
        A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, A.VESSEL_NM, A.MARKS, A.SHIPMENT_ID,ISNULL(C.CASE_NO,C.PLA_NO) AS CASE_NO, C.CASE_NUM, 
        C.QTY, C.TTL_QTY, C.GOODS_DESCP, C.OPART_NO, C.NW, C.TTL_NW, C.GW, C.TTL_GW, C.CBM, C.TTL_CBM, C.SEQ_NO,
        C.U_FID, C.QTYU, C.U_FID AS PU_FID, A.INCOTERM, A.TRADETERM_DESCP, C.PART_NO,
        A.TTL_PLT, B.CNT20, B.CNT40, B.CNT40HQ, B.CNT_TYPE,
       (SELECT TOP (1) CD_DESCP FROM BSCODE WHERE CD = A.PLTU) AS TTL_PLT_DESCP,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.SHPR_CD) AS PART_ADDR3, 
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO = A.BILL_TO) AS BILL_ADDR3,
       (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR1,
       (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR2,
       (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=B.STN ) AS TITLE_ADDR3,     
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.STN ) AS  TITLE_NAME,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') AS Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_NAME,
	   (SELECT TOP (1) PART_ADDR FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') AS Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM FROM BSCNTY WHERE (CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP)) AS CNTRY_NM,
	   (SELECT TOP (1) MEMO FROM SMDN WHERE DN_NO=A.DN_NO) AS MEMO,
	   (SELECT TOP (1) GOODS FROM SMDN WHERE DN_NO=A.DN_NO) AS DN_GOODS	               
FROM SMINM AS A 
     LEFT OUTER JOIN SMINP AS C ON A.U_ID = C.U_FID 
	 LEFT OUTER JOIN SMDN AS B ON A.DN_NO = B.DN_NO


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.CUR,B.OHS_CODE,B.PROD_DESCP,C.PAY_TERM_CD,C.PAY_DESCP,A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

	   (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO

ALTER VIEW [dbo].[V_IPQ05] AS
Select B.IHS_CODE,B.OPART_NO,B.PROD_DESCP,B.IPART_NO,A.U_ID, A.DLV_WAY,A.TTL_PLT,A.PLTU,A.PKG_UNIT_DESC, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       ISNULL(B.CASE_NO,B.PLA_NO) AS CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE, A.CUR, A.CMP AS LOCATION, B.TTL_QTY AS TTLQTY,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT B.IHS_CODE,B.OHS_CODE,B.PROD_DESCP,A.TRANSACTE_MODE,(CASE  A.TRANSACTE_MODE WHEN 'A' THEN '一般貿易' WHEN 'B' THEN '进料对口' WHEN 'C' THEN '进料复出' WHEN 'O' THEN '其它' ELSE '' END) AS TRANSACTE_MODENAME,
       B.OPART_NO,B.IPART_NO,B.BRAND,C.PAY_TERM_CD,C.PAY_DESCP,A.CMDTY_CD,A.U_ID,A.LGOODS, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       A.CMP AS LOCATION, B.QTYU, C.FREIGHT_TERM AS FREIGHTTERM, Convert(nvarchar(12),B.QTY)+B.QTYU AS QTYUU,
       A.DLV_WAY,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO
/********** end BY fish 2016/04/24 22:47 **********/

/********** BEGIN BY WILL 2016/04/24 23:45 **********/
ALTER TABLE SMSM ADD BR_CD NVARCHAR(10);
ALTER TABLE SMSM ADD BR_NAME NVARCHAR(70);
ALTER TABLE SMSM ADD CR_CD NVARCHAR(10);
ALTER TABLE SMSM ADD CR_NAME NVARCHAR(70);
/********** END BY WILL 2016/04/24 23:45 **********/

/********** BEGIN BY KING 2016/04/25 11:45 **********/
ALTER TABLE SMPTY 
ALTER COLUMN PART_ADDR2 NVARCHAR(40) 
ALTER TABLE SMPTY 
ALTER COLUMN PART_ADDR3 NVARCHAR(40) 

ALTER TABLE SMDNPT 
ALTER COLUMN PART_ADDR NVARCHAR(60) 
ALTER TABLE SMDNPT 
ALTER COLUMN PART_ADDR2 NVARCHAR(40) 
ALTER TABLE SMDNPT 
ALTER COLUMN PART_ADDR3 NVARCHAR(40) 

ALTER TABLE SMSMPT 
ALTER COLUMN PART_ADDR1 NVARCHAR(60) 
ALTER TABLE SMSMPT
ALTER COLUMN PART_ADDR2 NVARCHAR(40) 
ALTER TABLE SMSMPT 
ALTER COLUMN PART_ADDR3 NVARCHAR(40) 
/********** END BY KING 2016/04/25 11:45 **********/

/********** BEGIN BY HARRY 2016/04/25 16:05 **********/
ALTER TABLE SMBIM ADD APPROVE_STATUS nvarchar(1);
ALTER TABLE SMBIM ADD QAMT numeric(18,2);
ALTER TABLE SMBIM ADD SUB_AMT numeric(18,2);
/********** END BY HARRY 2016/04/25 16:05 **********/

/********** BEGIN BY WILL 2016/04/25 21:48 **********/
ALTER TABLE SMBD ADD CNTY NVARCHAR(2);
ALTER TABLE SMBD ADD CNTY_NM NVARCHAR(30);
ALTER TABLE SMBD ADD CITY NVARCHAR(3);
ALTER TABLE SMBD ADD CITY_NM NVARCHAR(30);
ALTER TABLE SMBD ADD PART_ADDR1 NVARCHAR(60);
ALTER TABLE SMBD ADD PART_ADDR2 NVARCHAR(40);
ALTER TABLE SMBD ADD PART_ADDR3 NVARCHAR(40);
ALTER TABLE SMBD ADD PARTY_ATTN NVARCHAR(40);
ALTER TABLE SMBD ADD PARTY_TEL NVARCHAR(40);
ALTER TABLE SMBD ADD ZIP NVARCHAR(10);
/********** END BY WILL 2016/04/25 21:48 **********/



/********** BEGIN BY FISH 2016/04/25 23:40 **********/
ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT A.QTYU AS M_QTYU,A.CUR,B.OHS_CODE,B.PROD_DESCP,C.PAY_TERM_CD,C.PAY_DESCP,A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

	   (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO


			 ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.CUR,B.IHS_CODE,B.OHS_CODE,B.PROD_DESCP,A.TRANSACTE_MODE,(CASE  A.TRANSACTE_MODE WHEN 'A' THEN '一般貿易' WHEN 'B' THEN '进料对口' WHEN 'C' THEN '进料复出' WHEN 'O' THEN '其它' ELSE '' END) AS TRANSACTE_MODENAME,
       B.OPART_NO,B.IPART_NO,B.BRAND,C.PAY_TERM_CD,C.PAY_DESCP,A.CMDTY_CD,A.U_ID,A.LGOODS, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK,
       A.TTL_VALUE,
       A.CMP AS LOCATION, B.QTYU, C.FREIGHT_TERM AS FREIGHTTERM, Convert(nvarchar(12),B.QTY)+B.QTYU AS QTYUU,
       A.DLV_WAY,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO
/********** END BY FISH 2016/04/25 23:40 **********/
/********** BEGIN BY KING 2016/04/25 11:45 **********/
ALTER TABLE SMPTY 
ALTER COLUMN PART_ADDR2 NVARCHAR(40) 
ALTER TABLE SMPTY 
ALTER COLUMN PART_ADDR3 NVARCHAR(40) 

ALTER TABLE SMDNPT 
ALTER COLUMN PART_ADDR NVARCHAR(60) 
ALTER TABLE SMDNPT 
ALTER COLUMN PART_ADDR2 NVARCHAR(40) 
ALTER TABLE SMDNPT 
ALTER COLUMN PART_ADDR3 NVARCHAR(40) 

ALTER TABLE SMSMPT 
ALTER COLUMN PART_ADDR1 NVARCHAR(60) 
ALTER TABLE SMSMPT
ALTER COLUMN PART_ADDR2 NVARCHAR(40) 
ALTER TABLE SMSMPT 
ALTER COLUMN PART_ADDR3 NVARCHAR(40) 
/********** END BY KING 2016/04/25 11:45 **********/


/********** BEGIN BY KING 2016/04/25 14:45 **********/
ALTER VIEW V_CMSUMMARY AS
SELECT  dbo.SMDN.APPROVE_TO,
		dbo.SMDN.SHIPMENT_ID,
		SMSM_1.COMBINE_INFO,
		SMSM_1.STATUS,
		dbo.SMDN.GROUP_ID,
		dbo.SMDN.CMP,
		dbo.SMDN.DN_NO,
		dbo.SMDNP.U_ID,
		dbo.SMDN.CARGO_TYPE,
		SMSM_1.CUT_PORT_DATE,
		SMSM_1.PORT_DATE,
		SMSM_1.TRAN_TYPE,
		SMSM_1.STATE,
		SMSM_1.SHIPMENT_INFO,
		SMSM_1.REMARK,
		SMSM_1.CUR,
		dbo.SMDNP.IPART_NO,
		dbo.SMDNP.JOB_NO,
		dbo.SMDNP.JQTY,
		dbo.SMDNP.PQTY,
		dbo.SMDNP.QTY,
		dbo.SMDN.SEAL_QTY,
		'CNT_TYPE' =
			CASE 
				WHEN (SMSM_1.PCNT20 > 0) THEN '20GP*' + convert(varchar(10),SMSM_1.CNT20) + ' '
				ELSE ''
			END+CASE 
				WHEN (SMSM_1.PCNT40 > 0) THEN '40GP*' + convert(varchar(10),SMSM_1.CNT40) + ' '
				ELSE ''
			END+CASE
				WHEN (SMSM_1.PCNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMSM_1.CNT40HQ) + ' '
				ELSE ''
			END
		,'' AS 'CNT_NUMBER',
		SMSM_1.CNT_TYPE,
		dbo.SMDNP.PRODUCT_LINE,
		dbo.SMDNP.IQTY,
		dbo.SMDNP.WQTY,
		dbo.SMDNP.CNTR_STD_QTY,
		SMSM_1.TORDER,

	(SELECT TOP (1) PARTY_NO
		FROM dbo.SMSMPT
		WHERE (PARTY_TYPE = 'FS')
			AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS CA_NO,

	(SELECT TOP (1) PARTY_NAME
		FROM dbo.SMSMPT
		WHERE (PARTY_TYPE = 'FS')
			AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS CA_NM,

	(SELECT TOP (1) PARTY_NO
		FROM dbo.SMSMPT
		WHERE (PARTY_TYPE = 'CR')
			AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NO,

	(SELECT TOP (1) PARTY_NAME
		FROM dbo.SMSMPT
		WHERE (PARTY_TYPE = 'CR')
			AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NM,
		dbo.SMDNP.OPART_NO,
		dbo.SMDNP.QTYU,
		dbo.SMDNP.UNIT_PRICE1,
		dbo.SMDNP.UNIT_PRICE1 AS PRICE,
		dbo.SMDNP.PKG_NUM,
		dbo.SMDNP.CBM,
		dbo.SMDNP.GW,
		dbo.SMDNP.DOWN_FLAG,
		dbo.SMDNP.U_ID AS Expr1,
		dbo.SMDN.STN
FROM dbo.SMDN
INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID
/********** END BY KING 2016/04/25 14:45 **********/

/********** ADD BY TIM 2016/04/26 14:45 **********/
ALTER VIEW V_CMEXCEL AS
SELECT '' AS 'USE_DATE',
	SMDNP.U_ID,
	PRODUCT_LINE,
	IPART_NO,
	JQTY,
	JOB_NO,
	'' AS RESERVE_HOUR,
	'' AS 'REMARK1',
	SMDNP.QTY,
	SMDNP.QTYU,
	SMSM.CARRIER_NM AS 'CARRIER',
	(SELECT TOP 1 PARTY_NAME FROM SMSMPT WHERE SMSMPT.SHIPMENT_ID=SMSM.SHIPMENT_ID AND PARTY_TYPE='CR') AS TRUCKER,
	'CNT_TYPE' =
		CASE 
			WHEN (SMDN.CNT20 > 0) THEN '20GP*' + convert(varchar(10),SMDN.CNT20) + ' '
			ELSE ''
		END+CASE 
			WHEN (SMDN.CNT40 > 0) THEN '40GP*' + convert(varchar(10),SMDN.CNT40) + ' '
			ELSE ''
		END+CASE
			WHEN (SMDN.CNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMDN.CNT40HQ) + ' '
			ELSE ''
		END
	,'' AS 'CNT_NUMBER',
	SMDNP.DN_NO,
	SMSM.COMBINE_INFO,
	SMDN.DN_RMARK AS 'REMARK2',
	'' AS 'CUST_CD',
	'' AS 'CNTR_NO',
	'' AS 'TRUCK_NO',
	SMDN.CREATE_BY,
	SMDNP.DOWN_FLAG
FROM SMDNP
INNER JOIN SMDN ON SMDN.U_ID=SMDNP.U_FID
INNER JOIN SMSM ON SMSM.SHIPMENT_ID=SMDN.SHIPMENT_ID AND SMSM.TORDER='S'
/********** END BY TIM 2016/04/26 14:45 **********/

/********** BEGIN BY TIM 2016/04/26 21:31 **********/

  
ALTER VIEW [dbo].[V_FCL01]
AS
SELECT A.*,B.PARTY_NAME, B.PART_ADDR1, B.PART_ADDR2, B.PART_ADDR3, B.PARTY_TEL, B.PARTY_ATTN, B.PARTY_NO, B.PARTY_TYPE, B.PARTY_MAIL, C.PARTY_FAX,
D.CNTR_NO, D.SEAL_NO1, D.CNTY_TYPE, E.AC_NO, C.PIC,
B.ORDER_BY, 
(SELECT TOP 1 SHPR_NM FROM SMSIM WHERE SMSIM.[PROFILE]=A.PROFILE_CD) AS SHPR_NM,
(SELECT TOP 1 COMMODITY FROM SMSIM WHERE SMSIM.[PROFILE]=A.PROFILE_CD) AS SI_COMMODITY,
(SELECT TOP 1 ISNULL(CD_DESCP,A.PKG_UNIT) FROM BSCODE WHERE  BSCODE.CD_TYPE='UB' AND  BSCODE.CD=A.PKG_UNIT AND  BSCODE.GROUP_ID=A.GROUP_ID) PKG_UNIT_UB,
(SELECT TOP 1 TAX_NO FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) TAX_NO,
(SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD=A.QTYU) QTYU_DESCP,
(SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID=A.SHIPMENT_ID) AMOUNT1,
(SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME1,
(SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME2,
(SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME3,
(SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO) PARTY_NAME4,
(SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_ADDR1,
(SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=B.PARTY_NO ) TITLE_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='FS') FS_NAME,
(SELECT TOP (1) PARTY_NAME FROM SMSMPT WHERE SHIPMENT_ID=A.SHIPMENT_ID AND PARTY_TYPE ='SP') SP_NAME
FROM SMSM A 
LEFT JOIN SMSMPT B ON A.SHIPMENT_ID=B.SHIPMENT_ID
LEFT JOIN SMPTY C ON B.PARTY_NO=C.PARTY_NO AND C.STATUS='U'
LEFT JOIN SMRV D ON A.SHIPMENT_ID=D.SHIPMENT_ID
LEFT JOIN SMEX_ACCT E ON B.PARTY_NO=E.EXPRESS_CD

/********** END BY TIM 2016/04/26 21:31 **********/

/********** BEGIN BY WILL 2016/04/26 22:20 **********/
ALTER TABLE SMBD ALTER COLUMN PARTY_ATTN NVARCHAR(20);
ALTER TABLE SMSM ADD PARTIAL_FLAG NVARCHAR(1);
ALTER TABLE SMBD ADD GVALUE NUMERIC(18,2);
ALTER TABLE SMBD ADD CUR NVARCHAR (3);
/********** END BY WILL 2016/04/26 22:20 **********/
ALTER TABLE SMSM ADD CR_NM NVARCHAR (70);
ALTER TABLE SMSM ADD BR_NM NVARCHAR (70);
ALTER TABLE SMSM DROP COLUMN CR_NAME;
ALTER TABLE SMSM DROP COLUMN BR_NAME;


/********** BEGIN BY KING 2016/04/27 08:20 **********/
 ALTER TABLE SMRV 
 ALTER COLUMN TEMP_GATENO nvarchar(4)
  ALTER TABLE SMRV 
 ALTER COLUMN GATE_NO nvarchar(4)

   ALTER TABLE SYS_NOTICE_RECORD
  ALTER COLUMN NOTICE_DATE datetime
 /********** END BY KING 2016/04/27 08:20 **********/

/********** BEGIN BY Tim 2016/04/27 08:20 **********/
正式机已经执行这段sql
INSERT INTO [dbo].[BSCODE_KIND]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[MODIFY_BY]
           ,[DEP])
     VALUES
           ('TPV'
           ,'TCS'
           ,'成本建档'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'MANA10'
           ,'*')
 /********** END BY Tim 2016/04/27 08:20 **********/

/********** BEGIN BY Tim 2016/04/27 16:20 **********/
 	ALTER TABLE SMBIM ADD APPROVE_TO NVARCHAR(10)
	ALTER TABLE SMBIM ADD APPROVE_BACK NVARCHAR(1)
	ALTER TABLE SMBIM ADD APPROVE_NO NVARCHAR(20)
	ALTER TABLE SMBIM ADD APPROVE_TYPE NVARCHAR(10)
/********** END BY Tim 2016/04/27 16:20 **********/


/********** BEGIN BY FISH 2016/04/27 23:23 **********/
 ALTER TABLE SMDNPT ALTER COLUMN CONTACT nvarchar(80);
 ALTER TABLE SMSMPT ALTER COLUMN PARTY_ATTN nvarchar(80);
 ALTER TABLE TKBLPT ALTER COLUMN PARTY_ATTN nvarchar(80);
 ALTER TABLE SMPTY ALTER COLUMN PARTY_ATTN nvarchar(80);
 ALTER TABLE SMQTM ADD TRAN_TYPE NVARCHAR(1);
   ALTER TABLE SMSM ALTER COLUMN LSP_NM nvarchar(70);
  ALTER TABLE SMQTM ALTER COLUMN LSP_NM nvarchar(70);
  ALTER TABLE SMRQM ALTER COLUMN RLOCATION_NM nvarchar(70);
 /********** END BY FISH 2016/04/27 23:23 **********/


/********** BEGIN BY Tim 2016/04/28 23:23 **********/
 ALTER VIEW V_CMSUMMARY AS
 SELECT  dbo.SMDN.APPROVE_TO,
 		dbo.SMDN.SHIPMENT_ID,
 		SMSM_1.COMBINE_INFO,
 		SMSM_1.STATUS,
 		dbo.SMDN.GROUP_ID,
 		dbo.SMDN.CMP,
 		dbo.SMDN.DN_NO,
 		dbo.SMDNP.U_ID,
 		dbo.SMDN.CARGO_TYPE,
 		SMSM_1.CUT_PORT_DATE,
 		SMSM_1.PORT_DATE,
 		SMSM_1.TRAN_TYPE,
 		SMSM_1.STATE,
 		SMSM_1.SHIPMENT_INFO,
 		SMSM_1.REMARK,
 		SMSM_1.CUR,
 		dbo.SMDNP.IPART_NO,
 		dbo.SMDNP.JOB_NO,
 		dbo.SMDNP.JQTY,
 		dbo.SMDNP.PQTY,
 		dbo.SMDNP.QTY,
 		dbo.SMDN.SEAL_QTY,
 		'CNT_TYPE' =
 			CASE 
 				WHEN (SMSM_1.PCNT20 > 0) THEN '20GP*' + convert(varchar(10),SMSM_1.CNT20) + ' '
 				ELSE ''
 			END+CASE 
 				WHEN (SMSM_1.PCNT40 > 0) THEN '40GP*' + convert(varchar(10),SMSM_1.CNT40) + ' '
 				ELSE ''
 			END+CASE
 				WHEN (SMSM_1.PCNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMSM_1.CNT40HQ) + ' '
 				ELSE ''
 			END+CASE
 				WHEN (SMSM_1.CNT_TYPE <> '') THEN SMSM_1.CNT_TYPE
 				ELSE ''
 			END,
 		SMSM_1.CNT_NUMBER,
 		dbo.SMDNP.PRODUCT_LINE,
 		dbo.SMDNP.IQTY,
 		dbo.SMDNP.WQTY,
 		dbo.SMDNP.CNTR_STD_QTY,
 		SMSM_1.TORDER,
		SMSM_1.CARRIER AS CA_NO,
		SMSM_1.CARRIER_NM AS CA_NM,
 	(SELECT TOP (1) PARTY_NO
 		FROM dbo.SMSMPT
 		WHERE (PARTY_TYPE = 'CR')
 			AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NO,

 	(SELECT TOP (1) PARTY_NAME
 		FROM dbo.SMSMPT
 		WHERE (PARTY_TYPE = 'CR')
 			AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NM,
 		dbo.SMDNP.OPART_NO,
 		dbo.SMDNP.QTYU,
 		dbo.SMDNP.UNIT_PRICE1,
 		dbo.SMDNP.UNIT_PRICE1 AS PRICE,
 		dbo.SMDNP.PKG_NUM,
 		dbo.SMDNP.CBM,
 		dbo.SMDNP.GW,
 		dbo.SMDNP.DOWN_FLAG,
 		dbo.SMDNP.U_ID AS Expr1,
 		dbo.SMDN.STN
 FROM dbo.SMDN
 INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
 INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID

ALTER VIEW V_CMEXCEL AS
SELECT '' AS 'USE_DATE',
	SMDNP.U_ID,
	PRODUCT_LINE,
	IPART_NO,
	JQTY,
	JOB_NO,
	'' AS RESERVE_HOUR,
	'' AS 'REMARK1',
	SMDNP.QTY,
	SMDNP.QTYU,
	SMSM.CARRIER_NM AS 'CARRIER',
	(SELECT TOP 1 PARTY_NAME FROM SMSMPT WHERE SMSMPT.SHIPMENT_ID=SMSM.SHIPMENT_ID AND PARTY_TYPE='CR') AS TRUCKER,
	'CNT_TYPE' =
		CASE 
			WHEN (SMDN.CNT20 > 0) THEN '20GP*' + convert(varchar(10),SMDN.CNT20) + ' '
			ELSE ''
		END+CASE 
			WHEN (SMDN.CNT40 > 0) THEN '40GP*' + convert(varchar(10),SMDN.CNT40) + ' '
			ELSE ''
		END+CASE
			WHEN (SMDN.CNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMDN.CNT40HQ) + ' '
			ELSE ''
		END
	,'' AS 'CNT_NUMBER',
	SMDNP.DN_NO,
	SMSM.COMBINE_INFO,
	SMDN.DN_RMARK AS 'REMARK2',
	'' AS 'CUST_CD',
	'' AS 'CNTR_NO',
	'' AS 'TRUCK_NO',
	SMDN.CREATE_BY,
	SMDNP.DOWN_FLAG
FROM SMDNP
INNER JOIN SMDN ON SMDN.U_ID=SMDNP.U_FID
INNER JOIN SMSM ON SMSM.SHIPMENT_ID=SMDN.SHIPMENT_ID AND SMSM.TORDER='S'

ALTER TABLE SMPTY ADD PART_ADDR4 NVARCHAR(40)
ALTER TABLE SMPTY ADD PART_ADDR5 NVARCHAR(40)
ALTER TABLE APPROVE_ATTR_D ADD SEQ_NO NUMERIC(12,0)
/********** END BY Tim 2016/04/28 23:23 **********/


ALTER VIEW [dbo].[V_IPQ02]
AS
SELECT B.SEQ_NO,A.QTYU AS M_QTYU,A.CUR,B.OHS_CODE,B.PROD_DESCP,C.PAY_TERM_CD,C.PAY_DESCP,A.U_ID, A.INVOICE_TYPE, A.BILL_TO, A.BILL_NM, A.VAT_NO, A.SHPR_CD, A.SHPR_NM, A.CNEE_CD, A.CNEE_NM, A.NOTIFY_NO, NOTIFY_NM,
       A.CMDTY_CD, A.CMDTY_DESCP, A.TRADE_TERM, A.INCOTERM_DESCP, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP,
       A.PACKING_NO, A.PACKING_RMK, A.CNTRY_ORN, A.CNTRY_DESCP, A.INV_DATE, A.INV_NO, A.SO_NO, B.PO_NO, A.REF_NO,
       A.ETD, A.ETA, A.VESSEL, A.SHIPPING_DATE, A.BL_NO, A.DLV_WAY, A.TTL_QTY AS M_TTL_QTY, A.TTL_NW AS M_TTL_NW, 
       A.TTL_GW AS M_TTL_GW, A.TTL_CBM AS M_TTL_CBM, A.DN_NO, A.FREIGHT_FEE, A.ISSUE_FEE, B.U_FID AS IU_FID,
       A.MARKS, B.OPART_NO, B.PART_NO, B.IPART_NO, B.GOODS_DESCP, B.BRAND, B.QTY, B.QTYU, B.CUR1, B.UNIT_PRICE1, B.amt, B.IHS_CODE,
	   A.INVOICE_RMK, A.VESSEL_NM, A.SHIPMENT_ID, A.INCOTERM, A.TRADETERM_DESCP, A.TTL_VALUE,
	   A.TTL_PLT, C.CNT20, C.CNT40, C.CNT40HQ, C.CNT_TYPE,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

	   (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO =A.SHPR_CD AND STATUS='U') AS PIC,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD ) PART_ADDR3,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMPTY WHERE PARTY_NO=C.STN ) TITLE_NAME,
	   (SELECT TOP (1) PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR1,
	   (SELECT TOP (1) PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO ) BILL_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='AG') Sodl_ADDR3,
	   (SELECT TOP (1) PARTY_NAME FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_NAME,
	   (SELECT TOP (1) PART_ADDR  FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR,
	   (SELECT TOP (1) PART_ADDR2 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR2,
	   (SELECT TOP (1) PART_ADDR3 FROM SMDNPT WHERE DN_NO=A.DN_NO AND PARTY_TYPE='WE') Shi_ADDR3,
	   (SELECT TOP (1) CNTRY_NM   FROM BSCNTY WHERE CNTRY_CD=SUBSTRING(A.FROM_CD,1,2) AND GROUP_ID=A.GROUP_ID AND CMP=A.CMP) CNTRY_NM,
	   (SELECT TOP (1) MEMO       FROM SMDN  WHERE DN_NO=A.DN_NO) MEMO,
	   (SELECT TOP (1) GOODS      FROM SMDN  WHERE DN_NO=A.DN_NO) DN_GOODS	     
FROM SMINM A LEFT JOIN SMIND B ON A.U_ID=B.U_FID
             LEFT JOIN SMDN C ON A.DN_NO=C.DN_NO

/********** begin BY buru 2016/04/28 20:34 **********/
 ALTER TABLE SMDN ADD SEND_SFIS_FLAG VARCHAR(1)
 /********** END BY buru 2016/04/29 20:34 **********/

/********** begin BY fish 2016/04/29 8:34 **********/
 ALTER TABLE SMSM ALTER COLUMN CBM numeric(18, 3);

 
ALTER VIEW [dbo].[V_IPQ05] AS
Select P.SAFETY_MODEL,B.IHS_CODE,B.OPART_NO,B.PROD_DESCP,B.IPART_NO,A.U_ID, A.DLV_WAY,A.TTL_PLT,A.PLTU,A.PKG_UNIT_DESC, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.SHPR_CD, A.SHPR_NM,
       A.SHIP_TO, A.SHIP_NM, A.CNEE_CD, A.CNEE_NM, A.BILL_TO, A.BILL_NM, A.NOTIFY_NO, A.NOTIFY_NM,
       A.SO_NO, A.PO_NO, A.MARKS, A.FROM_CD, A.FROM_DESCP, A.TO_CD, A.TO_DESCP, 
       ISNULL(B.CASE_NO,B.PLA_NO) AS CASE_NO, B.CASE_NUM, B.QTY, B.QTYU, B.GOODS_DESCP, B.NW, B.GW, B.CBM, B.TTL_QTY, B.TTL_NW, B.TTL_GW,
       B.TTL_CBM, B.SEQ_NO, B.U_FID AS PU_FID, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.TTL_VALUE, A.CUR, A.CMP AS LOCATION, B.TTL_QTY AS TTLQTY,
       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) AS TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,

	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,

       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
	   (SELECT TOP 1 
(CASE  WHEN PART_ADDR IS NULL THEN '' WHEN PART_ADDR = '' THEN '' ELSE PART_ADDR+',' END)+
(CASE  WHEN PART_ADDR2 IS NULL THEN '' WHEN PART_ADDR2 = '' THEN '' ELSE PART_ADDR2+',' END)+
(CASE  WHEN PART_ADDR3 IS NULL THEN '' WHEN PART_ADDR3 = '' THEN '' ELSE PART_ADDR3+',' END)
       FROM SMDNPT WHERE PARTY_TYPE='AG' AND SMDNPT.DN_NO=C.DN_NO) BILL_ADDR1,
	   (SELECT TOP 1 PARTY_NAME FROM SMDNPT WHERE PARTY_TYPE='AG' AND SMDNPT.DN_NO=C.DN_NO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMINP B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO LEFT JOIN SMDNP P ON A.DN_NO = P.DN_NO AND B.IPART_NO=P.IPART_NO


ALTER VIEW [dbo].[V_IPQ06] AS
SELECT A.CUR,B.IHS_CODE,B.OHS_CODE,B.PROD_DESCP,A.TRANSACTE_MODE,(CASE  A.TRANSACTE_MODE WHEN 'A' THEN '一般貿易' WHEN 'B' THEN '进料对口' WHEN 'C' THEN '进料复出' WHEN 'O' THEN '其它' ELSE '' END) AS TRANSACTE_MODENAME,
       B.OPART_NO,B.IPART_NO,B.BRAND,C.PAY_TERM_CD,C.PAY_DESCP,A.CMDTY_CD,A.U_ID,A.LGOODS, A.INVOICE_TYPE, B.U_ID AS P_UID, A.DN_NO, A.INV_DATE, A.BILL_TO, A.BILL_NM,
       A.CNEE_CD, A.CNEE_NM, A.SHIP_TO, A.SHIP_NM, A.SHPR_CD, A.SHPR_NM, A.FROM_CD, 
       A.FROM_DESCP, A.TO_CD, A.TO_DESCP, A.INCOTERM, A.INCOTERM_DESCP, A.TRADE_TERM, A.TRADETERM_DESCP,
       A.ISSUE_FEE, A.FREIGHT_FEE, A.MARKS, B.GOODS_DESCP, B.QTY, B.CUR1, B.UNIT_PRICE1, 
       B.AMT, A.PO_NO, A.SO_NO, A.INV_NO, B.SEQ_NO, B.U_FID AS IU_FID, A.INVOICE_RMK, B.PART_NO
       A.TTL_VALUE,
       A.CMP AS LOCATION, B.QTYU, C.FREIGHT_TERM AS FREIGHTTERM, Convert(nvarchar(12),B.QTY)+B.QTYU AS QTYUU,
       A.DLV_WAY,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_NAME4,

       (SELECT TOP 1 PIC FROM SMPTY WHERE PARTY_NO=C.STN AND STATUS='U') PIC,
       (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_NAME,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE (PARTY_NO = C.STN)) TITLE_ADDR3,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHPR_CD) SHPR_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_NAME4,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.CNEE_CD) CNEE_ATTN,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_TEL,
       (SELECT TOP 1 PARTY_MAIL FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_MAIL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.NOTIFY_NO) NOTIFY_FAX,
       (SELECT TOP 1 PART_ADDR1 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.SHIP_TO) SHIP_FAX,
	   (SELECT TOP 1 PARTY_NAME FROM SMDNPT WHERE PARTY_TYPE='AG' AND SMDNPT.DN_NO=C.DN_NO) BILL_NAME1,
	   (SELECT TOP 1 PARTY_NAME2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME2,
	   (SELECT TOP 1 PARTY_NAME3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME3,
       (SELECT TOP 1 PARTY_NAME4 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_NAME4,
     	   (SELECT TOP 1 
(CASE  WHEN PART_ADDR IS NULL THEN '' WHEN PART_ADDR = '' THEN '' ELSE PART_ADDR+',' END)+
(CASE  WHEN PART_ADDR2 IS NULL THEN '' WHEN PART_ADDR2 = '' THEN '' ELSE PART_ADDR2+',' END)+
(CASE  WHEN PART_ADDR3 IS NULL THEN '' WHEN PART_ADDR3 = '' THEN '' ELSE PART_ADDR3+',' END)
       FROM SMDNPT WHERE PARTY_TYPE='AG' AND SMDNPT.DN_NO=C.DN_NO) BILL_ADDR1,
       (SELECT TOP 1 PART_ADDR2 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR2,
       (SELECT TOP 1 PART_ADDR3 FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ADDR3,
       (SELECT TOP 1 PARTY_TEL FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_TEL,
       (SELECT TOP 1 PARTY_FAX FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_FAX,
       (SELECT TOP 1 PARTY_ATTN FROM SMPTY WHERE PARTY_NO=A.BILL_TO) BILL_ATTN
FROM SMINM A 
LEFT JOIN SMIND B ON A.U_ID=B.U_FID
LEFT JOIN SMDN C ON C.DN_NO = A.DN_NO
 /********** END BY fish 2016/04/29 8:34 **********/

 /********** ADD BY TIM 2016/04/29 15:34 **********/
ALTER TABLE SMRV ADD DIM NVARCHAR(20)
ALTER TABLE SMRV ADD SMCREATE_BY NVARCHAR(30)
 UPDATE
    SMRV
SET
   SMRV.SMCREATE_BY=SMSM.CREATE_BY
FROM
    SMRV
INNER JOIN
    SMSM
ON
    SMRV.SHIPMENT_ID = SMSM.SHIPMENT_ID
  /********** END BY TIM 2016/04/29 15:34 **********/

    ALTER TABLE SMSM ALTER COLUMN PCBM numeric(18, 3);

 /********** ADD BY TIM 2016/05/03 15:34 **********/
ALTER TABLE SMINM
ALTER COLUMN TTL_GW NUMERIC(12,3)
ALTER TABLE SMINM
ALTER COLUMN TTL_NW NUMERIC(12,3)
ALTER TABLE SMBIM ADD DEP NVARCHAR(10)
 /********** END BY TIM 2016/05/03 15:34 **********/
 /********** END BY TIM 2016/05/03 15:34 **********/

  /********** ADD BY WILL 2016/05/03 15:34 **********/
 ALTER TABLE SMDN ALTER COLUMN GW DECIMAL(18,3);
ALTER TABLE SMDN ALTER COLUMN NW DECIMAL(18,3);
ALTER TABLE SMDNP ALTER COLUMN CBM DECIMAL(8,3);
ALTER TABLE SMDNP ALTER COLUMN GW DECIMAL(18,3);
ALTER TABLE SMINM ALTER COLUMN TTL_GW NUMERIC(12,3);
ALTER TABLE SMINM ALTER COLUMN TTL_NW NUMERIC(12,3);
ALTER TABLE SMSM ALTER COLUMN GW DECIMAL(18,3);
ALTER TABLE SMSM ALTER COLUMN NW DECIMAL(18,3);
  /********** END BY WILL 2016/05/03 15:34 **********/
      /********** BEGAIN BY KING 2016/05/03 14:34 **********/
    ALTER TABLE SMSM ALTER COLUMN PCBM numeric(18, 3);


	INSERT INTO [dbo].[BSCODE_KIND]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[MODIFY_BY]
           ,[DEP])
     VALUES
           ('TPV'
           ,'SYS'
           ,'系統參數'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'MANA10'
           ,'*')


		   INSERT INTO [dbo].[BSCODE]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[ORDER_BY]
		   ,[AP_CD])
     VALUES
           ('TPV'
           ,'SYS'
           ,'COOKIE'
           ,'COOKIE存活時間(H)'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,'0'
		   ,'8')

/********** END BY KING 2016/05/03 14:34 **********/
/********** ADD BY WILL 2016/05/03 20:25 **********/
  CREATE VIEW V_SMDN
AS

SELECT SMSM.STATUS AS SM_STATUS,SMSM.RLS_CNTR_DATE,SMDN.* 
FROM SMDN LEFT JOIN SMSM ON SMSM.SHIPMENT_ID=SMDN.SHIPMENT_ID

GO
/********** END BY WILL 2016/05/03 20:25 **********/

ALTER TABLE SMRV 
ALTER COLUMN DIM NVARCHAR(50)
/********** END BY WILL 2016/05/03 20:25 **********/

/********** BEGIN BY WILL 2016/05/04 23:58 **********/
ALTER TABLE SMBD ADD CENT_DECL NVARCHAR(1);
ALTER TABLE SMBD ADD COST_CENTER NVARCHAR(20);
ALTER TABLE SMBD ADD TRADE_TERM NVARCHAR(3);
ALTER TABLE SMBD ADD TRADETERM_DESCP NVARCHAR(30);
ALTER TABLE SMBD ADD PKG_NUM Decimal(12,0);
ALTER TABLE SMBD ADD PKG_UNIT NVARCHAR(20);
ALTER TABLE SMBD ADD PKG_UNIT_DESC NVARCHAR(100);
/********** END BY WILL 2016/05/04 23:58 **********/

/********** BEGIN BY Tim 2016/05/05 23:58 **********/
ALTER TABLE SMIND ADD SAFETY_MODEL NVARCHAR(18)
ALTER TABLE SMINP ADD SAFETY_MODEL NVARCHAR(18)
ALTER TABLE SMBIM ADD APPROVE_USER NVARCHAR(30);
ALTER TABLE SMBIM ADD APPROVE_TO NVARCHAR(10);
ALTER TABLE SMBIM ADD APPROVE_BACK NVARCHAR(1);
ALTER TABLE SMBIM ADD APPROVE_TYPE NVARCHAR(10);
/********** BEGIN BY Tim 2016/05/05 23:58 **********/


ALTER TABLE SMDNP ADD DOWN_USER NVARCHAR(20)


/********** BEGIN BY Tim 2016/05/09 23:58 **********/
ALTER VIEW [dbo].[V_CMSUMMARY] AS
SELECT  dbo.SMDN.APPROVE_TO,
  dbo.SMDN.SHIPMENT_ID,
  SMSM_1.COMBINE_INFO,
  SMSM_1.STATUS,
  dbo.SMDN.GROUP_ID,
  dbo.SMDN.CMP,
  dbo.SMDN.DN_NO,
  dbo.SMDNP.U_ID,
  dbo.SMDN.CARGO_TYPE,
  SMSM_1.CUT_PORT_DATE,
  SMSM_1.PORT_DATE,
  SMSM_1.TRAN_TYPE,
  SMSM_1.STATE,
  SMSM_1.SHIPMENT_INFO,
  SMSM_1.REMARK,
  SMSM_1.CUR,
  dbo.SMDNP.IPART_NO,
  dbo.SMDNP.JOB_NO,
  dbo.SMDNP.JQTY,
  dbo.SMDNP.PQTY,
  dbo.SMDNP.QTY,
  dbo.SMDN.SEAL_QTY,
  'CNT_TYPE' =
   CASE 
    WHEN (SMSM_1.PCNT20 > 0) THEN '20GP*' + convert(varchar(10),SMSM_1.CNT20) + ' '
    ELSE ''
   END+CASE 
    WHEN (SMSM_1.PCNT40 > 0) THEN '40GP*' + convert(varchar(10),SMSM_1.CNT40) + ' '
    ELSE ''
   END+CASE
    WHEN (SMSM_1.PCNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMSM_1.CNT40HQ) + ' '
    ELSE ''
   END+CASE
    WHEN (SMSM_1.CNT_TYPE <> '') THEN SMSM_1.CNT_TYPE
    ELSE ''
   END,
  SMSM_1.CNT_NUMBER,
  dbo.SMDNP.PRODUCT_LINE,
  dbo.SMDNP.IQTY,
  dbo.SMDNP.WQTY,
  dbo.SMDNP.CNTR_STD_QTY,
  SMSM_1.TORDER,

 ISNULL(SMSM_1.CARRIER,(SELECT TOP (1) PARTY_NO
   FROM dbo.SMSMPT
   WHERE (PARTY_TYPE = 'FS')
    AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID))) AS CA_NO,

   ISNULL(SMSM_1.CARRIER_NM,(SELECT TOP (1) PARTY_NAME
   FROM dbo.SMSMPT
   WHERE (PARTY_TYPE = 'FS')
    AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID))) AS CA_NM,

 (SELECT TOP (1) PARTY_NO
  FROM dbo.SMSMPT
  WHERE (PARTY_TYPE = 'CR')
   AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NO,

 (SELECT TOP (1) PARTY_NAME
  FROM dbo.SMSMPT
  WHERE (PARTY_TYPE = 'CR')
   AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NM,
  dbo.SMDNP.OPART_NO,
  dbo.SMDNP.QTYU,
  dbo.SMDNP.UNIT_PRICE1,
  dbo.SMDNP.UNIT_PRICE1 AS PRICE,
  dbo.SMDNP.PKG_NUM,
  dbo.SMDNP.CBM,
  dbo.SMDNP.GW,
  dbo.SMDNP.DOWN_FLAG,
  dbo.SMDNP.U_ID AS Expr1,
  dbo.SMDN.STN
FROM dbo.SMDN
INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID

ALTER VIEW V_CMEXCEL AS
SELECT '' AS 'USE_DATE',
	SMDNP.U_ID,
	PRODUCT_LINE,
	IPART_NO,
	JQTY,
	JOB_NO,
	'' AS RESERVE_HOUR,
	'' AS 'REMARK1',
	SMDNP.QTY,
	SMDNP.QTYU,
   ISNULL(SMSM.CARRIER_NM,(SELECT TOP (1) PARTY_NAME
   FROM dbo.SMSMPT
   WHERE (PARTY_TYPE = 'FS')
    AND (SHIPMENT_ID = SMSM.SHIPMENT_ID))) AS 'CARRIER',
	(SELECT TOP 1 PARTY_NAME FROM SMSMPT WHERE SMSMPT.SHIPMENT_ID=SMSM.SHIPMENT_ID AND PARTY_TYPE='CR') AS TRUCKER,
	'CNT_TYPE' =
		CASE 
			WHEN (SMDN.CNT20 > 0) THEN '20GP*' + convert(varchar(10),SMDN.CNT20) + ' '
			ELSE ''
		END+CASE 
			WHEN (SMDN.CNT40 > 0) THEN '40GP*' + convert(varchar(10),SMDN.CNT40) + ' '
			ELSE ''
		END+CASE
			WHEN (SMDN.CNT40HQ > 0) THEN '40HQ*' +convert(varchar(10),SMDN.CNT40HQ) + ' '
			ELSE ''
		END
	,'' AS 'CNT_NUMBER',
	SMDNP.DN_NO,
	SMSM.COMBINE_INFO,
	SMDN.DN_RMARK AS 'REMARK2',
	'' AS 'CUST_CD',
	'' AS 'CNTR_NO',
	'' AS 'TRUCK_NO',
	SMDN.CREATE_BY,
	SMDNP.DOWN_FLAG,
	SMSM.SHIPMENT_ID,
	SMSM.DEP
FROM SMDNP
INNER JOIN SMDN ON SMDN.U_ID=SMDNP.U_FID
INNER JOIN SMSM ON SMSM.SHIPMENT_ID=SMDN.SHIPMENT_ID AND SMSM.TORDER='S'

ALTER TABLE SMRV
ALTER COLUMN DN_NO NVARCHAR(500)

ALTER TABLE SMINM
ALTER COLUMN COMBINE_INFO NVARCHAR(500)

ALTER TABLE SMBD
ALTER COLUMN COMBINE_INFO NVARCHAR(500)

ALTER TABLE SMDN
ALTER COLUMN COMBINE_INFO NVARCHAR(500)

ALTER TABLE SMSM
ALTER COLUMN COMBINE_INFO NVARCHAR(500)

ALTER TABLE TKBL
ALTER COLUMN REF_NO NVARCHAR(500)
/********** END BY Tim 2016/05/05 23:58 **********/
/********** END BY Tim 2016/05/05 23:58 **********/
/********** BEGAIN BY KING 2016/05/09 17:18 **********/

		   	ALTER TABLE SYS_ACCT
		   ADD PLANT_PRI NVARCHAR(100) 




   ALTER VIEW [dbo].[V_CMSUMMARY] AS
   SELECT dbo.SMDN.APPROVE_TO,
          dbo.SMDN.SHIPMENT_ID,
          SMSM_1.COMBINE_INFO,
          SMSM_1.STATUS,
   	   SMSM_1.BL_WIN,
          dbo.SMDN.GROUP_ID,
          dbo.SMDN.CMP,
          dbo.SMDN.DN_NO,
          dbo.SMDNP.U_ID,
          dbo.SMDN.CARGO_TYPE,
          SMSM_1.CUT_PORT_DATE,
          SMSM_1.PORT_DATE,
          SMSM_1.TRAN_TYPE,
          SMSM_1.STATE,
          SMSM_1.SHIPMENT_INFO,
          SMSM_1.REMARK,
          SMSM_1.CUR,
          dbo.SMDNP.IPART_NO,
          dbo.SMDNP.JOB_NO,
          dbo.SMDNP.JQTY,
          dbo.SMDNP.PQTY,
          dbo.SMDNP.QTY,
          dbo.SMDN.SEAL_QTY,
          CASE
              WHEN (ISNULL(SMSM_1.CNT20,SMSM_1.PCNT20) > 0) THEN '20GP*' + CONVERT(varchar(10), ISNULL(SMSM_1.CNT20,SMSM_1.PCNT20)) + ' '
              ELSE ''
          END + CASE
                    WHEN (ISNULL(SMSM_1.CNT40, SMSM_1.PCNT40) > 0) THEN '40GP*' + CONVERT(varchar(10), ISNULL(SMSM_1.CNT40, SMSM_1.PCNT40)) + ' '
                    ELSE ''
                END + CASE
                          WHEN (ISNULL(SMSM_1.CNT40HQ,SMSM_1.PCNT40HQ) > 0) THEN '40HQ*' + CONVERT(varchar(10), ISNULL(SMSM_1.CNT40HQ,SMSM_1.PCNT40HQ)) + ' '
                          ELSE ''
                      END + CASE
                                WHEN (SMSM_1.CNT_TYPE <> '') THEN SMSM_1.CNT_TYPE
                                ELSE ''
                            END AS CNT_TYPE,
                            SMSM_1.CNT_NUMBER,
                            dbo.SMDNP.PRODUCT_LINE,
                            dbo.SMDNP.IQTY,
                            dbo.SMDNP.WQTY,
                            dbo.SMDNP.CNTR_STD_QTY,
                            SMSM_1.TORDER,

      ISNULL((SELECT TOP (1) PARTY_NO
      FROM dbo.SMSMPT
      WHERE (PARTY_TYPE = 'FS')
       AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)),SMSM_1.CARRIER) AS CA_NO,

     ISNULL((SELECT TOP (1) PARTY_NAME
      FROM dbo.SMSMPT
      WHERE (PARTY_TYPE = 'FS')
       AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)),SMSM_1.CARRIER_NM) AS CA_NM,

     (SELECT TOP (1) PARTY_NO
      FROM dbo.SMSMPT AS SMSMPT_2
      WHERE (PARTY_TYPE = 'CR')
        AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NO,

     (SELECT TOP (1) PARTY_NAME
      FROM dbo.SMSMPT AS SMSMPT_1
      WHERE (PARTY_TYPE = 'CR')
        AND (SHIPMENT_ID = SMSM_1.SHIPMENT_ID)) AS TK_NM,
                            dbo.SMDNP.OPART_NO,
                            dbo.SMDNP.QTYU,
                            dbo.SMDNP.UNIT_PRICE1,
                            dbo.SMDNP.UNIT_PRICE1 AS PRICE,
                            dbo.SMDNP.PKG_NUM,
                            dbo.SMDNP.CBM,
                            dbo.SMDNP.GW,
                            dbo.SMDNP.DOWN_FLAG,
                            dbo.SMDNP.U_ID AS Expr1,
                            dbo.SMDN.STN,
                            dbo.SMDN.PLANT
   FROM dbo.SMDN
   INNER JOIN dbo.SMDNP ON dbo.SMDN.U_ID = dbo.SMDNP.U_FID
   INNER JOIN dbo.SMSM AS SMSM_1 ON dbo.SMDN.SHIPMENT_ID = SMSM_1.SHIPMENT_ID

/********** END BY KING 2016/05/09 17:18 **********/


ALTER TABLE SMBID ADD QTYU NVARCHAR(10)
ALTER TABLE SMBID ADD EX_RATE NUMERIC(18,6)
ALTER TABLE SMBID ADD LAMT NUMERIC(18,2)


/********** BEGIN BY FISH 2016/05/11 16:27 **********/
ALTER TABLE SMBID ADD PARTY_TYPE NVARCHAR(5);
/********** END BY FISH 2016/05/11 16:27 **********/

/********** BEGIN BY Will 2016/05/12 23:27 **********/
ALTER TABLE SMSM ADD SEND_BOOK_DATE DATETIME;
ALTER TABLE SMSM ADD INTERNAL_BK_DATE DATETIME;
ALTER TABLE SMSM ADD SEND_BROKER_DATE DATETIME;
/********** END BY Will 2016/05/12 23:27 **********/

/********** BEGIN BY Will 2016/05/15 10:24 **********/
ALTER TABLE SMSM  ALTER COLUMN GOODS NVARCHAR(2000);
ALTER TABLE SMSM  ALTER COLUMN LGOODS NVARCHAR(2000);
ALTER TABLE SMSM  ALTER COLUMN INSTRUCTION NVARCHAR(2000);
ALTER TABLE SMSM  ALTER COLUMN MARKS NVARCHAR(3000);
ALTER TABLE SMSM  ALTER COLUMN BL_RMK NVARCHAR(3000);
ALTER TABLE SMRV ALTER COLUMN DN_NO NVARCHAR(500);
ALTER TABLE SMINM ALTER COLUMN COMBINE_INFO NVARCHAR(500);
ALTER TABLE SMBD ALTER COLUMN COMBINE_INFO NVARCHAR(500);
ALTER TABLE SMDN ALTER COLUMN COMBINE_INFO NVARCHAR(500);
ALTER TABLE SMSM ALTER COLUMN COMBINE_INFO NVARCHAR(500);
ALTER TABLE SMBD ADD FRT_TERM NVARCHAR(2);
ALTER TABLE SMSM ADD ISCOMBINE_BL NVARCHAR(1);
/********** BEGIN BY Will 2016/05/15 10:24 **********/

ALTER TABLE SMBID ADD QT_DATA NVARCHAR(1)
ALTER TABLE SMBID ADD DEBIT_DATE DATE
ALTER TABLE SMBID ADD QEX_RATE NUMERIC(18,6)
ALTER TABLE SMBID ADD LSP_NM NVARCHAR(70)
ALTER TABLE SMBID ADD BILL_NM NVARCHAR(70)
ALTER TABLE SMBID ADD QLAMT NUMERIC(18,2)

ALTER TABLE APPROVE_FLOW_D ADD GROUP_ID NVARCHAR(10);
ALTER TABLE APPROVE_FLOW_D ADD CMP_ID NVARCHAR(10);

ALTER TABLE SMRV
ALTER COLUMN CNTY_TYPE NVARCHAR(10)

/********** BEGIN BY FISH 2016/05/19 18:00 **********/
ALTER TABLE SMBID ADD CHG_TYPE NVARCHAR(1);
ALTER TABLE SMDN ADD OT_COST NUMERIC(18,2);
ALTER TABLE SMDNP ADD COST_PRICE NUMERIC(18,2);
/********** BEGIN BY FISH 2016/05/19 19:00 **********/

/********** BEGIN BY Tim 2016/05/20 18:00 **********/
ALTER TABLE SMBID ADD CREATE_DATE DATETIME
ALTER TABLE SMBID ADD CREATE_BY NVARCHAR(30)
ALTER TABLE SMBID ADD MODIFY_DATE DATETIME
ALTER TABLE SMBID ADD MODIFY_BY NVARCHAR(30)
ALTER TABLE SMDN ADD FREIGHT_AMT NUMERIC(18,2)
ALTER TABLE SMBIM ADD COMBINE_INFO NVARCHAR(500)
/********** BEGIN BY Tim 2016/05/20 19:00 **********/
/********** BEGIN BY FISH 2016/05/20 19:00 **********/

/********** BEGIN BY KING 2016/05/20 10:00 **********/
 ALTER TABLE SMPTY
 ADD  IM_RECORD NVARCHAR(50)
 /********** END BY KING 2016/05/20 10:00 **********/
 /********** BEGIN BY KING 2016/05/20 10:00 **********/
  ALTER TABLE [SMCHG]
  ADD CHG_EDESCP NVARCHAR(30) 
  ALTER TABLE [SMCHG]
  ALTER COLUMN CHG_DESCP NVARCHAR(50) 

  UPDATE  [SMCHG] SET
  CHG_EDESCP = CHG_DESCP
  UPDATE  [SMCHG] SET
  CHG_DESCP = REMARK
 /********** END BY KING 2016/05/20 10:00 **********/

/********** BEGIN BY Tim 2016/05/23 18:00 **********/
 ALTER TABLE SMBID ADD COST_TONM NVARCHAR(70)
INSERT INTO BSCODE (GROUP_ID, CD_TYPE, CD, CD_DESCP, CMP, STN, CREATE_BY, CREATE_DATE) VALUES ('TPV', 'MT', 'BILL', '帐单比对结果', 'FQ', '*', 'ADMIN', '2016-05-23 17:20')
INSERT INTO BSCODE (GROUP_ID, CD_TYPE, CD, CD_DESCP, CMP, STN, CREATE_BY, CREATE_DATE) VALUES ('TPV', 'MT', 'BILL', '帐单比对结果', 'XM', '*', 'ADMIN', '2016-05-23 17:20')
ALTER TABLE SMPTY ADD EDI_CUST_NM NVARCHAR(35)
/********** BEGIN BY Tim 2016/05/23 18:00 **********/

/********** BEGIN BY Tim 2016/05/24 18:00 **********/
ALTER TABLE SMDN ADD FOB_VALUE NUMERIC(18,2)
ALTER TABLE SMDN ADD ISSUE_FEE NUMERIC(18,2)
ALTER TABLE SMINM ADD FORDER NVARCHAR(1)
/********** BEGIN BY Tim 2016/05/24 18:00 **********/

/********** BEGIN BY fish 2016/05/24 23:00 **********/
 ALTER TABLE SMQTD ALTER COLUMN PUNIT NVARCHAR(5);
 /********** BEGIN BY fish 2016/05/24 23:00 **********/

/********** BEGIN BY Tim 2016/05/26 18:00 **********/
ALTER TABLE SMRV
ALTER COLUMN CNTY_TYPE NVARCHAR(10)
ALTER TABLE SMRV
ALTER COLUMN DIM NVARCHAR(50)
/********** BEGIN BY Tim 2016/05/26 18:00 **********/

/********** BEGIN BY FISH 2016/05/26 22:27 **********/
ALTER TABLE SMBID ALTER COLUMN CHG_DESCP NVARCHAR(100);
ALTER TABLE SMCHG ALTER COLUMN CHG_EDESCP NVARCHAR(100);
/********** BEGIN BY FISH 2016/05/26 22:27 **********/

/********** BEGIN BY KING 2016/05/27 16:27 **********/
ALTER TABLE SMSM
ADD IS_EXPORT NVARCHAR(1)
/********** END BY KING 2016/05/27  16:27 **********/

/********** BEGIN BY FISH 2016/05/28 08:27 **********/
ALTER TABLE SMSM ADD TRUCK_COST NUMERIC(18,2);
ALTER TABLE SMDN ADD TRUCK_COST NUMERIC(18,2);
ALTER TABLE SMSM ADD LSP_COST NUMERIC(18,2);
ALTER TABLE SMDN ADD LSP_COST NUMERIC(18,2);
/********** BEGIN BY FISH 2016/05/28 08:27 **********/

/********** BEGIN BY FISH 2016/05/29 10:27 **********/
ALTER TABLE SMBID ADD QUOT_NO NVARCHAR(20);
ALTER TABLE SMBID ADD RFQ_NO NVARCHAR(20);

ALTER TABLE SMQTD ADD REPAY NVARCHAR(1);
ALTER TABLE SMQTM ADD CUST_CD NVARCHAR(10);
ALTER TABLE SMQTM ADD CUST_NM NVARCHAR(70);
/********** BEGIN BY FISH 2016/05/29 10:27 **********/

/********** BEGIN BY WILL 2016/05/31 09:39**********/
ALTER TABLE SMSM ADD EXTERNAL_WMS NVARCHAR(10);
ALTER TABLE SMSM ADD EXTERNAL_WMS_NM NVARCHAR(70);
ALTER TABLE SMSM ALTER COLUMN SO_NO NVARCHAR(120);
ALTER TABLE SMSM ADD DEBIT_NO NVARCHAR(10);
ALTER TABLE SMSM ADD DEBIT_NM NVARCHAR(70);
/********** END BY WILL 2016/05/31 09:39 **********/
ALTER TABLE SMSM ALTER COLUMN SO_NO NVARCHAR(120);

/********** BEGIN BY TIM 2016/05/31 10:27 **********/
ALTER TABLE SMQTM ADD APPROVE_BY NVARCHAR(10);
ALTER TABLE SMQTM ADD APPROVE_DATE DATETIME;

ALTER TABLE SMSIM ADD IM_RECORD NVARCHAR(50)
ALTER TABLE SMSIM ADD ISF_SELLER NVARCHAR(10)
ALTER TABLE SMSIM ADD ISF_SELLERNM NVARCHAR(35)
ALTER TABLE SMSIM ADD ISF_SELLERADDR1 NVARCHAR(35)
ALTER TABLE SMSIM ADD ISF_SELLERADDR2 NVARCHAR(35)
ALTER TABLE SMSIM ADD ISF_SELLERADDR3 NVARCHAR(35)
ALTER TABLE SMSIM ADD ISF_SELLERCITY NVARCHAR(5)
ALTER TABLE SMSIM ADD ISF_SELLERSTATE NVARCHAR(6)
ALTER TABLE SMSIM ADD ISF_SELLERCNTY NVARCHAR(2)
ALTER TABLE SMSIM ADD ISF_SELLERZIP NVARCHAR(10)
ALTER TABLE SMSIM ADD ISF_SELLERCNTY_NM NVARCHAR(20)
/********** BEGIN BY TIM 2016/05/31 10:27 **********/

/********** BEGIN BY TIM 2016/06/01 10:27 **********/
ALTER TABLE SMPTY ADD BANK_NM NVARCHAR(100)
ALTER TABLE SMPTY ADD BANK_ACCOUNT NVARCHAR(100)
/********** BEGIN BY TIM 2016/06/01 10:27 **********/
 ALTER TABLE SMSM ADD DECL_NUM NUMERIC(5,0);
  ALTER TABLE SMSM ADD NEXT_NUM NUMERIC(5,0);

 /********** BEGIN BY TIM 2016/06/02 10:27 **********/
 CREATE TABLE [dbo].[EDI_LIST](
	[U_ID] [nvarchar](50) NOT NULL,
	[U_FID] [nvarchar](50) NOT NULL,
	[EDI_MODEL] [nvarchar](1) NULL,
	[SOURCE_TYPE] [nvarchar](1) NULL,
	[TRIGGER_TYPE] [nvarchar](6) NULL,
	[CYCLE_DATA] [nvarchar](255) NULL,
	[SERVICE_PATH] [nvarchar](255) NULL,
	[SOURCE_PATH] [nvarchar](255) NULL,
	[SOURCE_ACCOUNT] [nvarchar](50) NULL,
	[SOURCE_PWD] [nvarchar](20) NULL,
	[SOURCE_FORMAT] [nvarchar](10) NULL,
	[SOURCE_PORT] [nvarchar](10) NULL,
	[FUNC_CODE] [nvarchar](50) NULL,
	[COURCE_FOLDER] [nvarchar](500) NULL,
	[EDI_PROGRAMER] [nvarchar](20) NULL,
	[EDI_NAMESPACE] [nvarchar](255) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[EDI_ID] [nvarchar](20) NULL,
	[EDI_NM] [nvarchar](20) NULL,
 CONSTRAINT [PK_EDI_LIST] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC,
	[U_FID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

 CREATE TABLE [dbo].[EDI_TARGET](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[CUST_CD] [nvarchar](20) NULL,
	[CUST_NM] [nvarchar](50) NULL,
	[CUST_TYPE] [nvarchar](1) NULL,
	[ATTN_NM] [nvarchar](50) NULL,
	[ATTN_TEL] [nvarchar](20) NULL,
	[ATTN_FAX] [nvarchar](20) NULL,
	[ATTN_MAIL] [nvarchar](255) NULL,
	[ATTN_ADDR] [nvarchar](255) NULL,
	[EDI_ACCOUNT] [nvarchar](50) NULL,
	[EDI_PWD] [nvarchar](20) NULL,
	[EDI_IP] [nvarchar](200) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_BSEDI] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
 /********** BEGIN BY TIM 2016/06/02 10:27 **********/

 
/********** BEGIN BY fish 2016/06/02 11:35        请务必按顺序执行，一错全错 **********/
 ALTER TABLE SMSM ADD DECL_NUM NUMERIC(5,0);
 ALTER TABLE SMSM ADD NEXT_NUM NUMERIC(5,0);

 ALTER TABLE SMBID ADD GROUP_ID NVARCHAR(10);
 ALTER TABLE SMBID ADD CMP NVARCHAR(10);
 ALTER TABLE SMBID ADD STN NVARCHAR(10);
  UPDATE SMBID SET U_FID=NULL,GROUP_ID='TPV',CMP='FQ';

UPDATE SMSM SET PPOL_CD='CNFOC' WHERE PPOL_CD='CNFUG' AND TRAN_TYPE='E';
UPDATE SMSM SET POL_CD='CNFOC' WHERE POL_CD='CNFUG' AND TRAN_TYPE='E';

UPDATE SMQTD SET REPAY=(SELECT TOP 1 REPAY FROM SMCHG WHERE SMCHG.CHG_CD=SMQTD.CHG_CD AND SMCHG.CHG_TYPE=SMQTD.CHG_TYPE
AND  SMCHG.TRAN_MODE='L')
WHERE TRAN_MODE='L' AND REPAY IS NULL;

UPDATE SMQTD SET REPAY=(SELECT TOP 1 REPAY FROM SMCHG WHERE SMCHG.CHG_CD=SMQTD.CHG_CD AND SMCHG.CHG_TYPE=SMQTD.CHG_TYPE
AND  SMCHG.TRAN_MODE='O')
WHERE TRAN_MODE='L' AND REPAY IS NULL;

UPDATE SMQTD SET REPAY='M' WHERE TRAN_MODE='L' AND REPAY IS NULL;


UPDATE SMQTD SET REPAY=(SELECT TOP 1 REPAY FROM SMCHG WHERE SMCHG.CHG_CD=SMQTD.CHG_CD AND SMCHG.CHG_TYPE=SMQTD.CHG_TYPE
AND  SMCHG.TRAN_MODE='A')
WHERE TRAN_MODE='A' AND REPAY IS NULL;

UPDATE SMQTD SET REPAY=(SELECT TOP 1 REPAY FROM SMCHG WHERE SMCHG.CHG_CD=SMQTD.CHG_CD AND SMCHG.CHG_TYPE=SMQTD.CHG_TYPE
AND  SMCHG.TRAN_MODE='O')
WHERE TRAN_MODE='A' AND REPAY IS NULL;

UPDATE SMQTD SET REPAY='M' WHERE TRAN_MODE='A' AND REPAY IS NULL;
/********** end BY fish 2016/06/02 11:35 **********/
ALTER TABLE SMPTY ADD IDENT NVARCHAR(5)
ALTER TABLE SMPTY ADD BOND_TYPE NVARCHAR(20)
ALTER TABLE SMPTY ADD BOND_ACT NVARCHAR(20)
ALTER TABLE EDI_LIST
ALTER  COLUMN TRIGGER_TYPE NVARCHAR(150)
ALTER TABLE EDI_LIST ADD REMARK NVARCHAR(1000)
ALTER TABLE EDI_LIST ADD SERVICE_PATH_Q NVARCHAR(255)
ALTER TABLE EDI_LIST ADD SERVICE_PATH_D NVARCHAR(255)

ALTER TABLE EDI_TARGET ADD REMARK NVARCHAR(1000)
ALTER TABLE EDI_TARGET ADD SOURCE_FOLDER NVARCHAR(500)
EXEC sp_rename  'EDI_LIST.EDI_MODEL', 'EDI_MODE', 'COLUMN';
EXEC sp_rename  'EDI_LIST.COURCE_FOLDER', 'SOURCE_FOLDER', 'COLUMN';
 /********** BEGIN BY TIM 2016/06/02 10:27 **********/

 /***********Begin by will 2016/06/03 08:55  **********/
 ALTER TABLE SMDNPT ADD PART_ADDR4 NVARCHAR(40);
ALTER TABLE SMDNPT ADD PART_ADDR5 NVARCHAR(40);
ALTER TABLE SMDNPT ADD FAX_NO NVARCHAR(30);
ALTER TABLE SMDNPT ADD PARTY_NAME2 NVARCHAR(70);
ALTER TABLE SMDNPT ADD PARTY_NAME3 NVARCHAR(70);
ALTER TABLE SMDNPT ADD PARTY_NAME4 NVARCHAR(70);
ALTER TABLE SMSMPT ADD PART_ADDR4 NVARCHAR(40);
ALTER TABLE SMSMPT ADD PART_ADDR5 NVARCHAR(40);
ALTER TABLE SMSMPT ADD FAX_NO NVARCHAR(30);
ALTER TABLE SMSMPT ADD PARTY_NAME2 NVARCHAR(70);
ALTER TABLE SMSMPT ADD PARTY_NAME3 NVARCHAR(70);
ALTER TABLE SMSMPT ADD PARTY_NAME4 NVARCHAR(70);
ALTER TABLE SMDNPT ADD PARTY_ATTN NVARCHAR(80);
ALTER TABLE SMSM ADD ATP DATE;
 /***********End by will 2016/06/03 08:55  **********/

ALTER TABLE SMINM
ALTER COLUMN SHPR_ADDR NVARCHAR(200)
ALTER TABLE SMINM ADD BILL_ADDR NVARCHAR(200)
ALTER TABLE SMINM ADD CNEE_ADDR NVARCHAR(200)
ALTER TABLE SMINM
ALTER COLUMN SHPR_NM NVARCHAR(140)
ALTER TABLE SMINM
ALTER COLUMN BILL_NM NVARCHAR(140)
ALTER TABLE SMINM
ALTER COLUMN CNEE_NM NVARCHAR(140)

ALTER TABLE SMWH ADD MF_NO NVARCHAR(5)
ALTER TABLE SMRV ADD MF_NO NVARCHAR(5)

UPDATE SMRV
SET SMRV.MF_NO= SMWH.MF_NO
FROM SMWH WHERE SMWH.WS_CD = SMRV.WS_CD AND SMWH.CMP='FQ'

UPDATE SMRV
SET SMRV.MF_NO= SMWH.MF_NO
FROM SMWH WHERE SMWH.WS_CD = SMRV.WS_CD AND SMWH.CMP='XM'

 /***********Begin by will 2016/06/06 16:01  **********/
ALTER TABLE SMQTD ALTER COLUMN CHG_DESCP NVARCHAR(100);
 /***********End by FISH 2016/06/06  16:01    **********/

/***********Begin by will 2016/06/06 20:16  **********/
 ALTER TABLE SMSM ADD CW numeric(18, 3);
ALTER TABLE SMSM ADD IORDER NVARCHAR(1);
 /***********End by will 2016/06/06 20:16    **********/

/**********************************!!!!!已經執行 留紀錄 不要再執行!!!!!**********************************/
UPDATE SCS_AUTONO_ITEM SET CODE_CONTENT='QP' WHERE RULE_CODE='QUOT_NO' AND CODE='CONST'
UPDATE SCS_AUTONO_ITEM SET CODE_CONTENT='AP' WHERE RULE_CODE='RFQ_NO' AND CODE='CONST'
UPDATE SCS_AUTONO_FLOWNO SET FLOW_NO='2000' WHERE RULE_CODE='QUOT_NO' AND FLOW_NO IS NOT NULL
UPDATE SCS_AUTONO_FLOWNO SET FLOW_NO='2000' WHERE RULE_CODE='RFQ_NO' AND FLOW_NO IS NOT NULL
/**********************************!!!!!已經執行 留紀錄 不要再執行!!!!!**********************************/

ALTER TABLE SMQTD ALTER COLUMN CHG_DESCP NVARCHAR(100);


INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('DEBIT_NO', 'XM', '*', 'TPV', '2015-12-15 14:35', ';XM;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('DEBIT_NO',1,'20151214','CMP','公司',2,'XM','XM','*','TPV'),
('DEBIT_NO',2,'20151214','CONST','常量',1,'DN','XM','*','TPV'),
('DEBIT_NO',3,'20151214','YY','年度',2,'YY','XM','*','TPV'),
('DEBIT_NO',4,'20151214','MM','月份',2,'MM','XM','*','TPV'),
('DEBIT_NO',5,'20151214','NO','流水號',6,NULL,'XM','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('DEBIT_NO', '帳單自動編號', '20151214', 'XM', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('DEBIT_NO', 'FQ', '*', 'TPV', '2015-12-15 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('DEBIT_NO',1,'20151214','CMP','公司',2,'FQ','FQ','*','TPV'),
('DEBIT_NO',2,'20151214','CONST','常量',1,'DN','FQ','*','TPV'),
('DEBIT_NO',3,'20151214','YY','年度',2,'YY','FQ','*','TPV'),
('DEBIT_NO',4,'20151214','MM','月份',2,'MM','FQ','*','TPV'),
('DEBIT_NO',5,'20151214','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('DEBIT_NO', '帳單自動編號', '20151214', 'FQ', '*', 'TPV')

INSERT [dbo].[BSCODE] ([GROUP_ID], [CD_TYPE], [CD], [CD_DESCP], [CMP], [STN], [CREATE_BY], [CREATE_DATE], [MODIFY_BY], [AMS_CODE], [INTTRA], [AR_CD], [AP_CD], [DEP], [APPLY], [LOCATION], [ORDER_BY]) VALUES (N'TPV', N'MT', N'BILL_AP', N'帳單簽核', N'FQ', N'*', N'ADMIN', CAST(N'2016-06-10 18:41:28.0000000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)
INSERT [dbo].[TKPMT] ([U_ID], [GROUP_ID], [CMP], [STN], [DEP], [SEQ], [MT_TYPE], [MT_NAME], [MT_CONTENT], [REMARK]) VALUES (N'30463120-b619-45bc-8343-5ce8389638c1', N'TPV', N'FQ', N'*', N'LST', NULL, N'BILL_AP', N'帳單簽核', N'&lt;p&gt;
&lt;style scoped=&quot;&quot; type=&quot;text/css&quot;&gt;table.GeneratedTable {
            width: 100%;
            background-color: #FFFFFF;
            border-collapse: collapse;
            border-width: 1px;
            border-color: #000;
            border-style: solid;
            color: #000;
        }

            table.GeneratedTable td, table.GeneratedTable th {
                border-width: 1px;
                width:100px;
                border-color: #336600;
                border-style: solid;
                padding: 3px;
            }

            table.GeneratedTable thead {
                background-color: #FFFFFF;
            }

        td.title {
            background-color: #5B9BD5;
        }
&lt;/style&gt;
&lt;!-- HTML Code --&gt;&lt;/p&gt;

&lt;table class=&quot;GeneratedTable&quot;&gt;
	&lt;tbody&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot; style=&quot;text-align: center; color: rgb(255, 255, 255); font-size: 16px;&quot;&gt;TPV E-Shipping Bill Information( For Test)&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Dear&amp;nbsp;{APPROVE_USER}:&lt;/p&gt;

&lt;table class=&quot;GeneratedTable&quot;&gt;
	&lt;tbody&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;Shipment ID&lt;/td&gt;
			&lt;td&gt;{SHIPMENT_ID}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;帐单号码&lt;/td&gt;
			&lt;td&gt;{DEBIT_NO}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;帐单日期&lt;/td&gt;
			&lt;td&gt;{DEBIT_DATE}&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;起始点&lt;/td&gt;
			&lt;td&gt;{POL}-{POL_NM}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;目的点&lt;/td&gt;
			&lt;td&gt;{POD}-{POD_NM}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;数量&lt;/td&gt;
			&lt;td&gt;{QTY} / {QTYU}&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;毛重&lt;/td&gt;
			&lt;td&gt;{GW} / {GWU}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;CBM&lt;/td&gt;
			&lt;td&gt;{CBM}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;计费种&lt;/td&gt;
			&lt;td&gt;{CW}&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;币别&lt;/td&gt;
			&lt;td&gt;{PORT_POLNM}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;金额&lt;/td&gt;
			&lt;td&gt;{POD_NM}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;汇率&lt;/td&gt;
			&lt;td&gt;{CHANNEL_CD}-{CHANNEL}&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;本地金额&lt;/td&gt;
			&lt;td&gt;{LAMT}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;发票号码&lt;/td&gt;
			&lt;td&gt;{VAT_NO}&lt;/td&gt;
			&lt;td class=&quot;title&quot;&gt;Statement No.&lt;/td&gt;
			&lt;td&gt;{STATEMENT_NO}&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;备注&lt;/td&gt;
			&lt;td colspan=&quot;5&quot;&gt;{REMARK}&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr&gt;
			&lt;td class=&quot;title&quot;&gt;拒绝原因&lt;/td&gt;
			&lt;td colspan=&quot;5&quot;&gt;{CHECK_DESCP}&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;不符合明细如下：&lt;/p&gt;

&lt;div&gt;{SMBID}&lt;/div&gt;

&lt;p style=&quot;text-align: center;&quot;&gt;請確認相關訊息後點擊下方按鈕去修正&lt;/p&gt;

&lt;p style=&quot;text-align: center;&quot;&gt;&lt;a href=&quot;http://59.60.10.236/zh-CN/Home/Index#帳務管理/AC010&quot; style=&quot;color: red; font-size: 40px;&quot;&gt;签核去&lt;/a&gt;&lt;/p&gt;
', N'')


ALTER TABLE SMINM ADD SHPR_TEL NVARCHAR(40)
ALTER TABLE SMINM ADD SHPR_ATTN NVARCHAR(80)
ALTER TABLE SMINM ADD SHPR_FAX NVARCHAR(30)

ALTER TABLE SMINM ADD BILL_TEL NVARCHAR(40)
ALTER TABLE SMINM ADD BILL_ATTN NVARCHAR(80)
ALTER TABLE SMINM ADD BILL_FAX NVARCHAR(30)

ALTER TABLE SMINM ADD CNEE_TEL NVARCHAR(40)
ALTER TABLE SMINM ADD CNEE_ATTN NVARCHAR(80)
ALTER TABLE SMINM ADD CNEE_FAX NVARCHAR(30)

 /***********Begin by will 2016/06/13 14:05  **********/
ALTER TABLE SMSM ALTER COLUMN PORT_NM NVARCHAR(80);
 /***********End by will 2016/06/13 14:05    **********/


/***********Begin by will 2016/06/14 15:11  **********/
ALTER TABLE SMSM ADD TCBM  NUMERIC(18, 3)
ALTER TABLE SMSM ADD COMBINE_OTHER  NVARCHAR(1);
ALTER TABLE SMSM ADD TELEX_RLS  NVARCHAR(1);
ALTER TABLE SMDN ADD COMBINE_OTHER  NVARCHAR(1);

ALTER TABLE SMDN ADD HORN  NVARCHAR(1);
ALTER TABLE SMDN ADD BATTERY  NVARCHAR(1);
ALTER TABLE SMDN ADD TCBM  NUMERIC(18, 3)
ALTER TABLE SMSM ADD HORN  NVARCHAR(1);
ALTER TABLE SMSM ADD BATTERY  NVARCHAR(1);

ALTER TABLE SMBD ADD COMBINE_OTHER  NVARCHAR(1);
ALTER TABLE SMBD ADD TCBM  NUMERIC(18, 3)
ALTER TABLE SMBD ADD HORN  NVARCHAR(1);
ALTER TABLE SMBD ADD BATTERY  NVARCHAR(1);
/***********End by will 2016/06/14 15:11    **********/


ALTER TABLE SMINM 
ALTER COLUMN SHIP_NM NVARCHAR(140)
ALTER TABLE SMINM ADD SHIP_ADDR NVARCHAR(255)
ALTER TABLE SMINM ADD SHIP_TEL NVARCHAR(40)
ALTER TABLE SMINM ADD SHIP_ATTN NVARCHAR(80)
ALTER TABLE SMINM ADD SHIP_FAX NVARCHAR(30)

  /***********Begin by FISH 2016/06/14 18:05  **********/
 ALTER TABLE SMQTD ADD COLLECT_BY NVARCHAR(2);
 ALTER TABLE SMQTD ADD IS_SHARE NVARCHAR(1);
 ALTER TABLE SMQTM ADD CREDIT_TO NVARCHAR(10);
 ALTER TABLE SMQTM ADD CREDIT_NM  NVARCHAR(70);
 /***********End by FISH 2016/06/14 18:05    **********/

   /***********Begin by FISH 2016/06/15 9:12  **********/
 ------------如果以下执行不通过,要根据情况而定，这句是根据dev的情况设置的  drop index IX_SMQTD_RFQ_NO ON SMQTD
 ALTER TABLE SMQTD ALTER COLUMN F3 NUMERIC(18, 6);
  /***********End by FISH 2016/06/15 9:12    **********/

 exec sp_rename 'MOD_BULLETIN.BULL_ID' ,'U_ID'
 ALTER TABLE MOD_BULLETIN
 ALTER COLUMN U_ID NVARCHAR(50)

ALTER TABLE SMINM ADD CUST_CD NVARCHAR(10)
ALTER TABLE SMINM ADD CUST_NM NVARCHAR(140)
ALTER TABLE SMINM ADD CUST_ADDR NVARCHAR(255)
ALTER TABLE SMINM ADD CUST_TEL NVARCHAR(40)
ALTER TABLE SMINM ADD CUST_ATTN NVARCHAR(80)
ALTER TABLE SMINM ADD CUST_FAX NVARCHAR(30)

ALTER TABLE TKBL ALTER COLUMN REF_NO NVARCHAR(500);
<<<<<<< .mine
ALTER TABLE SMSMPT ADD TAX_NO NVARCHAR(20);
ALTER TABLE SMDNPT ADD TAX_NO NVARCHAR(20);

ALTER TABLE SMINM ADD SEND_FRT NVARCHAR(1)

 /***********Begin by FISH 2016/06/16 17:33  **********/
 ALTER TABLE SMBID ADD IS_SHARE NVARCHAR(1);
 ALTER TABLE SMSM ADD CUSTOMS_CHECK NVARCHAR(1);
 UPDATE SMQTM SET QUOT_TYPE='A' WHERE TRAN_MODE='O' AND QUOT_TYPE='F'
 /***********End by FISH 2016/06/16 17:33    **********/
INSERT INTO BSCODE_KIND (GROUP_ID, CD_TYPE, CD_DESCP, CMP, STN)VALUES('TPV','QAT','Q&A类别', 'FQ', '*');
INSERT [dbo].[BSCODE] ([GROUP_ID], [CD_TYPE], [CD], [CD_DESCP], [CMP], [STN], [CREATE_BY], [CREATE_DATE], [MODIFY_BY], [AMS_CODE], [INTTRA], [AR_CD], [AP_CD], [DEP], [APPLY], [LOCATION], [ORDER_BY]) VALUES (N'TPV', N'QAT', N'A', N'DN相关', N'FQ', N'*', N'ADMIN', CAST(N'2016-06-10 18:41:28.0000000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)

 /***********Begin by KING 2016/06/17 17:33  **********/
ALTER TABLE SMDN
ADD  EDOC NVARCHAR(1)

SELECT          dbo.SMSM.STATUS AS SM_STATUS, dbo.SMSM.RLS_CNTR_DATE, dbo.SMDN.U_ID, dbo.SMDN.ETD, 
                            dbo.SMDN.SAP_ID, dbo.SMDN.WEEKLY, dbo.SMDN.MONTH, dbo.SMDN.YEAR, dbo.SMDN.GROUP_ID, 
                            dbo.SMDN.CMP, dbo.SMDN.STN, dbo.SMDN.DEP, dbo.SMDN.BU, dbo.SMDN.DN_NO, dbo.SMDN.ORIGIN_NO, 
                            dbo.SMDN.SAP_NO, dbo.SMDN.REF_NO, dbo.SMDN.TRAN_MODE, dbo.SMDN.TRAN_DESCP, 
                            dbo.SMDN.APPROVE_TO, dbo.SMDN.APPROVE_BACK, dbo.SMDN.COMBINE_INFO, dbo.SMDN.COMBINE_BY, 
                            dbo.SMDN.COMBINE_DATE, dbo.SMDN.SHIPMENT_ID, dbo.SMDN.DN_TYPE, dbo.SMDN.CARGO_TYPE, 
                            dbo.SMDN.CUR, dbo.SMDN.AMOUNT1, dbo.SMDN.INCOTERM, dbo.SMDN.INCOTERM_DESCP, 
                            dbo.SMDN.PAY_TERM_CD, dbo.SMDN.PAY_DESCP, dbo.SMDN.CHANNEL_CD, dbo.SMDN.CHANNEL, 
                            dbo.SMDN.DIVISION_CD, dbo.SMDN.DIVISION_DESCP, dbo.SMDN.SC_CODE, dbo.SMDN.SC_DESCP, 
                            dbo.SMDN.INV_NO, dbo.SMDN.PACKING_NO, dbo.SMDN.VAT_NO, dbo.SMDN.EXPORT_NO, dbo.SMDN.EDECL_NO, 
                            dbo.SMDN.APPROVE_NO, dbo.SMDN.POL, dbo.SMDN.POL_NM, dbo.SMDN.POD, dbo.SMDN.POD_NM, 
                            dbo.SMDN.STATE, dbo.SMDN.REGION, dbo.SMDN.REGION_NM, dbo.SMDN.SHIP_TO, dbo.SMDN.SHIP_NM, 
                            dbo.SMDN.CNEE3_CD, dbo.SMDN.CNEE3_NM, dbo.SMDN.FI_CUST_CD, dbo.SMDN.FI_CUST_NM, 
                            dbo.SMDN.SALES_CUST_CD, dbo.SMDN.SALES_CUST_NM, dbo.SMDN.EX_CD, dbo.SMDN.EX_NAME, 
                            dbo.SMDN.REVEIVE_DATE, dbo.SMDN.CNTR_QTY, dbo.SMDN.FEU, dbo.SMDN.SERVICE_MODE, 
                            dbo.SMDN.SERVICE_LOADING, dbo.SMDN.QTY, dbo.SMDN.QTYU, dbo.SMDN.GW, dbo.SMDN.GWU, dbo.SMDN.NW, 
                            dbo.SMDN.CBM, dbo.SMDN.FREIGHT_TERM, dbo.SMDN.COST, dbo.SMDN.CREATE_BY, dbo.SMDN.CREATE_DEP, 
                            dbo.SMDN.CREATE_EXT, dbo.SMDN.CREATE_DATE, dbo.SMDN.MODIFY_BY, dbo.SMDN.MODIFY_DATE, 
                            dbo.SMDN.SPEC_PROCID, dbo.SMDN.SPEC_DESCP, dbo.SMDN.SHIP_MARK, dbo.SMDN.ACT_SHIP_DATE, 
                            dbo.SMDN.ACT_POST_DATE, dbo.SMDN.DN_NO_REF, dbo.SMDN.DN_NO_CMP, dbo.SMDN.DN_NO_CMP_REF, 
                            dbo.SMDN.PORT_DEST, dbo.SMDN.PLANT, dbo.SMDN.BAND_TYPE, dbo.SMDN.TRACK_WAY, 
                            dbo.SMDN.CENT_DECL, dbo.SMDN.DEEP_PROCESS, dbo.SMDN.PLANT_NM, dbo.SMDN.SEAL_QTY, 
                            dbo.SMDN.BOOKING_AGENT, dbo.SMDN.BOOKING_NM, dbo.SMDN.PORTE_CD, dbo.SMDN.PORTE_DESCP, 
                            dbo.SMDN.ORDER_REASON, dbo.SMDN.UNICODE, dbo.SMDN.ASD_NO, dbo.SMDN.PORT_DESCP, 
                            dbo.SMDN.APPROVE_TYPE, dbo.SMDN.CNTR_NO, dbo.SMDN.TRAN_TYPE, dbo.SMDN.TRAN_TYPE_DESCP, 
                            dbo.SMDN.CNT20, dbo.SMDN.CNT40, dbo.SMDN.CNT40HQ, dbo.SMDN.CNT_TYPE, dbo.SMDN.CNT_NUMBER, 
                            dbo.SMDN.PORT_POL, dbo.SMDN.PORT_POLNM, dbo.SMDN.STATUS, dbo.SMDN.POST_FLAG, dbo.SMDN.OBU, 
                            dbo.SMDN.OSOLD_TO, dbo.SMDN.OUT_DATE, dbo.SMDN.ATRAN_TYPE, dbo.SMDN.LOADING_FROM, 
                            dbo.SMDN.LOADING_TO, dbo.SMDN.PROFILE_CD, dbo.SMDN.AG_CD, dbo.SMDN.AG_NM, dbo.SMDN.WE_CD, 
                            dbo.SMDN.WE_NM, dbo.SMDN.ZE_CD, dbo.SMDN.ZE_NM, dbo.SMDN.FC_CD, dbo.SMDN.FC_NM, 
                            dbo.SMDN.RE_CD, dbo.SMDN.RE_NM, dbo.SMDN.RO_CD, dbo.SMDN.RO_NM, dbo.SMDN.GOODS, 
                            dbo.SMDN.AC_REMARK, dbo.SMDN.PAYTERM_CD, dbo.SMDN.PAYTERM_NM, dbo.SMDN.CAR_TYPE, 
                            dbo.SMDN.PKG_NUM, dbo.SMDN.PKG_UNIT, dbo.SMDN.PKG_UNIT_DESC, dbo.SMDN.PRODUCT_DATE, 
                            dbo.SMDN.APPROVE_USER, dbo.SMDN.SH_CD, dbo.SMDN.SH_NM, dbo.SMDN.CS_CD, dbo.SMDN.CS_NM, 
                            dbo.SMDN.NT_CD, dbo.SMDN.NT_NM, dbo.SMDN.TRANSACTE_MODE, dbo.SMDN.MEMO, 
                            dbo.SMDN.COST_CENTER, dbo.SMDN.LGOODS, dbo.SMDN.BAND_DESCP, dbo.SMDN.TRADE_TERM, 
                            dbo.SMDN.TRADETERM_DESCP, dbo.SMDN.BAND_CD, dbo.SMDN.DN_RMARK, dbo.SMDN.SEND_SFIS_FLAG, 
                            dbo.SMDN.EDOC
FROM              dbo.SMDN LEFT OUTER JOIN
                            dbo.SMSM ON dbo.SMSM.SHIPMENT_ID = dbo.SMDN.SHIPMENT_ID


CREATE TABLE [dbo].[BSCAAM](
	[U_ID] [nvarchar](50) NOT NULL,
	[CARRIER] [nvarchar](10) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[AREA] [nvarchar](10) NULL,
	[AREA_NM] [nvarchar](70) NULL,
	[ATD_ATP] [nvarchar](3) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY]

 /***********End by KING 2016/06/17 17:33    **********/


 ALTER TABLE MOD_BULLETIN
ADD DEP nvarchar(10)

/**************** Add by Tim 2016/06/20 12:41 ***********************/
ALTER TABLE SMINM
ALTER COLUMN SHPR_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN SHIP_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN BILL_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN CNEE_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN CUST_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN NOTIFY_NM NVARCHAR(140)
/**************** End by Tim 2016/06/20 12:41 ***********************/


 /***********Begin by WILL 2016/06/20 18:45    **********/
 ALTER TABLE SMDN ADD TELEX_RLS  NVARCHAR(1);
 ALTER TABLE SMSM ADD ISF_SEND_DATE datetime;
 ALTER TABLE SMSM ADD ISF_WIN NVARCHAR(40);
 ALTER TABLE [MOD_BULLETIN]
ADD CREATE_BY NVARCHAR(30)
ALTER TABLE [MOD_BULLETIN]
ADD CREATE_DATE DATETIME
ALTER TABLE [MOD_BULLETIN]
ADD MODIFY_BY NVARCHAR(30)
ALTER TABLE [MOD_BULLETIN]
ADD MODIFY_DATE DATETIME
 /***********End by WILL 2016/06/20 18:45   **********/

 /**************** Add by FISH 2016/06/23 09:41 ***********************/
ALTER TABLE SMQTM ALTER COLUMN LSP_CD NVARCHAR(20);
ALTER TABLE SMQTD ALTER COLUMN LSP_CD NVARCHAR(20);
/**************** End by FISH 2016/06/23 09:41 ***********************/

/**************** Add by FISH 2016/06/24 15:41 ***********************/
UPDATE SMQTM SET FREIGHT_TERM='P' WHERE TRAN_MODE='X' AND INCOTERM='CIF'
UPDATE SMQTM SET FREIGHT_TERM='C' WHERE TRAN_MODE='X' AND INCOTERM<>'CIF'
/**************** End by FISH 2016/06/24 15:41 ***********************/

ALTER TABLE SMFSC ADD AREA_NM NVARCHAR(70)

CREATE TABLE [dbo].[SQL_ERROR_LOG](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[SQL] [text] NULL,
	[ERROR_TRACE] [text] NULL,
	[RESEND] [nvarchar](1) NULL,
	[CREATE_DATE] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

ALTER TABLE SMBIM ADD APPROVE_USER NVARCHAR(30);

ALTER TABLE SMBIM 
ALTER COLUMN BL_NO NVARCHAR(20)
ALTER TABLE SMBIM 
ALTER COLUMN LSP_NM NVARCHAR(140)

ALTER TABLE SMBID 
ALTER COLUMN BL_NO NVARCHAR(20)
ALTER TABLE SMBID 
ALTER COLUMN LSP_NM NVARCHAR(140)


/**************** Add by FISH 2016/07/06 10:19 ***********************/
ALTER TABLE TKBLST ALTER COLUMN LOCATION_DESCP NVARCHAR(300);
/**************** End by FISH 2016/07/06 10:19 ***********************/

 /**************** Add by Wil 2016/06/28 14:17 ***********************/
ALTER TABLE SMDN ADD BL_LEVEL NVARCHAR(1);
ALTER TABLE SMDN ADD ASK_TIM DATETIME;
ALTER TABLE SMDN ADD DECL_DATE DATE;
ALTER TABLE SMDN ADD RLS_DATE DATE;
ALTER TABLE SMDN ADD DRemark  NVARCHAR(50);
ALTER TABLE SMSM ADD DECL_NUM  NVARCHAR(5);
ALTER TABLE SMSM ADD NEXT_NUM  NVARCHAR(5);
 /**************** Add by Wil 2016/06/28 14:17 ***********************/

 ALTER TABLE SMSM ADD VIA  NVARCHAR(5);
ALTER TABLE SMDN ADD VIA  NVARCHAR(5);


/**************** Add by FISH 2016/07/11 13:19 ***********************/
ALTER TABLE TKBLST ALTER COLUMN REMARK NVARCHAR(500);
/**************** End by FISH 2016/07/11 10:13 ***********************/

/**************** Add by Will 2016/07/12 13:19 ***********************/
ALTER TABLE SMBDD ADD  CNTR_STD_QTY numeric(12,0); 
/**************** End by Will 2016/07/12 10:13 ***********************/

/**************** Add by FISH 2016/07/12 18:19 ***********************/
ALTER TABLE SMBID ALTER COLUMN REMARK NVARCHAR(1000);
/**************** End by FISH 2016/07/12 18:13 ***********************/

 ALTER TABLE SMSM ADD SORDER NVARCHAR(1);

 UPDATE SMQTD SET CHG_CD='AFR' WHERE CHG_CD='AFS'
 UPDATE SMBID SET CHG_CD='AFR' WHERE CHG_CD='AFS'

 /**************** Add by Will 2016/07/12 13:19 ***********************/
  ALTER TABLE SMSM ADD Sdate datetime;
  ALTER TABLE SMSM ADD SORDER_BY NVARCHAR(30);
  ALTER TABLE SMDN ADD BRG_TYPE NVARCHAR(20);
  ALTER TABLE SMSM ADD DEBIT_TO NVARCHAR(10);
/**************** End by Will 2016/07/12 10:13 ***********************/

 /**************** Add by FISH 2016/07/13 23:19 ***********************/
 UPDATE SMQTD SET CHG_CD='AFR' WHERE CHG_CD='AFS';
 UPDATE SMBID SET CHG_CD='AFR' WHERE CHG_CD='AFS';
 UPDATE SMQTD SET  CHG_CD='CTC' WHERE CHG_CD='OTC';

 ALTER TABLE SMBID ADD  DEBIT_TO NVARCHAR(10);
 ALTER TABLE SMBID ADD  DEBIT_NM NVARCHAR(100);
 ALTER TABLE SMBID ADD  CNTR_STD_QTY NUMERIC(12,0);
ALTER TABLE SMBID ADD  IPART_NO  NVARCHAR(18);

 ALTER TABLE SMBIM ADD  RECEIVER  NVARCHAR(10);
 ALTER TABLE SMBIM ADD  RECEIVER_NM  NVARCHAR(70);
 /**************** End by FISH 2016/07/13 23:13 ***********************/


/**************** Add by FISH 2016/07/14 17:19 ***********************/
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','TDLT','TPV账单付款人','FQ','*');
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','TDLT','TPV账单付款人','XM','*');
/**************** End by FISH 2016/07/14 17:13 ***********************/


/**************** Add by FISH 2016/07/18 13:19 ***********************/
ALTER TABLE SMBID ADD FSTATUS  NVARCHAR(1) DEFAULT 'A';
ALTER TABLE SMBID ADD DOWNLOAD_USER  NVARCHAR(10);
ALTER TABLE SMBID ADD DOWNLOAD_TIME  DATETIME;
/**************** End by FISH 2016/07/18 13:199 ***********************/


  /****************Modify by Will 2016/07/18*************************/
INSERT INTO [dbo].[BSCODE_KIND]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[CREATE_DATE]
           ,[MODIFY_BY]
           ,[DEP]
           ,[MODIFY_DATE])
     VALUES
           ('TPV'
           ,'ATST'
           ,'签核金额设定'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,NULL
           ,NULL
           ,NULL
           ,NULL)
GO

CREATE TABLE [dbo].[SMBKINFO](
	[U_ID] [nvarchar](40) NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[CRNCY] [nvarchar](3) NULL,
	[BANK_INFO] [nvarchar](200) NULL,
	[REMARK] [nvarchar](200) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
 CONSTRAINT [PK_SMBKINFO] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
  /****************END by Will 2016/07/18*************************/


  
/**************** Add by FISH 2016/07/21 15:19 已经更版到正式机 可以不更***********************/
ALTER TABLE SMQTD ALTER COLUMN VIA_CD NVARCHAR(10);
UPDATE SMQTD SET VIA_CD='AWR' WHERE REMARK LIKE '%(AWR)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='MLB' WHERE REMARK LIKE '%(MLB)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='NORTH' WHERE REMARK LIKE '%(NORTH)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='WEST' WHERE REMARK LIKE '%(WEST)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='SOUTH' WHERE REMARK LIKE '%(SOUTH)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='WEST' WHERE REMARK LIKE '%west%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='SOUTH' WHERE POD_NM LIKE '%south manila%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='SOUTH' WHERE POD_NM LIKE '%south%' AND POD_NM LIKE '%manila%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='NORTH' WHERE POD_NM='manila' AND VIA_CD IS NULL;

-------------UPDATE SMQTD SET VIA_CD='NORTH' WHERE POD_NM LIKE '%manila%' AND VIA_CD IS NULL;

SELECT POD_NM,REMARK FROM SMQTD WHERE REMARK LIKE '%(New port)%' AND VIA_CD IS NULL;
SELECT POD_NM,REMARK FROM SMQTD WHERE REMARK LIKE '%(Catlai)%' AND VIA_CD IS NULL;
SELECT POD_NM,REMARK FROM SMQTD WHERE REMARK LIKE '%(VICT)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='New port' WHERE REMARK LIKE '%(New port)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='Catlai' WHERE REMARK LIKE '%(Catlai)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='VICT' WHERE REMARK LIKE '%(VICT)%' AND VIA_CD IS NULL;
/**************** End by FISH 2016/07/21 15:19 ***********************/

/**************** Add by FISH 2016/07/21 20:19 ***********************/
CREATE TABLE [SMBID_TEMP](
	[SHIPMENT_ID] [nvarchar](20) NOT NULL,
	[LSP_NO] [nvarchar](20) NOT NULL,
	[CHG_CD] [nvarchar](10) NOT NULL,
	[CHG_DESCP] [nvarchar](100) NULL,
	[QUOT_NO] [nvarchar](30) NULL,
	[CHG_TYPE] [nvarchar](5) NULL,
	[CUR] [nvarchar](5) NULL,
	[REPAY] [nvarchar](1) NULL,
	[QAMT] [numeric](18, 2) NULL,
	[QLAMT] [numeric](18, 2) NULL,
	[DEBIT_TO] [nvarchar](20) NULL,
	[DEBIT_NM] [nvarchar](200) NULL,
	[CREATE_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMBID_TEMP] PRIMARY KEY CLUSTERED 
(
	[SHIPMENT_ID] ASC,
	[LSP_NO] ASC,
	[CHG_CD] ASC)
) ON [PRIMARY]
/**************** End by FISH 2016/07/21 20:19 ***********************/

/**************** End by will 2016/07/22 20:19 ***********************/
 ALTER TABLE SMBIM ADD TRAN_TYPE NVARCHAR(10);
 ALTER TABLE SMBIM ADD BANK_INFO NVARCHAR(200);
 /**************** End by will 2016/07/22 20:19 ***********************/

  ALTER TABLE SMBID ADD BI_REMARK NVARCHAR(1000);

  /**************** Begin by will 2016/07/25 10:55 ***********************/
USE [ESHIPPING]
GO

/****** Object:  Trigger [dbo].[TG_UP_SMRV_TTLVGM]    Script Date: 2016/7/25 10:04:27 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

create trigger [dbo].[TG_UP_SMRV_TTLVGM]
on [dbo].[SMRV]
    for update
as   
    if (UPDATE(GW) OR UPDATE(TARE_WEIGHT))
    begin
        UPDATE SMRV SET TTL_VGM=GW+TARE_WEIGHT WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
GO


USE [ESHIPPING]
GO

/****** Object:  Trigger [dbo].[TG_UP_SMINM_FobValue]    Script Date: 2016/7/25 10:04:27 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

create trigger [dbo].[TG_UP_SMINM_FobValue]
on [dbo].[SMINM]
    for update
as   
    if (UPDATE(TTL_VALUE) OR UPDATE(FREIGHT_FEE) OR UPDATE(ISSUE_FEE))
    begin
        UPDATE SMINM SET FOB_VALUE=TTL_VALUE-isnull(FREIGHT_FEE,0)-isnull(ISSUE_FEE,0) WHERE INV_NO IN (SELECT INV_NO FROM inserted)       
    end
GO
 /**************** End by will 2016/07/22 10:55 ***********************/

 /**************** Begin by will 2016/07/26 10:55 以下更新语法，只能执行一次***********************/
 --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"FcCd","width":100,"hidden":false},{"name":"FcNm","width":100,"hidden":false},{"name":"IpartNo","width":100,"hidden":false}]') 
--WHERE ID='Shipment List' AND LAYOUT_TYPE='GRID';

-- UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"FcCd","width":100,"hidden":false},{"name":"FcNm","width":100,"hidden":false}]') 
--WHERE ID='貨櫃管理列表' AND LAYOUT_TYPE='GRID';
 /**************** End by will 2016/07/26 10:55 *******************/

 /**************** Begin by will 2016/07/28 14:34 ***********************/
 ALTER TABLE SMBKINFO ADD COLLECT_BANK NVARCHAR (50);
ALTER TABLE SMBKINFO ADD ACCOUNT_NAME NVARCHAR (50);
ALTER TABLE SMBKINFO ADD SWIFT_CODE NVARCHAR (50);

ALTER TABLE SMBIM ADD COLLECT_BANK NVARCHAR (50);
ALTER TABLE SMBIM ADD ACCOUNT_NAME NVARCHAR (50);
ALTER TABLE SMBIM ADD SWIFT_CODE NVARCHAR (50);
 /**************** END by will 2016/07/28 14:34  ***********************/

  /**************** Begin by will 2016/07/28 14:34 ***********************/
 请更新View.txt中的的 V_CMSUMMARY,V_SMDN  视图
 /**************** END by will 2016/07/28 14:34  ***********************/
  /**************** Begin by will 2016/07/28 14:34 ***********************/
 	ALTER TABLE SMSM ADD OPTIONS nvarchar(3);
	ALTER TABLE SMSM ADD SERVICE nvarchar(3);
 /**************** END by will 2016/07/28 14:34  ***********************/

 
CREATE TABLE [dbo].[SMMATERIAL](
	[U_ID] [nvarchar](40) NOT NULL,
	[MATERIAL_TYPE] [nvarchar](5) NOT NULL,
	[CARGO_TYPE] [nvarchar](1) NOT NULL,
	[TRANSACTE_MODE] [nvarchar](2) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY]

GO

 /**************** Begin by dean  2016/08/05  ***********************/
 	VIEW [dbo].[V_FCL01]
 /**************** END  by dean  2016/08/05 ***********************/

/**************** Begin by Will  2016/08/05  ***********************/
ALTER TABLE SMDN ADD COST_CENTERDESCP NVARCHAR(70);
ALTER TABLE SMSM ADD COST_CENTERDESCP NVARCHAR(70);
 	VIEW [dbo].[V_SMDN]
/**************** END  by Will  2016/08/05 ***********************/

  /**************** Begin by dean  2016/08/08  ***********************/
 	VIEW [dbo].[V_IPQ01]
	VIEW [dbo].[V_IPQ02]
 /**************** END  by dean  2016/08/08 ***********************/

   /**************** Begin by dean  2016/08/16  ***********************/
   alter table SMINM  ADD INV_COMBINE_FLAG NVARCHAR(50);
 /**************** END  by dean  2016/08/16 ***********************/


 /**************** Begin by fish  2016/08/18  ***********************/
 alter table SMBIM  ADD TPV_DEBIT_NO NVARCHAR(20);
 alter table SMBID  ADD TRAN_TYPE NVARCHAR(10);
 UPDATE SMBID SET TRAN_TYPE=(SELECT TOP 1 TRAN_TYPE FROM SMSM WHERE SMSM.SHIPMENT_ID=SMBID.SHIPMENT_ID) WHERE TRAN_TYPE IS NULL;
 UPDATE SMBID SET CMP=(SELECT TOP 1 CMP FROM SMSM WHERE SMSM.SHIPMENT_ID=SMBID.SHIPMENT_ID) WHERE CMP IS NULL;


  INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('DEBIT_NO', '*', '*', 'TPV', '2016-02-18 14:35', '' );
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('DEBIT_NO',1,'20160218','CONST','常量',2,'DN','*','*','TPV'),
('DEBIT_NO',2,'20160218','YY','年度',2,'YY','*','*','TPV'),
('DEBIT_NO',3,'20160218','MM','月份',2,'MM','*','*','TPV'),
('DEBIT_NO',4,'20160218','NO','流水號',6,NULL,'*','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('DEBIT_NO', 'TPV账单号码', '20160218', '*', '*', 'TPV');
 /**************** END  by fish  2016/08/18 ***********************/

  /**************** Begin by fish  2016/08/20 11:43 ***********************/
 alter table SMBIM  ADD DEBIT_TYPE NVARCHAR(20);
 alter table SMBID  ALTER COLUMN DOWNLOAD_USER NVARCHAR(30);
 UPDATE SMBIM SET DEBIT_TYPE='A';
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','DTT','账单类型','FQ','*');
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','DTT','账单类型','XM','*');

INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','A','轉帳','FQ','*')
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','B','交申請人','FQ','*');
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','C','受款','FQ','*');

INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','A','轉帳','XM','*')
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','B','交申請人','XM','*');
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','C','受款','XM','*');

  /**************** END  by fish  2016/08/20 11:43 ***********************/



ALTER TABLE SMQTD ALTER COLUMN VIA_CD NVARCHAR(25);

  /**************** Begin by dean  2016/08/30 ***********************/

  V_FCL01，V_IPQ01，V_IPQ02，V_IPQ05，V_IPQ06

  alter table TMEXP alter column  DEP nvarchar(6) 

  
  alter table SMSM alter column  REF_NO nvarchar(1000) 

    alter table SMINM alter column  REF_NO nvarchar(1000) 
  /**************** END  by dean  2016/08/30 ***********************/

ALTER TABLE SMFSC ALTER COLUMN CARRIER NVARCHAR(20);
ALTER TABLE BSCAA ALTER COLUMN CARRIER NVARCHAR(20);
ALTER TABLE BSCAAM ALTER COLUMN CARRIER NVARCHAR(20);


/**************** Begin by Will  2016/08/31 ***********************/
Alter table SMRVM Alter column OGATE_NO NVARCHAR(4);
Alter table SMRVM Alter column NGATE_NO NVARCHAR(4);
  /**************** END  by Will  2016/08/31 ***********************/

  ALTER TABLE SMFSC ALTER COLUMN CARRIER NVARCHAR(20);
 ALTER TABLE BSCAA ALTER COLUMN CARRIER NVARCHAR(20);
 ALTER TABLE BSCAAM ALTER COLUMN CARRIER NVARCHAR(20);
  ALTER TABLE SMQTD ALTER COLUMN CARRIER NVARCHAR(20);

  
 /**************** Begin by dean  2016/09/7 ***********************/

alter table SMSM  ADD HOUSE_NO_FLAG NVARCHAR(1);

CREATE VIEW [dbo].[V_FCL02] 
AS
SELECT A.U_ID,A.SHIPMENT_ID,A.PPOR_NAME,A.INCOTERM_CD,A.INCOTERM_DESCP,A.LOADING_FROM,A.LOADING_TO,A.TRAN_TYPE,
		A.VOYAGE1,A.VESSEL1,A.PPOD_NAME,A.PPOD_CD,A.PDEST_NAME,A.PDEST_CD,A.MARKS,A.PKG_NUM,A.PKG_UNIT_DESC,A.PPOL_CD,
		A.QTY,A.QTYU,A.GOODS,A.LGOODS,A.GW,A.PGW,A.CNT_NUMBER,A.CNT_TYPE,A.TRACK_WAY,A.CAR_TYPE,A.CAR_QTY,A.SVC_CONTACT,
		A.PRODUCT_DATE,A.DN_ETD,A.FRT_TERM,A.SCAC_CD,A.INSTRUCTION,A.HORN,A.BATTERY,A.PCBM,A.CBM,A.PPOR_CD,A.PPOL_NAME,
		A.BL_RMK,A.MASTER_NO,A.GWU,A.POR_NAME,A.POL_NAME,A.HOUSE_NO,A.POD_NAME,A.DEST_NAME,A.SO_NO,
		(SELECT TOP 1 SHPR_NM FROM SMSIM  WHERE SMSIM.[PROFILE] = A.PROFILE_CD) AS SHPR_NM,
       (ISNULL('20''*'+convert(varchar(10),A.CNT20)+' ,','')+ISNULL('40''GP*'+convert(varchar(10),A.CNT40)+' ,','')+ISNULL('40''HQ*'+convert(varchar(10),A.CNT40HQ)+' ,','')) AS CNT,
       (ISNULL(B.PARTY_NAME+' ','')+ISNULL(B.PARTY_NAME2+' ','')+ISNULL(B.PARTY_NAME3+' ','')+ISNULL(B.PARTY_NAME4+' ','')) PARTY_NAME,
       (ISNULL(B.PART_ADDR1+',','')+ISNULL(B.PART_ADDR2+',','')+ISNULL(B.PART_ADDR3+',','')+ISNULL(B.PART_ADDR4+',','')+ISNULL(B.PART_ADDR5+',','')) PART_ADDR,
       (ISNULL(C.PARTY_NAME+' ','')+ISNULL(C.PARTY_NAME2+' ','')+ISNULL(C.PARTY_NAME3+' ','')+ISNULL(C.PARTY_NAME4+' ','')) CLIENT_NAME,
       B.PARTY_TEL,B.PARTY_ATTN,B.PARTY_NO,B.PARTY_TYPE,B.PARTY_MAIL,B.FAX_NO,C.PARTY_FAX,
       B.TAX_NO,D.CNTR_NO,D.SEAL_NO1,D.CNTY_TYPE,D.GW AS V_GW,D.GWU AS V_GWU,D.CBM AS V_CBM,
       E.AC_NO,C.PIC,B.ORDER_BY,
       (SELECT TOP 1 COMMODITY
          FROM SMSIM
         WHERE SMSIM. [PROFILE] = A.PROFILE_CD) AS SI_COMMODITY,
       (SELECT TOP 1 ISNULL(CD_DESCP, A.PKG_UNIT)
          FROM BSCODE
         WHERE BSCODE.CD_TYPE = 'UB'
           AND BSCODE.CD = A.PKG_UNIT
           AND BSCODE.GROUP_ID = A.GROUP_ID) PKG_UNIT_UB,
       (SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD = A.QTYU) QTYU_DESCP,
       (SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID = A.SHIPMENT_ID) AMOUNT1,
       (SELECT CASE
                 WHEN (CNT20 > 0) THEN
                  '20GP*' + convert(varchar(10), CNT20) + ' '
                 ELSE
                  ''
               END + CASE
                 WHEN (CNT40 > 0) THEN
                  '40GP*' + convert(varchar(10), CNT40) + ' '
                 ELSE
                  ''
               END + CASE
                 WHEN (CNT40HQ > 0) THEN
                  '40HQ*' + convert(varchar(10), CNT40HQ) + ' '
                 ELSE
                  ''
               END
          FROM SMSM
         WHERE D.SHIPMENT_ID = SMSM.SHIPMENT_ID) AS CntType,
       (SELECT TOP 1 PKG_NUM
          FROM SMSM
         WHERE D.SHIPMENT_ID = SMSM.SHIPMENT_ID) AS N_TTL_PLT,
       (SELECT TOP 1 PKG_UNIT
          FROM SMSM
         WHERE D.SHIPMENT_ID = SMSM.SHIPMENT_ID) AS N_PLTU,
         D.SHIPMENT_ID AS V_ID,
         A.COMBIN_SHIPMENT
  FROM SMSM A
  LEFT JOIN SMSMPT B
    ON A.SHIPMENT_ID = B.SHIPMENT_ID
  LEFT JOIN SMPTY C
    ON B.PARTY_NO = C.PARTY_NO
   AND C.STATUS = 'U'
  LEFT JOIN SMRV D
    ON A.SHIPMENT_ID = D.SHIPMENT_ID
    OR D.SHIPMENT_ID IN
       (SELECT SHIPMENT_ID FROM SMSM WHERE COMBIN_SHIPMENT = A.SHIPMENT_ID)
  LEFT JOIN SMEX_ACCT E
    ON B.PARTY_NO = E.EXPRESS_CD


CREATE VIEW [dbo].[V_FCL03]
AS
SELECT A.U_ID,A.SHIPMENT_ID,A.PPOR_NAME,A.INCOTERM_CD,A.INCOTERM_DESCP,A.LOADING_FROM,A.LOADING_TO,A.TRAN_TYPE,
		A.VOYAGE1,A.VESSEL1,A.PPOD_NAME,A.PPOD_CD,A.PDEST_NAME,A.PDEST_CD,A.MARKS,A.PKG_NUM,A.PKG_UNIT_DESC,A.PPOL_CD,
		A.QTY,A.QTYU,A.GOODS,A.LGOODS,A.GW,A.PGW,A.CNT_NUMBER,A.CNT_TYPE,A.TRACK_WAY,A.CAR_TYPE,A.CAR_QTY,A.SVC_CONTACT,
		A.PRODUCT_DATE,A.DN_ETD,A.FRT_TERM,A.SCAC_CD,A.INSTRUCTION,A.HORN,A.BATTERY,A.PCBM,A.CBM,A.PPOR_CD,A.PPOL_NAME,
		A.BL_RMK,A.MASTER_NO,A.GWU,A.POR_NAME,A.POL_NAME,A.HOUSE_NO,A.POD_NAME,A.DEST_NAME,A.SO_NO,A.PKG_UNIT,
       (SELECT TOP 1 TTL_PLT FROM SMINM WHERE SMINM.DN_NO = A.DN_NO) TTL_PLT,
       (SELECT TOP 1 PLTU FROM SMINM WHERE SMINM.DN_NO = A.DN_NO) PLTU,
       (ISNULL(B.PARTY_NAME+' ','')+ISNULL(B.PARTY_NAME2+' ','')+ISNULL(B.PARTY_NAME3+' ','')+ISNULL(B.PARTY_NAME4+' ','')) PARTY_NAME,
       (ISNULL(B.PART_ADDR1+',','')+ISNULL(B.PART_ADDR2+',','')+ISNULL(B.PART_ADDR3+',','')+ISNULL(B.PART_ADDR4+',','')+ISNULL(B.PART_ADDR5+',','')) PART_ADDR,
       B.PARTY_TEL,B.PARTY_ATTN,B.PARTY_NO,B.PARTY_TYPE,B.PARTY_MAIL,
       B.FAX_NO,B.TAX_NO,B.ORDER_BY,
       (SELECT TOP 1 SHPR_NM
          FROM SMSIM
         WHERE SMSIM.[PROFILE] = A.PROFILE_CD) AS SHPR_NM,
       (SELECT TOP 1 COMMODITY
          FROM SMSIM
         WHERE SMSIM. [PROFILE] = A.PROFILE_CD) AS SI_COMMODITY,
       (SELECT TOP 1 ISNULL(CD_DESCP, A.PKG_UNIT)
          FROM BSCODE
         WHERE BSCODE.CD_TYPE = 'UB'
           AND BSCODE.CD = A.PKG_UNIT
           AND BSCODE.GROUP_ID = A.GROUP_ID) PKG_UNIT_UB,
       (SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD = A.QTYU) QTYU_DESCP,
       (SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID = A.SHIPMENT_ID) AMOUNT1,
        (ISNULL(F.PARTY_NAME+' ','')+ISNULL(F.PARTY_NAME2+' ','')+ISNULL(F.PARTY_NAME3+' ','')+ISNULL(F.PARTY_NAME4+' ','')) P_SHIP_NAME,
       (ISNULL(F.PART_ADDR1+',','')+ISNULL(F.PART_ADDR2+',','')+ISNULL(F.PART_ADDR3+',','')+ISNULL(F.PART_ADDR4+',','')+ISNULL(F.PART_ADDR5+',','')) P_SHIP_ADDR,
       F.PIC AS P_PIC,F.PARTY_ATTN AS P_PARTY_ATTN,F.PARTY_TEL AS P_PARTY_TEL,F.PARTY_MAIL AS P_PARTY_MAIL,F.PARTY_FAX AS P_PARTY_FAX
  FROM SMSM A
  LEFT JOIN SMSMPT B
    ON A.SHIPMENT_ID = B.SHIPMENT_ID
    LEFT JOIN SMPTY F
         ON F.STATUS = 'U'  AND F.PARTY_NO = (SELECT TOP 1 SMDN.PLANT
                  FROM SMDN
                 WHERE SMDN.PLANT IS NOT NULL
                   AND A.DN_NO = SMDN.DN_NO)

ALTER VIEW [dbo].[V_FCL01]

ALTER VIEW [dbo].[V_IPQ01]

ALTER VIEW [dbo].[V_IPQ02]

ALTER VIEW [dbo].[V_IPQ03]

ALTER VIEW [dbo].[V_IPQ05]

ALTER VIEW [dbo].[V_IPQ06]
  /**************** END  by dean  2016/09/7 ***********************/

--UPDATE APPROVE_FLOW_M SET AU_ID='0F3C2DFC-9286-474B-80A4-204C0E155016' WHERE  GROUP_ID='TPV' AND CMP_ID='FQ' AND AU_ID='79C63C9D-ED9B-4CFD-913F-3AA793A7137E'
   ALTER TABLE SMRV ALTER COLUMN CUT_PORT_DATE datetime

 /**************** Begin by dean  2016/09/20 ***********************/
alter table SMINM  alter column COMBINE_INFO nvarchar(600) 
alter table SMINM  alter column LGOODS nvarchar(400) 
alter table SMINM  alter column MARKS nvarchar(2000) 
alter table SMINM  alter column CMDTY_CD nvarchar(500) 

alter table SMBD  ADD COST_CENTERDESCP NVARCHAR(70);
  /**************** END  by dean  2016/09/20 ***********************/
  ALTER TABLE SYS_ACCT ALTER COLUMN SAP_ID NVARCHAR(50);


--更新视图  TG_POST_CARGO_TRACE]

--V_CMSUMMARY  增加一个SMSM的ETD栏位
--V_FLOWSMDN  增加一个CUSTOMER_INNUMBER
__V_SMDN 增加一个CUSTOMER_INNUMBER

ALTER table SMDN  ADD CUSTOMER_INNUMBER NVARCHAR(135);


 /**************** begin  by dean  2016/10/17 ***********************/
alter trigger TG_POST_CARGO_TRACE
on [dbo].[SMSM]  
    for update  
as     
     if (UPDATE(ATD) OR UPDATE(ATA) OR UPDATE(ATA_D))  
    begin  
        UPDATE SMSM SET POST_CARGO_FLAG='N',POST_CARGO_DATE=NULL WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
    IF(UPDATE(STATUS))  
    BEGIN  
    declare @status varchar(5)   
    SELECT @status=STATUS FROM inserted  
    IF(@status='O')  
    BEGIN  
         UPDATE SMSM SET POST_CARGO_FLAG='N',POST_CARGO_DATE=NULL WHERE SHIPMENT_ID IN (SELECT SHIPMENT_ID FROM inserted)    
         END       
    end  
 if (UPDATE(ETA) OR UPDATE(ETD) OR UPDATE(ATA) OR UPDATE(ATD))  
    begin  
        UPDATE SMSM SET ETT=DATEDIFF(day, ETD,ETA ),  
  ATT=DATEDIFF(day, ATD,ATA ),  
  Dtt=DATEDIFF(day, ETD,ATD ) WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(AQTY) OR UPDATE(FQTY)OR UPDATE(QTY))  
    begin  
        UPDATE SMSM SET DQTY=AQTY-FQTY,  
  Fdqty=Qty-Aqty,  
  Ndqty=Aqty-Fqty  WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(CUT_PORT_DATE))  
    begin  
        UPDATE SMRV SET CUT_PORT_DATE=(SELECT CUT_PORT_DATE FROM inserted)  
   WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(CARRIER)OR UPDATE(CARRIER_NM))  
    begin  
        UPDATE SMRV SET CARRIER=(SELECT CARRIER FROM inserted),  
  CARRIER_NM=(SELECT CARRIER_NM FROM inserted)  
   WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
go

V_FCL03
 /**************** END  by dean  2016/10/17 ***********************/

 /**************** begin  by dean  2016/10/26 ***********************/
 CREATE TRIGGER UPDATE_SMBIM_FOR_ETD

ON SMSM

FOR UPDATE

AS

UPDATE SMBIM SET
SMBIM.DEBIT_DATE=INSERTED.ETD FROM INSERTED
WHERE SMBIM.SHIPMENT_ID=INSERTED.SHIPMENT_ID AND (SMBIM.DEBIT_NO IS NULL OR SMBIM.DEBIT_NO ='')

//task for auto Calculation
CREATE TABLE AUTO_VALUATION_TASK
(
U_ID NVARCHAR(36),
SMU_ID NVARCHAR(36),
DONE NVARCHAR(3)
)


update SMIND set GOODS_DESCP =replace(GOODS_DESCP,'&nbsp;',' ')
WHERE GOODS_DESCP LIKE '%&nbsp;%'

update SMIND set GOODS_DESCP =replace(GOODS_DESCP,' ',' ')
WHERE GOODS_DESCP LIKE '% %'

update SMINP set GOODS_DESCP =replace(GOODS_DESCP,'&nbsp;',' ')
WHERE GOODS_DESCP LIKE '%&nbsp;%'

update SMINP set GOODS_DESCP =replace(GOODS_DESCP,' ',' ')
WHERE GOODS_DESCP LIKE '% %'
 /**************** end  by dean  2016/10/26 ***********************/

/**************** add  by Tim  2016/10/31 ***********************/
CREATE TABLE [dbo].[SMCTM](
	[U_ID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[CT_NO] [nvarchar](20) NULL,
	[CT_DATE] [datetime] NULL,
	[STATUS] [nvarchar](1) NULL,
	[RFQ_NO] [nvarchar](20) NULL,
	[REGION] [nvarchar](2) NULL,
	[CNTY] [nvarchar](2) NULL,
	[EFFECT_FROM] [datetime] NULL,
	[EFFECT_TO] [datetime] NULL,
	[EXTEN] [nvarchar](1) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[LSP_CT] [nvarchar](20) NULL,
	[LSP_PIC] [nvarchar](30) NULL,
	[LOCATION] [nvarchar](10) NULL,
	[LOC_NAME] [nvarchar](70) NULL,
	[QUOT_NO] [nvarchar](20) NULL,
	[LOC_PIC] [nvarchar](30) NULL,
	[COPY] [numeric](2, 0) NULL,
	[EMTTOPORT] [numeric](3, 0) NULL,
	[PORTTOATD] [numeric](3, 0) NULL,
	[EMTTOATD] [numeric](3, 0) NULL,
	[REMARK] [nvarchar](500) NULL,
	[CMP] [nvarchar](10) NULL,
	[CREATE_DEP] [nvarchar](10) NULL,
	[CREATE_EXT] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL
) ON [PRIMARY]


CREATE TABLE [dbo].[SMIPM](
	[U_ID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[JOB_DATE] [datetime] NULL,
	[JOB_CMP] [nvarchar](10) NULL,
	[STATUS] [nvarchar](1) NULL,
	[BL_NO] [nvarchar](20) NULL,
	[TRAN_TYPE] [nvarchar](10) NULL,
	[EVEN_PLACE] [nvarchar](30) NULL,
	[CUR] [nvarchar](3) NULL,
	[AMT] [numeric](18, 2) NULL,
	[TERM] [nvarchar](3) NULL,
	[REGION] [nvarchar](2) NULL,
	[POL] [nvarchar](5) NULL,
	[POL_NM] [nvarchar](30) NULL,
	[POD] [nvarchar](5) NULL,
	[POD_NM] [nvarchar](30) NULL,
	[DEST] [nvarchar](5) NULL,
	[DEST_NM] [nvarchar](30) NULL,
	[CNT_NO] [nvarchar](500) NULL,
	[INV_NO] [nvarchar](500) NULL,
	[COMPANY] [nvarchar](10) NULL,
	[COMPANY_NM] [nvarchar](70) NULL,
	[GOODS] [nvarchar](300) NULL,
	[SHIPPER_CD] [nvarchar](10) NULL,
	[SHIPPER_NM] [nvarchar](70) NULL,
	[FI_CD] [nvarchar](10) NULL,
	[FI_NM] [nvarchar](70) NULL,
	[CNEE_CD] [nvarchar](10) NULL,
	[CNEE_NM] [nvarchar](70) NULL,
	[CARRIER] [nvarchar](10) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[INS_CD] [nvarchar](10) NULL,
	[INS_NM] [nvarchar](70) NULL,
	[REASON] [nvarchar](10) NULL,
	[LOSS_QTY] [numeric](12, 0) NULL,
	[LOSS_CUR] [nvarchar](3) NULL,
	[LOSS_AMT] [numeric](18, 2) NULL,
	[LOSS_UAMT] [numeric](18, 2) NULL,
	[IFLAG] [nvarchar](1) NULL,
	[ICUR] [nvarchar](3) NULL,
	[IAMT] [numeric](18, 2) NULL,
	[IUAMT] [numeric](18, 2) NULL,
	[IPAY_DATE] [datetime] NULL,
	[CFLAG] [nvarchar](1) NULL,
	[CCUR] [nvarchar](3) NULL,
	[CAMT] [numeric](18, 2) NULL,
	[CUAMT] [numeric](18, 2) NULL,
	[CPAY_DATE] [datetime] NULL,
	[FFLAG] [nvarchar](1) NULL,
	[FCUR] [nvarchar](3) NULL,
	[FAMT] [numeric](18, 2) NULL,
	[FUAMT] [numeric](18, 2) NULL,
	[FPAY_DATE] [datetime] NULL,
	[TFLAG] [nvarchar](1) NULL,
	[TCUR] [nvarchar](3) NULL,
	[TAMT] [numeric](18, 2) NULL,
	[TUAMT] [numeric](18, 2) NULL,
	[TPAY_DATE] [datetime] NULL,
	[PAY_TYPE] [nvarchar](1) NULL,
	[TPV_LCUR] [nvarchar](3) NULL,
	[TPV_LAMT] [numeric](18, 2) NULL,
	[CONFIRM_BY] [nvarchar](20) NULL,
	[CONFIRM_DATE] [datetime] NULL,
	[AC_BY] [nvarchar](20) NULL,
	[AC_DATE] [datetime] NULL,
	[ENDING_BY] [nvarchar](20) NULL,
	[ENDING_DATE] [datetime] NULL,
	[CMP] [nvarchar](10) NULL,
	[CREATE_DEP] [nvarchar](10) NULL,
	[CREATE_EXT] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[PAY_NO] [nvarchar](20) NULL
) ON [PRIMARY]


CREATE TABLE [dbo].[SMIPC](
	[U_ID] [nvarchar](50) NULL,
	[U_FID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[JOB_TYPE] [nvarchar](1) NULL,
	[SEQ_NO] [numeric](5, 0) NULL,
	[INS_CD] [nvarchar](10) NULL,
	[CHG_DESCP] [nvarchar](30) NULL,
	[IP_AMT] [numeric](18, 2) NULL,
	[REMARK] [nvarchar](100) NULL
) ON [PRIMARY]

CREATE TABLE [dbo].[SMIPR](
	[U_ID] [nvarchar](50) NULL,
	[U_FID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[SEQ_NO] [numeric](5, 0) NULL,
	[JOB_DATE] [datetime] NULL,
	[JOB_CMP] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[REMARK] [nvarchar](500) NULL
) ON [PRIMARY]

/**************** end  by Tim  2016/10/31 ***********************/

/**************** add  by fish  2016/11/08 17：46 ***********************/
ALTER table SMBID ADD APPROVE_BY NVARCHAR(30);
ALTER table SMBID ADD APPROVE_DATE DATETIME;
ALTER table SMBID ADD BOOKING_BY NVARCHAR(30);
ALTER table SMBID ADD APPROVE_STATUS NVARCHAR(2);
ALTER table SMBID ADD UNAPPROVE_MSG NVARCHAR(500);

UPDATE SMBID SET BOOKING_BY=
(SELECT TOP 1  CASE WHEN CHARINDEX(' ',BL_WIN)>0 THEN SUBSTRING(BL_WIN,1,CHARINDEX(' ',BL_WIN)-1) ELSE BL_WIN END FROM SMSM WHERE SMSM.SHIPMENT_ID=SMBID.SHIPMENT_ID)
WHERE BOOKING_BY IS NULL;
/**************** end  by fish 2016/11/08 17：46 ***********************/


 /**************** begin  by dean  2016/11/8 ***********************/



ALTER TABLE SMRV ADD CNTR_BE_DAY NVARCHAR(10);
ALTER TABLE SMRV ADD FAC_HOLD_DAY NVARCHAR(10);


ALTER trigger [dbo].[TG_UP_SMRV_TTLVGM]
on [dbo].[SMRV]
    for update
as   
    if (UPDATE(GW) OR UPDATE(TARE_WEIGHT))
    begin
        UPDATE SMRV SET TTL_VGM=GW+TARE_WEIGHT WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
    
    if (UPDATE(IN_DATE) OR UPDATE(CALL_DATE)OR UPDATE(OUT_DATE))
    begin
        UPDATE SMRV SET CNTR_BE_DAY =cast(cast(DATEDIFF(mi,CALL_DATE,IN_DATE) as float)/ 1440 as numeric(18,2)),
FAC_HOLD_DAY =cast(cast(DATEDIFF(mi,IN_DATE,OUT_DATE) as float)/ 1440 as numeric(18,2)) WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
GO


alter table SMRV  alter column CNTR_BE_DAY numeric(18,2)
alter table SMRV  alter column FAC_HOLD_DAY numeric(18,2)
/**************** end  by dean 2016/11/8 ***********************/

4：55 ***********************/
CREATE TABLE [dbo].[ASD_TASK](
	[U_ID] [nvarchar](40) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[BASE_CONDITION] [nvarchar](3000) NULL,
	[RESULT_STATUS] [nvarchar](1) NULL,
	[asd_type] [nvarchar](1) NULL,
	[USERID] [nvarchar](20) NULL,
	[FILE_NAMES] [nvarchar](200) NULL,
	[REMARK] [nvarchar](2000) NULL,
	[MONTH] [int] NULL,
	[YEAR] [int] NULL,
	[FilePath] [nvarchar](200) NULL,
	[TEMP_OK] [nvarchar](1) NULL,
	[ETD_FROM] [date] NULL,
	[ETD_TO] [date] NULL,
	[STR_MONTH] [nvarchar](2) NULL,
 CONSTRAINT [PK_ASD_TASK] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

/**************** end  by will  2016/11/12 14：55 ***********************/


/**************** add  by fish  2016/11/15 15：46 ***********************/
-----------上传报价的user---------------
ALTER TABLE SMBID ADD UPLOAD_USER  NVARCHAR(30);
ALTER TABLE SMBID ADD UPLOAD_TIME  DATETIME;

-----------解除账单关系的user---------------
ALTER TABLE SMBID ADD VOID_USER  NVARCHAR(30);
ALTER TABLE SMBID ADD VOID_TIME  DATETIME;

ALTER TABLE SMBID ADD UNAPPROVE_DESCP  NVARCHAR(100);
/**************** end  by fish 2016/11/15 15：46 ***********************/

/**************** add  by will  2016/11/18 9：41 ***********************/
ALTER TABLE SMSM ADD CONT_DECL_NUM NUMERIC(5,0);
alter table smsm alter column CBM decimal(18,4);
ALTER TABLE SMSM ADD VW decimal(18,3);
ALTER TABLE SMSM ADD PVW decimal(18,3)
/**************** end  by will  2016/11/18 9：41 ***********************/

/**************** add  by dean  2016/11/22 15：46 ***********************/
V_IPQ03
ALTER TABLE SMRV ADD CNTR_INFAC_DAY numeric(18,2)

ALTER trigger [dbo].[TG_UP_SMRV_TTLVGM]
on [dbo].[SMRV]
    for update
as   
    if (UPDATE(GW) OR UPDATE(TARE_WEIGHT))
    begin
        UPDATE SMRV SET TTL_VGM=GW+TARE_WEIGHT WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
    
    if (UPDATE(IN_DATE) OR UPDATE(CALL_DATE)OR UPDATE(OUT_DATE))
    begin
        UPDATE SMRV SET CNTR_BE_DAY =cast(cast(DATEDIFF(mi,CALL_DATE,IN_DATE) as float)/ 1440 as numeric(18,2)),
		CNTR_INFAC_DAY =cast(cast(DATEDIFF(mi,IN_DATE,OUT_DATE) as float)/ 1440 as numeric(18,2)),
		FAC_HOLD_DAY =cast(cast(DATEDIFF(mi,IN_DATE,SEAL_DATE) as float)/ 1440 as numeric(18,2))
		 WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
GO


/**************** end  by dean 2016/11/22 15：46 ***********************/=======
ALTER TABLE SMSMPT ADD TAX_NO NVARCHAR(20);
ALTER TABLE SMDNPT ADD TAX_NO NVARCHAR(20);

ALTER TABLE SMINM ADD SEND_FRT NVARCHAR(1)

 /***********Begin by FISH 2016/06/16 17:33  **********/
 ALTER TABLE SMBID ADD IS_SHARE NVARCHAR(1);
 ALTER TABLE SMSM ADD CUSTOMS_CHECK NVARCHAR(1);
 UPDATE SMQTM SET QUOT_TYPE='A' WHERE TRAN_MODE='O' AND QUOT_TYPE='F'
 /***********End by FISH 2016/06/16 17:33    **********/
INSERT INTO BSCODE_KIND (GROUP_ID, CD_TYPE, CD_DESCP, CMP, STN)VALUES('TPV','QAT','Q&A类别', 'FQ', '*');
INSERT [dbo].[BSCODE] ([GROUP_ID], [CD_TYPE], [CD], [CD_DESCP], [CMP], [STN], [CREATE_BY], [CREATE_DATE], [MODIFY_BY], [AMS_CODE], [INTTRA], [AR_CD], [AP_CD], [DEP], [APPLY], [LOCATION], [ORDER_BY]) VALUES (N'TPV', N'QAT', N'A', N'DN相关', N'FQ', N'*', N'ADMIN', CAST(N'2016-06-10 18:41:28.0000000' AS DateTime2), NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL)

 /***********Begin by KING 2016/06/17 17:33  **********/
ALTER TABLE SMDN
ADD  EDOC NVARCHAR(1)

SELECT          dbo.SMSM.STATUS AS SM_STATUS, dbo.SMSM.RLS_CNTR_DATE, dbo.SMDN.U_ID, dbo.SMDN.ETD, 
                            dbo.SMDN.SAP_ID, dbo.SMDN.WEEKLY, dbo.SMDN.MONTH, dbo.SMDN.YEAR, dbo.SMDN.GROUP_ID, 
                            dbo.SMDN.CMP, dbo.SMDN.STN, dbo.SMDN.DEP, dbo.SMDN.BU, dbo.SMDN.DN_NO, dbo.SMDN.ORIGIN_NO, 
                            dbo.SMDN.SAP_NO, dbo.SMDN.REF_NO, dbo.SMDN.TRAN_MODE, dbo.SMDN.TRAN_DESCP, 
                            dbo.SMDN.APPROVE_TO, dbo.SMDN.APPROVE_BACK, dbo.SMDN.COMBINE_INFO, dbo.SMDN.COMBINE_BY, 
                            dbo.SMDN.COMBINE_DATE, dbo.SMDN.SHIPMENT_ID, dbo.SMDN.DN_TYPE, dbo.SMDN.CARGO_TYPE, 
                            dbo.SMDN.CUR, dbo.SMDN.AMOUNT1, dbo.SMDN.INCOTERM, dbo.SMDN.INCOTERM_DESCP, 
                            dbo.SMDN.PAY_TERM_CD, dbo.SMDN.PAY_DESCP, dbo.SMDN.CHANNEL_CD, dbo.SMDN.CHANNEL, 
                            dbo.SMDN.DIVISION_CD, dbo.SMDN.DIVISION_DESCP, dbo.SMDN.SC_CODE, dbo.SMDN.SC_DESCP, 
                            dbo.SMDN.INV_NO, dbo.SMDN.PACKING_NO, dbo.SMDN.VAT_NO, dbo.SMDN.EXPORT_NO, dbo.SMDN.EDECL_NO, 
                            dbo.SMDN.APPROVE_NO, dbo.SMDN.POL, dbo.SMDN.POL_NM, dbo.SMDN.POD, dbo.SMDN.POD_NM, 
                            dbo.SMDN.STATE, dbo.SMDN.REGION, dbo.SMDN.REGION_NM, dbo.SMDN.SHIP_TO, dbo.SMDN.SHIP_NM, 
                            dbo.SMDN.CNEE3_CD, dbo.SMDN.CNEE3_NM, dbo.SMDN.FI_CUST_CD, dbo.SMDN.FI_CUST_NM, 
                            dbo.SMDN.SALES_CUST_CD, dbo.SMDN.SALES_CUST_NM, dbo.SMDN.EX_CD, dbo.SMDN.EX_NAME, 
                            dbo.SMDN.REVEIVE_DATE, dbo.SMDN.CNTR_QTY, dbo.SMDN.FEU, dbo.SMDN.SERVICE_MODE, 
                            dbo.SMDN.SERVICE_LOADING, dbo.SMDN.QTY, dbo.SMDN.QTYU, dbo.SMDN.GW, dbo.SMDN.GWU, dbo.SMDN.NW, 
                            dbo.SMDN.CBM, dbo.SMDN.FREIGHT_TERM, dbo.SMDN.COST, dbo.SMDN.CREATE_BY, dbo.SMDN.CREATE_DEP, 
                            dbo.SMDN.CREATE_EXT, dbo.SMDN.CREATE_DATE, dbo.SMDN.MODIFY_BY, dbo.SMDN.MODIFY_DATE, 
                            dbo.SMDN.SPEC_PROCID, dbo.SMDN.SPEC_DESCP, dbo.SMDN.SHIP_MARK, dbo.SMDN.ACT_SHIP_DATE, 
                            dbo.SMDN.ACT_POST_DATE, dbo.SMDN.DN_NO_REF, dbo.SMDN.DN_NO_CMP, dbo.SMDN.DN_NO_CMP_REF, 
                            dbo.SMDN.PORT_DEST, dbo.SMDN.PLANT, dbo.SMDN.BAND_TYPE, dbo.SMDN.TRACK_WAY, 
                            dbo.SMDN.CENT_DECL, dbo.SMDN.DEEP_PROCESS, dbo.SMDN.PLANT_NM, dbo.SMDN.SEAL_QTY, 
                            dbo.SMDN.BOOKING_AGENT, dbo.SMDN.BOOKING_NM, dbo.SMDN.PORTE_CD, dbo.SMDN.PORTE_DESCP, 
                            dbo.SMDN.ORDER_REASON, dbo.SMDN.UNICODE, dbo.SMDN.ASD_NO, dbo.SMDN.PORT_DESCP, 
                            dbo.SMDN.APPROVE_TYPE, dbo.SMDN.CNTR_NO, dbo.SMDN.TRAN_TYPE, dbo.SMDN.TRAN_TYPE_DESCP, 
                            dbo.SMDN.CNT20, dbo.SMDN.CNT40, dbo.SMDN.CNT40HQ, dbo.SMDN.CNT_TYPE, dbo.SMDN.CNT_NUMBER, 
                            dbo.SMDN.PORT_POL, dbo.SMDN.PORT_POLNM, dbo.SMDN.STATUS, dbo.SMDN.POST_FLAG, dbo.SMDN.OBU, 
                            dbo.SMDN.OSOLD_TO, dbo.SMDN.OUT_DATE, dbo.SMDN.ATRAN_TYPE, dbo.SMDN.LOADING_FROM, 
                            dbo.SMDN.LOADING_TO, dbo.SMDN.PROFILE_CD, dbo.SMDN.AG_CD, dbo.SMDN.AG_NM, dbo.SMDN.WE_CD, 
                            dbo.SMDN.WE_NM, dbo.SMDN.ZE_CD, dbo.SMDN.ZE_NM, dbo.SMDN.FC_CD, dbo.SMDN.FC_NM, 
                            dbo.SMDN.RE_CD, dbo.SMDN.RE_NM, dbo.SMDN.RO_CD, dbo.SMDN.RO_NM, dbo.SMDN.GOODS, 
                            dbo.SMDN.AC_REMARK, dbo.SMDN.PAYTERM_CD, dbo.SMDN.PAYTERM_NM, dbo.SMDN.CAR_TYPE, 
                            dbo.SMDN.PKG_NUM, dbo.SMDN.PKG_UNIT, dbo.SMDN.PKG_UNIT_DESC, dbo.SMDN.PRODUCT_DATE, 
                            dbo.SMDN.APPROVE_USER, dbo.SMDN.SH_CD, dbo.SMDN.SH_NM, dbo.SMDN.CS_CD, dbo.SMDN.CS_NM, 
                            dbo.SMDN.NT_CD, dbo.SMDN.NT_NM, dbo.SMDN.TRANSACTE_MODE, dbo.SMDN.MEMO, 
                            dbo.SMDN.COST_CENTER, dbo.SMDN.LGOODS, dbo.SMDN.BAND_DESCP, dbo.SMDN.TRADE_TERM, 
                            dbo.SMDN.TRADETERM_DESCP, dbo.SMDN.BAND_CD, dbo.SMDN.DN_RMARK, dbo.SMDN.SEND_SFIS_FLAG, 
                            dbo.SMDN.EDOC
FROM              dbo.SMDN LEFT OUTER JOIN
                            dbo.SMSM ON dbo.SMSM.SHIPMENT_ID = dbo.SMDN.SHIPMENT_ID


CREATE TABLE [dbo].[BSCAAM](
	[U_ID] [nvarchar](50) NOT NULL,
	[CARRIER] [nvarchar](10) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[AREA] [nvarchar](10) NULL,
	[AREA_NM] [nvarchar](70) NULL,
	[ATD_ATP] [nvarchar](3) NULL,
	[CREATE_BY] [nvarchar](10) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](10) NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY]

 /***********End by KING 2016/06/17 17:33    **********/


 ALTER TABLE MOD_BULLETIN
ADD DEP nvarchar(10)

/**************** Add by Tim 2016/06/20 12:41 ***********************/
ALTER TABLE SMINM
ALTER COLUMN SHPR_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN SHIP_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN BILL_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN CNEE_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN CUST_NM NVARCHAR(140)

ALTER TABLE SMINM
ALTER COLUMN NOTIFY_NM NVARCHAR(140)
/**************** End by Tim 2016/06/20 12:41 ***********************/


 /***********Begin by WILL 2016/06/20 18:45    **********/
 ALTER TABLE SMDN ADD TELEX_RLS  NVARCHAR(1);
 ALTER TABLE SMSM ADD ISF_SEND_DATE datetime;
 ALTER TABLE SMSM ADD ISF_WIN NVARCHAR(40);
 ALTER TABLE [MOD_BULLETIN]
ADD CREATE_BY NVARCHAR(30)
ALTER TABLE [MOD_BULLETIN]
ADD CREATE_DATE DATETIME
ALTER TABLE [MOD_BULLETIN]
ADD MODIFY_BY NVARCHAR(30)
ALTER TABLE [MOD_BULLETIN]
ADD MODIFY_DATE DATETIME
 /***********End by WILL 2016/06/20 18:45   **********/

 /**************** Add by FISH 2016/06/23 09:41 ***********************/
ALTER TABLE SMQTM ALTER COLUMN LSP_CD NVARCHAR(20);
ALTER TABLE SMQTD ALTER COLUMN LSP_CD NVARCHAR(20);
/**************** End by FISH 2016/06/23 09:41 ***********************/

/**************** Add by FISH 2016/06/24 15:41 ***********************/
UPDATE SMQTM SET FREIGHT_TERM='P' WHERE TRAN_MODE='X' AND INCOTERM='CIF'
UPDATE SMQTM SET FREIGHT_TERM='C' WHERE TRAN_MODE='X' AND INCOTERM<>'CIF'
/**************** End by FISH 2016/06/24 15:41 ***********************/

ALTER TABLE SMFSC ADD AREA_NM NVARCHAR(70)

CREATE TABLE [dbo].[SQL_ERROR_LOG](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[SQL] [text] NULL,
	[ERROR_TRACE] [text] NULL,
	[RESEND] [nvarchar](1) NULL,
	[CREATE_DATE] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

ALTER TABLE SMBIM ADD APPROVE_USER NVARCHAR(30);

ALTER TABLE SMBIM 
ALTER COLUMN BL_NO NVARCHAR(20)
ALTER TABLE SMBIM 
ALTER COLUMN LSP_NM NVARCHAR(140)

ALTER TABLE SMBID 
ALTER COLUMN BL_NO NVARCHAR(20)
ALTER TABLE SMBID 
ALTER COLUMN LSP_NM NVARCHAR(140)


/**************** Add by FISH 2016/07/06 10:19 ***********************/
ALTER TABLE TKBLST ALTER COLUMN LOCATION_DESCP NVARCHAR(300);
/**************** End by FISH 2016/07/06 10:19 ***********************/

 /**************** Add by Wil 2016/06/28 14:17 ***********************/
ALTER TABLE SMDN ADD BL_LEVEL NVARCHAR(1);
ALTER TABLE SMDN ADD ASK_TIM DATETIME;
ALTER TABLE SMDN ADD DECL_DATE DATE;
ALTER TABLE SMDN ADD RLS_DATE DATE;
ALTER TABLE SMDN ADD DRemark  NVARCHAR(50);
ALTER TABLE SMSM ADD DECL_NUM  NVARCHAR(5);
ALTER TABLE SMSM ADD NEXT_NUM  NVARCHAR(5);
 /**************** Add by Wil 2016/06/28 14:17 ***********************/

 ALTER TABLE SMSM ADD VIA  NVARCHAR(5);
ALTER TABLE SMDN ADD VIA  NVARCHAR(5);


/**************** Add by FISH 2016/07/11 13:19 ***********************/
ALTER TABLE TKBLST ALTER COLUMN REMARK NVARCHAR(500);
/**************** End by FISH 2016/07/11 10:13 ***********************/

/**************** Add by Will 2016/07/12 13:19 ***********************/
ALTER TABLE SMBDD ADD  CNTR_STD_QTY numeric(12,0); 
/**************** End by Will 2016/07/12 10:13 ***********************/

/**************** Add by FISH 2016/07/12 18:19 ***********************/
ALTER TABLE SMBID ALTER COLUMN REMARK NVARCHAR(1000);
/**************** End by FISH 2016/07/12 18:13 ***********************/

 ALTER TABLE SMSM ADD SORDER NVARCHAR(1);

 UPDATE SMQTD SET CHG_CD='AFR' WHERE CHG_CD='AFS'
 UPDATE SMBID SET CHG_CD='AFR' WHERE CHG_CD='AFS'

 /**************** Add by Will 2016/07/12 13:19 ***********************/
  ALTER TABLE SMSM ADD Sdate datetime;
  ALTER TABLE SMSM ADD SORDER_BY NVARCHAR(30);
  ALTER TABLE SMDN ADD BRG_TYPE NVARCHAR(20);
  ALTER TABLE SMSM ADD DEBIT_TO NVARCHAR(10);
/**************** End by Will 2016/07/12 10:13 ***********************/

 /**************** Add by FISH 2016/07/13 23:19 ***********************/
 UPDATE SMQTD SET CHG_CD='AFR' WHERE CHG_CD='AFS';
 UPDATE SMBID SET CHG_CD='AFR' WHERE CHG_CD='AFS';
 UPDATE SMQTD SET  CHG_CD='CTC' WHERE CHG_CD='OTC';

 ALTER TABLE SMBID ADD  DEBIT_TO NVARCHAR(10);
 ALTER TABLE SMBID ADD  DEBIT_NM NVARCHAR(100);
 ALTER TABLE SMBID ADD  CNTR_STD_QTY NUMERIC(12,0);
ALTER TABLE SMBID ADD  IPART_NO  NVARCHAR(18);

 ALTER TABLE SMBIM ADD  RECEIVER  NVARCHAR(10);
 ALTER TABLE SMBIM ADD  RECEIVER_NM  NVARCHAR(70);
 /**************** End by FISH 2016/07/13 23:13 ***********************/


/**************** Add by FISH 2016/07/14 17:19 ***********************/
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','TDLT','TPV账单付款人','FQ','*');
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','TDLT','TPV账单付款人','XM','*');
/**************** End by FISH 2016/07/14 17:13 ***********************/


/**************** Add by FISH 2016/07/18 13:19 ***********************/
ALTER TABLE SMBID ADD FSTATUS  NVARCHAR(1) DEFAULT 'A';
ALTER TABLE SMBID ADD DOWNLOAD_USER  NVARCHAR(10);
ALTER TABLE SMBID ADD DOWNLOAD_TIME  DATETIME;
/**************** End by FISH 2016/07/18 13:199 ***********************/


  /****************Modify by Will 2016/07/18*************************/
INSERT INTO [dbo].[BSCODE_KIND]
           ([GROUP_ID]
           ,[CD_TYPE]
           ,[CD_DESCP]
           ,[CMP]
           ,[STN]
           ,[CREATE_BY]
           ,[CREATE_DATE]
           ,[MODIFY_BY]
           ,[DEP]
           ,[MODIFY_DATE])
     VALUES
           ('TPV'
           ,'ATST'
           ,'签核金额设定'
           ,'FQ'
           ,'*'
           ,'MANA10'
           ,NULL
           ,NULL
           ,NULL
           ,NULL)
GO

CREATE TABLE [dbo].[SMBKINFO](
	[U_ID] [nvarchar](40) NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[CRNCY] [nvarchar](3) NULL,
	[BANK_INFO] [nvarchar](200) NULL,
	[REMARK] [nvarchar](200) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
 CONSTRAINT [PK_SMBKINFO] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
  /****************END by Will 2016/07/18*************************/


  
/**************** Add by FISH 2016/07/21 15:19 已经更版到正式机 可以不更***********************/
ALTER TABLE SMQTD ALTER COLUMN VIA_CD NVARCHAR(10);
UPDATE SMQTD SET VIA_CD='AWR' WHERE REMARK LIKE '%(AWR)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='MLB' WHERE REMARK LIKE '%(MLB)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='NORTH' WHERE REMARK LIKE '%(NORTH)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='WEST' WHERE REMARK LIKE '%(WEST)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='SOUTH' WHERE REMARK LIKE '%(SOUTH)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='WEST' WHERE REMARK LIKE '%west%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='SOUTH' WHERE POD_NM LIKE '%south manila%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='SOUTH' WHERE POD_NM LIKE '%south%' AND POD_NM LIKE '%manila%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='NORTH' WHERE POD_NM='manila' AND VIA_CD IS NULL;

-------------UPDATE SMQTD SET VIA_CD='NORTH' WHERE POD_NM LIKE '%manila%' AND VIA_CD IS NULL;

SELECT POD_NM,REMARK FROM SMQTD WHERE REMARK LIKE '%(New port)%' AND VIA_CD IS NULL;
SELECT POD_NM,REMARK FROM SMQTD WHERE REMARK LIKE '%(Catlai)%' AND VIA_CD IS NULL;
SELECT POD_NM,REMARK FROM SMQTD WHERE REMARK LIKE '%(VICT)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='New port' WHERE REMARK LIKE '%(New port)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='Catlai' WHERE REMARK LIKE '%(Catlai)%' AND VIA_CD IS NULL;
UPDATE SMQTD SET VIA_CD='VICT' WHERE REMARK LIKE '%(VICT)%' AND VIA_CD IS NULL;
/**************** End by FISH 2016/07/21 15:19 ***********************/

/**************** Add by FISH 2016/07/21 20:19 ***********************/
CREATE TABLE [SMBID_TEMP](
	[SHIPMENT_ID] [nvarchar](20) NOT NULL,
	[LSP_NO] [nvarchar](20) NOT NULL,
	[CHG_CD] [nvarchar](10) NOT NULL,
	[CHG_DESCP] [nvarchar](100) NULL,
	[QUOT_NO] [nvarchar](30) NULL,
	[CHG_TYPE] [nvarchar](5) NULL,
	[CUR] [nvarchar](5) NULL,
	[REPAY] [nvarchar](1) NULL,
	[QAMT] [numeric](18, 2) NULL,
	[QLAMT] [numeric](18, 2) NULL,
	[DEBIT_TO] [nvarchar](20) NULL,
	[DEBIT_NM] [nvarchar](200) NULL,
	[CREATE_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMBID_TEMP] PRIMARY KEY CLUSTERED 
(
	[SHIPMENT_ID] ASC,
	[LSP_NO] ASC,
	[CHG_CD] ASC)
) ON [PRIMARY]
/**************** End by FISH 2016/07/21 20:19 ***********************/

/**************** End by will 2016/07/22 20:19 ***********************/
 ALTER TABLE SMBIM ADD TRAN_TYPE NVARCHAR(10);
 ALTER TABLE SMBIM ADD BANK_INFO NVARCHAR(200);
 /**************** End by will 2016/07/22 20:19 ***********************/

  ALTER TABLE SMBID ADD BI_REMARK NVARCHAR(1000);

  /**************** Begin by will 2016/07/25 10:55 ***********************/
USE [ESHIPPING]
GO

/****** Object:  Trigger [dbo].[TG_UP_SMRV_TTLVGM]    Script Date: 2016/7/25 10:04:27 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

create trigger [dbo].[TG_UP_SMRV_TTLVGM]
on [dbo].[SMRV]
    for update
as   
    if (UPDATE(GW) OR UPDATE(TARE_WEIGHT))
    begin
        UPDATE SMRV SET TTL_VGM=GW+TARE_WEIGHT WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
GO


USE [ESHIPPING]
GO

/****** Object:  Trigger [dbo].[TG_UP_SMINM_FobValue]    Script Date: 2016/7/25 10:04:27 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

create trigger [dbo].[TG_UP_SMINM_FobValue]
on [dbo].[SMINM]
    for update
as   
    if (UPDATE(TTL_VALUE) OR UPDATE(FREIGHT_FEE) OR UPDATE(ISSUE_FEE))
    begin
        UPDATE SMINM SET FOB_VALUE=TTL_VALUE-isnull(FREIGHT_FEE,0)-isnull(ISSUE_FEE,0) WHERE INV_NO IN (SELECT INV_NO FROM inserted)       
    end
GO
 /**************** End by will 2016/07/22 10:55 ***********************/

 /**************** Begin by will 2016/07/26 10:55 以下更新语法，只能执行一次***********************/
 --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"FcCd","width":100,"hidden":false},{"name":"FcNm","width":100,"hidden":false},{"name":"IpartNo","width":100,"hidden":false}]') 
--WHERE ID='Shipment List' AND LAYOUT_TYPE='GRID';

-- UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"FcCd","width":100,"hidden":false},{"name":"FcNm","width":100,"hidden":false}]') 
--WHERE ID='貨櫃管理列表' AND LAYOUT_TYPE='GRID';
 /**************** End by will 2016/07/26 10:55 *******************/

 /**************** Begin by will 2016/07/28 14:34 ***********************/
 ALTER TABLE SMBKINFO ADD COLLECT_BANK NVARCHAR (50);
ALTER TABLE SMBKINFO ADD ACCOUNT_NAME NVARCHAR (50);
ALTER TABLE SMBKINFO ADD SWIFT_CODE NVARCHAR (50);

ALTER TABLE SMBIM ADD COLLECT_BANK NVARCHAR (50);
ALTER TABLE SMBIM ADD ACCOUNT_NAME NVARCHAR (50);
ALTER TABLE SMBIM ADD SWIFT_CODE NVARCHAR (50);
 /**************** END by will 2016/07/28 14:34  ***********************/

  /**************** Begin by will 2016/07/28 14:34 ***********************/
 请更新View.txt中的的 V_CMSUMMARY,V_SMDN  视图
 /**************** END by will 2016/07/28 14:34  ***********************/
  /**************** Begin by will 2016/07/28 14:34 ***********************/
 	ALTER TABLE SMSM ADD OPTIONS nvarchar(3);
	ALTER TABLE SMSM ADD SERVICE nvarchar(3);
 /**************** END by will 2016/07/28 14:34  ***********************/

 
CREATE TABLE [dbo].[SMMATERIAL](
	[U_ID] [nvarchar](40) NOT NULL,
	[MATERIAL_TYPE] [nvarchar](5) NOT NULL,
	[CARGO_TYPE] [nvarchar](1) NOT NULL,
	[TRANSACTE_MODE] [nvarchar](2) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY]

GO

 /**************** Begin by dean  2016/08/05  ***********************/
 	VIEW [dbo].[V_FCL01]
 /**************** END  by dean  2016/08/05 ***********************/

/**************** Begin by Will  2016/08/05  ***********************/
ALTER TABLE SMDN ADD COST_CENTERDESCP NVARCHAR(70);
ALTER TABLE SMSM ADD COST_CENTERDESCP NVARCHAR(70);
 	VIEW [dbo].[V_SMDN]
/**************** END  by Will  2016/08/05 ***********************/

  /**************** Begin by dean  2016/08/08  ***********************/
 	VIEW [dbo].[V_IPQ01]
	VIEW [dbo].[V_IPQ02]
 /**************** END  by dean  2016/08/08 ***********************/

   /**************** Begin by dean  2016/08/16  ***********************/
   alter table SMINM  ADD INV_COMBINE_FLAG NVARCHAR(50);
 /**************** END  by dean  2016/08/16 ***********************/


 /**************** Begin by fish  2016/08/18  ***********************/
 alter table SMBIM  ADD TPV_DEBIT_NO NVARCHAR(20);
 alter table SMBID  ADD TRAN_TYPE NVARCHAR(10);
 UPDATE SMBID SET TRAN_TYPE=(SELECT TOP 1 TRAN_TYPE FROM SMSM WHERE SMSM.SHIPMENT_ID=SMBID.SHIPMENT_ID) WHERE TRAN_TYPE IS NULL;
 UPDATE SMBID SET CMP=(SELECT TOP 1 CMP FROM SMSM WHERE SMSM.SHIPMENT_ID=SMBID.SHIPMENT_ID) WHERE CMP IS NULL;


  INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('DEBIT_NO', '*', '*', 'TPV', '2016-02-18 14:35', '' );
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('DEBIT_NO',1,'20160218','CONST','常量',2,'DN','*','*','TPV'),
('DEBIT_NO',2,'20160218','YY','年度',2,'YY','*','*','TPV'),
('DEBIT_NO',3,'20160218','MM','月份',2,'MM','*','*','TPV'),
('DEBIT_NO',4,'20160218','NO','流水號',6,NULL,'*','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('DEBIT_NO', 'TPV账单号码', '20160218', '*', '*', 'TPV');
 /**************** END  by fish  2016/08/18 ***********************/

  /**************** Begin by fish  2016/08/20 11:43 ***********************/
 alter table SMBIM  ADD DEBIT_TYPE NVARCHAR(20);
 alter table SMBID  ALTER COLUMN DOWNLOAD_USER NVARCHAR(30);
 UPDATE SMBIM SET DEBIT_TYPE='A';
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','DTT','账单类型','FQ','*');
INSERT INTO BSCODE_KIND(GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN) VALUES('TPV','DTT','账单类型','XM','*');

INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','A','轉帳','FQ','*')
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','B','交申請人','FQ','*');
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','C','受款','FQ','*');

INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','A','轉帳','XM','*')
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','B','交申請人','XM','*');
INSERT INTO BSCODE(GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN) VALUES('TPV','DTT','C','受款','XM','*');

  /**************** END  by fish  2016/08/20 11:43 ***********************/



ALTER TABLE SMQTD ALTER COLUMN VIA_CD NVARCHAR(25);

  /**************** Begin by dean  2016/08/30 ***********************/

  V_FCL01，V_IPQ01，V_IPQ02，V_IPQ05，V_IPQ06

  alter table TMEXP alter column  DEP nvarchar(6) 

  
  alter table SMSM alter column  REF_NO nvarchar(1000) 

    alter table SMINM alter column  REF_NO nvarchar(1000) 
  /**************** END  by dean  2016/08/30 ***********************/

ALTER TABLE SMFSC ALTER COLUMN CARRIER NVARCHAR(20);
ALTER TABLE BSCAA ALTER COLUMN CARRIER NVARCHAR(20);
ALTER TABLE BSCAAM ALTER COLUMN CARRIER NVARCHAR(20);


/**************** Begin by Will  2016/08/31 ***********************/
Alter table SMRVM Alter column OGATE_NO NVARCHAR(4);
Alter table SMRVM Alter column NGATE_NO NVARCHAR(4);
  /**************** END  by Will  2016/08/31 ***********************/

  ALTER TABLE SMFSC ALTER COLUMN CARRIER NVARCHAR(20);
 ALTER TABLE BSCAA ALTER COLUMN CARRIER NVARCHAR(20);
 ALTER TABLE BSCAAM ALTER COLUMN CARRIER NVARCHAR(20);
  ALTER TABLE SMQTD ALTER COLUMN CARRIER NVARCHAR(20);

  
 /**************** Begin by dean  2016/09/7 ***********************/

alter table SMSM  ADD HOUSE_NO_FLAG NVARCHAR(1);

CREATE VIEW [dbo].[V_FCL02] 
AS
SELECT A.U_ID,A.SHIPMENT_ID,A.PPOR_NAME,A.INCOTERM_CD,A.INCOTERM_DESCP,A.LOADING_FROM,A.LOADING_TO,A.TRAN_TYPE,
		A.VOYAGE1,A.VESSEL1,A.PPOD_NAME,A.PPOD_CD,A.PDEST_NAME,A.PDEST_CD,A.MARKS,A.PKG_NUM,A.PKG_UNIT_DESC,A.PPOL_CD,
		A.QTY,A.QTYU,A.GOODS,A.LGOODS,A.GW,A.PGW,A.CNT_NUMBER,A.CNT_TYPE,A.TRACK_WAY,A.CAR_TYPE,A.CAR_QTY,A.SVC_CONTACT,
		A.PRODUCT_DATE,A.DN_ETD,A.FRT_TERM,A.SCAC_CD,A.INSTRUCTION,A.HORN,A.BATTERY,A.PCBM,A.CBM,A.PPOR_CD,A.PPOL_NAME,
		A.BL_RMK,A.MASTER_NO,A.GWU,A.POR_NAME,A.POL_NAME,A.HOUSE_NO,A.POD_NAME,A.DEST_NAME,A.SO_NO,
		(SELECT TOP 1 SHPR_NM FROM SMSIM  WHERE SMSIM.[PROFILE] = A.PROFILE_CD) AS SHPR_NM,
       (ISNULL('20''*'+convert(varchar(10),A.CNT20)+' ,','')+ISNULL('40''GP*'+convert(varchar(10),A.CNT40)+' ,','')+ISNULL('40''HQ*'+convert(varchar(10),A.CNT40HQ)+' ,','')) AS CNT,
       (ISNULL(B.PARTY_NAME+' ','')+ISNULL(B.PARTY_NAME2+' ','')+ISNULL(B.PARTY_NAME3+' ','')+ISNULL(B.PARTY_NAME4+' ','')) PARTY_NAME,
       (ISNULL(B.PART_ADDR1+',','')+ISNULL(B.PART_ADDR2+',','')+ISNULL(B.PART_ADDR3+',','')+ISNULL(B.PART_ADDR4+',','')+ISNULL(B.PART_ADDR5+',','')) PART_ADDR,
       (ISNULL(C.PARTY_NAME+' ','')+ISNULL(C.PARTY_NAME2+' ','')+ISNULL(C.PARTY_NAME3+' ','')+ISNULL(C.PARTY_NAME4+' ','')) CLIENT_NAME,
       B.PARTY_TEL,B.PARTY_ATTN,B.PARTY_NO,B.PARTY_TYPE,B.PARTY_MAIL,B.FAX_NO,C.PARTY_FAX,
       B.TAX_NO,D.CNTR_NO,D.SEAL_NO1,D.CNTY_TYPE,D.GW AS V_GW,D.GWU AS V_GWU,D.CBM AS V_CBM,
       E.AC_NO,C.PIC,B.ORDER_BY,
       (SELECT TOP 1 COMMODITY
          FROM SMSIM
         WHERE SMSIM. [PROFILE] = A.PROFILE_CD) AS SI_COMMODITY,
       (SELECT TOP 1 ISNULL(CD_DESCP, A.PKG_UNIT)
          FROM BSCODE
         WHERE BSCODE.CD_TYPE = 'UB'
           AND BSCODE.CD = A.PKG_UNIT
           AND BSCODE.GROUP_ID = A.GROUP_ID) PKG_UNIT_UB,
       (SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD = A.QTYU) QTYU_DESCP,
       (SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID = A.SHIPMENT_ID) AMOUNT1,
       (SELECT CASE
                 WHEN (CNT20 > 0) THEN
                  '20GP*' + convert(varchar(10), CNT20) + ' '
                 ELSE
                  ''
               END + CASE
                 WHEN (CNT40 > 0) THEN
                  '40GP*' + convert(varchar(10), CNT40) + ' '
                 ELSE
                  ''
               END + CASE
                 WHEN (CNT40HQ > 0) THEN
                  '40HQ*' + convert(varchar(10), CNT40HQ) + ' '
                 ELSE
                  ''
               END
          FROM SMSM
         WHERE D.SHIPMENT_ID = SMSM.SHIPMENT_ID) AS CntType,
       (SELECT TOP 1 PKG_NUM
          FROM SMSM
         WHERE D.SHIPMENT_ID = SMSM.SHIPMENT_ID) AS N_TTL_PLT,
       (SELECT TOP 1 PKG_UNIT
          FROM SMSM
         WHERE D.SHIPMENT_ID = SMSM.SHIPMENT_ID) AS N_PLTU,
         D.SHIPMENT_ID AS V_ID,
         A.COMBIN_SHIPMENT
  FROM SMSM A
  LEFT JOIN SMSMPT B
    ON A.SHIPMENT_ID = B.SHIPMENT_ID
  LEFT JOIN SMPTY C
    ON B.PARTY_NO = C.PARTY_NO
   AND C.STATUS = 'U'
  LEFT JOIN SMRV D
    ON A.SHIPMENT_ID = D.SHIPMENT_ID
    OR D.SHIPMENT_ID IN
       (SELECT SHIPMENT_ID FROM SMSM WHERE COMBIN_SHIPMENT = A.SHIPMENT_ID)
  LEFT JOIN SMEX_ACCT E
    ON B.PARTY_NO = E.EXPRESS_CD


CREATE VIEW [dbo].[V_FCL03]
AS
SELECT A.U_ID,A.SHIPMENT_ID,A.PPOR_NAME,A.INCOTERM_CD,A.INCOTERM_DESCP,A.LOADING_FROM,A.LOADING_TO,A.TRAN_TYPE,
		A.VOYAGE1,A.VESSEL1,A.PPOD_NAME,A.PPOD_CD,A.PDEST_NAME,A.PDEST_CD,A.MARKS,A.PKG_NUM,A.PKG_UNIT_DESC,A.PPOL_CD,
		A.QTY,A.QTYU,A.GOODS,A.LGOODS,A.GW,A.PGW,A.CNT_NUMBER,A.CNT_TYPE,A.TRACK_WAY,A.CAR_TYPE,A.CAR_QTY,A.SVC_CONTACT,
		A.PRODUCT_DATE,A.DN_ETD,A.FRT_TERM,A.SCAC_CD,A.INSTRUCTION,A.HORN,A.BATTERY,A.PCBM,A.CBM,A.PPOR_CD,A.PPOL_NAME,
		A.BL_RMK,A.MASTER_NO,A.GWU,A.POR_NAME,A.POL_NAME,A.HOUSE_NO,A.POD_NAME,A.DEST_NAME,A.SO_NO,A.PKG_UNIT,
       (SELECT TOP 1 TTL_PLT FROM SMINM WHERE SMINM.DN_NO = A.DN_NO) TTL_PLT,
       (SELECT TOP 1 PLTU FROM SMINM WHERE SMINM.DN_NO = A.DN_NO) PLTU,
       (ISNULL(B.PARTY_NAME+' ','')+ISNULL(B.PARTY_NAME2+' ','')+ISNULL(B.PARTY_NAME3+' ','')+ISNULL(B.PARTY_NAME4+' ','')) PARTY_NAME,
       (ISNULL(B.PART_ADDR1+',','')+ISNULL(B.PART_ADDR2+',','')+ISNULL(B.PART_ADDR3+',','')+ISNULL(B.PART_ADDR4+',','')+ISNULL(B.PART_ADDR5+',','')) PART_ADDR,
       B.PARTY_TEL,B.PARTY_ATTN,B.PARTY_NO,B.PARTY_TYPE,B.PARTY_MAIL,
       B.FAX_NO,B.TAX_NO,B.ORDER_BY,
       (SELECT TOP 1 SHPR_NM
          FROM SMSIM
         WHERE SMSIM.[PROFILE] = A.PROFILE_CD) AS SHPR_NM,
       (SELECT TOP 1 COMMODITY
          FROM SMSIM
         WHERE SMSIM. [PROFILE] = A.PROFILE_CD) AS SI_COMMODITY,
       (SELECT TOP 1 ISNULL(CD_DESCP, A.PKG_UNIT)
          FROM BSCODE
         WHERE BSCODE.CD_TYPE = 'UB'
           AND BSCODE.CD = A.PKG_UNIT
           AND BSCODE.GROUP_ID = A.GROUP_ID) PKG_UNIT_UB,
       (SELECT TOP 1 CHG_DESCP FROM SMCHG WHERE CHG_CD = A.QTYU) QTYU_DESCP,
       (SELECT SUM(AMOUNT1) FROM SMDN WHERE SMDN.SHIPMENT_ID = A.SHIPMENT_ID) AMOUNT1,
        (ISNULL(F.PARTY_NAME+' ','')+ISNULL(F.PARTY_NAME2+' ','')+ISNULL(F.PARTY_NAME3+' ','')+ISNULL(F.PARTY_NAME4+' ','')) P_SHIP_NAME,
       (ISNULL(F.PART_ADDR1+',','')+ISNULL(F.PART_ADDR2+',','')+ISNULL(F.PART_ADDR3+',','')+ISNULL(F.PART_ADDR4+',','')+ISNULL(F.PART_ADDR5+',','')) P_SHIP_ADDR,
       F.PIC AS P_PIC,F.PARTY_ATTN AS P_PARTY_ATTN,F.PARTY_TEL AS P_PARTY_TEL,F.PARTY_MAIL AS P_PARTY_MAIL,F.PARTY_FAX AS P_PARTY_FAX
  FROM SMSM A
  LEFT JOIN SMSMPT B
    ON A.SHIPMENT_ID = B.SHIPMENT_ID
    LEFT JOIN SMPTY F
         ON F.STATUS = 'U'  AND F.PARTY_NO = (SELECT TOP 1 SMDN.PLANT
                  FROM SMDN
                 WHERE SMDN.PLANT IS NOT NULL
                   AND A.DN_NO = SMDN.DN_NO)

ALTER VIEW [dbo].[V_FCL01]

ALTER VIEW [dbo].[V_IPQ01]

ALTER VIEW [dbo].[V_IPQ02]

ALTER VIEW [dbo].[V_IPQ03]

ALTER VIEW [dbo].[V_IPQ05]

ALTER VIEW [dbo].[V_IPQ06]
  /**************** END  by dean  2016/09/7 ***********************/

--UPDATE APPROVE_FLOW_M SET AU_ID='0F3C2DFC-9286-474B-80A4-204C0E155016' WHERE  GROUP_ID='TPV' AND CMP_ID='FQ' AND AU_ID='79C63C9D-ED9B-4CFD-913F-3AA793A7137E'
   ALTER TABLE SMRV ALTER COLUMN CUT_PORT_DATE datetime

 /**************** Begin by dean  2016/09/20 ***********************/
alter table SMINM  alter column COMBINE_INFO nvarchar(600) 
alter table SMINM  alter column LGOODS nvarchar(400) 
alter table SMINM  alter column MARKS nvarchar(2000) 
alter table SMINM  alter column CMDTY_CD nvarchar(500) 

alter table SMBD  ADD COST_CENTERDESCP NVARCHAR(70);
  /**************** END  by dean  2016/09/20 ***********************/
  ALTER TABLE SYS_ACCT ALTER COLUMN SAP_ID NVARCHAR(50);


--更新视图  TG_POST_CARGO_TRACE]

--V_CMSUMMARY  增加一个SMSM的ETD栏位
--V_FLOWSMDN  增加一个CUSTOMER_INNUMBER
__V_SMDN 增加一个CUSTOMER_INNUMBER

ALTER table SMDN  ADD CUSTOMER_INNUMBER NVARCHAR(135);


 /**************** begin  by dean  2016/10/17 ***********************/
alter trigger TG_POST_CARGO_TRACE
on [dbo].[SMSM]  
    for update  
as     
     if (UPDATE(ATD) OR UPDATE(ATA) OR UPDATE(ATA_D))  
    begin  
        UPDATE SMSM SET POST_CARGO_FLAG='N',POST_CARGO_DATE=NULL WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
    IF(UPDATE(STATUS))  
    BEGIN  
    declare @status varchar(5)   
    SELECT @status=STATUS FROM inserted  
    IF(@status='O')  
    BEGIN  
         UPDATE SMSM SET POST_CARGO_FLAG='N',POST_CARGO_DATE=NULL WHERE SHIPMENT_ID IN (SELECT SHIPMENT_ID FROM inserted)    
         END       
    end  
 if (UPDATE(ETA) OR UPDATE(ETD) OR UPDATE(ATA) OR UPDATE(ATD))  
    begin  
        UPDATE SMSM SET ETT=DATEDIFF(day, ETD,ETA ),  
  ATT=DATEDIFF(day, ATD,ATA ),  
  Dtt=DATEDIFF(day, ETD,ATD ) WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(AQTY) OR UPDATE(FQTY)OR UPDATE(QTY))  
    begin  
        UPDATE SMSM SET DQTY=AQTY-FQTY,  
  Fdqty=Qty-Aqty,  
  Ndqty=Aqty-Fqty  WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(CUT_PORT_DATE))  
    begin  
        UPDATE SMRV SET CUT_PORT_DATE=(SELECT CUT_PORT_DATE FROM inserted)  
   WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(CARRIER)OR UPDATE(CARRIER_NM))  
    begin  
        UPDATE SMRV SET CARRIER=(SELECT CARRIER FROM inserted),  
  CARRIER_NM=(SELECT CARRIER_NM FROM inserted)  
   WHERE SHIPMENT_ID=(SELECT SHIPMENT_ID FROM inserted)         
    end  
go

V_FCL03
 /**************** END  by dean  2016/10/17 ***********************/

 /**************** begin  by dean  2016/10/26 ***********************/
 CREATE TRIGGER UPDATE_SMBIM_FOR_ETD

ON SMSM

FOR UPDATE

AS

UPDATE SMBIM SET
SMBIM.DEBIT_DATE=INSERTED.ETD FROM INSERTED
WHERE SMBIM.SHIPMENT_ID=INSERTED.SHIPMENT_ID AND (SMBIM.DEBIT_NO IS NULL OR SMBIM.DEBIT_NO ='')

//task for auto Calculation
CREATE TABLE AUTO_VALUATION_TASK
(
U_ID NVARCHAR(36),
SMU_ID NVARCHAR(36),
DONE NVARCHAR(3)
)


update SMIND set GOODS_DESCP =replace(GOODS_DESCP,'&nbsp;',' ')
WHERE GOODS_DESCP LIKE '%&nbsp;%'

update SMIND set GOODS_DESCP =replace(GOODS_DESCP,' ',' ')
WHERE GOODS_DESCP LIKE '% %'

update SMINP set GOODS_DESCP =replace(GOODS_DESCP,'&nbsp;',' ')
WHERE GOODS_DESCP LIKE '%&nbsp;%'

update SMINP set GOODS_DESCP =replace(GOODS_DESCP,' ',' ')
WHERE GOODS_DESCP LIKE '% %'
 /**************** end  by dean  2016/10/26 ***********************/

/**************** add  by Tim  2016/10/31 ***********************/
CREATE TABLE [dbo].[SMCTM](
	[U_ID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[CT_NO] [nvarchar](20) NULL,
	[CT_DATE] [datetime] NULL,
	[STATUS] [nvarchar](1) NULL,
	[RFQ_NO] [nvarchar](20) NULL,
	[REGION] [nvarchar](2) NULL,
	[CNTY] [nvarchar](2) NULL,
	[EFFECT_FROM] [datetime] NULL,
	[EFFECT_TO] [datetime] NULL,
	[EXTEN] [nvarchar](1) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[LSP_CT] [nvarchar](20) NULL,
	[LSP_PIC] [nvarchar](30) NULL,
	[LOCATION] [nvarchar](10) NULL,
	[LOC_NAME] [nvarchar](70) NULL,
	[QUOT_NO] [nvarchar](20) NULL,
	[LOC_PIC] [nvarchar](30) NULL,
	[COPY] [numeric](2, 0) NULL,
	[EMTTOPORT] [numeric](3, 0) NULL,
	[PORTTOATD] [numeric](3, 0) NULL,
	[EMTTOATD] [numeric](3, 0) NULL,
	[REMARK] [nvarchar](500) NULL,
	[CMP] [nvarchar](10) NULL,
	[CREATE_DEP] [nvarchar](10) NULL,
	[CREATE_EXT] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL
) ON [PRIMARY]


CREATE TABLE [dbo].[SMIPM](
	[U_ID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[JOB_DATE] [datetime] NULL,
	[JOB_CMP] [nvarchar](10) NULL,
	[STATUS] [nvarchar](1) NULL,
	[BL_NO] [nvarchar](20) NULL,
	[TRAN_TYPE] [nvarchar](10) NULL,
	[EVEN_PLACE] [nvarchar](30) NULL,
	[CUR] [nvarchar](3) NULL,
	[AMT] [numeric](18, 2) NULL,
	[TERM] [nvarchar](3) NULL,
	[REGION] [nvarchar](2) NULL,
	[POL] [nvarchar](5) NULL,
	[POL_NM] [nvarchar](30) NULL,
	[POD] [nvarchar](5) NULL,
	[POD_NM] [nvarchar](30) NULL,
	[DEST] [nvarchar](5) NULL,
	[DEST_NM] [nvarchar](30) NULL,
	[CNT_NO] [nvarchar](500) NULL,
	[INV_NO] [nvarchar](500) NULL,
	[COMPANY] [nvarchar](10) NULL,
	[COMPANY_NM] [nvarchar](70) NULL,
	[GOODS] [nvarchar](300) NULL,
	[SHIPPER_CD] [nvarchar](10) NULL,
	[SHIPPER_NM] [nvarchar](70) NULL,
	[FI_CD] [nvarchar](10) NULL,
	[FI_NM] [nvarchar](70) NULL,
	[CNEE_CD] [nvarchar](10) NULL,
	[CNEE_NM] [nvarchar](70) NULL,
	[CARRIER] [nvarchar](10) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[INS_CD] [nvarchar](10) NULL,
	[INS_NM] [nvarchar](70) NULL,
	[REASON] [nvarchar](10) NULL,
	[LOSS_QTY] [numeric](12, 0) NULL,
	[LOSS_CUR] [nvarchar](3) NULL,
	[LOSS_AMT] [numeric](18, 2) NULL,
	[LOSS_UAMT] [numeric](18, 2) NULL,
	[IFLAG] [nvarchar](1) NULL,
	[ICUR] [nvarchar](3) NULL,
	[IAMT] [numeric](18, 2) NULL,
	[IUAMT] [numeric](18, 2) NULL,
	[IPAY_DATE] [datetime] NULL,
	[CFLAG] [nvarchar](1) NULL,
	[CCUR] [nvarchar](3) NULL,
	[CAMT] [numeric](18, 2) NULL,
	[CUAMT] [numeric](18, 2) NULL,
	[CPAY_DATE] [datetime] NULL,
	[FFLAG] [nvarchar](1) NULL,
	[FCUR] [nvarchar](3) NULL,
	[FAMT] [numeric](18, 2) NULL,
	[FUAMT] [numeric](18, 2) NULL,
	[FPAY_DATE] [datetime] NULL,
	[TFLAG] [nvarchar](1) NULL,
	[TCUR] [nvarchar](3) NULL,
	[TAMT] [numeric](18, 2) NULL,
	[TUAMT] [numeric](18, 2) NULL,
	[TPAY_DATE] [datetime] NULL,
	[PAY_TYPE] [nvarchar](1) NULL,
	[TPV_LCUR] [nvarchar](3) NULL,
	[TPV_LAMT] [numeric](18, 2) NULL,
	[CONFIRM_BY] [nvarchar](20) NULL,
	[CONFIRM_DATE] [datetime] NULL,
	[AC_BY] [nvarchar](20) NULL,
	[AC_DATE] [datetime] NULL,
	[ENDING_BY] [nvarchar](20) NULL,
	[ENDING_DATE] [datetime] NULL,
	[CMP] [nvarchar](10) NULL,
	[CREATE_DEP] [nvarchar](10) NULL,
	[CREATE_EXT] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[PAY_NO] [nvarchar](20) NULL
) ON [PRIMARY]


CREATE TABLE [dbo].[SMIPC](
	[U_ID] [nvarchar](50) NULL,
	[U_FID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[JOB_TYPE] [nvarchar](1) NULL,
	[SEQ_NO] [numeric](5, 0) NULL,
	[INS_CD] [nvarchar](10) NULL,
	[CHG_DESCP] [nvarchar](30) NULL,
	[IP_AMT] [numeric](18, 2) NULL,
	[REMARK] [nvarchar](100) NULL
) ON [PRIMARY]

CREATE TABLE [dbo].[SMIPR](
	[U_ID] [nvarchar](50) NULL,
	[U_FID] [nvarchar](50) NULL,
	[JOB_NO] [nvarchar](20) NULL,
	[SEQ_NO] [numeric](5, 0) NULL,
	[JOB_DATE] [datetime] NULL,
	[JOB_CMP] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[REMARK] [nvarchar](500) NULL
) ON [PRIMARY]

/**************** end  by Tim  2016/10/31 ***********************/

/**************** add  by fish  2016/11/08 17：46 ***********************/
ALTER table SMBID ADD APPROVE_BY NVARCHAR(30);
ALTER table SMBID ADD APPROVE_DATE DATETIME;
ALTER table SMBID ADD BOOKING_BY NVARCHAR(30);
ALTER table SMBID ADD APPROVE_STATUS NVARCHAR(2);
ALTER table SMBID ADD UNAPPROVE_MSG NVARCHAR(500);

UPDATE SMBID SET BOOKING_BY=
(SELECT TOP 1  CASE WHEN CHARINDEX(' ',BL_WIN)>0 THEN SUBSTRING(BL_WIN,1,CHARINDEX(' ',BL_WIN)-1) ELSE BL_WIN END FROM SMSM WHERE SMSM.SHIPMENT_ID=SMBID.SHIPMENT_ID)
WHERE BOOKING_BY IS NULL;
/**************** end  by fish 2016/11/08 17：46 ***********************/


 /**************** begin  by dean  2016/11/8 ***********************/



ALTER TABLE SMRV ADD CNTR_BE_DAY NVARCHAR(10);
ALTER TABLE SMRV ADD FAC_HOLD_DAY NVARCHAR(10);


ALTER trigger [dbo].[TG_UP_SMRV_TTLVGM]
on [dbo].[SMRV]
    for update
as   
    if (UPDATE(GW) OR UPDATE(TARE_WEIGHT))
    begin
        UPDATE SMRV SET TTL_VGM=GW+TARE_WEIGHT WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
    
    if (UPDATE(IN_DATE) OR UPDATE(CALL_DATE)OR UPDATE(OUT_DATE))
    begin
        UPDATE SMRV SET CNTR_BE_DAY =cast(cast(DATEDIFF(mi,CALL_DATE,IN_DATE) as float)/ 1440 as numeric(18,2)),
FAC_HOLD_DAY =cast(cast(DATEDIFF(mi,IN_DATE,OUT_DATE) as float)/ 1440 as numeric(18,2)) WHERE RESERVE_NO IN (SELECT RESERVE_NO FROM inserted)       
    end
GO


alter table SMRV  alter column CNTR_BE_DAY numeric(18,2)
alter table SMRV  alter column FAC_HOLD_DAY numeric(18,2)
/**************** end  by dean 2016/11/8 ***********************/

4：55 ***********************/
CREATE TABLE [dbo].[ASD_TASK](
	[U_ID] [nvarchar](40) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[BASE_CONDITION] [nvarchar](3000) NULL,
	[RESULT_STATUS] [nvarchar](1) NULL,
	[asd_type] [nvarchar](1) NULL,
	[USERID] [nvarchar](20) NULL,
	[FILE_NAMES] [nvarchar](200) NULL,
	[REMARK] [nvarchar](2000) NULL,
	[MONTH] [int] NULL,
	[YEAR] [int] NULL,
	[FilePath] [nvarchar](200) NULL,
	[TEMP_OK] [nvarchar](1) NULL,
	[ETD_FROM] [date] NULL,
	[ETD_TO] [date] NULL,
	[STR_MONTH] [nvarchar](2) NULL,
 CONSTRAINT [PK_ASD_TASK] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

/**************** end  by will  2016/11/12 14：55 ***********************/


/**************** add  by fish  2016/11/15 15：46 ***********************/
-----------上传报价的user---------------
ALTER TABLE SMBID ADD UPLOAD_USER  NVARCHAR(30);
ALTER TABLE SMBID ADD UPLOAD_TIME  DATETIME;

-----------解除账单关系的user---------------
ALTER TABLE SMBID ADD VOID_USER  NVARCHAR(30);
ALTER TABLE SMBID ADD VOID_TIME  DATETIME;

ALTER TABLE SMBID ADD UNAPPROVE_DESCP  NVARCHAR(100);
/**************** end  by fish 2016/11/15 15：46 ***********************/

/**************** add  by will  2016/11/18 9：41 ***********************/
ALTER TABLE SMSM ADD CONT_DECL_NUM NUMERIC(5,0);
alter table smsm alter column CBM decimal(18,4);
ALTER TABLE SMSM ADD VW decimal(18,3);
ALTER TABLE SMSM ADD PVW decimal(18,3)
/**************** end  by will  2016/11/18 9：41 ***********************/

/**************** add  by dean  2016/11/22 15：46 ***********************/
V_IPQ03
/**************** end  by dean 2016/11/22 15：46 ***********************/>>>>>>> .r10753

/**************** add  by fish  2016/11/25 15：46 ***********************/
UPDATE SMBID SET DEBIT_NO=(SELECT DEBIT_NO FROM SMBIM WHERE SMBIM.U_ID=SMBID.U_FID) WHERE DEBIT_NO IS NULL
/**************** end  by fish 2016/11/25 15：46 ***********************/



/**************** add  by TIM  2016/12/07 15：46 ***********************/
INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('JOB_NO', 'FQ', '*', 'TPV', '2015-12-15 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('JOB_NO',1,'20151214','CMP','公司',2,'FQ','FQ','*','TPV'),
('JOB_NO',2,'20151214','CONST','常量',2,'IP','FQ','*','TPV'),
('JOB_NO',3,'20151214','YY','年度',2,'YY','FQ','*','TPV'),
('JOB_NO',4,'20151214','MM','月份',2,'MM','FQ','*','TPV'),
('JOB_NO',5,'20151214','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('JOB_NO', '出险自动编号', '20151214', 'FQ', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('JOB_NO', 'XM', '*', 'TPV', '2015-12-15 14:35', ';XM;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('JOB_NO',1,'20151214','CMP','公司',2,'XM','XM','*','TPV'),
('JOB_NO',2,'20151214','CONST','常量',2,'IP','XM','*','TPV'),
('JOB_NO',3,'20151214','YY','年度',2,'YY','XM','*','TPV'),
('JOB_NO',4,'20151214','MM','月份',2,'MM','XM','*','TPV'),
('JOB_NO',5,'20151214','NO','流水號',6,NULL,'XM','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('JOB_NO', '出险自动编号', '20151214', 'XM', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('JOB_NO', 'BJ', '*', 'TPV', '2015-12-15 14:35', ';BJ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('JOB_NO',1,'20151214','CMP','公司',2,'BJ','BJ','*','TPV'),
('JOB_NO',2,'20151214','CONST','常量',2,'IP','BJ','*','TPV'),
('JOB_NO',3,'20151214','YY','年度',2,'YY','BJ','*','TPV'),
('JOB_NO',4,'20151214','MM','月份',2,'MM','BJ','*','TPV'),
('JOB_NO',5,'20151214','NO','流水號',6,NULL,'BJ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('JOB_NO', '出险自动编号', '20151214', 'BJ', '*', 'TPV')

CREATE VIEW V_SMSM
AS
SELECT V.CNTR_NO,M.* FROM SMSM M LEFT JOIN SMRV V ON M.SHIPMENT_ID = V.SHIPMENT_ID

ALTER TABLE SMIPM
ALTER COLUMN JOB_DATE DATE
/**************** add  by TIM  2016/12/07 15：46 ***********************/


/**************** add  by TIM  2016/12/08 15：46 ***********************/
INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('CT_NO', 'FQ', '*', 'TPV', '2015-12-15 14:35', ';FQ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('CT_NO',1,'20151214','CMP','公司',2,'FQ','FQ','*','TPV'),
('CT_NO',2,'20151214','CONST','常量',2,'CT','FQ','*','TPV'),
('CT_NO',3,'20151214','YY','年度',2,'YY','FQ','*','TPV'),
('CT_NO',4,'20151214','MM','月份',2,'MM','FQ','*','TPV'),
('CT_NO',5,'20151214','NO','流水號',6,NULL,'FQ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('CT_NO', '出险自动编号', '20151214', 'FQ', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('CT_NO', 'XM', '*', 'TPV', '2015-12-15 14:35', ';XM;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('CT_NO',1,'20151214','CMP','公司',2,'XM','XM','*','TPV'),
('CT_NO',2,'20151214','CONST','常量',2,'CT','XM','*','TPV'),
('CT_NO',3,'20151214','YY','年度',2,'YY','XM','*','TPV'),
('CT_NO',4,'20151214','MM','月份',2,'MM','XM','*','TPV'),
('CT_NO',5,'20151214','NO','流水號',6,NULL,'XM','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('CT_NO', '出险自动编号', '20151214', 'XM', '*', 'TPV')

INSERT INTO SCS_AUTONO_FLOWNO (RULE_CODE, CMP, STN, GROUP_ID, UPDATE_DATE, FLOW_COND) VALUES('CT_NO', 'BJ', '*', 'TPV', '2015-12-15 14:35', ';BJ;15;12' )
INSERT INTO SCS_AUTONO_ITEM (RULE_CODE, SEQ_NO, EFFECT_DATE, CODE, CODE_NAME, CODE_LEN, CODE_CONTENT, CMP, STN, GROUP_ID) VALUES
('CT_NO',1,'20151214','CMP','公司',2,'BJ','BJ','*','TPV'),
('CT_NO',2,'20151214','CONST','常量',2,'CT','BJ','*','TPV'),
('CT_NO',3,'20151214','YY','年度',2,'YY','BJ','*','TPV'),
('CT_NO',4,'20151214','MM','月份',2,'MM','BJ','*','TPV'),
('CT_NO',5,'20151214','NO','流水號',6,NULL,'BJ','*','TPV');
INSERT INTO SCS_AUTONO_RULE (RULE_CODE, RULE_NAME, EFFECT_DATE, CMP, STN, GROUP_ID) VALUES ('CT_NO', '出险自动编号', '20151214', 'BJ', '*', 'TPV')

ALTER TABLE SMCTM ADD STN NVARCHAR(10)
ALTER TABLE SMCTM ADD DEP NVARCHAR(10)
ALTER TABLE SMIPM ADD TERM_DESCP NVARCHAR(30)
/**************** add  by TIM  2016/12/08 15：46 ***********************/

/**************** add  by WILL  2016/12/12 14：03 ***********************/
CREATE TABLE [dbo].[SMPTY_FILTER](
	[CMP_CD] [nvarchar](5) NULL,
	[PARTY_NO] [nvarchar](10) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[U_ID] [nvarchar](40) NOT NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_SMPTY_FILTER] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

ALTER TABLE SMCTM ADD APPROVE_USER NVARCHAR(30);
ALTER TABLE SMCTM ADD APPROVE_TO NVARCHAR(10);
ALTER TABLE SMCTM ADD APPROVE_BACK NVARCHAR(1);
/**************** begin  by WILL  2016/12/12 14：03 ***********************/


/**************** begin  by FISH  2016/12/12 16：03 3 ***********************/
   ALTER trigger [dbo].[TG_SMBID]
on [dbo].[SMBID]
    for update
as   

 declare @b_QCUR nvarchar(200)  --修改之前的
 declare @S_QCUR nVARCHAR(200)  --修改之后的
 SELECT @S_QCUR= ISNULL(QCUR,'') FROM INSERTED --从更新后的副本表(临时表)里面 获得要修改后的状态 
 select @b_QCUR=ISNULL(QCUR,'') from deleted  --从之前删掉的临时表里面获取原来的值
    if (UPDATE(QCUR))
    begin
	      if((select COUNT(1) from inserted where QCUR IS NULL OR QCUR='')>0 AND (select COUNT(1) from deleted where QCUR IS NOT NULL)>0)
         update SMBID set QCUR=(SELECT TOP 1 QCUR FROM deleted WHERE deleted.U_ID=SMBID.U_ID) where U_ID IN (SELECT U_ID FROM inserted WHERE QCUR IS NULL OR QCUR='')
    end

	if (UPDATE(BAMT))
    begin
         update SMBID set APPROVE_STATUS='E' where U_ID IN (SELECT U_ID FROM inserted) AND APPROVE_STATUS='N'
    end
	/**************** EDN  by FISH  2016/12/12 16：03 ***********************/

	/**************** add  by dean  2016/12/21 15：46 ***********************/
ALTER TABLE SMINP ALTER COLUMN GW NUMERIC(15,6);
ALTER TABLE SMINP ALTER COLUMN TTL_GW NUMERIC(21,6);
ALTER TABLE SMINP ALTER COLUMN CBM NUMERIC(15,6);
ALTER TABLE SMINP ALTER COLUMN TTL_CBM NUMERIC(14,6);
ALTER TABLE SMINP ALTER COLUMN NW NUMERIC(15,6);
ALTER TABLE SMINP ALTER COLUMN TTL_NW NUMERIC(21,6);

ALTER TABLE AUTO_VALUATION_TASK ADD DONE_DATE datetime
ALTER TABLE AUTO_VALUATION_TASK ADD DONE_FREQUENCY NUMERIC

V_IPQ03
/**************** add  by dean  2016/12/21 15：46 ***********************

/**************** add  by tim  2016/12/27 15：46 ***********************/
CREATE TABLE [dbo].[BSRPT](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[RPT_ID] [nvarchar](100) NULL,
	[RPT_NM] [nvarchar](200) NULL,
	[RPT_TYPE] [nvarchar](10) NULL,
	[RPT_WAY] [nvarchar](1) NULL,
	[RPT_CONDITION] [nvarchar](300) NULL,
	[VIEW_ID] [nvarchar](100) NULL,
	[VIEW_TYPE] [nvarchar](1) NULL,
	[RPT_PARAMETER] [nvarchar](300) NULL,
	[REMARK] [text] NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_BSRPT] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
/**************** add  by tim  2016/12/27 15：46 ***********************/

/**************** add  by will  2017/1/5 11：56 ***********************/
 ALTER TABLE SMBD ADD RELEASE_NO NVARCHAR(20);
ALTER TABLE SMSM ADD RELEASE_NO NVARCHAR(20);
ALTER TABLE TKBL ADD RELEASE_NO NVARCHAR(20);
ALTER TABLE SMEXM ADD AUTHORI_ZATION NVARCHAR(50);
ALTER TABLE SMSM ADD DN_NO_REF NVARCHAR(20);
/**************** end  by will  2017/1/5 11：56 ***********************/

/**************** add  by will  2017/1/9 11：56 ***********************/
INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','VERP','LCL','LCL','FQ','*','MANA10','2017-01-09',null,null,null,null,'0005',null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','VERP','LCL','LCL','XM','*','MANA10','2017-01-09',null,null,null,null,'0005',null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','VERP','LCL','LCL','BJ','*','MANA10','2017-01-09',null,null,null,null,'0005',null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','VERP','LCL','LCL','QD','*','MANA10','2017-01-09',null,null,null,null,'0005',null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','VERP','LCL','LCL','WH','*','MANA10','2017-01-09',null,null,null,null,'0005',null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','VERP','LCL','LCL','BH','*','MANA10','2017-01-09',null,null,null,null,'0005',null,null,null,null);

update bscode set ap_cd='0001' where cd_type='VERP' and cd='20GP'
update bscode set ap_cd='0002' where cd_type='VERP' and cd='40GP'
update bscode set ap_cd='0003' where cd_type='VERP' and cd='40HQ'

/**************** end  by will  2017/1/9 11：56 ***********************/

/**************** add  by will  2017/1/11 11：56 ***********************/
INSERT INTO BSCODE_KIND (GROUP_ID, CD_TYPE, CD_DESCP, CMP, STN)VALUES('TPV','SERV','Express Service', 'FQ', '*');
INSERT INTO [dbo].[BSCODE]
           ([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP],[STN],[CREATE_BY],[ORDER_BY])
     VALUES('TPV','SERV','15D','15D：全球快递（文件）','FQ','*','MANA10','0'),
          ('TPV','SERV','15N ','15N：全球快递（包裹）','FQ','*','MANA10','1'),
		  ('TPV','SERV','48N ','48N：经济快递','FQ','*','MANA10','2')
/**************** add  by will  2017/1/11 11：56 ***********************/

/**************** add  by DEAN  2017/1/12 11：56 ***********************/
ALTER TABLE TKPMT ADD  CREATE_BY NVARCHAR(30)
ALTER TABLE TKPMT ADD  CREATE_DATE DATETIME
ALTER TABLE TKPMT ADD  MODIFY_BY NVARCHAR(30)
ALTER TABLE TKPMT ADD  MODIFY_DATE DATETIME
alter TABLE SMCTM ADD  EXTEN_DATE DATE

/**************** end  by DEAN  2017/1/12 11：56 ***********************/



/**************** add  by DEAN  2017/1/16 11：56 ***********************/

alter table SMIPM  add  APPLICATION_DATE DATETIME
alter table SMIPM  add  APPLICATION_BY NVARCHAR(30)
alter table SMIPM  add  EXCEPTION_DESC NVARCHAR(200)

--复制FQ代码建档到其他工厂
Insert into BSCODE  (GROUP_ID,
CD_TYPE,
CD,
CD_DESCP,
CMP,
STN,
CREATE_BY,
CREATE_DATE,
MODIFY_BY,
AMS_CODE,
INTTRA,
AR_CD,
AP_CD,
DEP,
APPLY,
LOCATION,
ORDER_BY) select GROUP_ID,
CD_TYPE,
CD,
CD_DESCP,
'XM',
STN,
CREATE_BY,
CREATE_DATE,
MODIFY_BY,
AMS_CODE,
INTTRA,
AR_CD,
AP_CD,
DEP,
APPLY,
LOCATION,
ORDER_BY from BSCODE  where CD_TYPE='IPAC' AND CMP='FQ'


alter table SMIPM ADD IU_RATE DECIMAL(18,6)
alter table SMIPM ADD LOSS_RATE DECIMAL(18,6)
alter table SMIPM ADD CU_RATE DECIMAL(18,6)
alter table SMIPM ADD FU_RATE DECIMAL(18,6)
alter table SMIPM ADD TU_RATE DECIMAL(18,6)
/**************** end  by DEAN  2017/1/16 11：56 ***********************/



alter TABLE SMCTM  alter column  EXTEN_DATE DATE

alter TABLE SMCTM  alter column  CT_DATE DATE

alter TABLE SMCTM  alter column  EFFECT_TO DATE

alter TABLE SMCTM  add REFUSE_REASON NVARCHAR(200)



/**************** add  by fish  2017/2/6 9：56 ***********************/
ALTER TABLE TKBL ADD CNTR_NO NVARCHAR(500);
UPDATE TKBL SET CNTR_NO=(SELECT DISTINCT CNTR_NO+';' FROM TKBLCNTR WHERE JOB_NO=TKBL.U_ID AND CNTR_NO IS NOT NULL FOR XML PATH(''));
/**************** end  by fish  2017/2/6 9：56 ***********************/
/**************** begin  by DEAN  2017/2/7 11：56 ***********************/
ALTER TABLE SMSM ADD C_MASTER_NO NVARCHAR(20)
ALTER TABLE SMSM ADD C_HOUSE_NO NVARCHAR(20)

UPDATE SMSM  SET C_MASTER_NO = C.MASTER_NO , 
C_HOUSE_NO=C.HOUSE_NO  from (select B.MASTER_NO , B.HOUSE_NO ,A.COMBIN_SHIPMENT
  from SMSM A
  LEFT JOIN SMSM B
    ON A.COMBIN_SHIPMENT = B.SHIPMENT_ID
   AND A.SHIPMENT_ID != '' ) C where C.COMBIN_SHIPMENT=SMSM.COMBIN_SHIPMENT

ALTER trigger [dbo].[TG_POST_CARGO_TRACE]
on [dbo].[SMSM]  
    for update  
as     
     if (UPDATE(ATD) OR UPDATE(ATA) OR UPDATE(ATA_D))  
    begin  
        UPDATE SMSM SET POST_CARGO_FLAG='N',POST_CARGO_DATE=NULL WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted)         
    end  
    IF(UPDATE(STATUS))  
    BEGIN  
    declare @status varchar(5)   
    SELECT @status=STATUS FROM inserted  
    IF(@status='O')  
    BEGIN  
         UPDATE SMSM SET POST_CARGO_FLAG='N',POST_CARGO_DATE=NULL WHERE SHIPMENT_ID IN (SELECT SHIPMENT_ID FROM inserted)    
         END       
    end  
 if (UPDATE(ETA) OR UPDATE(ETD) OR UPDATE(ATA) OR UPDATE(ATD))  
    begin  
        UPDATE SMSM SET ETT=DATEDIFF(day, ETD,ETA ),  
  ATT=DATEDIFF(day, ATD,ATA ),  
  Dtt=DATEDIFF(day, ETD,ATD ) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(AQTY) OR UPDATE(FQTY)OR UPDATE(QTY))  
    begin  
        UPDATE SMSM SET DQTY=AQTY-FQTY,  
  Fdqty=Qty-Aqty,  
  Ndqty=Aqty-Fqty  WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(CUT_PORT_DATE))  
    begin  
        UPDATE SMRV SET CUT_PORT_DATE=(SELECT TOP 1 CUT_PORT_DATE FROM inserted where inserted.SHIPMENT_ID=SMRV.SHIPMENT_ID)  
   WHERE SHIPMENT_ID IN (SELECT SHIPMENT_ID FROM inserted)         
    end  
  
 if (UPDATE(CARRIER)OR UPDATE(CARRIER_NM))  
    begin  
        UPDATE SMRV SET CARRIER=(SELECT TOP 1 CARRIER FROM inserted where inserted.SHIPMENT_ID=SMRV.SHIPMENT_ID),  
  CARRIER_NM=(SELECT TOP 1 CARRIER_NM FROM inserted where inserted.SHIPMENT_ID=SMRV.SHIPMENT_ID)
   WHERE SHIPMENT_ID IN (SELECT SHIPMENT_ID FROM inserted)         
    end  
if (UPDATE(MASTER_NO)OR UPDATE(HOUSE_NO))  
    begin  
	  UPDATE SMSM SET C_MASTER_NO=(
	  SELECT TOP 1 MASTER_NO FROM SMSM B WHERE B.SHIPMENT_ID IN (
	  SELECT TOP 1 COMBIN_SHIPMENT FROM inserted where inserted.COMBIN_SHIPMENT=B.SHIPMENT_ID)) ,  
   C_HOUSE_NO=(
	  SELECT TOP 1 HOUSE_NO FROM SMSM B WHERE B.SHIPMENT_ID IN (
	  SELECT TOP 1 COMBIN_SHIPMENT FROM inserted where inserted.COMBIN_SHIPMENT=B.SHIPMENT_ID))
   WHERE COMBIN_SHIPMENT IN (SELECT COMBIN_SHIPMENT FROM inserted)      
    end  
GO

--更新语句
update smsm set C_HOUSE_NO=(SELECT TOP 1 A.HOUSE_NO FROM SMSM A WHERE A.SHIPMENT_ID =smsm.COMBIN_SHIPMENT AND smsm.COMBIN_SHIPMENT!=''),
C_MASTER_NO=(SELECT TOP 1  A.MASTER_NO FROM SMSM A WHERE A.SHIPMENT_ID =smsm.COMBIN_SHIPMENT AND smsm.COMBIN_SHIPMENT!='')
WHERE  smsm.COMBIN_SHIPMENT!=''

ALTER TABLE SYS_ACCT ADD MODIFY_BY NVARCHAR(30)
ALTER TABLE SYS_ACCT ADD MODIFY_DATE datetime
alter table SMQTM add BACK_REMARK NVARCHAR(200)
alter table SMQTM add APPROVE_TO NVARCHAR(20)
alter table SMQTM add APPROVE_NM NVARCHAR(70)
alter table SMQTM add APPROVE_USER NVARCHAR(30)
alter table SMQTM add APPROVE_TYPE NVARCHAR(10)
alter table SMQTM add APPROVE_STATUS NVARCHAR(1)

/**************** end  by DEAN  2017/2/7 11：56 ***********************/

 /**************** Begin by will 2017/02/09 17:40 注释的更新语法，只能执行一次***********************/
ALTER TABLE SMINM ADD SEND_FRT_DATE DATETIME;
ALTER TABLE SMSM ADD SEND_FRT_DATE DATETIME;
 --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"SendFrtDate","width":100,"hidden":false},{"name":"SendBrokerDate","width":100,"hidden":false}]') 
--WHERE ID='Invoice List' AND LAYOUT_TYPE='GRID';

 --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"SendFrtDate","width":100,"hidden":false}]') 
--WHERE ID='报关通知' AND LAYOUT_TYPE='GRID';
 /**************** end by will 2017/02/09 17:40***********************/


 /**************** add  by fish  2017/2/10 14：56 ***********************/
ALTER TABLE SMBID ADD DN_NO NVARCHAR(30);
/**************** end  by fish  2017/2/10 14：56 ***********************/


 /**************** add  by fish  2017/2/21 14：56 ***********************/
ALTER TABLE SMINM
ADD  STATUS NVARCHAR(1) DEFAULT 'U'
UPDATE [SMINM] SET STATUS = 'U'

ALTER TABLE SMINM
ADD  STATUS NVARCHAR(1) DEFAULT 'U'
/**************** end  by fish  2017/2/21 14：56 ***********************/

/**************** add  by Will  2017/2/21 15：50 ***********************/
 ALTER TABLE SMBD ADD PLANT NVARCHAR(10);
 ALTER TABLE SMSM ADD PLANT NVARCHAR(10);
 ALTER TABLE SMRV ADD PLANT NVARCHAR(10);

  --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"Plant","width":80,"hidden":false}]') 
  --WHERE ID='Shipment List' AND LAYOUT_TYPE='GRID';

  ALTER TABLE SMDNP ADD NW decimal(18,3);
  --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"Nw","width":80,"hidden":false}]') 
  --WHERE ID='DN料号明细' AND LAYOUT_TYPE='GRID';

  UPDATE SMSM SET PLANT=(SELECT PLANT FROM SMDN WHERE SMDN.DN_NO=SMSM.DN_NO)
  UPDATE SMRV SET PLANT=(SELECT PLANT FROM SMSM WHERE SMSM.shipment_id=SMRV.shipment_id)
/**************** end  by Will  2017/2/21 15：50 ***********************/
/**************** begin  by Will  2017/2/22 17：30 ***********************/
-- UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"MappingCode","width":80,"hidden":false}]') 
--  WHERE ID='城市港口列表' AND LAYOUT_TYPE='GRID';
/**************** end  by Will  2017/2/22 17：31 ***********************/

  ALTER TABLE SMDNP ADD DOWN_DATE DATETIME;

  alter view V_CMSUMMARY
  -- UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"DownDate","width":80,"hidden":false}]') 
--  WHERE ID='货柜管理列表' AND LAYOUT_TYPE='GRID';
  
ALTER TABLE TKBL ADD C_MASTER_NO NVARCHAR(20)
ALTER TABLE TKBL ADD C_HOUSE_NO NVARCHAR(20)
ALTER TABLE TKBL ADD ISCOMBINE_BL NVARCHAR(1)
ALTER TABLE TKBL ADD COMBIN_SHIPMENT NVARCHAR(20)
 ALTER TABLE TKBL ADD ISF_SEND_DATE datetime;
  ALTER TABLE TKBL ADD IORDER NVARCHAR(1);

  UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"CombinShipment","width":80,"hidden":false},{"name":"Iorder","width":80,"hidden":false},{"name":"IsfSendDate","width":80,"hidden":false},{"name":"CMasterNo","width":80,"hidden":false},{"name":"CHouseNo","width":80,"hidden":false}]') 
 WHERE ID='货况汇总' AND LAYOUT_TYPE='GRID'; 
    UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"IsfSendDate","width":80,"hidden":false}]') 
 WHERE ID='订舱列表' AND LAYOUT_TYPE='GRID';
    UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"IsfSendDate","width":80,"hidden":false}]') 
 WHERE ID='FCL 订舱' AND LAYOUT_TYPE='GRID';
      UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"IsfSendDate","width":80,"hidden":false}]') 
 WHERE ID='LCL 订舱' AND LAYOUT_TYPE='GRID';


alter FCL02，IPQ05,IPQ06

BEGIN DEAN 2017/03/29
ALTER TABLE SYS_ACCT ADD  I_E NVARCHAR(1)

alter TABLE SMINM ADD DN_STATUS NVARCHAR(10)

create trigger [dbo].[UP_SMINM_APPROVE]
on [dbo].[SMDN]
    for update
as   
    if (UPDATE(APPROVE_TO))
    begin
        UPDATE SMINM SET DN_STATUS=(SELECT APPROVE_TO FROM inserted)  WHERE DN_NO IN (SELECT DN_NO FROM inserted)       
    end
GO


END DEAN 2017/03/29

/********************************************進口SQL*******************************************************/
--SMRV--
ALTER TABLE SMRV ADD LOT_NO NVARCHAR(20)
ALTER TABLE SMRV ADD RV_TYPE NVARCHAR(1)
ALTER TABLE SMRV ADD CAR_TYPE NVARCHAR(20)
ALTER TABLE SMRV ADD TRS_MODE NVARCHAR(5)
ALTER TABLE SMRV ADD CANCEL_DATE DATETIME
ALTER TABLE SMRV ADD PICK_AREA NVARCHAR(20)
ALTER TABLE SMRV ADD PICK_AREA_NM NVARCHAR(70)
ALTER TABLE SMRV ADD DLV_AREA NVARCHAR(20)
ALTER TABLE SMRV ADD DLV_AREA_NM NVARCHAR(70)
ALTER TABLE SMRV ADD GATEIN_DATE DATETIME

--SMFSC--
ALTER TABLE SMFSC ADD IO_TYPE NVARCHAR(1)
ALTER TABLE SMFSC ADD TAREA NVARCHAR(5)

CREATE TABLE [dbo].[SMQTI](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CHG_CD] [nvarchar](10) NULL,
	[POD_CD] [nvarchar](20) NULL,
	[I_TYPE] [nvarchar](1) NULL,
	[CARRIER_CD] [nvarchar](20) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[CNT_TYPE] [nvarchar](10) NULL,
	[S_DAY] [int] NULL,
	[E_DAY] [int] NULL,
	[FEE_PER_DAY] [int] NULL,
	[EMPTY_RETURN] [nvarchar](20) NULL,
 CONSTRAINT [PK_SMQTI] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[BSDATE](
	[U_ID] [nvarchar](50) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[D_DAY] [date] NULL,
	[REMARK] [nvarchar](200) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY]

CREATE TABLE [dbo].[BSDIST](
	[U_ID] [nvarchar](50) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CNTRY_CD] [nvarchar](2) NULL,
	[CNTRY_NM] [nvarchar](30) NULL,
	[STATE_CD] [nvarchar](50) NULL,
	[STATE_NM] [nvarchar](20) NULL,
	[CITY_CD] [nvarchar](10) NULL,
	[CITY_NM] [nvarchar](70) NULL,
	[DIST_CD] [nvarchar](50) NULL,
	[DIST_NM] [nvarchar](100) NULL,
	[ZIP_F] [nvarchar](6) NULL,
	[ZIP_E] [nvarchar](6) NULL,
	[REMARK] [nvarchar](200) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[PICK_FEE] [numeric](18, 2) NULL,
	[LTYPE] [nvarchar](1) NULL
) ON [PRIMARY]

CREATE TABLE [dbo].[BSLIGHTD](
	[U_ID] [nvarchar](50) NOT NULL,
	[U_FID] [nvarchar](50) NOT NULL,
	[CUST_CD] [nvarchar](30) NOT NULL,
	[IO] [nvarchar](1) NULL,
	[TRAN_TYPE] [nvarchar](1) NULL,
	[L1] [nvarchar](20) NULL,
	[L2] [nvarchar](20) NULL,
	[L3] [nvarchar](20) NULL,
	[L4] [nvarchar](20) NULL,
	[L5] [nvarchar](20) NULL,
	[L6] [nvarchar](20) NULL,
	[L7] [nvarchar](20) NULL,
	[L8] [nvarchar](20) NULL,
	[L9] [nvarchar](20) NULL,
	[L10] [nvarchar](20) NULL,
 CONSTRAINT [PK_BSLIGHTD_1] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC,
	[U_FID] ASC,
	[CUST_CD] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[BSLIGHTM](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CUST_CD] [nvarchar](30) NULL,
	[CUST_NM] [nvarchar](70) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
 CONSTRAINT [PK_BSLIGHTM] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[ECREFFEE](
	[U_ID] [nvarchar](50) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CHG_CD] [nvarchar](10) NULL,
	[CHG_DESCP] [nvarchar](50) NULL,
	[CREATE_BY] [nvarchar](50) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](50) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[CHG_ID] [nvarchar](20) NULL,
	[REMARK] [nvarchar](100) NULL,
	[SEQ_NO] [int] NULL,
	[GW] [numeric](10, 3) NULL,
	[CBM] [numeric](10, 3) NULL,
	[FEE_FROM] [numeric](10, 3) NULL,
	[FEE_TO] [numeric](10, 3) NULL,
	[VENDER_CD] [nvarchar](30) NULL,
	[VENDER_NM] [nvarchar](70) NULL,
	[FEE_TYPE] [nvarchar](1) NULL,
	[FEE_WEIGHT] [numeric](10, 3) NULL,
	[FEE_OP] [nvarchar](1) NULL,
	[CAL_TYPE] [nvarchar](1) NULL,
	[PUNIT] [nvarchar](10) NULL
) ON [PRIMARY]

CREATE TABLE [dbo].[SMSMI](
	[U_ID] [nvarchar](50) NOT NULL,
	[LIGHT] [nvarchar](1000) NULL,
	[MONTH] [nvarchar](10) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[TRAN_TYPE] [nvarchar](1) NULL,
	[STATUS] [nvarchar](1) NULL,
	[DN_ETD] [date] NULL,
	[COMBINE_INFO] [nvarchar](3000) NULL,
	[MARKS] [nvarchar](3000) NULL,
	[GOODS] [nvarchar](2000) NULL,
	[LGOODS] [nvarchar](2000) NULL,
	[BL_RMK] [nvarchar](3000) NULL,
	[INSTRUCTION] [nvarchar](2000) NULL,
	[BOOKING_INFO] [nvarchar](300) NULL,
	[ABNORMAL_RMK] [nvarchar](1000) NULL,
	[LSP_ABNORMAL_RMK] [nvarchar](1000) NULL,
	[PRODUCTION_DATE] [date] NULL,
	[PRIORITY] [int] NULL,
	[PORT_FREE_TIME] [int] NULL,
	[FACT_FREE_TIME] [int] NULL,
	[FREIGHT_CUR] [nvarchar](3) NULL,
	[FREIGHT_AMT] [decimal](10, 2) NULL,
	[CUR] [nvarchar](3) NULL,
	[GVALUE] [decimal](10, 2) NULL,
	[CNT20] [decimal](10, 0) NULL,
	[CNT40] [decimal](10, 0) NULL,
	[CNT40HQ] [decimal](10, 0) NULL,
	[CNT_TYPE] [nvarchar](5) NULL,
	[CNT_NUMBER] [decimal](10, 0) NULL,
	[INSURANCE_AMT] [decimal](10, 2) NULL,
	[PKG_NUM] [decimal](10, 0) NULL,
	[PKG_UNIT] [nvarchar](20) NULL,
	[PKG_UNIT_DESC] [nvarchar](100) NULL,
	[GW] [decimal](10, 3) NULL,
	[GWU] [nvarchar](3) NULL,
	[CBM] [decimal](10, 4) NULL,
	[WEEKLY] [decimal](10, 0) NULL,
	[YEAR] [decimal](10, 0) NULL,
	[TRADE_TERM] [nvarchar](3) NULL,
	[TRADETERM_DESCP] [nvarchar](30) NULL,
	[INCOTERM_CD] [nvarchar](3) NULL,
	[INCOTERM_DESCP] [nvarchar](30) NULL,
	[LOADING_FROM] [nvarchar](5) NULL,
	[LOADING_TO] [nvarchar](5) NULL,
	[PICKUP_CDATE] [date] NULL,
	[CARRIER] [nvarchar](20) NULL,
	[CARRIER_NM] [nvarchar](70) NULL,
	[SCAC_CD] [nvarchar](20) NULL,
	[FRT_TERM] [nvarchar](2) NULL,
	[CON_FREE_TIME] [int] NULL,
	[MASTER_NO] [nvarchar](20) NULL,
	[HOUSE_NO] [nvarchar](20) NULL,
	[SVC_CONTACT] [nvarchar](20) NULL,
	[WH_TIME] [datetime] NULL,
	[POR_CD] [nvarchar](5) NULL,
	[POR_CNTY] [nvarchar](2) NULL,
	[POR_NAME] [nvarchar](30) NULL,
	[IB_WINDOW] [nvarchar](200) NULL,
	[FACT_TIME] [datetime] NULL,
	[POL_CD] [nvarchar](5) NULL,
	[POL_CNTY] [nvarchar](2) NULL,
	[POL_NAME] [nvarchar](30) NULL,
	[PORT_ETA] [date] NULL,
	[EMPTY_TIME] [datetime] NULL,
	[POD_CD] [nvarchar](5) NULL,
	[POD_CNTY] [nvarchar](2) NULL,
	[POD_NAME] [nvarchar](30) NULL,
	[PORT_ATA] [datetime] NULL,
	[BACK_LOCATION] [nvarchar](50) NULL,
	[DEST_CD] [nvarchar](5) NULL,
	[DEST_CNTY] [nvarchar](2) NULL,
	[DEST_NAME] [nvarchar](30) NULL,
	[PORT_RLS_DATE] [datetime] NULL,
	[WM_CUT_DATE] [datetime] NULL,
	[VESSEL1] [nvarchar](30) NULL,
	[VOYAGE1] [nvarchar](12) NULL,
	[ETD1] [date] NULL,
	[ETA1] [date] NULL,
	[VESSEL2] [nvarchar](30) NULL,
	[VOYAGE2] [nvarchar](12) NULL,
	[ETD2] [date] NULL,
	[ETA2] [date] NULL,
	[VESSEL3] [nvarchar](30) NULL,
	[VOYAGE3] [nvarchar](12) NULL,
	[ETD3] [date] NULL,
	[ETA3] [date] NULL,
	[VESSEL4] [nvarchar](30) NULL,
	[VOYAGE4] [nvarchar](12) NULL,
	[ETD4] [date] NULL,
	[ETA4] [date] NULL,
	[ETD] [date] NULL,
	[ETA] [date] NULL,
	[ATP] [date] NULL,
	[ATD] [date] NULL,
	[ATA] [date] NULL,
	[OEXPORTER] [nvarchar](10) NULL,
	[OEXPORTER_NM] [nvarchar](70) NULL,
	[OEXPORTER_ADDR] [nvarchar](140) NULL,
	[OIMPORTER] [nvarchar](10) NULL,
	[OIMPORTER_NM] [nvarchar](70) NULL,
	[OIMPORTER_ADDR] [nvarchar](140) NULL,
	[IMPORT_NO] [nvarchar](50) NULL,
	[DEC_NO] [nvarchar](50) NULL,
	[CER_NO] [nvarchar](50) NULL,
	[DEC_DATE] [date] NULL,
	[REL_DATE] [date] NULL,
	[INSPECTION] [nvarchar](50) NULL,
	[DEC_CUST] [text] NULL,
	[DEC_REPLY] [text] NULL,
	[TC_IMPORTER] [nvarchar](10) NULL,
	[TC_IMPORTER_NM] [nvarchar](70) NULL,
	[TC_IMPORTER_ADDR] [nvarchar](140) NULL,
	[TC_IMPORT_NO] [nvarchar](50) NULL,
	[TC_DEC_NO] [nvarchar](50) NULL,
	[TC_CER_NO] [nvarchar](50) NULL,
	[TC_DEC_DATE] [date] NULL,
	[TC_REL_DATE] [date] NULL,
	[TC_INSPECTION] [nvarchar](50) NULL,
	[TC_DEC_CUST] [text] NULL,
	[TC_DEC_REPLY] [text] NULL,
	[CREATE_DATE] [datetime] NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[AIRLINE_CD] [nvarchar](10) NULL,
	[AIRLINE_NM] [nvarchar](70) NULL,
	[QTY] [int] NULL,
	[QTYU] [nvarchar](10) NULL,
	[VW] [decimal](10, 3) NULL,
	[OF_COST] [decimal](10, 2) NULL,
	[TRUCK_COST] [decimal](10, 2) NULL,
	[CW] [decimal](10, 3) NULL,
	[HORN] [nvarchar](1) NULL,
	[BATTERY] [nvarchar](1) NULL,
	[TRUCK_CD] [nvarchar](20) NULL,
	[O_LOCATION] [nvarchar](10) NULL,
	[CSTATUS] [nvarchar](1) NULL,
	[BSTATUS] [nvarchar](1) NULL,
	[DN_NO] [nvarchar](100) NULL,
	[LOT_NO] [nvarchar](20) NULL,
	[BL_WIN] [nvarchar](40) NULL,
	[TERMINAL_CD] [nvarchar](30) NULL,
	[TERMINAL_NM] [nvarchar](70) NULL,
	[HS_CODE] [nvarchar](20) NULL,
	[HS_CODE_NO] [nvarchar](20) NULL,
	[TC_HS_CODE] [nvarchar](20) NULL,
	[TC_HS_CODE_NO] [nvarchar](20) NULL,
	[PRODUCT_TYPE] [nvarchar](20) NULL,
	[CONTAINER_YARD_CD] [nvarchar](20) NULL,
	[CONTAINER_YARD_NM] [nvarchar](300) NULL,
	[EXTRA_SRV] [nvarchar](50) NULL,
	[EXTRA_MEMO] [nvarchar](50) NULL,
	[FORK] [decimal](5, 0) NULL,
 CONSTRAINT [PK_SMSMI] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

CREATE TABLE [dbo].[SMSMIPT](
	[U_ID] [nvarchar](50) NOT NULL,
	[U_FID] [nvarchar](50) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[PARTY_TYPE] [nvarchar](10) NULL,
	[TYPE_DESCP] [nvarchar](30) NULL,
	[ORDER_BY] [nvarchar](3) NULL,
	[PARTY_NO] [nvarchar](10) NULL,
	[PARTY_NAME] [nvarchar](70) NULL,
	[PARTY_NAME2] [nvarchar](70) NULL,
	[PARTY_NAME3] [nvarchar](70) NULL,
	[PARTY_NAME4] [nvarchar](70) NULL,
	[PARTY_ADDR1] [nvarchar](60) NULL,
	[PARTY_ADDR2] [nvarchar](40) NULL,
	[PARTY_ADDR3] [nvarchar](40) NULL,
	[PARTY_ADDR4] [nvarchar](40) NULL,
	[PARTY_ADDR5] [nvarchar](40) NULL,
	[CNTY] [nvarchar](2) NULL,
	[CNTY_NM] [nvarchar](30) NULL,
	[CITY] [nvarchar](3) NULL,
	[CITY_NM] [nvarchar](30) NULL,
	[STATE] [nvarchar](2) NULL,
	[ZIP] [nvarchar](10) NULL,
	[PARTY_ATTN] [nvarchar](80) NULL,
	[PARTY_TEL] [nvarchar](50) NULL,
	[PARTY_MAIL] [nvarchar](100) NULL,
	[DEBIT_TO] [nvarchar](10) NULL,
	[FAX_NO] [nvarchar](30) NULL,
	[TAX_NO] [nvarchar](20) NULL,
 CONSTRAINT [PK_SMSMIPT] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[SMWHT](
	[U_ID] [nvarchar](50) NOT NULL,
	[U_FID] [nvarchar](50) NULL,
	[CMP] [nvarchar](10) NULL,
	[WS_CD] [nvarchar](10) NULL,
	[SEQ_NO] [int] NULL,
	[T_FROM] [int] NULL,
	[T_TO] [int] NULL,
	[REMARK] [nvarchar](200) NULL,
 CONSTRAINT [PK_SMWHT] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[SMIDN](
	[U_ID] [nvarchar](50) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[DN_NO] [nvarchar](20) NULL,
	[INV_NO] [nvarchar](20) NULL,
	[NW] [numeric](10, 3) NULL,
	[GW] [numeric](10, 3) NULL,
	[GWU] [nvarchar](3) NULL,
	[CBM] [numeric](10, 3) NULL,
	[CBMU] [nvarchar](3) NULL,
	[QTY] [numeric](10, 3) NULL,
	[QTYU] [nvarchar](3) NULL,
	[PKG_NUM] [numeric](10, 0) NULL,
	[PKG_UNIT] [nvarchar](3) NULL,
	[PKG_UNIT_DESC] [nvarchar](100) NULL,
	[CNT20] [numeric](3, 0) NULL,
	[CNT40] [numeric](3, 0) NULL,
	[CNT40HQ] [numeric](3, 0) NULL,
	[OTH_CNT_TYPE] [nvarchar](20) NULL,
	[OTH_CNT_NUM] [numeric](3, 0) NULL,
	[IMPORT_NO] [nvarchar](50) NULL,
	[DEC_NO] [nvarchar](50) NULL,
	[CER_NO] [nvarchar](50) NULL,
	[DEC_DATE] [datetime] NULL,
	[REL_DATE] [datetime] NULL,
	[INSPECTION] [nvarchar](1) NULL,
	[DEC_CUST] [text] NULL,
	[DEC_REPLY] [text] NULL,
	[TC_IMPORT_NO] [nvarchar](50) NULL,
	[TC_DEC_NO] [nvarchar](50) NULL,
	[TC_CER_NO] [nvarchar](50) NULL,
	[TC_DEC_DATE] [datetime] NULL,
	[TC_REL_DATE] [datetime] NULL,
	[TC_INSPECTION] [nvarchar](50) NULL,
	[TC_DEC_CUST] [text] NULL,
	[TC_DEC_REPLY] [text] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

CREATE TABLE [dbo].[SMIDNP](
	[U_ID] [nvarchar](50) NULL,
	[U_FID] [nvarchar](50) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[DN_NO] [nvarchar](20) NULL,
	[INV_NO] [nvarchar](20) NULL,
	[OPART_NO] [nvarchar](18) NULL,
	[IPART_NO] [nvarchar](18) NULL,
	[GOODS_DESCP] [nvarchar](40) NULL,
	[PROD_DESCP] [nvarchar](50) NULL,
	[QTY] [numeric](10, 3) NULL,
	[GW] [numeric](10, 3) NULL,
	[CBM] [numeric](10, 3) NULL,
	[CNTR_TYPE] [nvarchar](20) NULL,
	[CNTR_NO] [nvarchar](20) NULL,
	[SEAL_NO1] [nvarchar](20) NULL,
	[SEAL_NO2] [nvarchar](20) NULL
) ON [PRIMARY]

ALTER TABLE SMSM ADD IS_OK NVARCHAR(1)
ALTER TABLE SMQTD ADD HOLIDAY NVARCHAR(1)
ALTER TABLE SMQTD ADD PRODUCT_TYPE NVARCHAR(20)

INSERT INTO ECREFFEE (U_ID,GROUP_ID,CMP,STN,DEP,CHG_CD,CHG_DESCP,FEE_TYPE,SEQ_NO) VALUES 
(NEWID(),'TPV','PL','*','*','F1','按计费重报价（公斤）','O',1),
(NEWID(),'TPV','PL','*','*','F2','按吨报价','O',2),
(NEWID(),'TPV','PL','*','*','F3','按立方米报价','O',3),
(NEWID(),'TPV','PL','*','*','F4','20呎','O',4),
(NEWID(),'TPV','PL','*','*','F5','40GP','O',5),
(NEWID(),'TPV','PL','*','*','F6','40HQ','O',6)

ALTER TABLE SMWHGT ADD SEQ_NO INT
ALTER TABLE TKBLCNTR ADD IS_ORDER NVARCHAR(1)
ALTER TABLE SMRV ADD DLV_ADDR NVARCHAR(350)
ALTER TABLE SMRV ADD ADDR_CODE NVARCHAR(10)
ALTER TABLE SMRV ADD OUTER_FLAG NVARCHAR(1)
ALTER TABLE SMQTI ADD TERMINAL_CD NVARCHAR(20)
ALTER TABLE SMSMI ADD IS_EXPORT NVARCHAR(1)
ALTER TABLE SMSMI ADD O_UID NVARCHAR(50)
ALTER TABLE TKBL ADD O_UID NVARCHAR(50)
ALTER TABLE TKBL ADD O_LOCATION NVARCHAR(10)
ALTER TABLE TKBL ADD POD_MDATE DATETIME
ALTER TABLE SMSMI ADD POD_MDATE DATETIME

ALTER TABLE smwhgt_log
ALTER COLUMN GT_CNTR_NO NVARCHAR(20)
ALTER TABLE smwhgt_log
ALTER COLUMN RV_CNTR_NO NVARCHAR(20)
ALTER TABLE SMRV
ALTER COLUMN CNTR_NO NVARCHAR(20)
/********************************************進口SQL END*******************************************************/

 --UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"BlWin","width":100,"hidden":false}]') 
--WHERE ID='报关通知' AND LAYOUT_TYPE='GRID';

ALTER TABLE SMSM ADD IS_OK NVARCHAR(1);





// HARRY 2017/04/14
CREATE TABLE BSADDR
(
GROUP_ID nvarchar(10),
CMP nvarchar(10),
STN nvarchar(10),
DEP nvarchar(10),
CNTRY_CD nvarchar(2),
PORT_CD nvarchar(6),
SEQ_NO numeric(5,0),
ADDR_CODE nvarchar(10),
ADDR nvarchar(200),
);

ALTER TABLE BSADDR ADD CREATE_BY nvarchar(30)
ALTER TABLE BSADDR ADD CREATE_DATE datetime
ALTER TABLE BSADDR ADD MODIFY_BY nvarchar(30)
ALTER TABLE BSADDR ADD MODIFY_DATE datetime
ALTER TABLE BSADDR ADD OUTER_FLAG nvarchar(1)
// END BY HARRY 2017/04/14

----- dean 2017/04/17
update BSCAA SET CARRIER=(select top 1 CARRIER from BSCAAM where BSCAAM.U_ID=BSCAA.U_FID),
  AREA=(select top 1 AREA from BSCAAM where BSCAAM.U_ID=BSCAA.U_FID)
  ----- dean 2017/04/17


  /**************** add  by fish   2017/4/17 17：17 ***********************/
 CREATE TABLE [dbo].[AUTO_BOUNDCOST_TASK](
	[U_ID] [nvarchar](36) NULL,
	[SMU_ID] [nvarchar](36) NULL,
	[DONE] [nvarchar](3) NULL,
	BOUND_TYPE [nvarchar](1) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[DONE_DATE] [datetime] NULL,
	[DONE_COUNT] int NULL,
	[FAIL_MSG] [nvarchar](100) NULL,
	EXCEPTION_MSG [nvarchar](100) NULL
) ON [PRIMARY] 

CREATE trigger [dbo].[TG_AUTO_BOUNDCOST_TASK]
on [dbo].[SMSMI]  
    for insert,update  
as     
    if (UPDATE(ATA))  
    begin  
	    DELETE FROM [AUTO_BOUNDCOST_TASK] WHERE [SMU_ID] IN (select U_ID from inserted)
    end
	if (UPDATE(ATA))  
    begin  
	    INSERT INTO [AUTO_BOUNDCOST_TASK]([U_ID],[SMU_ID],BOUND_TYPE,[CREATE_BY],[CREATE_DATE],[DONE_DATE],DONE_COUNT)
		 select NEWID(),U_ID,'I',ISNULL(MODIFY_BY,CREATE_BY),GETDATE(),ATA,0 from inserted WHERE ATA IS NOT NULL
    end

/**************** end  by fish  2017/4/17 17：17 ***********************/

ALTER TABLE SMSM ADD ATD1 DATE;
ALTER TABLE SMSM ADD ATD2 DATE;
ALTER TABLE SMSM ADD ATD3 DATE;
ALTER TABLE SMSM ADD ATD4 DATE;
ALTER TABLE SMSM ADD ATA1 DATE;
ALTER TABLE SMSM ADD ATA2 DATE;
ALTER TABLE SMSM ADD ATA3 DATE;
ALTER TABLE SMSM ADD ATA4 DATE;
ALTER TABLE SMSM ADD IS_EXPORT NVARCHAR(1);
ALTER TABLE SMDN ADD CATON_NUM int;
ALTER TABLE SMDN ADD PALLET_NUM int;
ALTER TABLE SMDN ADD CATON_SUM int;



/**************** ADD  BY HARRY  2017/4/20  18：17 ***********************/

CREATE TABLE SMIDN
(
U_ID nvarchar(50),
GROUP_ID nvarchar(10),
CMP nvarchar(10),
STN nvarchar(10),
DEP nvarchar(10),
SHIPMENT_ID nvarchar(20),
DN_NO nvarchar(20),
INV_NO nvarchar(20),
NW numeric(10,3),
GW numeric(10,3),
GWU nvarchar(3),
CBM numeric(10,3),
CBMU nvarchar(3),
QTY numeric(10,3),
QTYU nvarchar(3),
PKG_NUM numeric(10,0),
PKG_UNIT  nvarchar(3),
PKG_UNIT_DESC  nvarchar(100),
CNT_20 numeric(3,0),
CNT_40 numeric(3,0),
CNT_40HQ numeric(3,0),
OTH_CNT_TYPE nvarchar(20),
OTH_CNT_NUM numeric(3,0),
IMPORT_NO nvarchar(50),
DEC_NO  nvarchar(50),
CER_NO  nvarchar(50),
DEC_DATE datetime,
REL_DATE datetime,
INSPECTION nvarchar(1),
DEC_CUST text,
DEC_REPLY text,
TC_IMPORTER  nvarchar(10),
TC_IMPORTER_NM  nvarchar(70),
TC_IMPORTER_ADDR  nvarchar(140),
TC_IMPORT_NO  nvarchar(50),
TC_DEC_NO  nvarchar(50),
TC_CER_NO  nvarchar(50),
TC_DEC_DATE datetime,
TC_REL_DATE datetime,
TC_INSPECTION  nvarchar(50),
TC_DEC_CUST text,
TC_DEC_REPLY text
);

CREATE TABLE SMIDNP
(
U_ID nvarchar(50),
U_FID nvarchar(50),
SHIPMENT_ID nvarchar(20),
DN_NO nvarchar(20),
INV_NO nvarchar(20),
OPART_NO nvarchar(18),
IPART_NO nvarchar(18),
GOODS_DESCP nvarchar(40),
PROD_DESCP nvarchar(50),
QTY numeric(10,3),
GW numeric(10,3),
CBM numeric(10,3),
CNTR_TYPE nvarchar(20),
CNTR_NO nvarchar(20),
SEAL_NO1 nvarchar(20),
SEAL_NO2 nvarchar(20),
);

/**************** END  BY HARRY  2017/4/20  18：17 ***********************/

/**************** ADD  BY HARRY  2017/4/26  14：17 ***********************/
ALTER TABLE SMSMI ADD POL1 nvarchar(5)
ALTER TABLE SMSMI ADD POL_NM1 nvarchar(70)
ALTER TABLE SMSMI ADD TRAN_TYPE1 nvarchar(1)
ALTER TABLE SMSMI ADD TRUCKER1 nvarchar(20)
ALTER TABLE SMSMI ADD TRUCKER_NM1 nvarchar(70)

ALTER TABLE SMSMI ADD POL2 nvarchar(5)
ALTER TABLE SMSMI ADD POL_NM2 nvarchar(70)
ALTER TABLE SMSMI ADD TRAN_TYPE2 nvarchar(1)
ALTER TABLE SMSMI ADD TRUCKER2 nvarchar(20)
ALTER TABLE SMSMI ADD TRUCKER_NM2 nvarchar(70)

ALTER TABLE SMSMI ADD POL3 nvarchar(5)
ALTER TABLE SMSMI ADD POL_NM3 nvarchar(70)
ALTER TABLE SMSMI ADD TRAN_TYPE3 nvarchar(1)
ALTER TABLE SMSMI ADD TRUCKER3 nvarchar(20)
ALTER TABLE SMSMI ADD TRUCKER_NM3 nvarchar(70)
/**************** END  BY HARRY  2017/4/26  14：17 ***********************/

/**************** ADD  BY HARRY  2017/4/27  11：50 ***********************/
ALTER TABLE SMSMI ADD T_ATD1 datetime
ALTER TABLE SMSMI ADD T_ETD1 datetime
ALTER TABLE SMSMI ADD T_ETA1 datetime
ALTER TABLE SMSMI ADD T_ATA1 datetime

ALTER TABLE SMSMI ADD T_ATD2 datetime
ALTER TABLE SMSMI ADD T_ETD2 datetime
ALTER TABLE SMSMI ADD T_ETA2 datetime
ALTER TABLE SMSMI ADD T_ATA2 datetime

ALTER TABLE SMSMI ADD T_ATD3 datetime
ALTER TABLE SMSMI ADD T_ETD3 datetime
ALTER TABLE SMSMI ADD T_ETA3 datetime
ALTER TABLE SMSMI ADD T_ATA3 datetime
/**************** END  BY HARRY  2017/4/27  11：50 ***********************/

/**************** END  BY HARRY  2017/4/27  11：50 ***********************/

update BSCAA SET CARRIER=(select top 1 CARRIER from BSCAAM where BSCAAM.U_ID=BSCAA.U_FID),
  AREA=(select top 1 AREA from BSCAAM where BSCAAM.U_ID=BSCAA.U_FID)
/**************** begin  BY dean  2017/5/2  11：50 ***********************/
alter TABLE [dbo].[BSTRUCKC]  ADD  SP_PLANT NVARCHAR(10)

alter TABLE [dbo].[BSTRUCKD]  ADD  SP_PLANT_D NVARCHAR(10)


alter table SMINM add BATCH_FLAGP nvarchar(1)
alter table SMINM add BATCH_FLAGI nvarchar(1)
alter table SMINM add BATCH_FLAGC nvarchar(1)

/**************** END  BY dean  2017/5/2  11：50 ***********************//**************** ADD  BY Tim  2017/4/27  11：50 ***********************/
ALTER TABLE SMWH ADD ADDR_CODE NVARCHAR(10)
ALTER TABLE SMWH ADD DLV_ADDR NVARCHAR(350)
/**************** ADD  BY Tim  2017/4/27  11：50 ***********************/
/**************** END  BY dean  2017/5/2  11：50 ***********************/

/**************** begin  BY dean  2017/5/3  11：50 ***********************/
alter Table SMDN ADD SEAL_SATAUE nvarchar(1)
alter Table SMDN ADD SEAL_USER nvarchar(20)
alter Table SMDN ADD SEAL_DATE datetime
ALTER TABLE SMIPM  ADD SHIPMENT_ID NVARCHAR(20)

UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"RvTruckSealno","width":100,"hidden":false},{"name":"RvTruckCntrno","width":100,"hidden":false}]') 
WHERE ID='报关确认' AND LAYOUT_TYPE='GRID'

/**************** END  BY dean  2017/5/3  11：50 ***********************/

/****************Begin by Will 2017/05/03 17:06 ***********/
ALTER TABLE TKBL ADD ATD DATE;
ALTER TABLE TKBL ADD ATA DATE;
--UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"Atd","width":100,"hidden":false},{"name":"Ata","width":100,"hidden":false}]') 
--WHERE ID='货况汇总' AND LAYOUT_TYPE='GRID';
/****************end by Will 2017/05/03 17:06 ***********/

/****************Begin by Will 2017/05/09 14:10 ***********/
INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','ASR','QAH','QA Hold货','FQ','*','MANA10','2017-05-08 17:38:07',null,null,null,null,null,null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','ASR','QAH','QA Hold货','XM','*','MANA10','2017-05-08 17:38:07',null,null,null,null,null,null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','ASR','QAH','QA Hold货','BJ','*','MANA10','2017-05-08 17:38:07',null,null,null,null,null,null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','ASR','QAH','QA Hold货','QD','*','MANA10','2017-05-08 17:38:07',null,null,null,null,null,null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','ASR','QAH','QA Hold货','WH','*','MANA10','2017-05-08 17:38:07',null,null,null,null,null,null,null,null,null);

INSERT INTO [dbo].[BSCODE]([GROUP_ID],[CD_TYPE],[CD],[CD_DESCP],[CMP]
           ,[STN],[CREATE_BY],[CREATE_DATE],[MODIFY_BY],[AMS_CODE],[INTTRA],[AR_CD],[AP_CD],[DEP],[APPLY],[LOCATION],[ORDER_BY])
values('TPV','ASR','QAH','QA Hold货','BH','*','MANA10','2017-05-08 17:38:07',null,null,null,null,null,null,null,null,null);

/****************END by Will 2017/05/09 14:10 ***********/

/****************Begin by HARRY 2017/05/16 12:10 ***********/
ALTER TABLE SMSMI ADD HTS_CODE nvarchar(50)

ALTER TABLE SMSMI ADD COUNTRY nvarchar(5)
ALTER TABLE SMSMI ADD DEST_REGION nvarchar(5)
ALTER TABLE SMIDN ADD INV_PRICE decimal(10,2)
ALTER TABLE SMIDN ADD INV_CUR nvarchar(3)
/****************END by HARRY 2017/05/16 12:10 ***********/

/****************begin by dean  2017/05/09 14:10 ***********/
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"RvSealNo1","width":100,"hidden":false},{"name":"RvCntrNo","width":100,"hidden":false}]') 
WHERE ID='报关确认' AND LAYOUT_TYPE='GRID';

alter table SMIPM ADD DEP NVARCHAR(10)


ALTER TABLE SMCTM ADD  VOID_USER NVARCHAR(20)

ALTER TABLE SMCTM ADD VOID_DATE datetime

ALTER TABLE SMCTM ADD VOID_REASON NVARCHAR(200)
/****************END by dean  2017/05/09 14:10 ***********/


/****************begin by fish  2017/05/22 11:00 ***********/
CREATE NONCLUSTERED INDEX INX_TKBLST_SHIPMENT_ID_2017052201 ON [dbo].[TKBLST] ([SHIPMENT_ID])
/****************END by fish  2017/05/22 11:00 ***********/

/****************begin by Will  2017/05/23 12:00 ***********/
CREATE TABLE [dbo].[CHANGE_INFO](
	[U_ID] [nvarchar](40) NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[OLD_INFO] [nvarchar](10) NULL,
	[NEW_INFO] [nvarchar](3) NULL,
	[CHANGE_DATE] [nvarchar](200) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[JOB_ID] [nvarchar](20) NULL,
	[CHANGE_TYPE]  [nvarchar](20) NULL,
 CONSTRAINT [PK_CHANGE_INFO] PRIMARY KEY CLUSTERED 
(
	[U_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
/****************END by Will  2017/05/23 12:00 ***********/


/****************begin by Tim  2017/05/23 12:00 ***********/
ALTER TABLE SMRV ADD ARRIVAL_DATE DATETIME
ALTER TABLE SMRV ADD TRAIN_FLIGHT NVARCHAR(100)
ALTER TABLE SMRV ADD ORD_NO NVARCHAR(20)
ALTER TABLE SMRV ADD CALL_TYPE NVARCHAR(1)
ALTER TABLE SMRV ADD ORD_INFO NVARCHAR(500)


ALTER TABLE SYS_ACCT_ROLE
ALTER COLUMN FACCT_ID NVARCHAR(40)

ALTER TABLE SMSMI
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMSMI
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMRQM
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMRQM
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMQTM
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMQTM
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMRVD
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMCHG
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMCHG
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE BSLIGHTM
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE BSLIGHTM
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMRV
ALTER COLUMN CREATE_BY NVARCHAR(40)

ALTER TABLE ECREFFEE
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE ECREFFEE
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMAL
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMAL
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE BSCODE
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE BSCODE
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE BSADDR
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE BSADDR
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMPTY
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMPTY
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMBIM
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMBIM
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMORD
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMORD
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMWH
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMWH
ALTER COLUMN MODIFY_BY NVARCHAR(40)

ALTER TABLE SMWH
ALTER COLUMN CREATE_BY NVARCHAR(40)
ALTER TABLE SMWH
ALTER COLUMN MODIFY_BY NVARCHAR(40)
/****************begin by Tim  2017/05/23 12:00 ***********/

/****************begin by dean  2017/05/27 12:00 ***********/ / 废弃
insert BSCODE_KIND (GROUP_ID,CD_TYPE,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY, DEP,MODIFY_DATE)
VALUES('TPV','DNRC','订舱撤回原因','XM','*','MANA10',GETDATE(),null,null,null) 




insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNA','品质异常','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 



insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNS','SCM修改','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNM','制造原因','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNC','客户/Sales变更','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNL','LST 改港','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNP','FA价格趋势','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNR','RD包装方式','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 

insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNF','AQM品质补料','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DND','PM Sample信息','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNK','其他部门变更','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNB','货代甩柜','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNT','临时缺料','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','DNRC','DNO','其他','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNR','订舱撤回','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 
/****************end by dean  2017/05/27 12:00 ***********/ / 废弃
/****************start by king  2017/06/01 12:00 ***********/


ALTER VIEW V_SMDN AS
SELECT          dbo.SMSM.STATUS AS SM_STATUS, dbo.SMSM.RLS_CNTR_DATE, dbo.SMDN.U_ID, dbo.SMDN.ETD, 
                            dbo.SMDN.SAP_ID, dbo.SMDN.WEEKLY, dbo.SMDN.MONTH, dbo.SMDN.YEAR, dbo.SMDN.GROUP_ID, 
                            dbo.SMDN.CMP, dbo.SMDN.STN, dbo.SMDN.DEP, dbo.SMDN.BU, dbo.SMDN.DN_NO, dbo.SMDN.ORIGIN_NO, 
                            dbo.SMDN.SAP_NO, dbo.SMDN.REF_NO, dbo.SMDN.TRAN_MODE, dbo.SMDN.TRAN_DESCP, 
                            dbo.SMDN.APPROVE_TO, dbo.SMDN.APPROVE_BACK, dbo.SMDN.COMBINE_INFO, dbo.SMDN.COMBINE_BY, 
                            dbo.SMDN.COMBINE_DATE, dbo.SMDN.SHIPMENT_ID, dbo.SMDN.DN_TYPE, dbo.SMDN.CARGO_TYPE, 
                            dbo.SMDN.CUR, dbo.SMDN.AMOUNT1, dbo.SMDN.INCOTERM, dbo.SMDN.INCOTERM_DESCP, 
                            dbo.SMDN.PAY_TERM_CD, dbo.SMDN.PAY_DESCP, dbo.SMDN.CHANNEL_CD, dbo.SMDN.CHANNEL, 
                            dbo.SMDN.DIVISION_CD, dbo.SMDN.DIVISION_DESCP, dbo.SMDN.SC_CODE, dbo.SMDN.SC_DESCP, 
                            dbo.SMDN.INV_NO, dbo.SMDN.PACKING_NO, dbo.SMDN.VAT_NO, dbo.SMDN.EXPORT_NO, dbo.SMDN.EDECL_NO, 
                            dbo.SMDN.APPROVE_NO, dbo.SMDN.POL, dbo.SMDN.POL_NM, dbo.SMDN.POD, dbo.SMDN.POD_NM, 
                            dbo.SMDN.STATE, dbo.SMDN.REGION, dbo.SMDN.REGION_NM, dbo.SMDN.SHIP_TO, dbo.SMDN.SHIP_NM, 
                            dbo.SMDN.CNEE3_CD, dbo.SMDN.CNEE3_NM, dbo.SMDN.FI_CUST_CD, dbo.SMDN.FI_CUST_NM, 
                            dbo.SMDN.SALES_CUST_CD, dbo.SMDN.SALES_CUST_NM, dbo.SMDN.EX_CD, dbo.SMDN.EX_NAME, 
                            dbo.SMDN.REVEIVE_DATE, dbo.SMDN.CNTR_QTY, dbo.SMDN.FEU, dbo.SMDN.SERVICE_MODE, 
                            dbo.SMDN.SERVICE_LOADING, dbo.SMDN.QTY, dbo.SMDN.QTYU, dbo.SMDN.GW, dbo.SMDN.GWU, dbo.SMDN.NW, 
                            dbo.SMDN.CBM, dbo.SMDN.FREIGHT_TERM, dbo.SMDN.COST, dbo.SMDN.CREATE_BY, dbo.SMDN.CREATE_DEP, 
                            dbo.SMDN.CREATE_EXT, dbo.SMDN.CREATE_DATE, dbo.SMDN.MODIFY_BY, dbo.SMDN.MODIFY_DATE, 
                            dbo.SMDN.SPEC_PROCID, dbo.SMDN.SPEC_DESCP, dbo.SMDN.SHIP_MARK, dbo.SMDN.ACT_SHIP_DATE, 
                            dbo.SMDN.ACT_POST_DATE, dbo.SMDN.DN_NO_REF, dbo.SMDN.DN_NO_CMP, dbo.SMDN.DN_NO_CMP_REF, 
                            dbo.SMDN.PORT_DEST, dbo.SMDN.PLANT, dbo.SMDN.BAND_TYPE, dbo.SMDN.TRACK_WAY, 
                            dbo.SMDN.CENT_DECL, dbo.SMDN.DEEP_PROCESS, dbo.SMDN.PLANT_NM, dbo.SMDN.SEAL_QTY, 
                            dbo.SMDN.BOOKING_AGENT, dbo.SMDN.BOOKING_NM, dbo.SMDN.PORTE_CD, dbo.SMDN.PORTE_DESCP, 
                            dbo.SMDN.ORDER_REASON, dbo.SMDN.UNICODE, dbo.SMDN.ASD_NO, dbo.SMDN.PORT_DESCP, 
                            dbo.SMDN.APPROVE_TYPE, dbo.SMDN.CNTR_NO, dbo.SMDN.TRAN_TYPE, dbo.SMDN.TRAN_TYPE_DESCP, 
                            dbo.SMDN.CNT20, dbo.SMDN.CNT40, dbo.SMDN.CNT40HQ, dbo.SMDN.CNT_TYPE, dbo.SMDN.CNT_NUMBER, 
                            dbo.SMDN.PORT_POL, dbo.SMDN.PORT_POLNM, dbo.SMDN.STATUS, dbo.SMDN.POST_FLAG, dbo.SMDN.OBU, 
                            dbo.SMDN.OSOLD_TO, dbo.SMDN.OUT_DATE, dbo.SMDN.ATRAN_TYPE, dbo.SMDN.LOADING_FROM, 
                            dbo.SMDN.LOADING_TO, dbo.SMDN.PROFILE_CD, dbo.SMDN.AG_CD, dbo.SMDN.AG_NM, dbo.SMDN.WE_CD, 
                            dbo.SMDN.WE_NM, dbo.SMDN.ZE_CD, dbo.SMDN.ZE_NM, dbo.SMDN.FC_CD, dbo.SMDN.FC_NM, 
                            dbo.SMDN.RE_CD, dbo.SMDN.RE_NM, dbo.SMDN.RO_CD, dbo.SMDN.RO_NM, dbo.SMDN.GOODS, 
                            dbo.SMDN.AC_REMARK, dbo.SMDN.PAYTERM_CD, dbo.SMDN.PAYTERM_NM, dbo.SMDN.CAR_TYPE, 
                            dbo.SMDN.PKG_NUM, dbo.SMDN.PKG_UNIT, dbo.SMDN.PKG_UNIT_DESC, dbo.SMDN.PRODUCT_DATE, 
                            dbo.SMDN.APPROVE_USER, dbo.SMDN.SH_CD, dbo.SMDN.SH_NM, dbo.SMDN.CS_CD, dbo.SMDN.CS_NM, 
                            dbo.SMDN.NT_CD, dbo.SMDN.NT_NM, dbo.SMDN.TRANSACTE_MODE, dbo.SMDN.MEMO, 
                            dbo.SMDN.COST_CENTER, dbo.SMDN.LGOODS, dbo.SMDN.BAND_DESCP, dbo.SMDN.TRADE_TERM, 
                            dbo.SMDN.TRADETERM_DESCP, dbo.SMDN.BAND_CD, dbo.SMDN.DN_RMARK, dbo.SMDN.SEND_SFIS_FLAG, 
                            dbo.SMDN.OCMP, dbo.SMDN.OT_COST, dbo.SMDN.FREIGHT_AMT, dbo.SMDN.FOB_VALUE, dbo.SMDN.ISSUE_FEE, 
                            dbo.SMDN.TRUCK_COST, dbo.SMDN.LSP_COST, dbo.SMDN.DECL_DATE, dbo.SMDN.DECL_RLS_DATE, 
                            dbo.SMDN.EDOC, dbo.SMDN.BL_LEVEL, dbo.SMDN.ASK_TIM, dbo.SMDN.HORN, dbo.SMDN.TELEX_RLS, 
                            dbo.SMDN.BATTERY, dbo.SMDN.COMBINE_OTHER, dbo.SMDN.VIA, dbo.SMDN.TCBM, dbo.SMDN.BRG_TYPE, 
                            dbo.SMDN.COST_CENTERDESCP, dbo.SMDN.CUSTOMER_INNUMBER,SMSM.ATA,SMSM.ATD
FROM              dbo.SMDN LEFT OUTER JOIN
                            dbo.SMSM ON dbo.SMSM.SHIPMENT_ID = dbo.SMDN.SHIPMENT_ID


ALTER VIEW V_FLOWSMDN AS
SELECT          dbo.SMSM.STATUS AS SM_STATUS, dbo.SMSM.RLS_CNTR_DATE, dbo.SMDN.U_ID, dbo.SMDN.ETD, 
                            dbo.SMDN.SAP_ID, dbo.SMDN.WEEKLY, dbo.SMDN.MONTH, dbo.SMDN.YEAR, dbo.SMDN.GROUP_ID, 
                            dbo.SMDN.CMP, dbo.SMDN.STN, dbo.SMDN.DEP, dbo.SMDN.BU, dbo.SMDN.DN_NO, dbo.SMDN.ORIGIN_NO, 
                            dbo.SMDN.SAP_NO, dbo.SMDN.REF_NO, dbo.SMDN.TRAN_MODE, dbo.SMDN.TRAN_DESCP, 
                            dbo.SMDN.APPROVE_TO, dbo.SMDN.APPROVE_BACK, dbo.SMDN.COMBINE_INFO, dbo.SMDN.COMBINE_BY, 
                            dbo.SMDN.COMBINE_DATE, dbo.SMDN.SHIPMENT_ID, dbo.SMDN.DN_TYPE, dbo.SMDN.CARGO_TYPE, 
                            dbo.SMDN.CUR, dbo.SMDN.AMOUNT1, dbo.SMDN.INCOTERM, dbo.SMDN.INCOTERM_DESCP, 
                            dbo.SMDN.PAY_TERM_CD, dbo.SMDN.PAY_DESCP, dbo.SMDN.CHANNEL_CD, dbo.SMDN.CHANNEL, 
                            dbo.SMDN.DIVISION_CD, dbo.SMDN.DIVISION_DESCP, dbo.SMDN.SC_CODE, dbo.SMDN.SC_DESCP, 
                            dbo.SMDN.INV_NO, dbo.SMDN.PACKING_NO, dbo.SMDN.VAT_NO, dbo.SMDN.EXPORT_NO, dbo.SMDN.EDECL_NO, 
                            dbo.SMDN.APPROVE_NO, dbo.SMDN.POL, dbo.SMDN.POL_NM, dbo.SMDN.POD, dbo.SMDN.POD_NM, 
                            dbo.SMDN.STATE, dbo.SMDN.REGION, dbo.SMDN.REGION_NM, dbo.SMDN.SHIP_TO, dbo.SMDN.SHIP_NM, 
                            dbo.SMDN.CNEE3_CD, dbo.SMDN.CNEE3_NM, dbo.SMDN.FI_CUST_CD, dbo.SMDN.FI_CUST_NM, 
                            dbo.SMDN.SALES_CUST_CD, dbo.SMDN.SALES_CUST_NM, dbo.SMDN.EX_CD, dbo.SMDN.EX_NAME, 
                            dbo.SMDN.REVEIVE_DATE, dbo.SMDN.CNTR_QTY, dbo.SMDN.FEU, dbo.SMDN.SERVICE_MODE, 
                            dbo.SMDN.SERVICE_LOADING, dbo.SMDN.QTY, dbo.SMDN.QTYU, dbo.SMDN.GW, dbo.SMDN.GWU, dbo.SMDN.NW, 
                            dbo.SMDN.CBM, dbo.SMDN.FREIGHT_TERM, dbo.SMDN.COST, dbo.SMDN.CREATE_BY, dbo.SMDN.CREATE_DEP, 
                            dbo.SMDN.CREATE_EXT, dbo.SMDN.CREATE_DATE, dbo.SMDN.MODIFY_BY, dbo.SMDN.MODIFY_DATE, 
                            dbo.SMDN.SPEC_PROCID, dbo.SMDN.SPEC_DESCP, dbo.SMDN.SHIP_MARK, dbo.SMDN.ACT_SHIP_DATE, 
                            dbo.SMDN.ACT_POST_DATE, dbo.SMDN.DN_NO_REF, dbo.SMDN.DN_NO_CMP, dbo.SMDN.DN_NO_CMP_REF, 
                            dbo.SMDN.PORT_DEST, dbo.SMDN.PLANT, dbo.SMDN.BAND_TYPE, dbo.SMDN.TRACK_WAY, 
                            dbo.SMDN.CENT_DECL, dbo.SMDN.DEEP_PROCESS, dbo.SMDN.PLANT_NM, dbo.SMDN.SEAL_QTY, 
                            dbo.SMDN.BOOKING_AGENT, dbo.SMDN.BOOKING_NM, dbo.SMDN.PORTE_CD, dbo.SMDN.PORTE_DESCP, 
                            dbo.SMDN.ORDER_REASON, dbo.SMDN.UNICODE, dbo.SMDN.ASD_NO, dbo.SMDN.PORT_DESCP, 
                            dbo.SMDN.APPROVE_TYPE, dbo.SMDN.CNTR_NO, dbo.SMDN.TRAN_TYPE, dbo.SMDN.TRAN_TYPE_DESCP, 
                            dbo.SMDN.CNT20, dbo.SMDN.CNT40, dbo.SMDN.CNT40HQ, dbo.SMDN.CNT_TYPE, dbo.SMDN.CNT_NUMBER, 
                            dbo.SMDN.PORT_POL, dbo.SMDN.PORT_POLNM, 'X' AS STATUS, dbo.SMDN.POST_FLAG, dbo.SMDN.OBU, 
                            dbo.SMDN.OSOLD_TO, dbo.SMDN.OUT_DATE, dbo.SMDN.ATRAN_TYPE, dbo.SMDN.LOADING_FROM, 
                            dbo.SMDN.LOADING_TO, dbo.SMDN.PROFILE_CD, dbo.SMDN.AG_CD, dbo.SMDN.AG_NM, dbo.SMDN.WE_CD, 
                            dbo.SMDN.WE_NM, dbo.SMDN.ZE_CD, dbo.SMDN.ZE_NM, dbo.SMDN.FC_CD, dbo.SMDN.FC_NM, 
                            dbo.SMDN.RE_CD, dbo.SMDN.RE_NM, dbo.SMDN.RO_CD, dbo.SMDN.RO_NM, dbo.SMDN.GOODS, 
                            dbo.SMDN.AC_REMARK, dbo.SMDN.PAYTERM_CD, dbo.SMDN.PAYTERM_NM, dbo.SMDN.CAR_TYPE, 
                            dbo.SMDN.PKG_NUM, dbo.SMDN.PKG_UNIT, dbo.SMDN.PKG_UNIT_DESC, dbo.SMDN.PRODUCT_DATE, 
                            dbo.SMDN.APPROVE_USER, dbo.SMDN.SH_CD, dbo.SMDN.SH_NM, dbo.SMDN.CS_CD, dbo.SMDN.CS_NM, 
                            dbo.SMDN.NT_CD, dbo.SMDN.NT_NM, dbo.SMDN.TRANSACTE_MODE, dbo.SMDN.MEMO, 
                            dbo.SMDN.COST_CENTER, dbo.SMDN.LGOODS, dbo.SMDN.BAND_DESCP, dbo.SMDN.TRADE_TERM, 
                            dbo.SMDN.TRADETERM_DESCP, dbo.SMDN.BAND_CD, dbo.SMDN.DN_RMARK, dbo.SMDN.SEND_SFIS_FLAG, 
                            dbo.SMDN.OCMP, dbo.SMDN.OT_COST, dbo.SMDN.FREIGHT_AMT, dbo.SMDN.FOB_VALUE, dbo.SMDN.ISSUE_FEE, 
                            dbo.SMDN.TRUCK_COST, dbo.SMDN.LSP_COST, dbo.SMDN.DECL_DATE, dbo.SMDN.DECL_RLS_DATE, 
                            dbo.SMDN.EDOC, dbo.SMDN.BL_LEVEL, dbo.SMDN.ASK_TIM, dbo.SMDN.HORN, dbo.SMDN.TELEX_RLS, 
                            dbo.SMDN.BATTERY, dbo.SMDN.COMBINE_OTHER, dbo.SMDN.VIA, dbo.SMDN.TCBM, dbo.SMDN.BRG_TYPE, 
                            dbo.SMDN.COST_CENTERDESCP, dbo.SMDN.CUSTOMER_INNUMBER,SMSM.ATA,SMSM.ATD
FROM              dbo.SMDN LEFT OUTER JOIN
                            dbo.SMSM ON dbo.SMSM.SHIPMENT_ID = dbo.SMDN.SHIPMENT_ID
WHERE          (dbo.SMDN.STATUS = 'D') AND (dbo.SMDN.DN_NO_CMP_REF IS NOT NULL)


/****************end by king  2017/06/01 12:00 ***********/

/****************start by harry  2017/06/05 17:00 ***********/
ALTER TABLE SMSMI ADD COUNTRY nvarchar(5)
ALTER TABLE SMSMI ADD DEST_REGION nvarchar(5)
ALTER TABLE SMIDN ADD INV_PRICE decimal(10,2)
ALTER TABLE SMIDN ADD INV_CUR nvarchar(3)

ALTER TABLE TKPEM ADD POL_CD nvarchar(5);
ALTER TABLE TKPEM ADD POL_NM nvarchar(70);
ALTER TABLE TKPEM ADD POD_CD nvarchar(5);
ALTER TABLE TKPEM ADD POD_NM nvarchar(70);
ALTER TABLE TKPEM ADD NOTIFY_GROUP nvarchar(20)
ALTER TABLE TKEVM ADD NOTIFY_GROUP nvarchar(20)
ALTER TABLE SMIDN ADD INSERT_NO nvarchar(50)
ALTER TABLE SMBID ALTER COLUMN CHECK_DESCP nvarchar(200)
/****************end by harry  2017/06/05 17:00 ***********/

/****************by Tim  2017/06/07 17:00 ***********/
EXEC sp_RENAME 'SMSMI.POL_1', 'POL1', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POL_NM_1', 'POL_NM1', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POD_1', 'POD1', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POD_NM1', 'POD_NM1', 'COLUMN'

EXEC sp_RENAME 'SMSMI.TRAN_TYPE_1', 'TRAN_TYPE1', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRUCKER_1', 'TRUCKER1', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRUCKER_NM_1', 'TRUCKER_NM1', 'COLUMN'

EXEC sp_RENAME 'SMSMI.POL_2', 'POL2', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POL_NM_2', 'POL_NM2', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POD_2', 'POD2', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POD_NM_2', 'POD_NM2', 'COLUMN'

EXEC sp_RENAME 'SMSMI.TRAN_TYPE_2', 'TRAN_TYPE2', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRUCKER_2', 'TRUCKER2', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRUCKER_NM_2', 'TRUCKER_NM2', 'COLUMN'


EXEC sp_RENAME 'SMSMI.POL_3', 'POL3', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POL_NM_3', 'POL_NM3', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POD_3', 'POD3', 'COLUMN'
EXEC sp_RENAME 'SMSMI.POD_NM_3', 'POD_NM3', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRAN_TYPE_3', 'TRAN_TYPE3', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRUCKER_3', 'TRUCKER3', 'COLUMN'
EXEC sp_RENAME 'SMSMI.TRUCKER_NM_3', 'TRUCKER_NM3', 'COLUMN'


EXEC sp_RENAME 'SMORD.POL_1', 'POL1', 'COLUMN'
EXEC sp_RENAME 'SMORD.POL_NM_1', 'POL_NM1', 'COLUMN'
EXEC sp_RENAME 'SMORD.POD_1', 'POD1', 'COLUMN'
EXEC sp_RENAME 'SMORD.POD_NM1', 'POD_NM1', 'COLUMN'
EXEC sp_RENAME 'SMORD.TRAN_TYPE_1', 'TRAN_TYPE1', 'COLUMN'
EXEC sp_RENAME 'SMORD.TRUCKER_1', 'TRUCKER1', 'COLUMN'
EXEC sp_RENAME 'SMORD.TRUCKER_NM_1', 'TRUCKER_NM1', 'COLUMN'

EXEC sp_RENAME 'SMICNTR.POL_1', 'POL1', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POL_NM_1', 'POL_NM1', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POD_1', 'POD1', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POD_NM_1', 'POD_NM1', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRAN_TYPE_1', 'TRAN_TYPE1', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRUCKER_1', 'TRUCKER1', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRUCKER_NM_1', 'TRUCKER_NM1', 'COLUMN'

EXEC sp_RENAME 'SMICNTR.POL_2', 'POL2', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POL_NM_2', 'POL_NM2', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POD_2', 'POD2', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POD_NM_2', 'POD_NM2', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRAN_TYPE_2', 'TRAN_TYPE2', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRUCKER_2', 'TRUCKER2', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRUCKER_NM_2', 'TRUCKER_NM2', 'COLUMN'

EXEC sp_RENAME 'SMICNTR.POL_3', 'POL3', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POL_NM_3', 'POL_NM3', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POD_3', 'POD3', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.POD_NM_3', 'POD_NM3', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRAN_TYPE_3', 'TRAN_TYPE3', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRUCKER_3', 'TRUCKER3', 'COLUMN'
EXEC sp_RENAME 'SMICNTR.TRUCKER_NM_3', 'TRUCKER_NM3', 'COLUMN'
/****************end by Tim  2017/06/07 17:00 ***********/




alter table SMDN ADD REVOKE_BY NVARCHAR(20)
alter table SMDN ADD REVOKE_DATE DATETIME
alter table SMDN ADD REVOKE_REASON NVARCHAR(200)


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','AST','DNR','订舱退回','FQ','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null)


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNA','品质异常',null,null,'MANA10',GETDATE(),'N') 



insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNS','SCM修改',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNM','制造原因',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNC','客户/Sales变更',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNL','LST 改港',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNP','FA价格趋势',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNR','RD包装方式',null,null,'MANA10',GETDATE(),'N') 

insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNF','AQM品质补料',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DND','PM Sample信息',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNK','其他部门变更',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNB','货代甩柜',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNT','临时缺料',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNO','其他',null,null,'MANA10',GETDATE(),'N') 


insert EXPRELA (U_ID,EXP_TYPE,EXP_REASON,EXP_DESCP,MODIFY_BY,MODIFY_DATE,CREATE_BY,CREATE_DATE,IS_RELIEVE)
VALUES(NEWID(),'DNR','DNR','订舱撤回',null,null,'MANA10',GETDATE(),'N') 
/****************end by dean  2017/05/27 12:00 ***********/



insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRA','空运订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRT','卡车订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 

insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRE','EXPRESS订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 

insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRD','INLAND EXPRESS订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 

insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRF','FCL订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 



insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRL','LCL订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','MT','DNRR','铁路订舱撤回','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null) 




insert into BSCODE (AMS_CODE,
AP_CD,
APPLY,
AR_CD,
CD,
CD_DESCP,
CD_TYPE,
CMP,
CREATE_BY,
CREATE_DATE,
DEP,
GROUP_ID,
INTTRA,
LOCATION,
MODIFY_BY,
ORDER_BY,
STN)
select AMS_CODE,
AP_CD,
APPLY,
AR_CD,
CD,
CD_DESCP,
CD_TYPE,
'*' CMP,
CREATE_BY,
CREATE_DATE,
DEP,
GROUP_ID,
INTTRA,
LOCATION,
MODIFY_BY,
ORDER_BY,
STN　from BSCODE WHERE CMP='FQ' AND CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI')

/****************begin by will  2017/06/12 22:00 ***********/
ALTER TABLE SMDN ADD POST_FLAG_DATE datetime
ALTER TABLE SMSM ADD POST_FLAG_DATE datetime
/****************end by will  2017/06/12 22:00 ***********/

/****************begin by TIM  2017/06/13 22:00 ***********/
ALTER TABLE SMRV 
ALTER COLUMN OUT_BY NVARCHAR(40)
/****************END by TIM  2017/06/13 22:00 ***********/

ALTER TABLE SMRV ADD NIGHT_MOVE NUMERIC(3,0)
ALTER TABLE BSDATE ADD CNTRY_CD NVARCHAR(2)
ALTER TABLE SMICNTR ADD BACK_LOCATION NVARCHAR(50)
ALTER TABLE SMRV ADD BACK_LOCATION NVARCHAR(50)
ALTER TABLE SMICNTR ADD EMPTY_TIME DATETIME


ALTER TABLE SMRDN ADD POD_MDATE DATETIME
ALTER TABLE SMRCNTR ADD POD_MDATE DATETIME
ALTER TABLE SMIDN ADD PICKUP_CDATE DATETIME

/****************begin by fish  2017/07/04 16:55***********/
ALTER TABLE SMRDN ADD SEAL_CHECK NVARCHAR(1);
ALTER TABLE SMRCNTR ADD SEAL_CHECK NVARCHAR(1);

ALTER TABLE SMRDN ADD FLOOR_CHECK NVARCHAR(1);
ALTER TABLE SMRCNTR ADD FLOOR_CHECK NVARCHAR(1);

ALTER TABLE SMRDN ADD POD_CHECK NVARCHAR(1);
ALTER TABLE SMRCNTR ADD POD_CHECK NVARCHAR(1);

ALTER TABLE SMRDN ADD EXPP_CHECK NVARCHAR(1);
ALTER TABLE SMRCNTR ADD EXPP_CHECK NVARCHAR(1);
/****************END by fish  2017/07/04 16:55 ***********/

/****************begin by fish  2017/07/10 16:55***********/
ALTER TABLE SMRV ADD SEAL_CHECK NVARCHAR(1) DEFAULT 'N';
ALTER TABLE SMRV ADD FLOOR_CHECK NVARCHAR(1) DEFAULT 'N';
ALTER TABLE SMRV ADD POD_CHECK NVARCHAR(1) DEFAULT 'N';
ALTER TABLE SMRV ADD EXPP_CHECK NVARCHAR(1) DEFAULT 'N';
/****************END by fish  2017/07/10 16:55 ***********/



/****************begin by dean  2017/08/16 16:55  代码建档公用 ***********/
insert into BSCODE_KIND (CD_DESCP,
CD_TYPE,
CMP,
CREATE_BY,
CREATE_DATE,
DEP,
GROUP_ID,
MODIFY_BY,
MODIFY_DATE,
STN)
select CD_DESCP,
CD_TYPE,
'*' cmp,
CREATE_BY,
CREATE_DATE,
DEP,
GROUP_ID,
MODIFY_BY,
MODIFY_DATE,
STN　from BSCODE_KIND WHERE CMP='FQ' AND CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI')

SELECT * FROM BSCODE_KIND WHERE CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI') AND CMP!='*'

alter table BSCODE_KIND ALTER COLUMN CMP NVARCHAR (3)
update BSCODE_KIND SET CMP=CMP+'B' WHERE CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI') AND CMP!='*'



insert into BSCODE (AMS_CODE,
AP_CD,
APPLY,
AR_CD,
CD,
CD_DESCP,
CD_TYPE,
CMP,
CREATE_BY,
CREATE_DATE,
DEP,
GROUP_ID,
INTTRA,
LOCATION,
MODIFY_BY,
ORDER_BY,
STN)
select AMS_CODE,
AP_CD,
APPLY,
AR_CD,
CD,
CD_DESCP,
CD_TYPE,
'*' CMP,
CREATE_BY,
CREATE_DATE,
DEP,
GROUP_ID,
INTTRA,
LOCATION,
MODIFY_BY,
ORDER_BY,
STN　from BSCODE WHERE CMP='FQ' AND CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI')

SELECT * FROM BSCODE WHERE CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI') AND CMP!='*'

alter table BSCODE ALTER COLUMN CMP NVARCHAR (3)

update BSCODE SET CMP=CMP+'B' WHERE CD_TYPE IN(
'TNT','PT','PK','LW','TTRN','TRGN','MT','TVTW','TCT','EXTP','TCNT',
	'TSPA','TVPT','VERP','TVKO','TVAK','DE','TCAR','TALN','TEDI','TKLC',
	'TCGT','TD','TSAP','EDT','TINC','UB','TIR','TCMP','PLT','SCAC','QAT','TMG',
	'VIA','IMT','CULO','QTP','TIP','TIC','PRI') AND CMP!='*'
/****************END by dean  2017/08/16 16:55 ***********/

/****************begin by FISH  2017/08/29 16:55 ***********/
ALTER TABLE SYS_ACCT ADD WHS NVARCHAR(100);
/****************END by FISH  2017/08/29 16:55 ***********/

/****************begin by WILL  2017/08/31 17:17 ***********/
ALTER TABLE SMRV ADD GOODS NVARCHAR(500);
ALTER TABLE BSADDR ADD CUSTOMER_CODE NVARCHAR(10);
ALTER TABLE SMSMI ADD LSP_NO nvarchar(20);
ALTER TABLE SMSMI ADD LSP_NM nvarchar(70);
ALTER TABLE SMSMI DROP COLUMN DEC_NO;   
ALTER TABLE SMSMI DROP COLUMN CER_NO; 
ALTER TABLE SMSMI DROP COLUMN DEC_DATE; 
ALTER TABLE SMSMI DROP COLUMN REL_DATE; 
ALTER TABLE SMSMI DROP COLUMN TC_DEC_DATE; 
ALTER TABLE SMSMI DROP COLUMN TC_DEC_NO; 
ALTER TABLE SMRV ADD IS_AUTOCREATE NVARCHAR(1);
/****************END by WILL  2017/08/31 17:17 ***********/

/****************begin by WILL 2017/09/06 11:17 ***********/
ALTER TABLE SMIDN ADD IDATE datetime;
ALTER TABLE SMIDN ADD POD_DATE datetime;
ALTER TABLE SMIDN ADD ODATE datetime;
ALTER TABLE SMICNTR ADD IDATE datetime;
ALTER TABLE SMICNTR ADD POD_DATE datetime;
ALTER TABLE SMICNTR ADD ODATE datetime;
/****************END by WILL 2017/09/06 11:17 ***********/

/****************begin by WILL 2017/09/07 16:17 ***********/
ALTER TABLE SMICNTR ALTER COLUMN INV_NO NVARCHAR(500);
/****************END by WILL 2017/09/07 16:17 ***********/


ALTER TABLE SMICNTR ADD PO_NO nvarchar(200);
ALTER TABLE SMICNTR ADD INV_NO nvarchar(20);
ALTER TABLE SMIDN ADD PO_NO nvarchar(200);
ALTER TABLE SMRV ADD PO_NO nvarchar(500);
ALTER TABLE SMRDN ADD PO_NO nvarchar(200);
ALTER TABLE SMRCNTR ADD PO_NO nvarchar(200);

/****************begin by WILL 2017/09/13 16:17 ***********/
ALTER TABLE SMWHGT_LOG ALTER COLUMN RV_CNTR_NO NVARCHAR(40)
/****************END by WILL 2017/09/13 16:17 ***********/

/****************begin by WILL 2017/09/13 16:17  已经执行不用更新***********/ 
--update SMICNTR set INV_NO=substring((SELECT DISTINCT INV_NO+',' FROM SMIDN WHERE SMIDN.SHIPMENT_ID=SMICNTR.SHIPMENT_ID  FOR XML PATH(''))
--,1,len((SELECT DISTINCT INV_NO+',' FROM SMIDN WHERE SMIDN.SHIPMENT_ID=SMICNTR.SHIPMENT_ID  FOR XML PATH('')))-1) where CMP='RU'
 /****************END by WILL 2017/09/13 16:17 ***********/

 /****************begin by WILL 2017/09/19 10:17 ***********/
ALTER TABLE SMRV ADD SHIPPER NVARCHAR(400);
ALTER TABLE SMRV ADD FOWARDER NVARCHAR(400);
ALTER TABLE SMRV ALTER COLUMN CARRIER NVARCHAR(400);

--UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"Shipper","width":100,"hidden":false},{"name":"Fowarder","width":100,"hidden":false}]') WHERE ID in('Platform Reservation',
--'Appointment Confirmed','Subscribe List','truck entery details') AND LAYOUT_TYPE='GRID';
	/****************END by WILL 2017/09/19 10:17 ***********/

/****************begin by WILL 2017/09/21 10:17 ***********/
ALTER TABLE SMRV ADD GATE_DATE DATETIME;
--UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'}]','},{"name":"GateDate","width":100,"hidden":false}]') WHERE ID in('Platform Reservation',
--'Appointment Confirmed','Subscribe List','truck entery details') AND LAYOUT_TYPE='GRID';
/****************END by WILL 2017/09/21 10:17 ***********/

/****************begin by JIMMY 2017/09/22 16:33 ***********/
ALTER TABLE SMBIM ADD VERIFY_DATE_L DATETIME;
ALTER TABLE SMBIM ADD DEBIT_DATE_L DATETIME;
ALTER TABLE SMBIM ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMBIM ADD MODIFY_DATE_L DATETIME;
ALTER TABLE APPROVE_RECORD ADD APPROVE_DATE_L DATETIME;
ALTER TABLE APPROVE_RECORD ADD NOTIFY_DATE_L DATETIME;
ALTER TABLE APPROVE_RECORD ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMQTM ADD APPROVE_DATE_L DATETIME;
ALTER TABLE SMQTM ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMQTM ADD MODIFY_DATE_L DATETIME;
ALTER TABLE SMQTM ADD QUOT_DATE_L DATETIME;
ALTER TABLE SMRV ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMRV ADD CALL_DATE_L DATETIME;
ALTER TABLE SMRV ADD CANCEL_DATE_L DATETIME;
ALTER TABLE SMRV ADD OUT_DATE_L DATETIME;
ALTER TABLE SMRV ADD EPT_IDATE_L DATETIME;
ALTER TABLE SMRV ADD SEAL_DATE_L DATETIME;
ALTER TABLE SMRV ADD IN_DATE_L DATETIME;
ALTER TABLE SMRV ADD EPT_ODATE_L DATETIME;
ALTER TABLE SMRV ADD ORDER_DATE_L DATETIME;
ALTER TABLE SMRV ADD CONFIRM_DATE_L DATETIME;
ALTER TABLE SMRV ADD Arrival_Fact_Date_L DATETIME;
ALTER TABLE SMIPM ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMIPM ADD MODIFY_DATE_L DATETIME;
ALTER TABLE SMIPM ADD CONFIRM_DATE_L DATETIME;
ALTER TABLE SMIPM ADD AC_DATE_L DATETIME;
ALTER TABLE SMIPM ADD ENDING_DATE_L DATETIME;
ALTER TABLE SMIPM ADD APPLICATION_DATE_L DATETIME;
ALTER TABLE SMBID ADD DOWNLOAD_TIME_L DATETIME;
ALTER TABLE SMBID ADD APPROVE_DATE_L DATETIME;
ALTER TABLE SMBID ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMBID ADD MODIFY_DATE_L DATETIME;
ALTER TABLE SMBID ADD UPLOAD_TIME_L DATETIME;
ALTER TABLE SMRCNTR ADD LDATE_L DATETIME;
ALTER TABLE SMRCNTR ADD IDATE_L DATETIME;
ALTER TABLE SMRCNTR ADD POD_MDATE_L DATETIME;
ALTER TABLE SMRDN ADD LDATE_L DATETIME;
ALTER TABLE SMRDN ADD IDATE_L DATETIME;
ALTER TABLE SMRDN ADD POD_MDATE_L DATETIME;
ALTER TABLE MOD_BULLETIN ADD CREATE_DATE_L DATETIME;
ALTER TABLE MOD_BULLETIN ADD MODIFY_DATE_L DATETIME;
ALTER TABLE SMRVM ADD MOVING_DATE_L DATETIME;
ALTER TABLE SMRVM ADD MODIFY_DATE_L DATETIME;
ALTER TABLE SMSMI ADD CREATE_DATE_L DATETIME;
ALTER TABLE SMSMI ADD MODIFY_DATE_L DATETIME;
ALTER TABLE SMRQD ADD NOTIFY_DATE_L DATETIME;
ALTER TABLE SMICNTR ADD ODATE_L DATETIME;
ALTER TABLE SMICNTR ADD IDATE_L DATETIME;
ALTER TABLE SMICNTR ADD POD_DATE_L DATETIME;
ALTER TABLE SMIDN ADD ODATE_L DATETIME;
ALTER TABLE SMIDN ADD IDATE_L DATETIME;
ALTER TABLE SMIDN ADD POD_DATE_L DATETIME;
/****************END by JIMMY 2017/09/22 16:33 ***********/

/****************begin by JIMMY 2017/09/25 11:35 ***********/
alter table SMQTD alter column MIN_AMT numeric(18,4)
alter table SMQTD alter column F1 numeric(18,4)
alter table SMQTD alter column F2 numeric(18,4)
alter table SMQTD alter column F3 numeric(18,4)
alter table SMQTD alter column F4 numeric(18,4)
alter table SMQTD alter column F5 numeric(18,4)
alter table SMQTD alter column F6 numeric(18,4)
alter table SMQTD alter column F7 numeric(18,4)
alter table SMQTD alter column F8 numeric(18,4)
alter table SMQTD alter column F9 numeric(18,4)
alter table SMQTD alter column F10 numeric(18,4)
alter table SMQTD alter column F11 numeric(18,4)
alter table SMQTD alter column F12 numeric(18,4)
alter table SMQTD alter column F13 numeric(18,4)
alter table SMQTD alter column F14 numeric(18,4)
alter table SMQTD alter column F15 numeric(18,4)
alter table SMQTD alter column F16 numeric(18,4)
alter table SMQTD alter column F17 numeric(18,4)
alter table SMQTD alter column F18 numeric(18,4)
alter table SMQTD alter column F19 numeric(18,4)
alter table SMQTD alter column F20 numeric(18,4)
alter table SMQTD alter column F21 numeric(18,4)
alter table SMQTD alter column F22 numeric(18,4)
alter table SMQTD alter column F23 numeric(18,4)
alter table SMQTD alter column F24 numeric(18,4)
alter table SMQTD alter column F25 numeric(18,4)
alter table SMQTD alter column F26 numeric(18,4)
alter table SMQTD alter column F27 numeric(18,4)
alter table SMQTD alter column F28 numeric(18,4)
alter table SMQTD alter column F29 numeric(18,4)
alter table SMQTD alter column F30 numeric(18,4)
alter table SMQTD alter column F31 numeric(18,4)
alter table SMQTD alter column F32 numeric(18,4)
alter table SMQTD alter column F33 numeric(18,4)
alter table SMQTD alter column F34 numeric(18,4)
alter table SMQTD alter column F35 numeric(18,4)
alter table SMQTD alter column F36 numeric(18,4)
alter table SMQTD alter column F37 numeric(18,4)
alter table SMQTD alter column F38 numeric(18,4)
alter table SMQTD alter column F39 numeric(18,4)
alter table SMQTD alter column F40 numeric(18,4)
alter table SMQTD alter column F41 numeric(18,4)
alter table SMQTD alter column F42 numeric(18,4)
alter table SMQTD alter column F43 numeric(18,4)
alter table SMQTD alter column F44 numeric(18,4)
alter table SMQTD alter column F45 numeric(18,4)
alter table SMQTD alter column F46 numeric(18,4)
alter table SMQTD alter column F47 numeric(18,4)
alter table SMQTD alter column F48 numeric(18,4)
alter table SMQTD alter column F49 numeric(18,4)
alter table SMQTD alter column F50 numeric(18,4)
/****************END by JIMMY 2017/09/25 11:35 ***********/

/****************Begin by Will 2017/10/17 1:24 ***********/
ALTER TABLE SMPTY ADD SOURCE_CODE NVARCHAR(10);
ALTER TABLE SMPTY_FILTER ADD SOURCE_CODE NVARCHAR(10);
/****************Begin by Will 2017/10/17 1:24 ***********/

/****************begin by fish 2017/10/18 17:35 ***********/
ALTER TABLE Files ALTER COLUMN Uploader NVARCHAR(50)
/****************end by fish 2017/10/18 17:35 ***********/

/****************begin by JIMMY 2017/09/25 11:35 ***********/
ALTER TABLE SMRV ADD PRODUCT_TYPE NVARCHAR(200);
ALTER TABLE SMRV ADD WS_REMARK NVARCHAR(500);
ALTER TABLE SMRV ADD PALLET_QTY NVARCHAR(50);
/****************END by JIMMY 2017/09/25 11:35 ***********/


/****************begin by fish 2017/10/23 11:35 ***********/

ALTER TABLE SYS_ACCT ADD IP_LOCKER NVARCHAR(500);

CREATE TABLE IP_LOG(
	[ID] [bigint] identity(1,1) NOT NULL,
	DATA_PATH [nvarchar](10) NULL,
	CMP [nvarchar](30) NULL,
	IP [nvarchar](50) NULL,
	KEY_WORD [nvarchar](100) NULL,
    PC_NAME [nvarchar](50) NULL,
	[CREATE_BY] [nvarchar](50) NULL,
	[CREATE_DATE] [datetime] NULL,
 CONSTRAINT [PK_IP_LOG] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
) ON [PRIMARY])

/****************END by fish 2017/10/23 11:35 ***********/


/****************begin by fish 2017/10/31 11:35 ***********/
ALTER TABLE TMP_AMT ADD CHG_TYPE NVARCHAR(1);
ALTER TABLE TMP_AMT ADD REPAY NVARCHAR(1);

ALTER TABLE SMBID ADD QLCUR NVARCHAR(3);
ALTER TABLE SMBID ADD QLRATE NUMERIC(18,6);
ALTER TABLE SMBID ADD REPAY NVARCHAR(1);
/****************END by fish 2017/10/31 11:35 ***********/

/****************begin by fish 2017/11/01 11:35 ***********/
INSERT INTO BSCODE_KIND (GROUP_ID, CD_TYPE, CD_DESCP, CMP, STN)VALUES('TPV','LCUR','Local Currency', '*', '*');
/****************END by fish 2017/11/01 11:35 ***********/

/****************begin by WILL 2017/11/08 11:35 ***********/
 ALTER TABLE SMSMI ADD ISF_SEND_DATE datetime;
 ALTER TABLE SMSMI ADD ISF_WIN NVARCHAR(40);
  ALTER TABLE SMSMI ADD IORDER NVARCHAR(1);
  /****************END by WILL 2017/11/08 11:35 ***********/

  
/****************begin by fish 2017/11/08 16:35 ***********/
ALTER TABLE SMRV ADD EMPTY_TIME DATETIME;
ALTER TABLE SMRV ADD BATCH_ID NVARCHAR(50);
/****************END by fish 2017/11/08 16:35 ***********/

/****************begin by fish 2017/11/21 14:31 ***********/
ALTER TABLE SMBID ADD INVOICE_INFO NVARCHAR(500);
ALTER TABLE SMRV ADD DIMENSIONS_INFO NVARCHAR(1000);
ALTER TABLE SMORD ADD DIMENSIONS_INFO NVARCHAR(1000);
/****************END by fish 2017/11/21 14:31 ***********/

/****************begin by will 2017/11/17 05:08 ***********/
ALTER TABLE SMSMI ADD UPLOAD_SCM_BY NVARCHAR(40);
ALTER TABLE SMSMI ADD BROKER_CONFIRM_BY NVARCHAR(40);
ALTER TABLE SMSMI ADD UPLOAD_SCM_DATE DATETIME;
ALTER TABLE SMSMI ADD BROKER_CONFIRM_DATE DATETIME;
ALTER TABLE SMSMI ADD IB_DATE DATETIME;
ALTER TABLE SMBIM ADD PAID_DATE DATETIME
ALTER TABLE SMSMI ADD PONO_INPUT_DATE DATETIME

ALTER TABLE SMSMI ADD LSP_CONFIRM_DATE DATETIME
ALTER TABLE SMSMI ADD LSP_CONFIRM_BY NVARCHAR(40)
/****************END by will 2017/11/17 05:08 ***********/

ALTER TABLE SMSMI ALTER COLUMN MONTH decimal(10,0)


/****************begin by fish 2017/11/21 14:31 ***********/
ALTER TABLE SMBID ADD INVOICE_INFO NVARCHAR(500);
ALTER TABLE SMRV ADD DIMENSIONS_INFO NVARCHAR(1000);
ALTER TABLE SMORD ADD DIMENSIONS_INFO NVARCHAR(1000);
/****************END by fish 2017/11/21 14:31 ***********/

ALTER TABLE SMSMI ADD CANCEL_NOTIFY_LSP_TIME DATETIME


ALTER TABLE SMICNTR ADD FINAL_WH NVARCHAR(5);
ALTER TABLE SMICNTR ADD WS_CD NVARCHAR(10);
ALTER TABLE SMICNTR ADD WS_NM NVARCHAR(30);

ALTER TABLE SMIDN ADD FINAL_WH NVARCHAR(5);
ALTER TABLE SMIDN ADD WS_CD NVARCHAR(10);
ALTER TABLE SMIDN ADD WS_NM NVARCHAR(30);

ALTER TABLE SMRV ADD WS_NM NVARCHAR(30);

ALTER TABLE SMBIM ADD B_MONTH NUMERIC(5,0);

 ALTER TABLE SMRV ALTER COLUMN DRIVER NVARCHAR(100);
 ALTER TABLE SMRV ALTER COLUMN LDRIVER NVARCHAR(100);

/****************begin by lance 2017/12/20 15:14 ***********/
ALTER TABLE SMSMI ADD IBCR_NO NVARCHAR(20);
ALTER TABLE SMSMI ADD IBCR_NM NVARCHAR(70);
ALTER TABLE SMSMI ADD IBLP_NO NVARCHAR(20);
ALTER TABLE SMSMI ADD IBLP_NM NVARCHAR(70);
ALTER TABLE SMSMI ADD IBGV_NO NVARCHAR(20);
ALTER TABLE SMSMI ADD IBGV_NM NVARCHAR(70);
/****************END by lance 2017/12/20 15:14 ***********/

/****************begin by lance 2018/1/3 17:07 ***********/
ALTER TABLE SMQTM
ALTER COLUMN QUOT_DATE_L DATE 
/****************END by lance 2018/1/3 17:07 ***********/

/****************begin by lance 2018/1/11 15:59 ***********/
ALTER TABLE SMIDNP ALTER COLUMN IPART_NO VARCHAR(200)
alter table Smidnp alter column inv_no nvarchar(40)

alter table Smidn alter column inv_no nvarchar(40)

 ALTER TABLE SMSMI ADD ISF_SEND_DATE_L datetime;
 ALTER TABLE TKBL ADD ISF_SEND_DATE_L datetime;
/****************END by lance 2018/1/12 14:21 ***********/

/****************begin by Will 2018/1/26 17:33 ***********/
 ALTER TABLE SMQTD ALTER COLUMN F1 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F2 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F3 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F4 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F5 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F6 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F7 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F8 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F9 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F10 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F11 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F12 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F13 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F14 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F15 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F16 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F17 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F18 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F19 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F20 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F21 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F22 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F23 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F24 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F25 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F26 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F27 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F28 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F29 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F30 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F31 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F32 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F33 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F34 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F35 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F36 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F37 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F38 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F39 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F40 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F41 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F42 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F43 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F44 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F45 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F46 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F47 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F48 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F49 numeric(18,4);
 ALTER TABLE SMQTD ALTER COLUMN F50 numeric(18,4);
 /****************End by Will 2018/1/26 17:33 ***********/

 /***********begin by Levi 2022-05-05***********/
 CREATE NONCLUSTERED INDEX [INX_SMIDNP_SHIPMENT_ID] ON [dbo].[SMIDNP]
(
	[SHIPMENT_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO



CREATE NONCLUSTERED INDEX [IX_SMICUFT_DN_NO] ON [dbo].[SMICUFT]
(
	[DN_NO] ASC
)
INCLUDE ( 	[U_ID],
	[U_FID],
	[L],
	[W],
	[H],
	[PKG],
	[PKG_UNIT],
	[CUFT],
	[VW]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO

 /***********end by Levi 2022-05-05***********/

 ALTER TABLE SMSMI ALTER COLUMN DISCHARGE_DATE DATE



CREATE TRIGGER  [dbo].[TG_SMICNTR_TOSMI] ON [dbo].[SMICNTR]
  AFTER UPDATE  
AS
	DECLARE @shipmentid char(30);
	select @shipmentid=SHIPMENT_ID from deleted
	    if(@shipmentid is not null)
		BEGIN 
		UPDATE SMSMI SET DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),DEC_CUST) 
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),TC_DEC_CUST) 
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_CER_NO =(
SELECT STUFF((SELECT DISTINCT ';' + CER_NO
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )) WHERE SHIPMENT_ID=@shipmentid AND TRAN_TYPE IN ('F','R')
							END;

GO



CREATE TRIGGER  [dbo].[TG_SMIDN_TOSMI] ON [dbo].[SMIDN]
  AFTER UPDATE  
AS
	DECLARE @shipmentid char(30);
	select @shipmentid=SHIPMENT_ID from deleted
	    if(@shipmentid is not null)
		BEGIN 
		UPDATE SMSMI SET DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),DEC_CUST) 
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),TC_DEC_CUST) 
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_CER_NO =(
SELECT STUFF((SELECT DISTINCT ';' + CER_NO
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )) WHERE SHIPMENT_ID=@shipmentid AND TRAN_TYPE NOT IN ('F','R')
							END;

GO


/**********Begin by Will 2022-12-08***********/
ALTER TABLE SMICNTR ADD EMP_PICK_DATE DATE;
ALTER TABLE SMORD ADD EMP_PICK_DATE DATE;
 /**********End by Will 2022-12-08***********/

 
 /***********begin by Lance 2022-12-09***********/
ALTER TABLE SMORD ADD STO_EXCEED_TIME INT
ALTER TABLE SMORD ADD DEM_EXCEED_TIME INT
ALTER TABLE SMORD ADD DET_EXCEED_TIME INT

ALTER TABLE SMORD ADD STO_EST_CUR NVARCHAR(3)
ALTER TABLE SMORD ADD DEM_EST_CUR NVARCHAR(3)
ALTER TABLE SMORD ADD DET_EST_CUR NVARCHAR(3)

ALTER TABLE SMORD ADD STO_EST_AMT NUMERIC(12,2)
ALTER TABLE SMORD ADD DEM_EST_AMT NUMERIC(12,2)
ALTER TABLE SMORD ADD DET_EST_AMT NUMERIC(12,2)

ALTER TABLE SMORD ADD STO_EST_FROM DATE
ALTER TABLE SMORD ADD DEM_EST_FROM DATE
ALTER TABLE SMORD ADD DET_EST_FROM DATE

ALTER TABLE SMORD ADD STO_EST_TO DATE
ALTER TABLE SMORD ADD DEM_EST_TO DATE
ALTER TABLE SMORD ADD DET_EST_TO DATE

ALTER TABLE SMORD ADD STO_ACT_CUR NVARCHAR(3)
ALTER TABLE SMORD ADD DEM_ACT_CUR NVARCHAR(3)
ALTER TABLE SMORD ADD DET_ACT_CUR NVARCHAR(3)

ALTER TABLE SMORD ADD STO_ACT_AMT NUMERIC(12,2)
ALTER TABLE SMORD ADD DEM_ACT_AMT NUMERIC(12,2)
ALTER TABLE SMORD ADD DET_ACT_AMT NUMERIC(12,2)

ALTER TABLE SMORD ADD DEBIT_NO NVARCHAR(30)
ALTER TABLE SMORD ADD QUOT_NO NVARCHAR(20)
ALTER TABLE SMORD ADD APPROVE_TO NVARCHAR(30)

CREATE TRIGGER [dbo].[updateSmsmiEta]
   ON  [dbo].[SMSMI]
   AFTER INSERT,UPDATE
AS 
BEGIN
    DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),TRAN_TYPE NVARCHAR(1),ETA DATE,
	COMBINE_DET NVARCHAR(1),PORT_FREE_TIME INT,FACT_FREE_TIME INT)
	DECLARE @shipment_id NVARCHAR(20),
	        @tran_type nvarchar(1),
			@eta date,
			@combine_det nvarchar(1),
			@port_free_time int,
			@fact_free_time int
	DECLARE @Total INT,@Line INT = 1
	if (UPDATE(ETA))
	BEGIN
		INSERT INTO @Table SELECT SHIPMENT_ID,TRAN_TYPE,ETA,COMBINE_DET,PORT_FREE_TIME,FACT_FREE_TIME FROM inserted
		SELECT @Total = MAX(ID) FROM @Table
        
		WHILE @Line <= @Total
		BEGIN
			SELECT @shipment_id=SHIPMENT_ID, @tran_type=TRAN_TYPE,@eta=ETA,@combine_det=COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME FROM @Table WHERE ID = @Line
			if(@fact_free_time is not null AND @tran_type IN ('F','R') and @eta is not null)
			begin
				UPDATE SMORD SET STORAGE_DUE_DATE=DATEADD(DAY,@fact_free_time,@eta) WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
				UPDATE SMICNTR SET STORAGE_DUE_DATE=DATEADD(DAY,@fact_free_time,@eta) WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
			end
			if((@combine_det!='U' OR @combine_det IS NULL) and @port_free_time is not null AND @tran_type IN ('F','R') and @eta is not null)
			BEGIN
				UPDATE SMORD SET DEMURRAGE_DUE_DATE=DATEADD(DAY,@port_free_time,@eta) WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
				UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=DATEADD(DAY,@port_free_time,@eta) WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
			END
			SET @Line = @Line + 1
		END
	END
END
GO

CREATE TRIGGER [dbo].[updateSMORD]
   ON  [dbo].[SMORD]
   AFTER INSERT,UPDATE
AS 
BEGIN

    DECLARE @Table TABLE(ID INT IDENTITY(1,1),ORD_NO NVARCHAR(100),TRAN_TYPE NVARCHAR(1),PICKUP_CDATE DATE,
	EMPTY_TIME DATE,COMBINE_DET NVARCHAR(1),DETENTION_DUE_DATE DATE,DEMURRAGE_DUE_DATE DATE,STORAGE_DUE_DATE DATE,
	STO_EXCEED_TIME INT,DEM_EXCEED_TIME INT, DET_EXCEED_TIME INT)
	DECLARE @ord_no NVARCHAR(20),
	        @tran_type nvarchar(1),
			@pick_cdate date,
			@combine_det nvarchar(1),
			@storage_due_date date,
			@demurrage_due_date date,
			@detention_due_date date,
			@empty_time date
	DECLARE @Total INT,@det_exceed_time INT,@dem_exceed_time INT,@sto_exceed_time INT
	DECLARE @Line INT = 1
    if(UPDATE(DETENTION_DUE_DATE) OR UPDATE(EMPTY_TIME) OR UPDATE(PICKUP_CDATE) OR UPDATE(STORAGE_DUE_DATE) OR UPDATE(DEMURRAGE_DUE_DATE))
	BEGIN
		INSERT INTO @Table SELECT ORD_NO,TRAN_TYPE,PICKUP_CDATE,EMPTY_TIME,COMBINE_DET,DETENTION_DUE_DATE,DEMURRAGE_DUE_DATE,STORAGE_DUE_DATE,
		CASE WHEN STORAGE_DUE_DATE IS NULL THEN 0 WHEN PICKUP_CDATE IS NULL THEN DATEDIFF(DAY,STORAGE_DUE_DATE,GETDATE()) ELSE DATEDIFF(DAY,STORAGE_DUE_DATE,PICKUP_CDATE) END,
CASE WHEN DEMURRAGE_DUE_DATE IS NULL THEN 0 WHEN (PICKUP_CDATE IS NULL AND (COMBINE_DET ='N' OR COMBINE_DET IS NULL)) OR (EMPTY_TIME IS NULL AND COMBINE_DET IN ('U','Y')) THEN DATEDIFF(DAY,DEMURRAGE_DUE_DATE,GETDATE()) WHEN COMBINE_DET='N' OR COMBINE_DET IS NULL THEN DATEDIFF(DAY,DEMURRAGE_DUE_DATE,PICKUP_CDATE) ELSE DATEDIFF(DAY,DEMURRAGE_DUE_DATE,EMPTY_TIME) END,
CASE WHEN DETENTION_DUE_DATE IS NULL THEN 0 WHEN EMPTY_TIME IS NULL THEN DATEDIFF(DAY,DETENTION_DUE_DATE,GETDATE()) ELSE DATEDIFF(DAY,DETENTION_DUE_DATE,EMPTY_TIME) END
		FROM inserted
		SELECT @Total = MAX(ID) FROM @Table
        
		WHILE @Line <= @Total
		BEGIN
			select @ord_no=ORD_NO, @tran_type=TRAN_TYPE,@pick_cdate=PICKUP_CDATE,@empty_time=EMPTY_TIME,
		@combine_det=COMBINE_DET,@detention_due_date=DETENTION_DUE_DATE,
		@demurrage_due_date=DEMURRAGE_DUE_DATE,@storage_due_date=STORAGE_DUE_DATE,@det_exceed_time=DET_EXCEED_TIME,
		@dem_exceed_time=DEM_EXCEED_TIME,@sto_exceed_time=STO_EXCEED_TIME from @Table WHERE ID = @Line
			if (@tran_type IN ('F','R'))
			BEGIN
				DECLARE @det_from date=null,@det_to date=null,
				@dem_from date=null,@dem_to date=null,
				@sto_from date=null,@sto_to date=null
				if(@sto_exceed_time>0)
				BEGIN
					SET @sto_from = dateadd(day,1,@storage_due_date)
					SET @sto_to = @pick_cdate
					if(@sto_to is null)
						SET @sto_to = GETDATE()
				END

				if(@dem_exceed_time>0)
				BEGIN
					SET @dem_from = dateadd(day,1,@demurrage_due_date)
					SET @dem_to = @pick_cdate
					if(@combine_det IN ('U','Y'))
					    SET @dem_to = @empty_time
					if(@dem_to is null)
						SET @dem_to = GETDATE()
				END

				if(@det_exceed_time>0)
				BEGIN
					SET @det_from = dateadd(day,1,@detention_due_date)
					SET @det_to = @empty_time
					if(@det_to is null)
						SET @det_to = GETDATE()
				END

				if(UPDATE(STORAGE_DUE_DATE) OR UPDATE(PICKUP_CDATE))
					UPDATE SMORD SET STO_EXCEED_TIME=@sto_exceed_time,STO_EST_FROM=@sto_from,STO_EST_TO=@sto_to WHERE ORD_NO=@ord_no AND STORAGE_DUE_DATE IS NOT NULL
				if(UPDATE(DEMURRAGE_DUE_DATE) OR (UPDATE(PICKUP_CDATE) AND (@combine_det = 'N' OR @combine_det IS NULL)) OR (UPDATE(EMPTY_TIME) AND @combine_det IN('U','Y')))
					UPDATE SMORD SET DEM_EXCEED_TIME=@dem_exceed_time,DEM_EST_FROM=@dem_from,DEM_EST_TO=@dem_to WHERE ORD_NO=@ord_no AND DEMURRAGE_DUE_DATE IS NOT NULL
				if(UPDATE(DETENTION_DUE_DATE) OR UPDATE(EMPTY_TIME))
					UPDATE SMORD SET DET_EXCEED_TIME=@det_exceed_time,DET_EST_FROM=@det_from,DET_EST_TO=@det_to WHERE ORD_NO=@ord_no AND DETENTION_DUE_DATE IS NOT NULL
			END
			SET @Line = @Line + 1
		END
	END
END
GO

CREATE PROC [dbo].[PROC_UP_SMORD]
AS
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @ord_no nvarchar(20),@combine_det nvarchar(1)
	DECLARE @dem_due_date date,@det_due_date date,@sto_due_date date,@pickup_cdate date,@empty_time date
	DECLARE @det_exceed_time INT = null,@dem_exceed_time INT = null,@sto_exceed_time INT = null,
			@sto_from date,@sto_to date,@dem_from date,@dem_to date,@det_from date,@det_to date
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),ORD_NO NVARCHAR(20),DEMURRAGE_DUE_DATE DATE,DETENTION_DUE_DATE DATE,STORAGE_DUE_DATE DATE,
		PICKUP_CDATE DATE,EMPTY_TIME DATE,COMBINE_DET NVARCHAR(1),STO_EXCEED_TIME INT,DEM_EXCEED_TIME INT,DET_EXCEED_TIME INT,
		STO_EST_FROM DATE,STO_EST_TO DATE,DEM_EST_FROM DATE,DEM_EST_TO DATE,DET_EST_FROM DATE,DET_EST_TO DATE)

		INSERT INTO @Table SELECT ORD_NO,DEMURRAGE_DUE_DATE,DETENTION_DUE_DATE,STORAGE_DUE_DATE,PICKUP_CDATE,EMPTY_TIME,COMBINE_DET,STO_EXCEED_TIME,DEM_EXCEED_TIME,DET_EXCEED_TIME,STO_EST_FROM,STO_EST_TO,DEM_EST_FROM,DEM_EST_TO,DET_EST_FROM,DET_EST_TO FROM SMORD WHERE DEMURRAGE_DUE_DATE IS NOT NULL AND EMPTY_TIME IS NULL AND COMBINE_DET='U'
	union SELECT ORD_NO,DEMURRAGE_DUE_DATE,DETENTION_DUE_DATE,STORAGE_DUE_DATE,PICKUP_CDATE,EMPTY_TIME,COMBINE_DET,STO_EXCEED_TIME,DEM_EXCEED_TIME,DET_EXCEED_TIME,STO_EST_FROM,STO_EST_TO,DEM_EST_FROM,DEM_EST_TO,DET_EST_FROM,DET_EST_TO FROM SMORD WHERE DEMURRAGE_DUE_DATE IS NOT NULL AND PICKUP_CDATE IS NULL AND (COMBINE_DET<>'U' OR COMBINE_DET IS NULL)
	UNION SELECT ORD_NO,DEMURRAGE_DUE_DATE,DETENTION_DUE_DATE,STORAGE_DUE_DATE,PICKUP_CDATE,EMPTY_TIME,COMBINE_DET,STO_EXCEED_TIME,DEM_EXCEED_TIME,DET_EXCEED_TIME,STO_EST_FROM,STO_EST_TO,DEM_EST_FROM,DEM_EST_TO,DET_EST_FROM,DET_EST_TO FROM SMORD WHERE DETENTION_DUE_DATE IS NOT NULL AND EMPTY_TIME IS NULL
	UNION SELECT ORD_NO,DEMURRAGE_DUE_DATE,DETENTION_DUE_DATE,STORAGE_DUE_DATE,PICKUP_CDATE,EMPTY_TIME,COMBINE_DET,STO_EXCEED_TIME,DEM_EXCEED_TIME,DET_EXCEED_TIME,STO_EST_FROM,STO_EST_TO,DEM_EST_FROM,DEM_EST_TO,DET_EST_FROM,DET_EST_TO FROM SMORD WHERE STORAGE_DUE_DATE IS NOT NULL AND PICKUP_CDATE IS NULL


	SELECT @Total = MAX(ID) FROM @Table
        
	WHILE @Line <= @Total
	BEGIN
		SELECT @ord_no=ORD_NO,@combine_det=COMBINE_DET,@dem_due_date=DEMURRAGE_DUE_DATE,@det_due_date=DETENTION_DUE_DATE,
		@sto_due_date=STORAGE_DUE_DATE,@pickup_cdate=PICKUP_CDATE,@empty_time=EMPTY_TIME,@sto_exceed_time= STO_EXCEED_TIME,
		@dem_exceed_time=DEM_EXCEED_TIME,@det_exceed_time=DET_EXCEED_TIME,@sto_from=STO_EST_FROM,@sto_to=STO_EST_TO,
		@dem_from=DEM_EST_FROM,@dem_to=DEM_EST_TO,@det_from=DET_EST_FROM,@det_to=DET_EST_TO FROM @Table WHERE ID = @Line

		
		IF(@pickup_cdate is null and @sto_due_date is not null)
			SET @sto_exceed_time = DATEDIFF(DAY,@sto_due_date,GETDATE())
			SET @sto_from=null
			SET @sto_to=null
			if(@sto_exceed_time>0)
				BEGIN
					SET @sto_from = dateadd(day,1,@sto_due_date)
					SET @sto_to = GETDATE()
				END

		IF(@dem_due_date is not null AND ((@pickup_cdate IS NULL AND (@combine_det='N' OR @combine_det IS NULL)) OR (@empty_time IS NULL AND @combine_det IN ('U','Y'))))
			SET @dem_exceed_time = DATEDIFF(DAY,@dem_due_date,GETDATE())
			SET @dem_from=null
			SET @dem_to=null
			if(@dem_exceed_time>0)
				BEGIN
					SET @dem_from = dateadd(day,1,@sto_due_date)
					SET @dem_to = GETDATE()
				END

		IF(@empty_time is null and @det_due_date is not null)
			SET @det_exceed_time = DATEDIFF(DAY,@det_due_date,GETDATE())
			SET @det_from=null
			SET @det_to=null
			if(@det_exceed_time>0)
				BEGIN
					SET @det_from = dateadd(day,1,@det_due_date)
					SET @det_to = GETDATE()
				END

		UPDATE SMORD SET STO_EXCEED_TIME=@sto_exceed_time,STO_EST_FROM=@sto_from,STO_EST_TO=@sto_to,
		DEM_EXCEED_TIME=@dem_exceed_time,DEM_EST_FROM=@dem_from,DEM_EST_TO=@dem_to,
		DET_EXCEED_TIME=@det_exceed_time,DET_EST_FROM=@det_from,DET_EST_TO=@det_to WHERE ORD_NO=@ord_no

		SET @Line = @Line + 1
	END
END


GO

BEGIN TRANSACTION
DECLARE @ReturnCode INT
SELECT @ReturnCode = 0
/****** Object:  JobCategory [[Uncategorized (Local)]]    Script Date: 11-Dec-2022 5:05:22 PM ******/
IF NOT EXISTS (SELECT name FROM msdb.dbo.syscategories WHERE name=N'[Uncategorized (Local)]' AND category_class=1)
BEGIN
EXEC @ReturnCode = msdb.dbo.sp_add_category @class=N'JOB', @type=N'LOCAL', @name=N'[Uncategorized (Local)]'
IF (@@ERROR <> 0 OR @ReturnCode <> 0) GOTO QuitWithRollback

END

DECLARE @jobId BINARY(16)
EXEC @ReturnCode =  msdb.dbo.sp_add_job @job_name=N'EXECUTE_PROC_UP_SMORD', 
		@enabled=1, 
		@notify_level_eventlog=0, 
		@notify_level_email=0, 
		@notify_level_netsend=0, 
		@notify_level_page=0, 
		@delete_level=0, 
		@description=N'No description available.', 
		@category_name=N'[Uncategorized (Local)]', 
		@owner_login_name=N'ESHIPPING', @job_id = @jobId OUTPUT
IF (@@ERROR <> 0 OR @ReturnCode <> 0) GOTO QuitWithRollback
/****** Object:  Step [Execute stored procedures]    Script Date: 11-Dec-2022 5:05:23 PM ******/
EXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'Execute stored procedures', 
		@step_id=1, 
		@cmdexec_success_code=0, 
		@on_success_action=1, 
		@on_success_step_id=0, 
		@on_fail_action=2, 
		@on_fail_step_id=0, 
		@retry_attempts=0, 
		@retry_interval=0, 
		@os_run_priority=0, @subsystem=N'TSQL', 
		@command=N'EXEC PROC_UP_SMORD', 
		@database_name=N'master', 
		@flags=0
IF (@@ERROR <> 0 OR @ReturnCode <> 0) GOTO QuitWithRollback
EXEC @ReturnCode = msdb.dbo.sp_update_job @job_id = @jobId, @start_step_id = 1
IF (@@ERROR <> 0 OR @ReturnCode <> 0) GOTO QuitWithRollback
EXEC @ReturnCode = msdb.dbo.sp_add_jobschedule @job_id=@jobId, @name=N'EveryDateRun', 
		@enabled=1, 
		@freq_type=4, 
		@freq_interval=1, 
		@freq_subday_type=1, 
		@freq_subday_interval=0, 
		@freq_relative_interval=0, 
		@freq_recurrence_factor=0, 
		@active_start_date=20221210, 
		@active_end_date=99991231, 
		@active_start_time=0, 
		@active_end_time=235959, 
		@schedule_uid=N'ba34f2b2-625e-4661-a6cc-edc5378e1777'
IF (@@ERROR <> 0 OR @ReturnCode <> 0) GOTO QuitWithRollb


IF OBJECT_ID(N'[dbo].[ufn_SplitToTable]', N'TF') IS NOT NULL
BEGIN
    DROP FUNCTION [dbo].[ufn_SplitToTable];
END
GO

CREATE FUNCTION [dbo].[ufn_SplitToTable]
(
    @chvnKeyWords NVARCHAR(4000),        -- 要分隔的关键字字符串集
    @chvnSeparator NCHAR(1)                -- 要使用的分隔符，默认为'|'
) RETURNS @tblResult TABLE (
    Num INT IDENTITY(1, 1) NOT NULL,
    Word NVARCHAR(200) NOT NULL
)
AS
BEGIN
    -- 分隔符参数为NULL时则使用"|"
    SET @chvnSeparator = ISNULL(@chvnSeparator, N'|');
 
    DECLARE @intPos AS INT = 0;
    SET @intPos = CHARINDEX(@chvnSeparator, @chvnKeyWords);
 
    WHILE @intPos >= 1 /* @intPos > 0*/
    BEGIN
        IF @intPos >= 2 /*@intPos > 1*/
        BEGIN
            INSERT INTO @tblResult (Word)
            VALUES (LEFT(@chvnKeyWords, @intPos - 1));
        END
  
        SET @chvnKeyWords = STUFF(@chvnKeyWords, 1, @intPos, N'');
        SET @intPos = CHARINDEX(@chvnSeparator, @chvnKeyWords);
    END
 
    IF @chvnKeyWords > N''
    BEGIN
        INSERT INTO @tblResult (Word)
        VALUES(@chvnKeyWords);
    END
 
    RETURN;
END
GO




CREATE TRIGGER  [dbo].[TG_SMIRV_EMPTYTIME] ON [dbo].[SMIRV]
  AFTER UPDATE  
AS
	DECLARE @orinfo NVARCHAR(1024);
	DECLARE @ordno NVARCHAR(100);
	DECLARE @backlocation NVARCHAR(100);
	DECLARE @emptytime datetime;

	select @backlocation=BACK_LOCATION,@emptytime=EMPTY_TIME,@orinfo=ORD_INFO  from inserted;
	if update(BACK_LOCATION) or update(EMPTY_TIME) or update(ORD_INFO)
	begin 
	if @orinfo is not null
	begin
	declare updateorvdt cursor for select Word from dbo.ufn_SplitToTable(@orinfo,',')--查出需要循环的集合放到游标中
	open updateorvdt;--打开游标
	while 1=1
		begin--开始
			fetch next from updateorvdt into @ordno--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			update SMORD set BACK_LOCATION=@backlocation,EMPTY_TIME=@emptytime where ORD_NO=@ordno
		end--结束
		close updateorvdt--关闭游标
		deallocate updateorvdt--释放游标
	end
	end
GO


ALTER TRIGGER  [dbo].[TG_SMICNTR_TOSMI] ON [dbo].[SMICNTR]
  AFTER UPDATE  
AS
	DECLARE @shipmentid char(30);
	select @shipmentid=SHIPMENT_ID from deleted
	    if(@shipmentid is not null AND (update(DEC_CUST) or update(TC_DEC_CUST) or update(DEC_REPLY)or update(TC_DEC_REPLY)or update(TC_CER_NO)))
		BEGIN 
		UPDATE SMSMI SET DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),DEC_CUST) 
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),TC_DEC_CUST) 
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),DEC_REPLY =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),DEC_REPLY) 
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_DEC_REPLY =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),TC_DEC_REPLY) 
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_CER_NO =(
SELECT STUFF((SELECT DISTINCT ';' + CER_NO
                             FROM SMICNTR
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )) WHERE SHIPMENT_ID=@shipmentid AND TRAN_TYPE IN ('F','R')
							END;

GO




ALTER TRIGGER  [dbo].[TG_SMIDN_TOSMI] ON [dbo].[SMIDN]
  AFTER UPDATE  
AS
	DECLARE @shipmentid char(30);
	select @shipmentid=SHIPMENT_ID from deleted
	    if(@shipmentid is not null AND (update(DEC_CUST) or update(TC_DEC_CUST) or update(DEC_REPLY)or update(TC_DEC_REPLY)or update(TC_CER_NO)))
		BEGIN 
		UPDATE SMSMI SET DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),DEC_CUST) 
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_DEC_CUST =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),TC_DEC_CUST) 
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),DEC_REPLY =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),DEC_REPLY) 
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_DEC_REPLY =(
SELECT STUFF((SELECT DISTINCT ';' + convert(varchar(MAX),TC_DEC_REPLY) 
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )),TC_CER_NO =(
SELECT STUFF((SELECT DISTINCT ';' + CER_NO
                             FROM SMIDN
                             WHERE SHIPMENT_ID =@shipmentid
                             FOR xml path('')
                            ),1,1,''
                            )) WHERE SHIPMENT_ID=@shipmentid AND TRAN_TYPE NOT IN ('F','R')
							END;

GO


 ALTER TABLE SMSMI ADD Vessel5 NVARCHAR(30) NULL;
 ALTER TABLE SMSMI ADD Voyage5 NVARCHAR(12) NULL;
 ALTER TABLE SMSMI ADD POL_CD5 NVARCHAR(5) NULL;
 ALTER TABLE SMSMI ADD POD5 NVARCHAR(5) NULL;
 ALTER TABLE SMSMI ADD ETD5 DATE NULL;
 ALTER TABLE SMSMI ADD ETA5 DATE NULL;
 ALTER TABLE SMSMI ADD ATD5 DATE NULL;
 ALTER TABLE SMSMI ADD ATA5 DATE NULL;
 
 ALTER TABLE SMSMI ADD Vessel6 NVARCHAR(30) NULL;
 ALTER TABLE SMSMI ADD Voyage6 NVARCHAR(12) NULL;
 ALTER TABLE SMSMI ADD POL_CD6 NVARCHAR(5) NULL;
 ALTER TABLE SMSMI ADD POD6 NVARCHAR(5) NULL;
 ALTER TABLE SMSMI ADD ETD6 DATE NULL;
 ALTER TABLE SMSMI ADD ETA6 DATE NULL;
 ALTER TABLE SMSMI ADD ATD6 DATE NULL;
 ALTER TABLE SMSMI ADD ATA6 DATE NULL;
 
 ALTER TABLE SMSMI ADD Vessel7 NVARCHAR(30) NULL;
 ALTER TABLE SMSMI ADD Voyage7 NVARCHAR(12) NULL;
 ALTER TABLE SMSMI ADD POL_CD7 NVARCHAR(5) NULL;
 ALTER TABLE SMSMI ADD POD7 NVARCHAR(5) NULL;
 ALTER TABLE SMSMI ADD ETD7 DATE NULL;
 ALTER TABLE SMSMI ADD ETA7 DATE NULL;
 ALTER TABLE SMSMI ADD ATD7 DATE NULL;
 ALTER TABLE SMSMI ADD ATA7 DATE NULL;




 
 /***********begin by Lance 2022-12-19***********/
  ALTER TABLE SMORD ADD VERIFY_DATE DATETIME NULL;
/**********End by Lance 2022-12-19***********/
GO



 /***********Begin by Will 2022-11-28***********/
Alter Table SMIDN add ASN_NO NVARCHAR(50);
Alter Table SMIDN add ASN_DATE datetime;
ALTER TABLE SMIDNP ADD ASN_DATE DATETIME;
ALTER TABLE SMIDNP ADD GR_STATUS NVARCHAR(1);
ALTER TABLE SMIDN ADD SEND_ASN_STATUS NVARCHAR(1);


 create TRIGGER [dbo].[TG_SMSMI_TOSMIDN] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS
	DECLARE @shipmentid char(30);
	DECLARE @cmp_old char(30);
	select @shipmentid=SHIPMENT_ID, @cmp_old=CMP from deleted
	    if(@shipmentid is not null and @cmp_old in ('AVAIB','MN'))
		BEGIN 

		 if (UPDATE(ETA))  
    begin  
		declare @eta_new date
		declare @eta_old date


		SELECT @eta_new= ETA FROM INSERTED 
		select @eta_old= ETA,@cmp_old=CMP from deleted 
		if (@eta_new <> @eta_old)
		begin  
			UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !=''          
		end    
		end  

	End
GO



CREATE TRIGGER [dbo].[TG_SMORD_TOSMIDN] ON [dbo].[SMORD]
after update
as 
DECLARE @shipmentid char(30);
DECLARE @cntrno char(30);
DECLARE @cmp_old char(30);
select @shipmentid=SHIPMENT_ID,@cntrno=CNTR_NO, @cmp_old=CMP from deleted
 if(@shipmentid is not null and @cntrno is not null and @cmp_old in ('AVAIB','MN'))
 begin
  if (UPDATE(ETA))  
  begin
		 declare @deliverydate_new date
		declare @deliverydate_old date
		SELECT @deliverydate_new= DELIVERY_DATE FROM INSERTED 
		select @deliverydate_old= DELIVERY_DATE from deleted 
		if (@deliverydate_new <> @deliverydate_old )
		begin  
			UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,6,@deliverydate_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !=''        
		end    
  end

 end

 go


 CREATE NONCLUSTERED INDEX [INX_SMIDN_DNNO20221128] ON [dbo].[SMIDN]
(
	[DN_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO


  /***********End by Will 2022-11-28***********/

  /***********begin by Lance 2022-12-26***********/
ALTER TABLE SMQTI ADD CAL_DATE NVARCHAR(1) NULL;
ALTER TABLE SMQTI ADD EFFECT_DATE DATE NULL;
ALTER TABLE SMQTI ADD EXPIRAT_DATE DATE NULL;

UPDATE SMQTI SET CAL_DATE='A',EFFECT_DATE='2022-01-01',EXPIRAT_DATE='2023-12-31';
/**********End by Lance 2022-12-26***********/

/***********begin by Lance 2022-02-08***********/
DROP TRIGGER updateSMORD;
DROP PROCEDURE PROC_UP_SMORD;
EXEC msdb.dbo.sp_delete_job @job_id=N'72e9fe48-69e7-46ad-a635-147acd35147c', @delete_unused_schedule=1;

ALTER TABLE SMICNTR ADD STO_EXCEED_TIME INT;
ALTER TABLE SMICNTR ADD DEM_EXCEED_TIME INT;
ALTER TABLE SMICNTR ADD DET_EXCEED_TIME INT;

ALTER TABLE SMICNTR ADD STO_EST_FROM DATE;
ALTER TABLE SMICNTR ADD DEM_EST_FROM DATE;
ALTER TABLE SMICNTR ADD DET_EST_FROM DATE;

ALTER TABLE SMICNTR ADD STO_EST_TO DATE;
ALTER TABLE SMICNTR ADD DEM_EST_TO DATE;
ALTER TABLE SMICNTR ADD DET_EST_TO DATE;

ALTER TABLE SMICNTR ADD STO_EST_CUR NVARCHAR(3);
ALTER TABLE SMICNTR ADD DEM_EST_CUR NVARCHAR(3);
ALTER TABLE SMICNTR ADD DET_EST_CUR NVARCHAR(3);

ALTER TABLE SMICNTR ADD STO_EST_AMT NUMERIC(12,2);
ALTER TABLE SMICNTR ADD DEM_EST_AMT NUMERIC(12,2);
ALTER TABLE SMICNTR ADD DET_EST_AMT NUMERIC(12,2);

ALTER TABLE SMICNTR ADD STO_ACT_CUR NVARCHAR(3);
ALTER TABLE SMICNTR ADD DEM_ACT_CUR NVARCHAR(3);
ALTER TABLE SMICNTR ADD DET_ACT_CUR NVARCHAR(3);

ALTER TABLE SMICNTR ADD STO_ACT_AMT NUMERIC(12,2);
ALTER TABLE SMICNTR ADD DEM_ACT_AMT NUMERIC(12,2);
ALTER TABLE SMICNTR ADD DET_ACT_AMT NUMERIC(12,2);

ALTER TABLE SMORD ADD DEM_CUR_FORECAST NVARCHAR(3);
ALTER TABLE SMORD ADD STO_CUR_FORECAST NVARCHAR(3);
ALTER TABLE SMORD ADD DET_CUR_FORECAST NVARCHAR(3);

ALTER TABLE SMORD ADD DEM_AMT_FORECAST NUMERIC(18,2);
ALTER TABLE SMORD ADD STO_AMT_FORECAST NUMERIC(18,2);
ALTER TABLE SMORD ADD DET_AMT_FORECAST NUMERIC(18,2);

ALTER TABLE SMICNTR ADD DEM_CUR_FORECAST NVARCHAR(3);
ALTER TABLE SMICNTR ADD STO_CUR_FORECAST NVARCHAR(3);
ALTER TABLE SMICNTR ADD DET_CUR_FORECAST NVARCHAR(3);

ALTER TABLE SMICNTR ADD DEM_AMT_FORECAST NUMERIC(18,2);
ALTER TABLE SMICNTR ADD STO_AMT_FORECAST NUMERIC(18,2);
ALTER TABLE SMICNTR ADD DET_AMT_FORECAST NUMERIC(18,2);

ALTER TABLE SMORD ALTER COLUMN COMBINE_DET NVARCHAR(2);
ALTER TABLE SMSMI ALTER COLUMN COMBINE_DET NVARCHAR(2);


UPDATE SMORD SET COMBINE_DET='NN' WHERE COMBINE_DET='N';
UPDATE SMORD SET COMBINE_DET='UN' WHERE COMBINE_DET='U';
UPDATE SMORD SET COMBINE_DET='YY' WHERE COMBINE_DET='Y';

UPDATE SMSMI SET COMBINE_DET='NN' WHERE COMBINE_DET='N';
UPDATE SMSMI SET COMBINE_DET='UN' WHERE COMBINE_DET='U';
UPDATE SMSMI SET COMBINE_DET='YY' WHERE COMBINE_DET='Y';

CREATE TYPE [dbo].[QTI_DATATABLE] AS TABLE(
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[S_DAY] [int] NULL,
	[E_DAY] [int] NULL,
	[FEE_PER_DAY] [numeric](18, 2) NULL,
	[EFFECT_DATE] [date] NULL,
	[EXPIRAT_DATE] [date] NULL,
	[CAL_DATE] [nvarchar](1) NULL,
	[CUR] [nvarchar](3) NULL,
	[I_TYPE] [nvarchar](20) NULL,
	[CNT_TYPE] [nvarchar](10) NULL,
	[CARRIER_CD] [nvarchar](20) NULL,
	[TERMINAL_CD] [nvarchar](20) NULL,
	[CAL_TYPE] [nvarchar](1) NULL,
	[PERCENTAGE] [numeric](5, 2) NULL,
	[FOB_CIF] [nvarchar](1) NULL
)
GO


CREATE FUNCTION GET_FORECAST_FREE(@free_table QTI_DATATABLE READONLY,@fob_amt numeric(18,2),@cif_amt numeric(18,2),@date_diff INT)
RETURNS @free TABLE(AMT NUMERIC(18,2),CUR NVARCHAR(3))
AS
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @amt NUMERIC(18,2) = 0,@cur NVARCHAR(3),@fee_per_day NUMERIC(18,2),@s_day INT,@e_day INT,
	@cal_type NVARCHAR(1),@percentage NUMERIC(5,2),@fob_cif NVARCHAR(1)
	SELECT @Total = MAX(ID) FROM @free_table
		WHILE @Line <= @Total
		BEGIN
			SELECT @s_day=S_DAY,@e_day=E_DAY,@cur=CUR,@cal_type=CAL_TYPE,@fee_per_day=FEE_PER_DAY,@percentage=PERCENTAGE,@fob_cif=FOB_CIF FROM @free_table WHERE ID=@Line
			IF(@s_day <= @date_diff)
			BEGIN
				IF @percentage<=0
					SET @percentage = 100
				IF(@cal_type='C')
				BEGIN
					IF (@date_diff>@e_day)
						SET @fee_per_day= @fee_per_day * (@e_day-@s_day+1)
					IF (@date_diff<=@e_day)
						SET @fee_per_day= @fee_per_day * (@date_diff-@s_day+1)
				END
				SET @amt = @amt + @fee_per_day*@percentage/100
			END
			SET @Line = @Line + 1
		END
		IF(@fob_cif='F')
			SET @amt = @amt + @fob_amt
		IF(@fob_cif='C')
			SET @amt = @amt + @cif_amt
		IF(@fob_cif='B')
			SET @amt = @amt + @cif_amt + @fob_amt
		INSERT INTO @free values(@amt,@cur)
		RETURN
END
GO

CREATE FUNCTION [dbo].[GET_DET_FORECAST_FREE](
@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),
@tran_type nvarchar(10),@cnt_type nvarchar(10),@terminal_cd nvarchar(30),
@date_diff INT,
@fob_amt numeric(18,2),@cif_amt numeric(18,2),
@dep_date date,@arv_date date)
RETURNS @free TABLE(AMT NUMERIC(18,2),CUR NVARCHAR(3))
AS
BEGIN
	DECLARE @effect_date date,@expirat_date date
	DECLARE @Total INT,@Line INT = 1
	DECLARE @amt NUMERIC(18,2) = 0,@cur NVARCHAR(3),@fee_per_day NUMERIC(18,2),@s_day INT,@e_day INT,
	@cal_type NVARCHAR(1),@percentage NUMERIC(5,2),@fob_cif NVARCHAR(1)
	DECLARE @Table QTI_DATATABLE
	DECLARE @tmp_table QTI_DATATABLE
	INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF
	FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND TRAN_TYPE=@tran_type AND I_TYPE IN ('BOTH','DDET') AND (CNT_TYPE=@cnt_type OR CNT_TYPE IS NULL) 
	AND (CARRIER_CD=@carrier OR CARRIER_CD IS NULL) AND (TERMINAL_CD=@terminal_cd OR TERMINAL_CD IS NULL) AND FEE_PER_DAY>0
	SELECT @Total = MAX(ID) FROM @Table
	
	IF(@Total>0)
	BEGIN
		
		INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD=@carrier AND TERMINAL_CD=@terminal_cd
		SELECT @Total = MAX(ID) FROM @tmp_table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD=@carrier AND TERMINAL_CD IS NULL
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		DELETE FROM @Table
		INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @tmp_table WHERE CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
		SELECT @Total = MAX(ID) FROM @Table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @tmp_table WHERE CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
			SELECT @Total = MAX(ID) FROM @Table
		END
		SELECT @effect_date=EFFECT_DATE,@expirat_date=EXPIRAT_DATE FROM @Table WHERE ID=@Total

		DELETE FROM @tmp_table

		INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE EFFECT_DATE=@effect_date AND EXPIRAT_DATE=@expirat_date AND I_TYPE='BOTH' ORDER BY EFFECT_DATE ASC,S_DAY ASC
		SELECT @Total = MAX(ID) FROM @tmp_table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE EFFECT_DATE=@effect_date AND EXPIRAT_DATE=@expirat_date AND I_TYPE='DDET' ORDER BY EFFECT_DATE ASC,S_DAY ASC
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		INSERT INTO @free SELECT AMT,CUR FROM GET_FORECAST_FREE(@tmp_table,@fob_amt,@cif_amt,@date_diff)
	END
	RETURN
END
GO

CREATE FUNCTION [dbo].[GET_DEM_FORECAST_FREE](
@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),
@tran_type nvarchar(10),@cnt_type nvarchar(10),@terminal_cd nvarchar(30),
@date_diff INT,
@fob_amt numeric(18,2),@cif_amt numeric(18,2),
@dep_date date,@arv_date date)
RETURNS @free TABLE(AMT NUMERIC(18,2),CUR NVARCHAR(3))
AS
BEGIN
	DECLARE @effect_date date,@expirat_date date
	DECLARE @Total INT,@Line INT = 1
	DECLARE @amt NUMERIC(18,2) = 0,@cur NVARCHAR(3),@fee_per_day NUMERIC(18,2),@s_day INT,@e_day INT,
	@cal_type NVARCHAR(1),@percentage NUMERIC(5,2),@fob_cif NVARCHAR(1)
	DECLARE @Table QTI_DATATABLE
	DECLARE @tmp_table QTI_DATATABLE
	INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF
	FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND TRAN_TYPE=@tran_type AND I_TYPE IN ('BOTH','USAGE','DDEM') AND (CNT_TYPE=@cnt_type OR CNT_TYPE IS NULL) 
	AND (CARRIER_CD=@carrier OR CARRIER_CD IS NULL) AND (TERMINAL_CD=@terminal_cd OR TERMINAL_CD IS NULL) AND FEE_PER_DAY>0
	SELECT @Total = MAX(ID) FROM @Table
	
	IF(@Total>0)
	BEGIN
		
		INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD=@carrier AND TERMINAL_CD=@terminal_cd
		SELECT @Total = MAX(ID) FROM @tmp_table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD=@carrier AND TERMINAL_CD IS NULL
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		DELETE FROM @Table
		INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @tmp_table WHERE CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
		SELECT @Total = MAX(ID) FROM @Table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @tmp_table WHERE CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
			SELECT @Total = MAX(ID) FROM @Table
		END
		SELECT @effect_date=EFFECT_DATE,@expirat_date=EXPIRAT_DATE FROM @Table WHERE ID=@Total

		DELETE FROM @tmp_table

		INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE EFFECT_DATE=@effect_date AND EXPIRAT_DATE=@expirat_date AND I_TYPE='BOTH' ORDER BY EFFECT_DATE ASC,S_DAY ASC
		SELECT @Total = MAX(ID) FROM @tmp_table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE EFFECT_DATE=@effect_date AND EXPIRAT_DATE=@expirat_date AND I_TYPE='USAGE' ORDER BY EFFECT_DATE ASC,S_DAY ASC
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE EFFECT_DATE=@effect_date AND EXPIRAT_DATE=@expirat_date AND I_TYPE='DDEM' ORDER BY EFFECT_DATE ASC,S_DAY ASC
			SELECT @Total = MAX(ID) FROM @tmp_table
		END

		INSERT INTO @free SELECT AMT,CUR FROM GET_FORECAST_FREE(@tmp_table,@fob_amt,@cif_amt,@date_diff)
	END
	RETURN
END
GO

CREATE FUNCTION [dbo].[GET_STO_FORECAST_FREE](
@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),
@tran_type nvarchar(10),@cnt_type nvarchar(10),@terminal_cd nvarchar(30),
@date_diff INT,
@fob_amt numeric(18,2),@cif_amt numeric(18,2),
@dep_date date,@arv_date date)
RETURNS @free TABLE(AMT NUMERIC(18,2),CUR NVARCHAR(3))
AS
BEGIN
	DECLARE @effect_date date,@expirat_date date
	DECLARE @Total INT,@Line INT = 1
	DECLARE @amt NUMERIC(18,2) = 0,@cur NVARCHAR(3),@fee_per_day NUMERIC(18,2),@s_day INT,@e_day INT,
	@cal_type NVARCHAR(1),@percentage NUMERIC(5,2),@fob_cif NVARCHAR(1)
	DECLARE @Table QTI_DATATABLE
	DECLARE @tmp_table QTI_DATATABLE
	INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF
	FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DSTF') AND (CNT_TYPE=@cnt_type OR CNT_TYPE IS NULL) 
	AND (CARRIER_CD=@carrier OR CARRIER_CD IS NULL) AND (TERMINAL_CD=@terminal_cd OR TERMINAL_CD IS NULL) AND FEE_PER_DAY>0
	SELECT @Total = MAX(ID) FROM @Table
	
	IF(@Total>0)
	BEGIN
		
		INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD=@carrier AND TERMINAL_CD=@terminal_cd
		SELECT @Total = MAX(ID) FROM @tmp_table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD=@carrier AND TERMINAL_CD IS NULL
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE=@cnt_type AND CARRIER_CD IS NULL AND TERMINAL_CD IS NULL
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE CNT_TYPE IS NULL AND CARRIER_CD IS NULL AND TERMINAL_CD IS NULL
			SELECT @Total = MAX(ID) FROM @tmp_table
		END
		DELETE FROM @Table
		INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @tmp_table WHERE CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
		SELECT @Total = MAX(ID) FROM @Table
		IF(@Total<=0 OR @Total IS NULL)
		BEGIN
			INSERT INTO @Table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @tmp_table WHERE CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
			SELECT @Total = MAX(ID) FROM @Table
		END
		SELECT @effect_date=EFFECT_DATE,@expirat_date=EXPIRAT_DATE FROM @Table WHERE ID=@Total

		DELETE FROM @tmp_table

		INSERT INTO @tmp_table SELECT S_DAY,E_DAY,FEE_PER_DAY,EFFECT_DATE,EXPIRAT_DATE,CAL_DATE,CUR,I_TYPE,CNT_TYPE,CARRIER_CD,TERMINAL_CD,CAL_TYPE,PERCENTAGE,FOB_CIF FROM @Table WHERE EFFECT_DATE=@effect_date AND EXPIRAT_DATE=@expirat_date ORDER BY EFFECT_DATE ASC,S_DAY ASC
		
		INSERT INTO @free SELECT AMT,CUR FROM GET_FORECAST_FREE(@tmp_table,@fob_amt,@cif_amt,@date_diff)
	END
	RETURN
END
GO

CREATE FUNCTION [dbo].[GET_FREE_TIME]
(@dep_date date,@arv_date date,
@cmp nvarchar(10),
@pod_cd nvarchar(5),
@carrier nvarchar(20),
@tran_type nvarchar(10))
RETURNS @free TABLE(COMBINE_DET NVARCHAR(2),PORT_FREE_TIME INT,FACT_FREE_TIME INT,CON_FREE_TIME INT)
AS
BEGIN
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),E_DAY INT,I_TYPE NVARCHAR(20))
	DECLARE @Total INT,@Line INT = 1
	DECLARE @COMBINE_DET NVARCHAR(2),@PORT_FREE_TIME INT,@FACT_FREE_TIME INT,@CON_FREE_TIME INT,
	@iscombine_det NVARCHAR(2)
	INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDEM','BOTH','USAGE') AND FEE_PER_DAY=0 AND CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
	SELECT @Total = MAX(ID) FROM @Table
	set @COMBINE_DET= 'N'
	if(@Total<=0 OR @Total IS NULL)
	BEGIN
		INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDEM','BOTH','USAGE') AND FEE_PER_DAY=0 AND CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
		SELECT @Total = MAX(ID) FROM @Table
	END
	WHILE @Line <= @Total
	BEGIN
		SELECT @PORT_FREE_TIME=E_DAY,@COMBINE_DET=CASE WHEN I_TYPE='BOTH' THEN 'Y' WHEN I_TYPE='USAGE' THEN 'U' ELSE 'N' END FROM @Table WHERE ID= @Line
		SET @Line = @Line + 1
	END
	set @iscombine_det=@COMBINE_DET
	set @COMBINE_DET= 'N'
	SET @Line = 1
	INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDET','BOTH') AND FEE_PER_DAY=0 AND CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
	SELECT @Total = MAX(ID) FROM @Table
	if(@Total<=0 OR @Total IS NULL)
	BEGIN
		INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDET','BOTH') AND FEE_PER_DAY=0 AND CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
		SELECT @Total = MAX(ID) FROM @Table
	END
	WHILE @Line <= @Total
	BEGIN
		SELECT @CON_FREE_TIME=E_DAY,@COMBINE_DET=CASE WHEN I_TYPE='BOTH' THEN 'Y' ELSE 'N' END FROM @Table WHERE ID= @Line
		SET @Line = @Line + 1
	END
	set @iscombine_det=@iscombine_det+@COMBINE_DET
	SET @Line = 1
	INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DSTF') AND FEE_PER_DAY=0 AND CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
	SELECT @Total = MAX(ID) FROM @Table
	if(@Total<=0 OR @Total IS NULL)
	BEGIN
		INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DSTF') AND FEE_PER_DAY=0 AND CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
		SELECT @Total = MAX(ID) FROM @Table
	END
	WHILE @Line <= @Total
	BEGIN
		SELECT @FACT_FREE_TIME=E_DAY FROM @Table WHERE ID= @Line
		SET @Line = @Line + 1
	END

	INSERT INTO @free values(@iscombine_det,@PORT_FREE_TIME,@FACT_FREE_TIME,@CON_FREE_TIME)
	RETURN
END
GO

ALTER TRIGGER [dbo].[updateSmsmiEta]
   ON  [dbo].[SMSMI]
   AFTER INSERT,UPDATE
AS 
BEGIN
    DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),TRAN_TYPE NVARCHAR(1),CMP NVARCHAR(10),POD_CD NVARCHAR(5)
	,CARRIER NVARCHAR(20),ETA DATE,ARV_DATE DATE,DEP_DATE DATE)
	DECLARE @shipment_id NVARCHAR(20),
	        @cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),@tran_type nvarchar(10),
			@eta date,@arv_date date,@dep_date date,
			@combine_det nvarchar(2),
			@port_free_time int,
			@fact_free_time int,
			@sto_due_date date,
			@dem_due_date date
	DECLARE @Total INT,@Line INT = 1
	if (UPDATE(ETA))
	BEGIN
		INSERT INTO @Table SELECT SHIPMENT_ID,TRAN_TYPE,CMP,POD_CD,CARRIER,ETA,CASE WHEN ATA IS NULL THEN ETA ELSE ATA END,CASE WHEN ATD IS NULL THEN ETD ELSE ATD END FROM inserted
		SELECT @Total = MAX(ID) FROM @Table
        
		WHILE @Line <= @Total
		BEGIN
			SELECT @shipment_id=SHIPMENT_ID, @tran_type=TRAN_TYPE,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,@eta=ETA,@arv_date=ARV_DATE,@dep_date=DEP_DATE FROM @Table WHERE ID = @Line
			SET @Line = @Line + 1
			if (@tran_type NOT IN ('F','R') and @eta is null)
				continue;
			SELECT @combine_det= COMBINE_DET,@port_free_time=PORT_FREE_TIME,@port_free_time=PORT_FREE_TIME FROM GET_FREE_TIME(@dep_date,@arv_date,@cmp,@pod_cd,@carrier,@tran_type)
			if(@fact_free_time is not null)
				SET @sto_due_date = DATEADD(DAY,@fact_free_time,@eta)
			if(@port_free_time is not null)
				SET @dem_due_date = DATEADD(DAY,@port_free_time,@eta)

			UPDATE SMSMI SET FACT_FREE_TIME=@fact_free_time,PORT_FREE_TIME=@port_free_time,COMBINE_DET=@combine_det WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
			UPDATE SMORD SET STORAGE_DUE_DATE=@sto_due_date,FACT_FREE_TIME=@fact_free_time,PORT_FREE_TIME=@port_free_time,
			COMBINE_DET=@combine_det WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
			UPDATE SMICNTR SET STORAGE_DUE_DATE=@sto_due_date WHERE SHIPMENT_ID=@shipment_id AND DISCHARGE_DATE IS NULL
			UPDATE SMORD SET DEMURRAGE_DUE_DATE=@dem_due_date WHERE SHIPMENT_ID=@shipment_id AND ((EMP_PICK_DATE IS NULL AND @combine_det IN ('UN','UY')) OR (DISCHARGE_DATE IS NULL AND (@combine_det NOT IN ('UN','UY') OR @combine_det IS NULL) ))
			UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=@dem_due_date WHERE SHIPMENT_ID=@shipment_id AND ((EMP_PICK_DATE IS NULL AND @combine_det IN ('UN','UY')) OR (DISCHARGE_DATE IS NULL AND (@combine_det NOT IN ('UN','UY') OR @combine_det IS NULL) ))
			
		END
	END
END
GO


CREATE TRIGGER [dbo].[UP_SMICNTR_BY_DUE_DATE]
   ON  [dbo].[SMICNTR]
   AFTER INSERT,UPDATE
AS 
BEGIN
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),TRAN_TYPE NVARCHAR(1),PICKUP_CDATE DATE,
	EMPTY_TIME DATE,COMBINE_DET NVARCHAR(2),PORT_FREE_TIME INT,FACT_FREE_TIME INT, CON_FREE_TIME INT,
	DETENTION_DUE_DATE DATE,DEMURRAGE_DUE_DATE DATE,STORAGE_DUE_DATE DATE,CNT_TYPE NVARCHAR(10),CNTR_TYPE NVARCHAR(10),
	SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),STO_EXCEED_TIME INT,DEM_EXCEED_TIME INT, DET_EXCEED_TIME INT,
	CMP NVARCHAR(10),POD_CD NVARCHAR(5),CARRIER NVARCHAR(20),TERMINAL_CD NVARCHAR(30),FOB_AMT NUMERIC(18,2),CIF_AMT NUMERIC(18,2),ARV_DATE DATE,DEP_DATE DATE)
	DECLARE @tran_type nvarchar(1),@cnt_type nvarchar(10),@pick_cdate date,@empty_time date,
			@u_id nvarchar(50),@shipment_id nvarchar(20),@cntr_no nvarchar(20),@cmp nvarchar(10),
			@pod_cd nvarchar(10),@carrier nvarchar(20),@terminal_cd nvarchar(30),
			@fob_amt numeric(18,2),@cif_amt numeric(18,2),@dep_date date,@arv_date date,
			@storage_due_date date,@demurrage_due_date date,@detention_due_date date,
			@port_free_time int,@fact_free_time int,@con_free_time int,
			@combine_det nvarchar(2),@det_exceed_time INT,@dem_exceed_time INT,@sto_exceed_time INT,
			@dem_amt_forecast NUMERIC(18,2),@det_amt_forecast NUMERIC(18,2),@sto_amt_forecast NUMERIC(18,2),
			@dem_cur_forecast nvarchar(3),@det_cur_forecast nvarchar(3),@sto_cur_forecast nvarchar(3)
	DECLARE @Total INT,@Line INT = 1
    if(UPDATE(DETENTION_DUE_DATE) OR UPDATE(STORAGE_DUE_DATE) OR UPDATE(DEMURRAGE_DUE_DATE))
	BEGIN
		INSERT INTO @Table SELECT C.U_ID,I.TRAN_TYPE,C.PICKUP_CDATE,C.EMPTY_TIME,I.COMBINE_DET,I.PORT_FREE_TIME,I.FACT_FREE_TIME,I.CON_FREE_TIME,C.DETENTION_DUE_DATE,C.DEMURRAGE_DUE_DATE,C.STORAGE_DUE_DATE,
(SELECT TOP 1 CHG_CD FROM ECREFFEE WHERE CHG_DESCP=C.CNTR_TYPE AND (CMP='*' OR CMP=C.CMP)) AS CNT_TYPE,C.CNTR_TYPE,I.SHIPMENT_ID,C.CNTR_NO,
CASE WHEN C.STORAGE_DUE_DATE IS NULL THEN 0 WHEN C.PICKUP_CDATE IS NULL THEN DATEDIFF(DAY,C.STORAGE_DUE_DATE,GETDATE()) ELSE DATEDIFF(DAY,C.STORAGE_DUE_DATE,C.PICKUP_CDATE) END,
CASE WHEN C.DEMURRAGE_DUE_DATE IS NULL THEN 0 WHEN (C.PICKUP_CDATE IS NULL AND (I.COMBINE_DET ='NN' OR I.COMBINE_DET IS NULL)) OR (C.EMPTY_TIME IS NULL AND I.COMBINE_DET IN ('UY','UN','YY')) THEN DATEDIFF(DAY,C.DEMURRAGE_DUE_DATE,GETDATE()) WHEN I.COMBINE_DET='NN' OR I.COMBINE_DET IS NULL THEN DATEDIFF(DAY,C.DEMURRAGE_DUE_DATE,C.PICKUP_CDATE) ELSE DATEDIFF(DAY,C.DEMURRAGE_DUE_DATE,C.EMPTY_TIME) END,
CASE WHEN C.DETENTION_DUE_DATE IS NULL THEN 0 WHEN C.EMPTY_TIME IS NULL THEN DATEDIFF(DAY,C.DETENTION_DUE_DATE,GETDATE()) ELSE DATEDIFF(DAY,C.DETENTION_DUE_DATE,C.EMPTY_TIME) END,
I.CMP,I.POD_CD,I.CARRIER,I.TERMINAL_CD,ISNULL(C.FOB_AMT,0),ISNULL(C.CIF_AMT,0),CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END
		FROM inserted C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID
		SELECT @Total = MAX(ID) FROM @Table
        
		WHILE @Line <= @Total
		BEGIN
			select @u_id=U_ID, @tran_type=TRAN_TYPE,@pick_cdate=PICKUP_CDATE,@empty_time=EMPTY_TIME,
		@combine_det=COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME,
		@detention_due_date=DETENTION_DUE_DATE,@cnt_type=CASE WHEN CNT_TYPE IS NULL THEN CNTR_TYPE ELSE CNT_TYPE END,
		@demurrage_due_date=DEMURRAGE_DUE_DATE,@storage_due_date=STORAGE_DUE_DATE,@det_exceed_time=DET_EXCEED_TIME,
		@dem_exceed_time=DEM_EXCEED_TIME,@sto_exceed_time=STO_EXCEED_TIME,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,
		@terminal_cd=TERMINAL_CD,@fob_amt=FOB_AMT,@cif_amt=CIF_AMT,@dep_date=DEP_DATE,@arv_date=ARV_DATE,@cntr_no=CNTR_NO,
		@fact_free_time=FACT_FREE_TIME,@port_free_time=PORT_FREE_TIME,@con_free_time=CON_FREE_TIME,@shipment_id=SHIPMENT_ID from @Table WHERE ID = @Line
			if (@tran_type IN ('F','R'))
			BEGIN
				DECLARE @det_from date=null,@det_to date=null,
				@dem_from date=null,@dem_to date=null,
				@sto_from date=null,@sto_to date=null
				if(@sto_exceed_time>0)
				BEGIN
					SET @sto_from = dateadd(day,1,@storage_due_date)
					SET @sto_to = @pick_cdate
					if(@sto_to is null)
						SET @sto_to = GETDATE()
					SELECT @sto_amt_forecast=AMT,@sto_cur_forecast=CUR FROM GET_STO_FORECAST_FREE(@cmp,@pod_cd,@carrier,@tran_type,@cnt_type,@terminal_cd,@sto_exceed_time+@fact_free_time,@fob_amt,@cif_amt,@dep_date,@arv_date)
				END
				if(@dem_exceed_time>0)
				BEGIN
					SET @dem_from = dateadd(day,1,@demurrage_due_date)
					SET @dem_to = @pick_cdate
					if(@combine_det IN ('UY','UN','YY'))
					    SET @dem_to = @empty_time
					if(@dem_to is null)
						SET @dem_to = GETDATE()
					SELECT @dem_amt_forecast=AMT,@dem_cur_forecast=CUR FROM GET_DEM_FORECAST_FREE(@cmp,@pod_cd,@carrier,@tran_type,@cnt_type,@terminal_cd,@dem_exceed_time+@port_free_time,@fob_amt,@cif_amt,@dep_date,@arv_date)
				END

				if(@det_exceed_time>0)
				BEGIN
					SET @det_from = dateadd(day,1,@detention_due_date)
					SET @det_to = @empty_time
					if(@det_to is null)
						SET @det_to = GETDATE()
					SELECT @det_amt_forecast=AMT,@det_cur_forecast=CUR FROM GET_DET_FORECAST_FREE(@cmp,@pod_cd,@carrier,@tran_type,@cnt_type,@terminal_cd,@det_exceed_time+@con_free_time,@fob_amt,@cif_amt,@dep_date,@arv_date)
				END

				if (UPDATE(STORAGE_DUE_DATE) OR UPDATE(DEMURRAGE_DUE_DATE) OR UPDATE(DETENTION_DUE_DATE))
				BEGIN
					UPDATE SMICNTR SET STO_EXCEED_TIME=@sto_exceed_time,STO_EST_FROM=@sto_from,STO_EST_TO=@sto_to,
					DEM_EXCEED_TIME=@dem_exceed_time,DEM_EST_FROM=@dem_from,DEM_EST_TO=@dem_to,
					DET_EXCEED_TIME=@det_exceed_time,DET_EST_FROM=@det_from,DET_EST_TO=@det_to,
					DET_AMT_FORECAST=@det_amt_forecast,DET_CUR_FORECAST=@det_cur_forecast,
					DEM_AMT_FORECAST=@dem_amt_forecast,DEM_CUR_FORECAST=@dem_cur_forecast,
					STO_AMT_FORECAST=@sto_amt_forecast,STO_CUR_FORECAST=@sto_cur_forecast WHERE U_ID = @u_id
					UPDATE SMORD SET STO_EXCEED_TIME=@sto_exceed_time,STO_EST_FROM=@sto_from,STO_EST_TO=@sto_to,
					DEM_EXCEED_TIME=@dem_exceed_time,DEM_EST_FROM=@dem_from,DEM_EST_TO=@dem_to,
					DET_EXCEED_TIME=@det_exceed_time,DET_EST_FROM=@det_from,DET_EST_TO=@det_to,
					DET_AMT_FORECAST=@det_amt_forecast,DET_CUR_FORECAST=@det_cur_forecast,
					DEM_AMT_FORECAST=@dem_amt_forecast,DEM_CUR_FORECAST=@dem_cur_forecast,
					STO_AMT_FORECAST=@sto_amt_forecast,STO_CUR_FORECAST=@sto_cur_forecast WHERE SHIPMENT_ID = @shipment_id AND CNTR_NO=@cntr_no
				END
			END
			SET @Line = @Line + 1
		END
	END
END
GO

CREATE TRIGGER [dbo].[UP_SMICNTR_BY_END_DATE]
   ON  [dbo].[SMICNTR]
   AFTER INSERT,UPDATE
AS 
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @u_id nvarchar(50),@shipment_id nvarchar(20),@cntr_no nvarchar(20),@combine_det nvarchar(2),@port_free_time int,
	@fact_free_time int,@con_free_time int
	DECLARE @dem_due_date date,@det_due_date date,@sto_due_date date
	DECLARE @dep_date date,@arv_date date,@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),@tran_type nvarchar(10),
			@eta date,@discharge_date date,@emp_pick_date date,@pickup_cdate date
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),
	PICKUP_CDATE DATE,EMPTY_TIME DATE,TRAN_TYPE NVARCHAR(10),CMP NVARCHAR(10),
	POD_CD NVARCHAR(5),CARRIER NVARCHAR(20),ETA DATE,DISCHARGE_DATE DATE,EMP_PICK_DATE DATE,ARV_DATE DATE,DEP_DATE DATE)
	if(UPDATE(EMPTY_TIME) OR UPDATE(PICKUP_CDATE))
	BEGIN
		INSERT INTO @Table SELECT  C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM inserted C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID

		SELECT @Total = MAX(ID) FROM @Table        
		WHILE @Line <= @Total
		BEGIN
			SELECT @u_id=U_ID,@shipment_id=SHIPMENT_ID,@cntr_no=CNTR_NO,@tran_type=TRAN_TYPE,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,
			@arv_date=ARV_DATE,@dep_date=DEP_DATE,
			@eta=ETA,@discharge_date=DISCHARGE_DATE,@emp_pick_date=EMP_PICK_DATE,@pickup_cdate=PICKUP_CDATE FROM @Table WHERE ID = @Line
			if (@tran_type IN ('F','R'))
			BEGIN
				SELECT @combine_det= COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME FROM GET_FREE_TIME(@dep_date,@arv_date,@cmp,@pod_cd,@carrier,@tran_type)
				SET @sto_due_date=NULL
				IF (@fact_free_time>0)
				BEGIN
					IF @eta IS NOT NULL
						SET @sto_due_date=dateadd(day,@fact_free_time,@eta)
					IF @discharge_date IS NOT NULL
						SET @sto_due_date=dateadd(day,@fact_free_time,@discharge_date)
				END

				SET @dem_due_date=NULL
				IF (@port_free_time>0)
				BEGIN
					IF @eta IS NOT NULL
						SET @dem_due_date=dateadd(day,@port_free_time,@eta)
					IF @emp_pick_date IS NOT NULL AND @combine_det IN ('UY','UN')
						SET @dem_due_date=dateadd(day,@port_free_time,@emp_pick_date)
					IF (@discharge_date IS NOT NULL and (@combine_det NOT IN ('UY','UN') or @combine_det is null))
						SET @dem_due_date=dateadd(day,@port_free_time,@discharge_date)
				END

				SET @det_due_date=NULL
				IF (@con_free_time>0)
				BEGIN
					IF @combine_det IN ('YY','UY') AND @discharge_date IS NOT NULL
						SET @det_due_date=dateadd(day,@con_free_time,@discharge_date)
					IF (@combine_det NOT IN ('YY','UY') OR @combine_det IS NULL) AND @pickup_cdate IS NOT NULL
						SET @det_due_date=dateadd(day,@con_free_time,@pickup_cdate)
				END

				UPDATE SMORD SET COMBINE_DET=@combine_det,PORT_FREE_TIME=@port_free_time,FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time,
				DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE SHIPMENT_ID=@shipment_id AND CNTR_NO=@cntr_no
				UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE U_ID=@u_id
			END
			SET @Line = @Line + 1
		END
	END
END
GO

CREATE PROC [dbo].[PROC_UP_SMICNTR]
AS
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @u_id nvarchar(50),@shipment_id nvarchar(20),@cntr_no nvarchar(20),@combine_det nvarchar(2),
	@port_free_time int,@fact_free_time int,@con_free_time int
	DECLARE @dem_due_date date,@det_due_date date,@sto_due_date date
	DECLARE @dep_date date,@arv_date date,@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),@tran_type nvarchar(10),
			@eta date,@discharge_date date,@emp_pick_date date,@pickup_cdate date
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),PICKUP_CDATE DATE,
	EMPTY_TIME DATE,TRAN_TYPE NVARCHAR(10),CMP NVARCHAR(10),
	POD_CD NVARCHAR(5),CARRIER NVARCHAR(20),ETA DATE,DISCHARGE_DATE DATE,EMP_PICK_DATE DATE,ARV_DATE DATE,DEP_DATE DATE)

	INSERT INTO @Table SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND (I.ETA IS NOT NULL OR C.EMP_PICK_DATE IS NOT NULL) AND C.EMPTY_TIME IS NULL AND COMBINE_DET IN ('UN','UY') AND I.ETA>'2022-01-01'
UNION SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND (I.ETA IS NOT NULL OR C.DISCHARGE_DATE IS NOT NULL)  AND C.PICKUP_CDATE IS NULL AND (I.COMBINE_DET NOT IN ('UN','UY') OR I.COMBINE_DET IS NULL) AND I.ETA>'2022-01-01'
UNION SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND ((I.DISCHARGE_DATE IS NOT NULL AND I.COMBINE_DET IN ('UY','YY')) OR ( C.PICKUP_CDATE IS NOT NULL AND (I.COMBINE_DET NOT IN ('UY','YY') OR I.COMBINE_DET IS NULL))) AND C.EMPTY_TIME IS NULL AND I.ETA>'2022-01-01'
UNION SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND (I.ETA IS NOT NULL OR C.DISCHARGE_DATE IS NOT NULL) AND C.PICKUP_CDATE IS NULL AND I.ETA>'2022-01-01'

	SELECT @Total = MAX(ID) FROM @Table        
	WHILE @Line <= @Total
	BEGIN
		SELECT @u_id=U_ID,@shipment_id=SHIPMENT_ID,@cntr_no=CNTR_NO,@tran_type=TRAN_TYPE,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,@arv_date=ARV_DATE,@dep_date=DEP_DATE,
		@eta=ETA,@discharge_date=DISCHARGE_DATE,@emp_pick_date=EMP_PICK_DATE,@pickup_cdate=PICKUP_CDATE FROM @Table WHERE ID = @Line

		SELECT @combine_det= COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME FROM GET_FREE_TIME(@dep_date,@arv_date,@cmp,@pod_cd,@carrier,@tran_type)
		SET @sto_due_date=NULL
		IF (@fact_free_time>0)
		BEGIN
			IF @eta IS NOT NULL
				SET @sto_due_date=dateadd(day,@fact_free_time,@eta)
			IF @discharge_date IS NOT NULL
				SET @sto_due_date=dateadd(day,@fact_free_time,@discharge_date)
		END

		SET @dem_due_date=NULL
		IF (@port_free_time>0)
		BEGIN
			IF @eta IS NOT NULL
				SET @dem_due_date=dateadd(day,@port_free_time,@eta)
			IF @emp_pick_date IS NOT NULL AND @combine_det IN ('UY','UN')
				SET @dem_due_date=dateadd(day,@port_free_time,@emp_pick_date)
			IF (@discharge_date IS NOT NULL and (@combine_det NOT IN ('UY','UN') or @combine_det is null))
				SET @dem_due_date=dateadd(day,@port_free_time,@discharge_date)
		END

		SET @det_due_date=NULL
		IF (@con_free_time>0)
		BEGIN
			IF @combine_det IN ('YY','UY') AND @discharge_date IS NOT NULL
				SET @det_due_date=dateadd(day,@con_free_time,@discharge_date)
			IF (@combine_det NOT IN ('YY','UY') OR @combine_det IS NULL) AND @pickup_cdate IS NOT NULL
				SET @det_due_date=dateadd(day,@con_free_time,@pickup_cdate)
		END
		PRINT(@shipment_id)
		UPDATE SMORD SET COMBINE_DET=@combine_det,PORT_FREE_TIME=@port_free_time,FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time,
		DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE SHIPMENT_ID=@shipment_id AND CNTR_NO=@cntr_no
		UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE U_ID=@u_id
		SET @Line = @Line + 1
	END
END

GO

SET DATEFIRST 1;
DECLARE @last_year_last_date DATE,@this_year_last_date DATE
SELECT @last_year_last_date=dateadd(ms,-3,DATEADD(yy, DATEDIFF(yy,0,getdate()), 0)),@this_year_last_date=dateadd(ms,-3,DATEADD(yy, DATEDIFF(yy,0,getdate())+1, 0))
SELECT CNTR_NO,CASE WHEN CNT20>0 THEN '20GP' WHEN CNT40>0 THEN '40GP' WHEN CNT40HQ>0 THEN '40HQ' WHEN CNT_NUMBER>0 THEN CNT_TYPE ELSE NULL END AS CNT_TYPE,MASTER_NO,CARRIER,
CASE TRAN_TYPE when 'F' then 'FCL' when 'R' then 'Railway' ELSE TRAN_TYPE END AS TRAN_TYPE,SMSMI.CMP AS IB_CMP,
CASE STATUS WHEN 'A' THEN 'Unreach' WHEN 'B' THEN 'Notify LSP' WHEN 'C' THEN 'Notify Broker' WHEN 'D' THEN 'Broker Confirm' WHEN 'E' THEN 'E-Alert' WHEN 'F' THEN 'Release' WHEN 'G' THEN 'Gate In' 
WHEN 'H' THEN 'Notify Transit Broker' WHEN 'I' THEN 'Transit Confirm' WHEN 'P' THEN 'POD' WHEN 'X' THEN 'Cancel' ELSE STATUS END AS STATUS,SMSMI.SHIPMENT_ID,Combine_Info,INVOICE_INFO,
SMSMI.FC_NM AS CUST_NAME,POL_CD,POL_NAME,POD_CD,POD_NAME,ETD,datename(ISO_WEEK,ETD) AS ETD_WEEK,ETA,datename(ISO_WEEK,ETA) AS ETA_WEEK,ATD,ATA,
Emp_Pick_Date,SMICNTR.Discharge_Date,SMICNTR.PICKUP_CDATE,SMICNTR.EMPTY_TIME,SMICNTR.BACK_LOCATION,Fact_Free_Time,
Port_Free_Time,CON_FREE_TIME,STORAGE_DUE_DATE,DEMURRAGE_DUE_DATE,DETENTION_DUE_DATE,STO_EXCEED_TIME,DEM_EXCEED_TIME,
DET_EXCEED_TIME,STO_EST_FROM,STO_EST_TO,STO_CUR_FORECAST,STO_AMT_FORECAST,STO_ACT_CUR,STO_ACT_AMT,
DEM_EST_FROM,DEM_EST_TO,DEM_CUR_FORECAST,DEM_AMT_FORECAST,DEM_ACT_CUR,DEM_ACT_AMT,
DET_EST_FROM,DET_EST_TO,DET_CUR_FORECAST,DET_AMT_FORECAST,DET_ACT_CUR,DET_ACT_AMT FROM SMICNTR LEFT JOIN SMSMI ON SMICNTR.SHIPMENT_ID=SMSMI.SHIPMENT_ID WHERE SMSMI.CMP='PL' AND TRAN_TYPE IN ('F','R') AND
((datename(YEAR,ETA) = case when datename(ISO_WEEK,GETDATE())-8<1 then datename(YEAR,GETDATE())-1 else datename(YEAR,GETDATE()) end AND 
datename(ISO_WEEK,ETA)>case when datename(ISO_WEEK,GETDATE())-8<1 then datename(ISO_WEEK,@last_year_last_date)-8+datename(ISO_WEEK,GETDATE()) else datename(ISO_WEEK,GETDATE())-8 END) OR
(datename(YEAR,ETA) = case when datename(ISO_WEEK,GETDATE())+4>datename(ISO_WEEK,@this_year_last_date) then 
datename(YEAR,GETDATE())+1 else datename(YEAR,GETDATE()) end AND datename(ISO_WEEK,ETA)< case when datename(ISO_WEEK,GETDATE())+4>datename(ISO_WEEK,@this_year_last_date) THEN
datename(ISO_WEEK,GETDATE())+4-datename(ISO_WEEK,@this_year_last_date) ELSE datename(ISO_WEEK,GETDATE())+4 END))
/**********End by Lance 2022-02-08***********/


ALTER TABLE SMSMI ADD EALERT_DATE DATETIME
ALTER TABLE SMSMI ADD EALERT_DATE_L DATETIME

ALTER TABLE SMSMI ADD INBOUND_DATE DATETIME
ALTER TABLE SMSMI ADD INBOUND_DATE_L DATETIME

ALTER TABLE SMSM ADD EALERT_DATE DATETIME
ALTER TABLE SMSM ADD EALERT_DATE_L DATETIME

ALTER TABLE SMSM ADD INBOUND_DATE DATETIME
ALTER TABLE SMSM ADD INBOUND_DATE_L DATETIME




ALTER TABLE SMORD ADD SHOW_COMBINE_DET NVARCHAR(1);
ALTER TABLE SMSMI ADD SHOW_COMBINE_DET NVARCHAR(1);

CREATE FUNCTION [dbo].[GET_DUE_DATE]
(@fact_free_time int,@port_free_time int,@con_free_time int,
@eta date,@discharge_date date,@emp_pick_date date,@pickup_cdate date,@combine_det nvarchar(2))
RETURNS @due_date TABLE(DEMURRAGE_DUE_DATE DATE,DETENTION_DUE_DATE DATE,STORAGE_DUE_DATE DATE)
BEGIN
	DECLARE @sto_due_date date,@dem_due_date date,@det_due_date date
	SET @sto_due_date=NULL
	IF (@fact_free_time>0)
	BEGIN
		IF @eta IS NOT NULL
			SET @sto_due_date=dateadd(day,@fact_free_time,@eta)
		IF @discharge_date IS NOT NULL
			SET @sto_due_date=dateadd(day,@fact_free_time,@discharge_date)
	END
	
	SET @dem_due_date=NULL
	IF (@port_free_time>0)
	BEGIN
		IF @eta IS NOT NULL
			SET @dem_due_date=dateadd(day,@port_free_time,@eta)
		IF @emp_pick_date IS NOT NULL AND @combine_det IN ('UY','UN')
			SET @dem_due_date=dateadd(day,@port_free_time,@emp_pick_date)
		IF (@discharge_date IS NOT NULL and (@combine_det NOT IN ('UY','UN') or @combine_det is null))
			SET @dem_due_date=dateadd(day,@port_free_time,@discharge_date)
	END
	
	SET @det_due_date=NULL
	IF (@con_free_time>0)
	BEGIN
		IF @combine_det IN ('YY','UY') AND @eta IS NOT NULL
			SET @det_due_date=dateadd(day,@con_free_time,@eta)
		IF @combine_det IN ('YY','UY') AND @discharge_date IS NOT NULL
			SET @det_due_date=dateadd(day,@con_free_time,@discharge_date)
		IF (@combine_det NOT IN ('YY','UY') OR @combine_det IS NULL) AND @pickup_cdate IS NOT NULL
			SET @det_due_date=dateadd(day,@con_free_time,@pickup_cdate)
	END
	INSERT INTO @due_date values(@dem_due_date,@det_due_date,@sto_due_date)
	RETURN
END


ALTER PROC [dbo].[PROC_UP_SMICNTR]
AS
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @u_id nvarchar(50),@shipment_id nvarchar(20),@cntr_no nvarchar(20),@combine_det nvarchar(2),@showcombine_det nvarchar(1),
	@port_free_time int,@fact_free_time int,@con_free_time int
	DECLARE @dem_due_date date,@det_due_date date,@sto_due_date date
	DECLARE @dep_date date,@arv_date date,@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),@tran_type nvarchar(10),
			@eta date,@discharge_date date,@emp_pick_date date,@pickup_cdate date
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),PICKUP_CDATE DATE,
	EMPTY_TIME DATE,TRAN_TYPE NVARCHAR(10),CMP NVARCHAR(10),
	POD_CD NVARCHAR(5),CARRIER NVARCHAR(20),ETA DATE,DISCHARGE_DATE DATE,EMP_PICK_DATE DATE,ARV_DATE DATE,DEP_DATE DATE)

	INSERT INTO @Table SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND (I.ETA IS NOT NULL OR C.EMP_PICK_DATE IS NOT NULL) AND C.EMPTY_TIME IS NULL AND COMBINE_DET IN ('UN','UY') AND I.ETA>'2022-01-01'
UNION SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND (I.ETA IS NOT NULL OR C.DISCHARGE_DATE IS NOT NULL)  AND C.PICKUP_CDATE IS NULL AND (I.COMBINE_DET NOT IN ('UN','UY') OR I.COMBINE_DET IS NULL) AND I.ETA>'2022-01-01'
UNION SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND ((I.DISCHARGE_DATE IS NOT NULL AND I.COMBINE_DET IN ('UY','YY')) OR ( C.PICKUP_CDATE IS NOT NULL AND (I.COMBINE_DET NOT IN ('UY','YY') OR I.COMBINE_DET IS NULL))) AND C.EMPTY_TIME IS NULL AND I.ETA>'2022-01-01'
UNION SELECT C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM SMICNTR C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID WHERE I.TRAN_TYPE IN ('F','R') AND (I.ETA IS NOT NULL OR C.DISCHARGE_DATE IS NOT NULL) AND C.PICKUP_CDATE IS NULL AND I.ETA>'2022-01-01'

	SELECT @Total = MAX(ID) FROM @Table        
	WHILE @Line <= @Total
	BEGIN
		SELECT @u_id=U_ID,@shipment_id=SHIPMENT_ID,@cntr_no=CNTR_NO,@tran_type=TRAN_TYPE,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,@arv_date=ARV_DATE,@dep_date=DEP_DATE,
		@eta=ETA,@discharge_date=DISCHARGE_DATE,@emp_pick_date=EMP_PICK_DATE,@pickup_cdate=PICKUP_CDATE FROM @Table WHERE ID = @Line

		SELECT @combine_det= COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME,@showcombine_det=SHOW_COMBINE_DET FROM GET_FREE_TIME(@dep_date,@arv_date,@cmp,@pod_cd,@carrier,@tran_type)
		
		select @sto_due_date=STORAGE_DUE_DATE,@dem_due_date=DEMURRAGE_DUE_DATE,@det_due_date=DETENTION_DUE_DATE from GET_DUE_DATE(@fact_free_time,@port_free_time,@con_free_time,@eta,@discharge_date,@emp_pick_date,@pickup_cdate,@combine_det)
		
		UPDATE SMORD SET COMBINE_DET=@combine_det,SHOW_COMBINE_DET=@showcombine_det,PORT_FREE_TIME=@port_free_time,FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time,
		DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE SHIPMENT_ID=@shipment_id AND CNTR_NO=@cntr_no
		UPDATE SMSMI SET COMBINE_DET=@combine_det,SHOW_COMBINE_DET=@showcombine_det,PORT_FREE_TIME=@port_free_time,FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time WHERE SHIPMENT_ID=@shipment_id
		UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE U_ID=@u_id
		SET @Line = @Line + 1
	END
END


ALTER TRIGGER [dbo].[UP_SMICNTR_BY_DUE_DATE]
   ON  [dbo].[SMICNTR]
   AFTER INSERT,UPDATE
AS 
BEGIN
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),TRAN_TYPE NVARCHAR(1),PICKUP_CDATE DATE,
	EMPTY_TIME DATE,COMBINE_DET NVARCHAR(2),PORT_FREE_TIME INT,FACT_FREE_TIME INT, CON_FREE_TIME INT,
	DETENTION_DUE_DATE DATE,DEMURRAGE_DUE_DATE DATE,STORAGE_DUE_DATE DATE,CNT_TYPE NVARCHAR(10),CNTR_TYPE NVARCHAR(10),
	SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),STO_EXCEED_TIME INT,DEM_EXCEED_TIME INT, DET_EXCEED_TIME INT,
	CMP NVARCHAR(10),POD_CD NVARCHAR(5),CARRIER NVARCHAR(20),TERMINAL_CD NVARCHAR(30),FOB_AMT NUMERIC(18,2),CIF_AMT NUMERIC(18,2),ARV_DATE DATE,DEP_DATE DATE)
	DECLARE @tran_type nvarchar(1),@cnt_type nvarchar(10),@pick_cdate date,@empty_time date,
			@u_id nvarchar(50),@shipment_id nvarchar(20),@cntr_no nvarchar(20),@cmp nvarchar(10),
			@pod_cd nvarchar(10),@carrier nvarchar(20),@terminal_cd nvarchar(30),
			@fob_amt numeric(18,2),@cif_amt numeric(18,2),@dep_date date,@arv_date date,
			@storage_due_date date,@demurrage_due_date date,@detention_due_date date,
			@port_free_time int,@fact_free_time int,@con_free_time int,
			@combine_det nvarchar(2),@det_exceed_time INT,@dem_exceed_time INT,@sto_exceed_time INT,
			@dem_amt_forecast NUMERIC(18,2),@det_amt_forecast NUMERIC(18,2),@sto_amt_forecast NUMERIC(18,2),
			@dem_cur_forecast nvarchar(3),@det_cur_forecast nvarchar(3),@sto_cur_forecast nvarchar(3)
	DECLARE @Total INT,@Line INT = 1
    if(UPDATE(DETENTION_DUE_DATE) OR UPDATE(STORAGE_DUE_DATE) OR UPDATE(DEMURRAGE_DUE_DATE))
	BEGIN
		INSERT INTO @Table SELECT C.U_ID,I.TRAN_TYPE,C.PICKUP_CDATE,C.EMPTY_TIME,I.COMBINE_DET,I.PORT_FREE_TIME,I.FACT_FREE_TIME,I.CON_FREE_TIME,C.DETENTION_DUE_DATE,C.DEMURRAGE_DUE_DATE,C.STORAGE_DUE_DATE,
(SELECT TOP 1 CHG_CD FROM ECREFFEE WHERE CHG_DESCP=C.CNTR_TYPE AND (CMP='*' OR CMP=C.CMP)) AS CNT_TYPE,C.CNTR_TYPE,I.SHIPMENT_ID,C.CNTR_NO,
CASE WHEN C.STORAGE_DUE_DATE IS NULL THEN NULL WHEN C.PICKUP_CDATE IS NULL THEN DATEDIFF(DAY,C.STORAGE_DUE_DATE,GETDATE()) ELSE DATEDIFF(DAY,C.STORAGE_DUE_DATE,C.PICKUP_CDATE) END,
CASE WHEN C.DEMURRAGE_DUE_DATE IS NULL THEN NULL WHEN (C.PICKUP_CDATE IS NULL AND (I.COMBINE_DET ='NN' OR I.COMBINE_DET IS NULL)) OR (C.EMPTY_TIME IS NULL AND I.COMBINE_DET IN ('UY','UN','YY')) THEN DATEDIFF(DAY,C.DEMURRAGE_DUE_DATE,GETDATE()) WHEN I.COMBINE_DET='NN' OR I.COMBINE_DET IS NULL THEN DATEDIFF(DAY,C.DEMURRAGE_DUE_DATE,C.PICKUP_CDATE) ELSE DATEDIFF(DAY,C.DEMURRAGE_DUE_DATE,C.EMPTY_TIME) END AS DEM_EXCEED_TIME,
CASE WHEN C.DETENTION_DUE_DATE IS NULL THEN NULL WHEN C.EMPTY_TIME IS NULL THEN DATEDIFF(DAY,C.DETENTION_DUE_DATE,GETDATE()) ELSE DATEDIFF(DAY,C.DETENTION_DUE_DATE,C.EMPTY_TIME) END,
I.CMP,I.POD_CD,I.CARRIER,I.TERMINAL_CD,ISNULL(C.FOB_AMT,0),ISNULL(C.CIF_AMT,0),CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END
		FROM inserted C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID
		SELECT @Total = MAX(ID) FROM @Table
        
		WHILE @Line <= @Total
		BEGIN
			select @u_id=U_ID, @tran_type=TRAN_TYPE,@pick_cdate=PICKUP_CDATE,@empty_time=EMPTY_TIME,
		@combine_det=COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME,
		@detention_due_date=DETENTION_DUE_DATE,@cnt_type=CASE WHEN CNT_TYPE IS NULL THEN CNTR_TYPE ELSE CNT_TYPE END,
		@demurrage_due_date=DEMURRAGE_DUE_DATE,@storage_due_date=STORAGE_DUE_DATE,@det_exceed_time=DET_EXCEED_TIME,
		@dem_exceed_time=DEM_EXCEED_TIME,@sto_exceed_time=STO_EXCEED_TIME,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,
		@terminal_cd=TERMINAL_CD,@fob_amt=FOB_AMT,@cif_amt=CIF_AMT,@dep_date=DEP_DATE,@arv_date=ARV_DATE,@cntr_no=CNTR_NO,
		@fact_free_time=FACT_FREE_TIME,@port_free_time=PORT_FREE_TIME,@con_free_time=CON_FREE_TIME,@shipment_id=SHIPMENT_ID from @Table WHERE ID = @Line
			if (@tran_type IN ('F','R'))
			BEGIN
				DECLARE @det_from date=null,@det_to date=null,
				@dem_from date=null,@dem_to date=null,
				@sto_from date=null,@sto_to date=null
				if(@sto_exceed_time>0)
				BEGIN
					SET @sto_from = dateadd(day,1,@storage_due_date)
					SET @sto_to = @pick_cdate
					if(@sto_to is null)
						SET @sto_to = GETDATE()
					SELECT @sto_amt_forecast=AMT,@sto_cur_forecast=CUR FROM GET_STO_FORECAST_FREE(@cmp,@pod_cd,@carrier,@tran_type,@cnt_type,@terminal_cd,@sto_exceed_time+@fact_free_time,@fob_amt,@cif_amt,@dep_date,@arv_date)
				END
				if(@dem_exceed_time>0)
				BEGIN
					SET @dem_from = dateadd(day,1,@demurrage_due_date)
					SET @dem_to = @pick_cdate
					if(@combine_det IN ('UY','UN','YY'))
					    SET @dem_to = @empty_time
					if(@dem_to is null)
						SET @dem_to = GETDATE()
					SELECT @dem_amt_forecast=AMT,@dem_cur_forecast=CUR FROM GET_DEM_FORECAST_FREE(@cmp,@pod_cd,@carrier,@tran_type,@cnt_type,@terminal_cd,@dem_exceed_time+@port_free_time,@fob_amt,@cif_amt,@dep_date,@arv_date)
				END

				if(@det_exceed_time>0)
				BEGIN
					SET @det_from = dateadd(day,1,@detention_due_date)
					SET @det_to = @empty_time
					if(@det_to is null)
						SET @det_to = GETDATE()
					SELECT @det_amt_forecast=AMT,@det_cur_forecast=CUR FROM GET_DET_FORECAST_FREE(@cmp,@pod_cd,@carrier,@tran_type,@cnt_type,@terminal_cd,@det_exceed_time+@con_free_time,@fob_amt,@cif_amt,@dep_date,@arv_date)
				END

				if (UPDATE(STORAGE_DUE_DATE) OR UPDATE(DEMURRAGE_DUE_DATE) OR UPDATE(DETENTION_DUE_DATE))
				BEGIN
					UPDATE SMICNTR SET STO_EXCEED_TIME=@sto_exceed_time,STO_EST_FROM=@sto_from,STO_EST_TO=@sto_to,
					DEM_EXCEED_TIME=@dem_exceed_time,DEM_EST_FROM=@dem_from,DEM_EST_TO=@dem_to,
					DET_EXCEED_TIME=@det_exceed_time,DET_EST_FROM=@det_from,DET_EST_TO=@det_to,
					DET_AMT_FORECAST=@det_amt_forecast,DET_CUR_FORECAST=@det_cur_forecast,
					DEM_AMT_FORECAST=@dem_amt_forecast,DEM_CUR_FORECAST=@dem_cur_forecast,
					STO_AMT_FORECAST=@sto_amt_forecast,STO_CUR_FORECAST=@sto_cur_forecast WHERE U_ID = @u_id
					UPDATE SMORD SET STO_EXCEED_TIME=@sto_exceed_time,STO_EST_FROM=@sto_from,STO_EST_TO=@sto_to,
					DEM_EXCEED_TIME=@dem_exceed_time,DEM_EST_FROM=@dem_from,DEM_EST_TO=@dem_to,
					DET_EXCEED_TIME=@det_exceed_time,DET_EST_FROM=@det_from,DET_EST_TO=@det_to,
					DET_AMT_FORECAST=@det_amt_forecast,DET_CUR_FORECAST=@det_cur_forecast,
					DEM_AMT_FORECAST=@dem_amt_forecast,DEM_CUR_FORECAST=@dem_cur_forecast,
					STO_AMT_FORECAST=@sto_amt_forecast,STO_CUR_FORECAST=@sto_cur_forecast WHERE SHIPMENT_ID = @shipment_id AND CNTR_NO=@cntr_no
				END
			END
			SET @Line = @Line + 1
		END
	END
END
GO


ALTER TRIGGER [dbo].[UP_SMICNTR_BY_END_DATE]
   ON  [dbo].[SMICNTR]
   AFTER INSERT,UPDATE
AS 
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @u_id nvarchar(50),@shipment_id nvarchar(20),@cntr_no nvarchar(20),@combine_det nvarchar(2),@showcombine_det nvarchar(1),@port_free_time int,
	@fact_free_time int,@con_free_time int
	DECLARE @dem_due_date date,@det_due_date date,@sto_due_date date
	DECLARE @dep_date date,@arv_date date,@cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),@tran_type nvarchar(10),
			@eta date,@discharge_date date,@emp_pick_date date,@pickup_cdate date
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),
	PICKUP_CDATE DATE,EMPTY_TIME DATE,TRAN_TYPE NVARCHAR(10),CMP NVARCHAR(10),
	POD_CD NVARCHAR(5),CARRIER NVARCHAR(20),ETA DATE,DISCHARGE_DATE DATE,EMP_PICK_DATE DATE,ARV_DATE DATE,DEP_DATE DATE)
	if(UPDATE(EMPTY_TIME) OR UPDATE(PICKUP_CDATE) OR  UPDATE(DISCHARGE_DATE))
	BEGIN
		INSERT INTO @Table SELECT  C.U_ID,I.SHIPMENT_ID,C.CNTR_NO,C.PICKUP_CDATE,C.EMPTY_TIME,I.TRAN_TYPE,I.CMP,I.POD_CD,I.CARRIER,I.ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,
CASE WHEN I.ATA IS NULL THEN I.ETA ELSE I.ATA END,CASE WHEN I.ATD IS NULL THEN I.ETD ELSE I.ATD END 
FROM inserted C LEFT JOIN SMSMI I ON C.SHIPMENT_ID=I.SHIPMENT_ID

		SELECT @Total = MAX(ID) FROM @Table        
		WHILE @Line <= @Total
		BEGIN
			SELECT @u_id=U_ID,@shipment_id=SHIPMENT_ID,@cntr_no=CNTR_NO,@tran_type=TRAN_TYPE,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,
			@arv_date=ARV_DATE,@dep_date=DEP_DATE,
			@eta=ETA,@discharge_date=DISCHARGE_DATE,@emp_pick_date=EMP_PICK_DATE,@pickup_cdate=PICKUP_CDATE FROM @Table WHERE ID = @Line
			if (@tran_type IN ('F','R'))
			BEGIN
				SELECT @combine_det= COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME,@showcombine_det=SHOW_COMBINE_DET FROM GET_FREE_TIME(@dep_date,@arv_date,@cmp,@pod_cd,@carrier,@tran_type)
				
				select @sto_due_date=STORAGE_DUE_DATE,@dem_due_date=DEMURRAGE_DUE_DATE,@det_due_date=DETENTION_DUE_DATE from GET_DUE_DATE(@fact_free_time,@port_free_time,@con_free_time,@eta,@discharge_date,@emp_pick_date,@pickup_cdate,@combine_det)
				
				UPDATE SMORD SET COMBINE_DET=@combine_det,SHOW_COMBINE_DET=@showcombine_det,PORT_FREE_TIME=@port_free_time,
				FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time,
				DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE SHIPMENT_ID=@shipment_id AND CNTR_NO=@cntr_no
				UPDATE SMSMI SET COMBINE_DET=@combine_det,SHOW_COMBINE_DET=@showcombine_det,PORT_FREE_TIME=@port_free_time,
				FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time WHERE SHIPMENT_ID=@shipment_id
				UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE U_ID=@u_id
			END
			SET @Line = @Line + 1
		END
	END
END
GO


ALTER TRIGGER [dbo].[updateSmsmiEta]
   ON  [dbo].[SMSMI]
   AFTER INSERT,UPDATE
AS 
BEGIN
    DECLARE @Table TABLE(ID INT IDENTITY(1,1),U_ID NVARCHAR(50),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(20),TRAN_TYPE NVARCHAR(1),CMP NVARCHAR(10),POD_CD NVARCHAR(5)
	,CARRIER NVARCHAR(20),ETA DATE,DISCHARGE_DATE DATE,EMP_PICK_DATE DATE,PICKUP_CDATE DATE,ARV_DATE DATE,DEP_DATE DATE)
	DECLARE @shipment_id NVARCHAR(20),@cntr_no NVARCHAR(20),@u_id nvarchar(50),
	        @cmp nvarchar(10),@pod_cd nvarchar(5),@carrier nvarchar(20),@tran_type nvarchar(10),
			@eta date,@arv_date date,@dep_date date,
			@combine_det nvarchar(2),@showcombine_det nvarchar(1),
			@port_free_time int,@fact_free_time int,@con_free_time int,
			@sto_due_date date,@dem_due_date date,@det_due_date date,
			@discharge_date date,@emp_pick_date date,@pickup_cdate date
	DECLARE @Total INT,@Line INT = 1
	if (UPDATE(ETA))
	BEGIN
		INSERT INTO @Table SELECT C.U_ID,I.SHIPMENT_ID,CNTR_NO,TRAN_TYPE,I.CMP,POD_CD,CARRIER,ETA,C.DISCHARGE_DATE,C.EMP_PICK_DATE,C.PICKUP_CDATE,
		CASE WHEN ATA IS NULL THEN ETA ELSE ATA END,CASE WHEN ATD IS NULL THEN ETD ELSE ATD END FROM inserted I LEFT JOIN SMICNTR C ON I.SHIPMENT_ID=C.SHIPMENT_ID
		SELECT @Total = MAX(ID) FROM @Table
        
		WHILE @Line <= @Total
		BEGIN
			SELECT @u_id=U_ID,@shipment_id=SHIPMENT_ID,@cntr_no=CNTR_NO, @tran_type=TRAN_TYPE,@cmp=CMP,@pod_cd=POD_CD,@carrier=CARRIER,@eta=ETA,
			@discharge_date=DISCHARGE_DATE,@emp_pick_date=EMP_PICK_DATE,@pickup_cdate=PICKUP_CDATE,@arv_date=ARV_DATE,
			@dep_date=DEP_DATE FROM @Table WHERE ID = @Line
			SET @Line = @Line + 1
			if (@tran_type IN ('F','R'))
			BEGIN
				SELECT @combine_det= COMBINE_DET,@port_free_time=PORT_FREE_TIME,@fact_free_time=FACT_FREE_TIME,@con_free_time=CON_FREE_TIME,@showcombine_det=SHOW_COMBINE_DET FROM GET_FREE_TIME(@dep_date,@arv_date,@cmp,@pod_cd,@carrier,@tran_type)
					
				select @sto_due_date=STORAGE_DUE_DATE,@dem_due_date=DEMURRAGE_DUE_DATE,@det_due_date=DETENTION_DUE_DATE from GET_DUE_DATE(@fact_free_time,@port_free_time,@con_free_time,@eta,@discharge_date,@emp_pick_date,@pickup_cdate,@combine_det)

				UPDATE SMORD SET COMBINE_DET=@combine_det,SHOW_COMBINE_DET=@showcombine_det,PORT_FREE_TIME=@port_free_time,
				FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time,
				DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE SHIPMENT_ID=@shipment_id AND CNTR_NO=@cntr_no
				UPDATE SMSMI SET COMBINE_DET=@combine_det,SHOW_COMBINE_DET=@showcombine_det,PORT_FREE_TIME=@port_free_time,
				FACT_FREE_TIME=@fact_free_time,CON_FREE_TIME=@con_free_time WHERE SHIPMENT_ID=@shipment_id
				UPDATE SMICNTR SET DEMURRAGE_DUE_DATE=@dem_due_date,DETENTION_DUE_DATE=@det_due_date,STORAGE_DUE_DATE=@sto_due_date WHERE U_ID=@u_id
			END
		END
	END
END
GO

ALTER FUNCTION [dbo].[GET_FREE_TIME]
(@dep_date date,@arv_date date,
@cmp nvarchar(10),
@pod_cd nvarchar(5),
@carrier nvarchar(20),
@tran_type nvarchar(10))
RETURNS @free TABLE(COMBINE_DET NVARCHAR(2),PORT_FREE_TIME INT,FACT_FREE_TIME INT,CON_FREE_TIME INT,SHOW_COMBINE_DET NVARCHAR(1))
AS
BEGIN
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),E_DAY INT,I_TYPE NVARCHAR(20))
	DECLARE @Total INT,@Line INT = 1
	DECLARE @COMBINE_DET NVARCHAR(2),@PORT_FREE_TIME INT,@FACT_FREE_TIME INT,@CON_FREE_TIME INT,
	@iscombine_det NVARCHAR(2),
	@showcombine_det NVARCHAR(1)
	INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDEM','BOTH','USAGE') AND FEE_PER_DAY=0 AND CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
	SELECT @Total = MAX(ID) FROM @Table
	set @COMBINE_DET= 'N'
	if(@Total<=0 OR @Total IS NULL)
	BEGIN
		INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDEM','BOTH','USAGE') AND FEE_PER_DAY=0 AND CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
		SELECT @Total = MAX(ID) FROM @Table
	END
	WHILE @Line <= @Total
	BEGIN
		SELECT @PORT_FREE_TIME=E_DAY,@COMBINE_DET=CASE WHEN I_TYPE='BOTH' THEN 'Y' WHEN I_TYPE='USAGE' THEN 'U' ELSE 'N' END FROM @Table WHERE ID= @Line
		SET @Line = @Line + 1
	END
	set @iscombine_det=@COMBINE_DET
	set @COMBINE_DET= 'N'
	SET @Line = 1
	DELETE FROM @Table
	INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDET','BOTH') AND FEE_PER_DAY=0 AND CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
	SELECT @Total = MAX(ID) FROM @Table
	if(@Total<=0 OR @Total IS NULL)
	BEGIN
		INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DDET','BOTH') AND FEE_PER_DAY=0 AND CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
		SELECT @Total = MAX(ID) FROM @Table
	END
	WHILE @Line <= @Total
	BEGIN
		SELECT @CON_FREE_TIME=E_DAY,@COMBINE_DET=CASE WHEN I_TYPE='BOTH' THEN 'Y' ELSE 'N' END FROM @Table WHERE ID= @Line
		SET @Line = @Line + 1
	END
	if(@CON_FREE_TIME>0)
	BEGIN
		set @showcombine_det=@COMBINE_DET
	END
	set @iscombine_det=@iscombine_det+@COMBINE_DET
	SET @Line = 1
	DELETE FROM @Table
	INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DSTF') AND FEE_PER_DAY=0 AND CAL_DATE='A' AND EFFECT_DATE<=@arv_date and EXPIRAT_DATE>=@arv_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
	SELECT @Total = MAX(ID) FROM @Table
	if(@Total<=0 OR @Total IS NULL)
	BEGIN
		INSERT INTO @Table SELECT E_DAY,I_TYPE FROM SMQTI WHERE CMP=@cmp AND POD_CD=@pod_cd AND CARRIER_CD=@carrier AND TRAN_TYPE=@tran_type AND I_TYPE IN ('DSTF') AND FEE_PER_DAY=0 AND CAL_DATE='D' AND EFFECT_DATE<=@dep_date and EXPIRAT_DATE>=@dep_date ORDER BY EFFECT_DATE ASC,EXPIRAT_DATE ASC,I_TYPE DESC
		SELECT @Total = MAX(ID) FROM @Table
	END
	WHILE @Line <= @Total
	BEGIN
		SELECT @FACT_FREE_TIME=E_DAY FROM @Table WHERE ID= @Line
		SET @Line = @Line + 1
	END
	
	if(@showcombine_det = 'Y')
	BEGIN
		set @PORT_FREE_TIME=NULL
	END
	INSERT INTO @free values(@iscombine_det,@PORT_FREE_TIME,@FACT_FREE_TIME,@CON_FREE_TIME,@showcombine_det)
	RETURN
END

Alter Table SMORD add DEM_DEBIT_NO nvarchar(30);
Alter Table SMORD add DEM_APPROVE_TO nvarchar(30);
Alter Table SMORD add DEM_APPROVE_TIME DateTime;
Alter Table SMORD add DET_DEBIT_NO nvarchar(30);
Alter Table SMORD add DET_APPROVE_TO nvarchar(30);
Alter Table SMORD add DET_APPROVE_TIME DateTime;
ALTER TABLE SMORD ADD WS_RMK nvarchar(500);

EXEC sp_rename 'SMORD.[DEBIT_NO]', 'STO_DEBIT_NO', 'COLUMN'
EXEC sp_rename 'SMORD.[APPROVE_TO]', 'STO_APPROVE_TO', 'COLUMN'
EXEC sp_rename 'SMORD.[VERIFY_DATE]', 'STO_APPROVE_TIME', 'COLUMN'



ALTER TABLE SMIDN ADD AMOUNT NUMERIC(18, 2)

ALTER TABLE SMORD ADD LSP_NO NVARCHAR(20);
ALTER TABLE SMORD ADD LSP_NM NVARCHAR(70);

ALTER TABLE SMQTI ADD LSP_NO NVARCHAR(20);
ALTER TABLE SMQTI ADD LSP_NM NVARCHAR(70);
ALTER TABLE SMQTI ALTER COLUMN CNT_TYPE NVARCHAR (20)
ALTER TABLE SMQTI ADD CNT_DESCP NVARCHAR (200)
ALTER TABLE SMQTI ADD REF_NO NVARCHAR (50)
UPDATE SMQTI SET CNT_DESCP = '20GP' WHERE CNT_TYPE='F4'
UPDATE SMQTI SET CNT_DESCP = '40GP' WHERE CNT_TYPE='F5'
UPDATE SMQTI SET CNT_DESCP = '40HQ' WHERE CNT_TYPE='F6'

INSERT INTO SMQTI(U_ID,GROUP_ID,CMP,STN,DEP,POD_CD,I_TYPE,CARRIER_CD,CNT_TYPE,S_DAY,E_DAY,FEE_PER_DAY,CUR,EMPTY_RETURN,CAL_TYPE,PERCENTAGE,FOB_CIF,ORDER_SEQ,TRAN_TYPE,
MODIFY_DATE,MODIFY_BY,CAL_DATE,EFFECT_DATE,EXPIRAT_DATE,LSP_NO,LSP_NM,CNT_DESCP,REF_NO,FROM_CMP) SELECT NEWID(),GROUP_ID,'TP',STN,DEP,POD_CD,I_TYPE,CARRIER_CD,CNT_TYPE,S_DAY,E_DAY,FEE_PER_DAY,CUR,EMPTY_RETURN,CAL_TYPE,PERCENTAGE,FOB_CIF,ORDER_SEQ,TRAN_TYPE,
MODIFY_DATE,MODIFY_BY,CAL_DATE,EFFECT_DATE,EXPIRAT_DATE,LSP_NO,LSP_NM,CNT_DESCP,U_ID,CMP FROM SMQTI WHERE CMP='TP' AND POD_CD='TWKEL' AND TRAN_TYPE='F' AND TERMINAL_CD IS NULL


ALTER TRIGGER [dbo].[TG_SMORD_TOSMIDN] ON [dbo].[SMORD]
AFTER UPDATE
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(50), CMP NVARCHAR(10),DELIVERY_DATE date)
	DECLARE @shipmentid char(30);
	DECLARE @cntrno char(30);
	DECLARE @cmp_old char(30);
	DECLARE @deliverydate_old date;

    IF UPDATE(DELIVERY_DATE)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cntrno,@cmp_old,@deliverydate_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cntrno is not null and @cmp_old in ('AVAIB','MN'))
				begin
					declare @deliverydate_new date
					SELECT @deliverydate_new= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid
					if (((@deliverydate_old is null and @deliverydate_new is not null) or @deliverydate_new <> @deliverydate_old) and @cmp_old ='AVAIB')
						begin  
							UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
				SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' AND SMIDNP.CNTR_NO=@cntrno ) ;
							UPDATE SMIDNP SET ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID =@shipmentid AND CNTR_NO=@cntrno;
							UPDATE SMSMI SET ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID =@shipmentid;
						end  
					if (((@deliverydate_old is null and @deliverydate_new is not null) or @deliverydate_new <> @deliverydate_old) and @cmp_old ='MN')
						begin  
							UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
				SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' AND SMIDNP.CNTR_NO=@cntrno ) AND EXISTS(SELECT 1 FROM SMSMI WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND datediff(dd,dbo.WorkDayADD(ASN_DATE,3),@deliverydate_new)>=0) ;
						end  
				end  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
    END

GO



ALTER TRIGGER [dbo].[TG_SMSMI_TOSMIDN] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CMP NVARCHAR(10),ETA date)
	DECLARE @shipmentid char(30);
	DECLARE @cmp_old char(30);
	declare @eta_old date;

    IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CMP,ETA from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CMP,ETA from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cmp_old,@eta_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cmp_old in ('AVAIB','MN'))
				 begin  
					declare @eta_new date
					SELECT @eta_new= ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old ='AVAIB')
					begin  
						UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
			SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' );
						UPDATE SMIDNP SET ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !='';
						UPDATE SMSMI SET ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted);
					end 

				end  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
    END
GO

 /****************Begin by Lance 2023-07-10 ***********/
CREATE TABLE [dbo].[GR_MAP](
	[GROUP_ID] [nvarchar](10) NOT NULL,
	[MODEL_NO] [nvarchar](20) NULL,
	[ASN_NO] [nvarchar](20) NULL,
	[GR_DATE] [datetime] NULL,
	[GR_QTY] [int] NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_DATE] [datetime] NULL
) ON [PRIMARY]
GO

ALTER TABLE ASN_MAP ADD [MODIFY_DATE][datetime]

INSERT INTO GR_MAP(ASN_NO,MODEL_NO,GROUP_ID,GR_DATE,GR_QTY,CREATE_DATE) 
SELECT ASN_NO,MODEL_NO,GROUP_ID,
(SELECT TOP 1 GR_DATE FROM ASN_MAP A WHERE T.ASN_NO=A.ASN_NO AND T.MODEL_NO=A.MODEL_NO ORDER BY CREATE_DATE DESC) AS GR_DATE,
(SELECT TOP 1 GR_QTY FROM ASN_MAP A WHERE T.ASN_NO=A.ASN_NO AND T.MODEL_NO=A.MODEL_NO ORDER BY CREATE_DATE DESC) AS GR_QTY,
(SELECT TOP 1 GR_DATE FROM ASN_MAP A WHERE T.ASN_NO=A.ASN_NO AND T.MODEL_NO=A.MODEL_NO ORDER BY CREATE_DATE DESC) AS CREATE_DATE 
FROM (SELECT DISTINCT ASN_NO,MODEL_NO,GROUP_ID FROM ASN_MAP WHERE GR_DATE IS NOT NULL) T

if object_id('tempdb..#ASN_DATA20230709') is not null
    begin
        drop table #ASN_DATA20230709
    end
	SELECT NEWID() AS U_ID,*,(SELECT TOP 1 CREATE_DATE FROM ASN_MAP A WHERE T.CNTR_NO=A.CNTR_NO AND T.ASN_NO=A.ASN_NO AND T.ASN_DATE=A.ASN_DATE ORDER BY CREATE_DATE DESC) AS CREATE_DATE INTO #ASN_DATA20230709 FROM (SELECT DISTINCT CNTR_NO,ASN_NO,ASN_DATE FROM ASN_MAP) T

	INSERT INTO ASN_MAP(U_ID,CNTR_NO,ASN_NO,ASN_DATE,CREATE_DATE,GROUP_ID) SELECT U_ID,CNTR_NO,ASN_NO,ASN_DATE,CREATE_DATE,'TPV' FROM #ASN_DATA20230709

	if object_id('tempdb..#ASN_DATA20230709') is not null
    begin
        drop table #ASN_DATA20230709
    end


	UPDATE ASN_MAP SET GR_DATE=ASN_DATE WHERE ASN_NO IN (SELECT DISTINCT ASN_NO FROM SMIDNP WHERE ASN_NO IN (SELECT DISTINCT A.ASN_NO FROM
ASN_MAP A LEFT JOIN GR_MAP G ON A.ASN_NO=G.ASN_NO WHERE G.GR_DATE IS NULL) AND GR_DATE IS NOT NULL)

DELETE FROM ASN_MAP WHERE MODEL_NO IS NOT NULL
 /****************end by Lance 2023-07-10 ***********/
CREATE TYPE [dbo].[SMI_DATATABLE] AS TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20))

ALTER TABLE SMSMI ADD ASN_DATEINFO NVARCHAR(3000);

UPDATE SMSMI SET ASN_DATEINFO=CONVERT(nvarchar(10),ASN_DATE,23)

EXEC sp_rename 'dbo.SMSMI.ASN_DATE', 'ASN_DATETIME', 'COLUMN';
EXEC sp_rename 'dbo.SMSMI.ASN_DATEINFO', 'ASN_DATE', 'COLUMN';

UPDATE SYS_LAYOUT SET LAYOUT= REPLACE(cast(LAYOUT as nvarchar(max)),'AsnDate','AsnDateTime') FROM SYS_LAYOUT WHERE LAYOUT_TYPE='GRID'AND LAYOUT LIKE'%ASNDATE%'

ALTER TRIGGER [dbo].[TG_SMORD_TOSMIDN] ON [dbo].[SMORD]
AFTER UPDATE
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(50), CMP NVARCHAR(10),DELIVERY_DATE date);
	DECLARE @ShiDt SMI_DATATABLE;
	DECLARE @shipmentid char(30);
	DECLARE @cntrno char(30);
	DECLARE @cmp_old char(30);
	DECLARE @deliverydate_old date;
	

    IF UPDATE(DELIVERY_DATE)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cntrno,@cmp_old,@deliverydate_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cntrno is not null and @cmp_old='AVAIB')
				begin
					declare @deliverydate_new date
					DECLARE @count int;
					SELECT @deliverydate_new= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid
					if (((@deliverydate_old is null and @deliverydate_new is not null) or @deliverydate_new <> @deliverydate_old))
						begin  
							select @count=COUNT(1) from smidnp where SHIPMENT_ID=@shipmentid AND CNTR_NO=@cntrno AND ASN_NO IS NOT NULL AND ASN_NO!='';
							
							if(@count>0)
							begin
							UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
				SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' AND SMIDNP.CNTR_NO=@cntrno ) ;
							UPDATE SMIDNP SET ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID =@shipmentid AND CNTR_NO=@cntrno AND ASN_NO IS NOT NULL AND ASN_NO!='';
							Set @count = 0
							SELECT @count=ID FROM @ShiDt WHERE SHIPMENT_ID=@shipmentid
							
							IF(@count<=0 OR @count IS NULL)
							BEGIN
								INSERT INTO @ShiDt VALUES (@shipmentid)
							END
							end
						end  
				end
			if(@shipmentid is not null and @cmp_old='MN')
			begin
				declare @deliverydatenew date
				SELECT @deliverydatenew= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid

				if (((@deliverydate_old is null and @deliverydatenew is not null) or @deliverydatenew <> @deliverydate_old))
				begin  
							UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
				SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='') AND EXISTS(SELECT 1 FROM SMSMI WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND ASN_DATE IS NOT NULL AND (datediff(dd,dbo.WorkDayADD(ASN_DATE,-3),@deliverydatenew)<=0 or datediff(dd,dbo.WorkDayADD(ASN_DATE,3),@deliverydatenew)>=0)) ;
				end   
			end 
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt;
    END

GO

ALTER TRIGGER [dbo].[TG_SMSMI_TOSMIDN] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CMP NVARCHAR(10),ETA date)
	DECLARE @shipmentid char(30);
	DECLARE @cmp_old char(30);
	declare @eta_old date;
	DECLARE @ShiDt SMI_DATATABLE;

    IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CMP,ETA from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CMP,ETA from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cmp_old,@eta_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cmp_old in ('AVAIB','MN'))
				 begin  
					declare @eta_new date
					DECLARE @count int;
					SELECT @eta_new= ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old ='AVAIB')
					begin 
						select @count=COUNT(1) from smidnp where SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO!='';
						if(@count>0)
						BEGIN
						UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
			SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' );
						UPDATE SMIDNP SET ASN_DATE = DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !='';
						INSERT INTO @ShiDt SELECT DISTINCT SHIPMENT_ID FROM inserted
						END
					end 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old='MN')
					begin 
						UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
			SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' ) AND EXISTS(SELECT 1 FROM SMSMI WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND ASN_DATE IS NOT NULL  AND (datediff(dd,dbo.WorkDayADD(ASN_DATE,3),DATEADD(DAY,6,ETA))>=0 or datediff(dd,dbo.WorkDayADD(ASN_DATE,-3),DATEADD(DAY,6,ETA))<=0))
			AND EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE =''));
					end   
				end  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt
    END
GO

CREATE PROC [dbo].[SET_ASN_INFO](@ShiDt SMI_DATATABLE READONLY)
AS
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @PTotal INT,@PLine INT = 1
	DECLARE @shipmentid NVARCHAR(20)
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),INV_NO NVARCHAR(40),ASN_NO NVARCHAR(50),ASN_DATE DATETIME);
	SELECT @Total = MAX(ID) FROM @ShiDt
	WHILE @Line <= @Total
	BEGIN
		SELECT @shipmentid=SHIPMENT_ID FROM @ShiDt WHERE ID=@Line
		DELETE FROM @Table
		INSERT INTO @Table SELECT INV_NO,(SELECT TOP 1 ASN_NO FROM SMIDNP WHERE INV_NO=T.INV_NO AND SHIPMENT_ID=T.SHIPMENT_ID AND  (CATEGORY!='TANN' OR CATEGORY IS NULL)) AS ASN_NO, 
(SELECT TOP 1 ASN_DATE FROM SMIDNP WHERE INV_NO=T.INV_NO AND SHIPMENT_ID=T.SHIPMENT_ID AND (CATEGORY!='TANN' OR CATEGORY IS NULL)) AS ASN_DATE FROM 
(SELECT DISTINCT INV_NO,SHIPMENT_ID FROM SMIDNP P WHERE P.SHIPMENT_ID=@shipmentid AND (CATEGORY!='TANN' OR CATEGORY IS NULL) GROUP BY INV_NO,SHIPMENT_ID) T
		SELECT @PTotal = MAX(ID) FROM @Table
		IF(@PTotal>0)
		BEGIN
			UPDATE SMSMI SET ASNNO_INFO=stuff((SELECT ','+ISNULL(ASN_NO,'') FROM @Table ORDER BY ID ASC FOR XML PATH('')),1,1,''),
			ASN_DATE=stuff((SELECT ','+ISNULL(CONVERT(nvarchar(10),ASN_DATE,23),'') FROM @Table ORDER BY ID ASC FOR XML PATH('')),1,1,''),
			INVOICE_INFO=stuff((SELECT ','+INV_NO FROM @Table ORDER BY ID ASC FOR XML PATH('')),1,1,'') WHERE SHIPMENT_ID=@shipmentid
		END
		SET @Line = @Line + 1
	END
END

ALTER TABLE SMBIM ADD APPLY_BY NVARCHAR(40)
ALTER TABLE SMSMI ADD ETA_WK DECIMAL(10,0);
ALTER TABLE SMIRV ADD DIM NVARCHAR(50)
 /****************end by Lance 2023-07-10 ***********/


--20230705 189166 by levi start
ALTER TABLE SMSMI ADD VIA NVARCHAR(20);
ALTER TABLE SMSMI ADD BRG_TYPE NVARCHAR(20);
--20230705 189166 by levi end




CREATE TABLE [dbo].[SMORD_FORECAST](
	[BID_UID] [uniqueidentifier] NULL,
	[NEW_UID] [uniqueidentifier] NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[ETA] [date] NULL,
	[DELIVERY_DATE] [date] NULL,
	[DISCHARGE_DATE] [date] NULL,
	[CNTR_NO] [nvarchar](20) NULL,
	[CNTR_TYPE] [nvarchar](10) NULL,
	[EMP_PICK_DATE] [date] NULL,
	[PICKUP_CDATE] [date] NULL,
	[EMPTY_TIME] [datetime] NULL,
	[STORAGE_DUE_DATE] [date] NULL,
	[DEMURRAGE_DUE_DATE] [date] NULL,
	[DETENTION_DUE_DATE] [date] NULL,
	[STO_EXCEED_TIME] [int] NULL,
	[DEM_EXCEED_TIME] [int] NULL,
	[DET_EXCEED_TIME] [int] NULL,
	[STO_EST_FROM] [date] NULL,
	[DEM_EST_FROM] [date] NULL,
	[DET_EST_FROM] [date] NULL,
	[STO_EST_TO] [date] NULL,
	[DEM_EST_TO] [date] NULL,
	[DET_EST_TO] [date] NULL,
	[DEM_CUR_FORECAST] [nvarchar](3) NULL,
	[STO_CUR_FORECAST] [nvarchar](3) NULL,
	[DET_CUR_FORECAST] [nvarchar](3) NULL,
	[DEM_AMT_FORECAST] [numeric](18, 2) NULL,
	[STO_AMT_FORECAST] [numeric](18, 2) NULL,
	[DET_AMT_FORECAST] [numeric](18, 2) NULL,
	[DEP_DATE] [date] NULL,
	[ARV_DATE] [date] NULL,
	[LSP_NO] [nvarchar](20) NULL,
	[TRAN_TYPE] [nvarchar](1) NULL,
	[CARRIER] [nvarchar](20) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[POD_CD] [nvarchar](5) NULL,
	[COMBINE_DET] [nvarchar](2) NULL,
	[SHOW_COMBINE_DET] [nvarchar](1) NULL,
	[PORT_FREE_TIME] [int] NULL,
	[FACT_FREE_TIME] [int] NULL,
	[CON_FREE_TIME] [int] NULL,
	[TERMINAL_CD] [nvarchar](30) NULL,
	[FOB_AMT] [numeric](18, 2) NULL,
	[CIF_AMT] [numeric](18, 2) NULL,
	[CREATE_DATE] [datetime] NULL
) ON [PRIMARY]
GO


ALTER TABLE SMICNTR ADD PLI NVARCHAR(20),LI NVARCHAR(20),SUF_COST NUMERIC(18,2),CC_RATE NUMERIC(18,6),ADD_QTY NUMERIC(18,3),SIS_FEE NUMERIC(18,2);
ALTER TABLE SMIDN ADD PLI NVARCHAR(20),LI NVARCHAR(20),SUF_COST NUMERIC(18,2),CC_RATE NUMERIC(18,6),ADD_QTY NUMERIC(18,3),SIS_FEE NUMERIC(18,2);

ALTER TABLE SMAL ADD CARRIER NVARCHAR(20);

 
 
 CREATE TABLE [dbo].[DECLARATION_TASK](
	[NEW_ID] [nvarchar](50) NULL,
	[U_ID] [nvarchar](50) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[DEC_INFO] [nvarchar](500) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[ERROR_COUNT] [int] NULL,
	[SUCCESS] [nvarchar](1) NULL,
	[CREATE_BY] [nvarchar](40) NULL,
	[CREATE_DATE] [datetime] NULL,
	[PROCESS_DATE] [datetime] NULL,
	[REMARK] [nvarchar](500) NULL
) ON [PRIMARY]
GO





CREATE TABLE [dbo].[SMCSI](
	[U_ID] [nvarchar](36) NOT NULL,
	[TRAN_TYPE] [nvarchar](10) NULL,
	[IN_OUT] [nvarchar](1) NULL,
	[CHAIN] [nvarchar](10) NULL,
	[LOCATION] [nvarchar](10) NULL,
	[CS_YEAR] [nvarchar](4) NULL,
	[CS_QUARTER] [nvarchar](1) NULL,
	[CS_MONTH] [numeric](2, 0) NULL,
	[CS_WEEK] [numeric](2, 0) NULL,
	[POL] [nvarchar](5) NULL,
	[POD] [nvarchar](5) NULL,
	[DEST] [nvarchar](5) NULL,
	[COUNTRY] [nvarchar](2) NULL,
	[REGION] [nvarchar](2) NULL,
	[CONTACT_TYPE] [nvarchar](1) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,
	[POST_DATE] [datetime] NULL,
	[DN_NO] [nvarchar](20) NULL,
	[INCOTERM] [nvarchar](5) NULL,
	[FRT_TERM] [nvarchar](2) NULL,
	[BU] [nvarchar](10) NULL,
	[BG] [nvarchar](30) NULL,
	[SUB_BG] [nvarchar](10) NULL,
	[SUB_BG_NM] [nvarchar](30) NULL,
	[FI_CUST_CD] [nvarchar](10) NULL,
	[FI_CUST_NM] [nvarchar](20) NULL,
	[IPART_NO] [nvarchar](20) NULL,
	[PLANT] [nvarchar](10) NULL,
	[CBM] [numeric](12, 4) NULL,
	[QTY] [numeric](12, 0) NULL,
	[FEU] [numeric](12, 3) NULL,
	[CHG_CODE] [nvarchar](10) NULL,
	[CHG_DESCP] [nvarchar](100) NULL,
	[LSP_NO] [nvarchar](10) NULL,
	[LSP_NM] [nvarchar](70) NULL,
	[BILL_TO] [nvarchar](10) NULL,
	[CHG_TYPE] [nvarchar](1) NULL,
	[CHG_LEVEL] [nvarchar](1) NULL,
	[QCOST] [numeric](12, 2) NULL,
	[ECOST] [numeric](12, 2) NULL,
	[ACOST] [numeric](12, 2) NULL,
	[OCRNCY] [nvarchar](3) NULL,
	[OQCOST] [numeric](12, 2) NULL,
	[OECOST] [numeric](12, 2) NULL,
	[OACOST] [numeric](12, 2) NULL,
	[BU1] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[DN_TYPE] [nvarchar](10) NULL,
	[COST_CENTER] [nvarchar](20) NULL,
	[PROFIT_CENTER] [nvarchar](10) NULL,
	[REGION_GROUP] [nvarchar](20) NULL,
	[REF_KEY] [nvarchar](10) NULL,
	[ALLOCATION] [nvarchar](100) NULL,
	[RE_CD] [nvarchar](10) NULL,
	[QTAX] [numeric](12, 2) NULL,
	[ETAX] [numeric](12, 2) NULL,
	[ATAX] [numeric](12, 2) NULL,
	[QLEVEL] [nvarchar](2) NULL,
	[ELEVEL] [nvarchar](2) NULL,
	[ALEVEL] [nvarchar](2) NULL,
	[NQAMT] [numeric](12, 2) NULL,
	[NEAMT] [numeric](12, 2) NULL,
	[NAAMT] [numeric](12, 2) NULL,
	[QTAMT] [numeric](12, 2) NULL,
	[ETAMT] [numeric](12, 2) NULL,
	[ATAMT] [numeric](12, 2) NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [datetime] NULL,
	[DNP_ID] [nvarchar](40) NULL,
	[RG_CD] [nvarchar](10) NULL,
	[RG_NM] [nvarchar](70) NULL,
	[TRADE_TERM] [nvarchar](3) NULL,
	[POL_NM] [nvarchar](70) NULL,
	[POD_NM] [nvarchar](70) NULL,
	[DEST_NM] [nvarchar](70) NULL,
	[CARRIER_ABBR] [nvarchar](20) NULL,
	[CARRIER] [nvarchar](20) NULL,
	[FEU_FLAG] [nvarchar](1) NULL,
	[OQCRNCY] [nvarchar](3) NULL,
	[OECRNCY] [nvarchar](3) NULL,
	[PORT_POL] [nvarchar](4) NULL,
	[POST_FSSP] [datetime] NULL,
	[FSSP_ESTNO] [nvarchar](20) NULL,
	[BID_ID] [nvarchar](40) NULL,
	[CARD_NO] [nvarchar](20) NULL,
	[POST_FLAG] [nvarchar](1) NULL
)

CREATE TABLE [dbo].[CS_ITASK](
	[U_ID] [nvarchar](40) NOT NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[CMP] [nvarchar](10) NULL,
	[STN] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](20) NULL,
	[CREATE_DATE] [date] NULL,
	[SHIPMENT_ID] [nvarchar](3000) NULL,
	[DONE] [nvarchar](1) NULL,
	[MODIFY_BY] [nvarchar](20) NULL,
	[MODIFY_DATE] [datetime] NULL
)


ALTER TABLE SMIRV ADD SC_REMARK NVARCHAR(500);

 ALTER TABLE SMQTD ADD SP_CD NVARCHAR(20);
 ALTER TABLE SMQTD ADD SP_NM NVARCHAR(140);

 ALTER TABLE CS_ITASK ADD REMARK NVARCHAR(1000);

 

ALTER TRIGGER [dbo].[TG_SMSMI_TOSMIDN] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CMP NVARCHAR(10),ETA date)
	DECLARE @shipmentid char(30);
	DECLARE @cmp_old char(30);
	declare @eta_old date;
	DECLARE @ShiDt SMI_DATATABLE;

    IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CMP,ETA from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CMP,ETA from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cmp_old,@eta_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cmp_old in ('AVAIB','MN'))
				 begin  
					declare @eta_new date
					DECLARE @count int;
					SELECT @eta_new= ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old ='AVAIB')
					begin 
						select @count=COUNT(1) from smidnp where SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO!='';
						if(@count>0)
						BEGIN
						UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
			SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' );
						UPDATE SMIDNP SET ASN_DATE = DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !='';
						INSERT INTO @ShiDt SELECT DISTINCT SHIPMENT_ID FROM inserted
						END
					end 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old='MN')
					begin
						UPDATE SMIDN SET SEND_ASN_STATUS='E' WHERE SEND_ASN_STATUS='N' AND SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND NOT EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND
(datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))>=0 or 
datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))<=0))
			AND( EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));


						UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND
(datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))>=0 or
datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))<=0))
			AND( EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));
					end   
				end  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt
    END
GO


 
ALTER TRIGGER [dbo].[TG_SMORD_TOSMIDN] ON [dbo].[SMORD]
AFTER UPDATE
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(50), CMP NVARCHAR(10),DELIVERY_DATE date);
	DECLARE @ShiDt SMI_DATATABLE;
	DECLARE @shipmentid char(30);
	DECLARE @cntrno char(30);
	DECLARE @cmp_old char(30);
	DECLARE @deliverydate_old date;
	

    IF UPDATE(DELIVERY_DATE)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from deleted; 
		declare a_test_main cursor for select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cntrno,@cmp_old,@deliverydate_old--赋值到变量中 
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cntrno is not null and @cmp_old='AVAIB')
				begin
					declare @deliverydate_new date
					DECLARE @count int;
					SELECT @deliverydate_new= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid
					if (((@deliverydate_old is null and @deliverydate_new is not null) or @deliverydate_new <> @deliverydate_old))
						begin  
							select @count=COUNT(1) from smidnp where SHIPMENT_ID=@shipmentid AND CNTR_NO=@cntrno AND ASN_NO IS NOT NULL AND ASN_NO!='';
							
							if(@count>0)
							begin
							UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
				SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' AND SMIDNP.CNTR_NO=@cntrno ) ;
							UPDATE SMIDNP SET ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID =@shipmentid AND CNTR_NO=@cntrno AND ASN_NO IS NOT NULL AND ASN_NO!='';
							Set @count = 0
							SELECT @count=ID FROM @ShiDt WHERE SHIPMENT_ID=@shipmentid
							
							IF(@count<=0 OR @count IS NULL)
							BEGIN
								INSERT INTO @ShiDt VALUES (@shipmentid)
							END
							end
						end  
				end
			if(@shipmentid is not null and @cmp_old='MN')
			begin
				declare @deliverydatenew date
				SELECT @deliverydatenew= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid 
				if (((@deliverydate_old is null and @deliverydatenew is not null) or @deliverydatenew <> @deliverydate_old))
				begin   
							UPDATE SMIDN SET SEND_ASN_STATUS='D' WHERE SEND_ASN_STATUS='N' AND SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND NOT EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND (datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),@deliverydatenew)>=0 or datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),@deliverydatenew)<=0))
							UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND (datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),@deliverydatenew)>=0 or datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),@deliverydatenew)<=0))
				end   
			end 
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt;
    END

GO



CREATE OR ALTER TRIGGER [dbo].[TG_SMSMI_TOSMCSI] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),ATA date,ETA date)
	DECLARE @shipmentid char(30);
	DECLARE @ata_old date;
	DECLARE @ata_new date;
	DECLARE @eta_old date; 
	DECLARE @eta_new date; 

    IF UPDATE(ATA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,ATA,ETA from deleted;
		SET DATEFIRST 1;
		declare a_test_main cursor for select SHIPMENT_ID,ATA,ETA from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@ata_old,@eta_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环   
				SELECT @ata_new= ATA,@eta_new=ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
			 IF(@ata_new IS NOT NULL AND (@ata_old IS NULL OR @ata_new<>@ata_old))
			 
			 UPDATE SMCSI SET CS_YEAR=DATEPART(YEAR,@ata_new),CS_MONTH=DATEPART(MONTH,@ata_new),
			 CS_QUARTER=DATEPART(QUARTER,@ata_new),CS_WEEK=DATEPART(WEEK, @ata_new)
			 WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted)
			  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标 
    END
	IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,ATA,ETA from deleted;
		SET DATEFIRST 1;
		declare a_test_main cursor for select SHIPMENT_ID,ATA,ETA from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@ata_old,@eta_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环   
				SELECT @ata_new= ATA,@eta_new=ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
			 IF(@ata_new IS NULL AND @eta_new IS NOT NULL AND (@eta_old IS NULL OR @eta_new<>@eta_old))

			 UPDATE SMCSI SET CS_YEAR=DATEPART(YEAR,@eta_new),CS_MONTH=DATEPART(MONTH,@eta_new),
			 CS_QUARTER=DATEPART(QUARTER,@eta_new),CS_WEEK=DATEPART(WEEK, @eta_new)
			 WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted)
			  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标 
    END
GO

ALTER TABLE SMICUFT ADD SBW numeric(12,1);

UPDATE APPROVE_ATTR_D SET SENIOR_STAFF='Y' WHERE
APPROVE_GROUP IN ('55LEVEL','SGM','GLSTH','FHG','BHG','CEO','GMM','50AVA','SH','OPH','50MN')


UPDATE APPROVE_FLOW_D SET SENIOR_STAFF='Y' WHERE
ROLE IN ('55LEVEL','SGM','GLSTH','FHG','BHG','CEO','GMM','50AVA','SH','OPH','50MN')


ALTER TABLE SMIDNP ADD NEW_CATEGORY NVARCHAR(4);


ALTER PROC [dbo].[SET_ASN_INFO](@ShiDt SMI_DATATABLE READONLY)
AS
BEGIN
	DECLARE @Total INT,@Line INT = 1
	DECLARE @PTotal INT,@PLine INT = 1
	DECLARE @shipmentid NVARCHAR(20)
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),INV_NO NVARCHAR(40),ASN_NO NVARCHAR(50),ASN_DATE DATETIME);
	SELECT @Total = MAX(ID) FROM @ShiDt
	WHILE @Line <= @Total
	BEGIN
		SELECT @shipmentid=SHIPMENT_ID FROM @ShiDt WHERE ID=@Line
		DELETE FROM @Table
		INSERT INTO @Table SELECT INV_NO,(SELECT TOP 1 ASN_NO FROM SMIDNP WHERE INV_NO=T.INV_NO AND SHIPMENT_ID=T.SHIPMENT_ID AND  (NEW_CATEGORY!='TANN' OR NEW_CATEGORY IS NULL)) AS ASN_NO, 
(SELECT TOP 1 ASN_DATE FROM SMIDNP WHERE INV_NO=T.INV_NO AND SHIPMENT_ID=T.SHIPMENT_ID AND (NEW_CATEGORY!='TANN' OR NEW_CATEGORY IS NULL)) AS ASN_DATE FROM 
(SELECT DISTINCT INV_NO,SHIPMENT_ID FROM SMIDNP P WHERE P.SHIPMENT_ID=@shipmentid AND (NEW_CATEGORY!='TANN' OR NEW_CATEGORY IS NULL) GROUP BY INV_NO,SHIPMENT_ID) T
		SELECT @PTotal = MAX(ID) FROM @Table
		IF(@PTotal>0)
		BEGIN
			UPDATE SMSMI SET ASNNO_INFO=stuff((SELECT ','+ISNULL(ASN_NO,'') FROM @Table ORDER BY ID ASC FOR XML PATH('')),1,1,''),
			ASN_DATE=stuff((SELECT ','+ISNULL(CONVERT(nvarchar(10),ASN_DATE,23),'') FROM @Table ORDER BY ID ASC FOR XML PATH('')),1,1,''),
			INVOICE_INFO=stuff((SELECT ','+INV_NO FROM @Table ORDER BY ID ASC FOR XML PATH('')),1,1,'') WHERE SHIPMENT_ID=@shipmentid
		END
		SET @Line = @Line + 1
	END
END
GO

ALTER TABLE SMICUFT ADD SBW numeric(12,1);
ALTER TABLE SMICUFT ADD GW NUMERIC(16,4);
 ALTER TABLE CS_ITASK ADD FAIL_COUNT INT;

 --191111 BY ROWLIN 2024.08.22
alter table SMSMI alter column TC_REL_DATE nvarchar(500);
alter table SMORD alter column TC_REL_DATE nvarchar(500);
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Booking List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='FCL Search' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='LCL Search' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Air Freight Booking List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Express List' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Railway Search' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Booking_Truck' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Declaration List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='FCL Confirm List' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='LCL Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Air Confirm List' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Express Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Railway Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Booking_Truck' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='DeclarationConfirm List' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":true}',
'{"name":"TcRelDate","width":100,"hidden":true}') WHERE ID='Truck Order List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Booking List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='FCL Search' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='LCL Search' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Air Freight Booking List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Express List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Railway Search' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Booking_Truck' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Declaration List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='FCL Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='LCL Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Air Confirm List' AND LAYOUT_TYPE='GRID'
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Express Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Railway Confirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Booking_Truck' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='DeclarationConfirm List' AND LAYOUT_TYPE='GRID' 
UPDATE SYS_LAYOUT SET LAYOUT=REPLACE(CAST(LAYOUT as NVARCHAR(MAX)),'{"name":"TcRelDate","width":100,"formatter":"date","hidden":false}',
'{"name":"TcRelDate","width":100,"hidden":false}') WHERE ID='Truck Order List' AND LAYOUT_TYPE='GRID' 

UPDATE NOTICE_TASK SET WEEKLY_MON='Y',WEEKLY_TUS='Y',WEEKLY_WEN='Y',WEEKLY_THU='Y',WEEKLY_FRI='Y',WEEKLY_SAT=NULL,WEEKLY_SUN=NULL WHERE TASK_ID='MN_ASNDATE_REPORT'

CREATE NONCLUSTERED INDEX [IDX_SMBID_20240827] ON [dbo].[SMBID]
(
	[LSP_NO] ASC,
	[QUOT_NO] ASC
) 
 
  


insert BSCODE (GROUP_ID,CD_TYPE,CD,CD_DESCP,CMP,STN,CREATE_BY,CREATE_DATE,MODIFY_BY,AMS_CODE,
INTTRA	,AR_CD,AP_CD,DEP,APPLY,LOCATION,ORDER_BY)
VALUES('TPV','EDT','ISC','Inbound Shipment Confirm','*','*','MANA10',GETDATE(),null,null,null,null,null,null,null,null,null);
ALTER TABLE DECLARATION_TASK ADD IO_FLAG NVARCHAR(1),EDOC_TYPE NVARCHAR(20);
 ALTER TABLE BSTERM ALTER COLUMN NEED_CHG NVARCHAR(30);

CREATE TABLE [dbo].[BSTPS](
	[PORT_CD] [nvarchar](6) NOT NULL,
	[GROUP_ID] [nvarchar](10) NOT NULL,
	[CMP] [nvarchar](10) NOT NULL,
	[PORT_NM] [nvarchar](70) NULL,
	[TRAN_TYPE] [nvarchar](1) NULL,
	[DLV_AREA] [nvarchar](20) NULL,
	[DLV_AREA_NM] [nvarchar](70) NULL,
	[REMARK] [nvarchar](30) NULL,
	[STN] [nvarchar](10) NULL,
	[DEP] [nvarchar](10) NULL,
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](30) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[CMP_NM] [nvarchar](70) NULL,
	[U_ID] [nvarchar](40) NULL
) 


CREATE TABLE [dbo].[SMIDNPL](
	[U_ID] [nvarchar](50) NULL,
	[U_FID] [nvarchar](50) NULL,
	[SHIPMENT_ID] [nvarchar](20) NULL,--Shipment ID
	[MASTER_NO] [nvarchar](500) NULL,--Master B/L
	[HOUSE_NO] [nvarchar](500) NULL,--House B/L
	[ETA] [date] NULL,--ETA
	[ATA] [date] NULL,--ETA
	[DISCHARGE_DATE] [date] NULL,--Discharge Date
	[POD_CD] [nvarchar](5) NULL,--POD
	[POD_NAME] [nvarchar](30) NULL,--POD Name
	[CARRIER] [nvarchar](20) NULL,--Carrier
	[CARRIER_NM] [nvarchar](70) NULL,--Carrier Name
	[DN_NO] [nvarchar](20) NULL,--DN NO
	[INV_NO] [nvarchar](40) NULL,--Invoice No
	[PLA_NO] [nvarchar](10) NULL,--Pallet No
	[PLA_SIZE] [nvarchar](20) NULL,--Pallet Size
	[CASE_NO] [nvarchar](20) NULL,--Case No
	[CASE_NUM] [numeric](12, 0) NULL,--Case#
	[IPART_NO] [varchar](200) NULL,--对内机种名
	[OPART_NO] [nvarchar](100) NULL,--对外机种名
	[GOODS_DESCP] [nvarchar](50) NULL,--商品名称
	[LGOODS_DESCP] [nvarchar](50) NULL,--中文商品名称
	[QTY] [numeric](18,0) NULL,--数量
	[QTYU] [nvarchar](3) NULL,--数量单位
	[TTL_QTY] [numeric](12, 0) NULL,--总数量
	[NW] [numeric](15, 6) NULL,--净重
	[TTL_NW] [numeric](21, 6) NULL,--总净重
	[GW] [numeric](21, 6) NULL,--毛重
	[TTL_GW] [numeric](21, 6) NULL,--总毛重
	[CBM] [numeric](15, 6) NULL,--CBM
	[TTL_CBM] [numeric](14, 6) NULL,--总CBM
	[IHS_CODE] [nvarchar](12) NULL,--目的国商品编码
	[NCM_NO] [nvarchar](10) NULL,--NCM NO
	[CNTRY_ORN] [nvarchar](30) NULL,--Original Country
	[PART_NO] [nvarchar](35) NULL,--客户物料号
	[VEN_CD] [nvarchar](20) NULL,--Vendor Code
	[VEN_NM] [nvarchar](100) NULL,--Vendor Name
	[VEN_ADDR] [nvarchar](300) NULL,--Vendor Address
	[CNTR_NO] [nvarchar](20) NULL,--Container No.
	[REMARK] [nvarchar](50) NULL,--备注
	[GW_BY_PN] [numeric](15, 6) NULL,--Gross Weight by PN
	[CN_CODE] [nvarchar](20) NULL,--CN Code
	[MODEL_NAME] [nvarchar](35) NULL, --Customer Model
	[CREATE_BY] [nvarchar](30) NULL,
	[CREATE_DATE] [datetime] NULL
)


ALTER TABLE SMSMI ADD [CSM_NO] [nvarchar](20);
ALTER TABLE SMSMI ADD [BL_NO_INFO] [nvarchar](500);
ALTER TABLE SMSMI ADD [TC_DEC_NO] [nvarchar](50);
ALTER TABLE SMSMI ADD [TC_DEC_DATE] datetime;
ALTER TABLE SMSMI ADD [TS_TRAILER] [nvarchar](20);
ALTER TABLE SMSMI ADD [TS_TRUCK] [nvarchar](20);
ALTER TABLE SMSMI ADD [PALLET_QTY] [numeric](12, 0);
ALTER TABLE SMSMI ADD [TS_SEAL_NO] [nvarchar](20);
ALTER TABLE SMSMI ADD [CI_OUT_NO] [nvarchar](20);
ALTER TABLE SMSMI ADD [CI_OUT_DATE] date;
ALTER TABLE SMSMI ADD [CI_IN_DATE] datetime;
ALTER TABLE SMSMI ADD [REL_DATE] datetime;
ALTER TABLE SMSMI ADD [POD_UPDATE_DATE] datetime;
ALTER TABLE SMSMI ADD [TRANSLOAD] [nvarchar](1);

//---191422 by rowlin2024.10.28-----
ALTER TRIGGER [dbo].[TG_SMSMI_TOSMIDN] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CMP NVARCHAR(10),ETA date)
	DECLARE @shipmentid char(30);
	DECLARE @cmp_old char(30);
	declare @eta_old date;
	DECLARE @ShiDt SMI_DATATABLE;

    IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CMP,ETA from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CMP,ETA from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cmp_old,@eta_old--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cmp_old in ('AVAIB','MN'))
				 begin  
					declare @eta_new date
					DECLARE @count int;
					SELECT @eta_new= ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old ='AVAIB')
					begin 
						select @count=COUNT(1) from smidnp where SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO!='';
						if(@count>0)
						BEGIN
						UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
			SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' ) AND(EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) 
			OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));
						UPDATE SMIDNP SET ASN_DATE = DATEADD(DAY,6,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !='' 
						AND(EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDNP.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) 
						OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDNP.SHIPMENT_ID));
						INSERT INTO @ShiDt SELECT DISTINCT SHIPMENT_ID FROM inserted
						END
					end 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old='MN')
					begin
						UPDATE SMIDN SET SEND_ASN_STATUS='E' WHERE SEND_ASN_STATUS='N' AND SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND NOT EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND
(datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))>=0 or 
datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))<=0))
			AND( EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));


						UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND
(datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))>=0 or
datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))<=0))
			AND( EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));
					end   
				end  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt
    END




ALTER TABLE SMQTI ADD CHG_DAY_TYPE NVARCHAR(1);
ALTER TABLE SMICNTR ADD PORT_CHG_TYPE NVARCHAR(1),FACT_CHG_TYPE NVARCHAR(1),CON_CHG_TYPE NVARCHAR(1);

ALTER TABLE SMRQM ADD BUSINESS_GROUP NVARCHAR(10)
ALTER TABLE SMQTM ADD BUSINESS_GROUP NVARCHAR(10)

ALTER TABLE SMAL ADD WE_CD NVARCHAR(30),WE_NM NVARCHAR(70)

ALTER TABLE SMBIM ADD INVOICE_INFOS NVARCHAR(MAX);


CREATE TRIGGER  [dbo].[TG_SMBIM_INFO] ON [dbo].[SMBID]
  AFTER UPDATE, INSERT,DELETE
AS
	DECLARE @ufid nvarchar(36);
	select @ufid=U_FID from deleted
	if(UPDATE(INVOICE_INFO))
	BEGIN 
	UPDATE SMBIM SET INVOICE_INFOS=(SELECT DISTINCT INVOICE_INFO+',' FROM SMBID WHERE SMBID.U_FID=SMBIM.U_ID AND INVOICE_INFO IS NOT NULL FOR XML PATH(''))
WHERE U_ID= @ufid
	END;

GO

--更新旧数据语法
--UPDATE SMBIM SET INVOICE_INFOS=(SELECT DISTINCT INVOICE_INFO+',' FROM SMBID WHERE SMBID.U_FID=SMBIM.U_ID AND INVOICE_INFO IS NOT NULL FOR XML PATH(''))



----191593 by rowlin 2024.12.02 测试机已执行过-----
ALTER TRIGGER [dbo].[TG_SMSMI_TOSMIDN] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CMP NVARCHAR(10),ETA date,TRAN_TYPE nvarchar(1))
	DECLARE @shipmentid char(30);
	DECLARE @cmp_old char(30);
	declare @eta_old date;
	DECLARE @ShiDt SMI_DATATABLE;
	DECLARE @tranType char(1);	
    IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CMP,ETA,TRAN_TYPE from deleted;

		declare a_test_main cursor for select SHIPMENT_ID,CMP,ETA,TRAN_TYPE from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cmp_old,@eta_old,@tranType--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环
			if(@shipmentid is not null and @cmp_old in ('AVAIB','MN'))
				 begin  
					declare @eta_new date
					DECLARE @count int;
					DECLARE @numDay int;					
					SELECT @eta_new= ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old ='AVAIB')
					begin 
					    SET @numDay=6;
						if(@tranType='R')SET @numDay=3;
						if(@tranType='A' or @tranType='E')SET @numDay=1;
						select @count=COUNT(1) from smidnp where SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO!='';
						if(@count>0)
						BEGIN
						UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=DATEADD(DAY,@numDay,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
			SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' ) AND(EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) 
			OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));
						UPDATE SMIDNP SET ASN_DATE = DATEADD(DAY,@numDay,@eta_new) WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND ASN_NO IS NOT NULL AND ASN_NO !='' 
						AND(EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDNP.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) 
						OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDNP.SHIPMENT_ID));
						INSERT INTO @ShiDt SELECT DISTINCT SHIPMENT_ID FROM inserted
						END
					end 
					if (((@eta_old is null and @eta_new is not null) or @eta_new <> @eta_old) and @cmp_old='MN')
					begin
						UPDATE SMIDN SET SEND_ASN_STATUS='E' WHERE SEND_ASN_STATUS='N' AND SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND NOT EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND
(datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))>=0 or 
datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))<=0))
			AND( EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));


						UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND
(datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))>=0 or
datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),DATEADD(DAY,CASE WHEN I.TRAN_TYPE IN('F','L') THEN 6 WHEN I.TRAN_TYPE='R' THEN 3 WHEN I.TRAN_TYPE IN('A','E') THEN 1 ELSE 6 END,ETA))<=0))
			AND( EXISTS(SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID AND (DELIVERY_DATE IS NULL OR DELIVERY_DATE ='')) OR NOT EXISTS (SELECT 1 FROM SMORD WHERE SHIPMENT_ID=SMIDN.SHIPMENT_ID));
					end   
				end  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt
    END

--------测试机已执行过 by rowlin 2024.12.12（改的原因：LCL、Air、Express因为cntrno空值，导致ASN DATE没有同步更新，所以将cntrno这个条件去掉）
	ALTER TRIGGER [dbo].[TG_SMORD_TOSMIDN] ON [dbo].[SMORD]
AFTER UPDATE
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),CNTR_NO NVARCHAR(50), CMP NVARCHAR(10),DELIVERY_DATE date);
	DECLARE @ShiDt SMI_DATATABLE;
	DECLARE @shipmentid char(30);
	DECLARE @cntrno char(30);
	DECLARE @cmp_old char(30);
	DECLARE @deliverydate_old date;
	

    IF UPDATE(DELIVERY_DATE)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from deleted; 
		declare a_test_main cursor for select SHIPMENT_ID,CNTR_NO,CMP,DELIVERY_DATE from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@cntrno,@cmp_old,@deliverydate_old--赋值到变量中 
			if(@@fetch_status!=0)break;--如果没有结果退出循环			
			if(@shipmentid is not null and @cmp_old='AVAIB')
				begin
					declare @deliverydate_new date
					DECLARE @count int;
					SELECT @deliverydate_new= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid
					if (((@deliverydate_old is null and @deliverydate_new is not null) or @deliverydate_new <> @deliverydate_old))
						begin  
							select @count=COUNT(1) from smidnp where SHIPMENT_ID=@shipmentid AND ASN_NO IS NOT NULL AND ASN_NO!='';							
							if(@count>0)
							begin
							UPDATE SMIDN SET SEND_ASN_STATUS='N',ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP WHERE SMIDNP.INV_NO=SMIDN.INV_NO AND
				SMIDNP.ASN_NO IS NOT NULL AND SMIDNP.ASN_NO !='' ) ;
							UPDATE SMIDNP SET ASN_DATE=@deliverydate_new WHERE SHIPMENT_ID =@shipmentid AND ASN_NO IS NOT NULL AND ASN_NO!='';
							Set @count = 0
							SELECT @count=ID FROM @ShiDt WHERE SHIPMENT_ID=@shipmentid
							
							IF(@count<=0 OR @count IS NULL)
							BEGIN
								INSERT INTO @ShiDt VALUES (@shipmentid)
							END
							end
						end  
				end
			if(@shipmentid is not null and @cmp_old='MN')
			begin
				declare @deliverydatenew date
				SELECT @deliverydatenew= DELIVERY_DATE FROM SMORD where  SHIPMENT_ID=@shipmentid 
				if (((@deliverydate_old is null and @deliverydatenew is not null) or @deliverydatenew <> @deliverydate_old))
				begin   
							UPDATE SMIDN SET SEND_ASN_STATUS='D' WHERE SEND_ASN_STATUS='N' AND SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND NOT EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND (datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),@deliverydatenew)>=0 or datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),@deliverydatenew)<=0))
							UPDATE SMIDN SET SEND_ASN_STATUS='N' WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted) AND EXISTS(SELECT 1 FROM SMIDNP P LEFT JOIN SMSMI I ON P.SHIPMENT_ID=I.SHIPMENT_ID WHERE P.ASN_NO IS NOT NULL AND P.ASN_NO !='' AND 
P.INV_NO=SMIDN.INV_NO AND I.SHIPMENT_ID=SMIDN.SHIPMENT_ID  AND P.ASN_DATE IS NOT NULL AND (datediff(dd,dbo.WorkDayADD(P.ASN_DATE,1),@deliverydatenew)>=0 or datediff(dd,dbo.WorkDayADD(P.ASN_DATE,-1),@deliverydatenew)<=0))
				end   
			end 
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标
		EXEC SET_ASN_INFO @ShiDt;
    END

	------Add By Will 2024-12-19-------
CREATE TABLE [dbo].[SCALLO](
	[U_ID] [uniqueidentifier] NOT NULL,
	[CMP] [nvarchar](10) NULL,
	[CMP_NM] [nvarchar](70) NULL,
	[BY_CBM] int NULL,
	[BY_GW] int NULL,
	[BY_NW] int NULL,
	[BY_VALUE] int NULL,
	[CREATE_BY] [nvarchar](50) NULL,
	[CREATE_DATE] [datetime] NULL,
	[MODIFY_BY] [nvarchar](50) NULL,
	[MODIFY_DATE] [datetime] NULL,
	[GROUP_ID] [nvarchar](10) NULL,
	[REMARK] [nvarchar](200) NULL,
) ON [PRIMARY]
GO

ALTER TABLE SMCSI ADD COST_RULE NVARCHAR(20);
ALTER TABLE SMCSI ADD RULE_TYPE NVARCHAR(10);
------End By Will 2024-12-19-------

ALTER TABLE SMICNTR ADD [FOB_AMT_USD] [numeric](18, 2) NULL
ALTER TABLE SMIDN ADD [FOB_AMT_USD] [numeric](18, 2) NULL



CREATE TABLE SMETA(
[SHIPMENT_ID] [nvarchar](20) NULL,
[CMP] [nvarchar](10) NULL,
[CREATE_DATE] [datetime] NULL,
[RESULT_STATUS] [nvarchar](1) NULL,
[FAIL_MSG] [nvarchar](100) NULL,
[MODIFY_DATE] [datetime] NULL
)


ALTER TRIGGER [dbo].[TG_SMSMI_TOSMCSI] ON [dbo].[SMSMI]
  AFTER UPDATE  
AS 
	DECLARE @Table TABLE(ID INT IDENTITY(1,1),SHIPMENT_ID NVARCHAR(20),ATA date,ETA date,CMP NVARCHAR(10))
	DECLARE @shipmentid char(30);
	DECLARE @ata_old date;
	DECLARE @ata_new date;
	DECLARE @eta_old date; 
	DECLARE @eta_new date; 
	DECLARE @cmp char(10);

    IF UPDATE(ATA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,ATA,ETA,CMP from deleted;
		SET DATEFIRST 1;
		declare a_test_main cursor for select SHIPMENT_ID,ATA,ETA,CMP from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@ata_old,@eta_old,@cmp--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环   
				SELECT @ata_new= ATA,@eta_new=ETA FROM SMSMI where  SHIPMENT_ID=@shipmentid 
			 IF(@ata_new IS NOT NULL AND (@ata_old IS NULL OR @ata_new<>@ata_old))
			 
			 UPDATE SMCSI SET CS_YEAR=DATEPART(YEAR,@ata_new),CS_MONTH=DATEPART(MONTH,@ata_new),
			 CS_QUARTER=DATEPART(QUARTER,@ata_new),CS_WEEK=DATEPART(WEEK, @ata_new)
			 WHERE SHIPMENT_ID IN(SELECT SHIPMENT_ID FROM inserted)
			  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标 
    END
	IF UPDATE(ETA)
    BEGIN
		INSERT INTO @Table select SHIPMENT_ID,ATA,ETA,CMP from deleted;
		SET DATEFIRST 1;
		declare a_test_main cursor for select SHIPMENT_ID,ATA,ETA,CMP from @Table--查出需要循环的集合放到游标中
		open a_test_main;--打开游标
		while 1=1--开始循环
		begin--开始
			fetch next from a_test_main into @shipmentid,@ata_old,@eta_old,@cmp--赋值到变量中
			if(@@fetch_status!=0)break;--如果没有结果退出循环   
			 insert into SMETA (SHIPMENT_ID,CMP,CREATE_DATE,RESULT_STATUS)VALUES(@shipmentid,@cmp,GETDATE(),'N')
			  
		end--结束
		close a_test_main--关闭游标
		deallocate a_test_main--释放游标 
    END
GO


--停用updateSmsmiEta

ALTER TABLE SMSMI ALTER COLUMN PKG_UNIT_DESC NVARCHAR(500);