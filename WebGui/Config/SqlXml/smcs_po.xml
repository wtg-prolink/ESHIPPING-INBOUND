<?xml version="1.0" encoding="utf-8"?>
<root>
  <col>
    'I' AS IN_OUT,'UP' AS CHAIN,SMSMI.CMP LOCATION,'' AS QUARTER,SMSMI.WEEKLY AS WEEK,SMSMI.POL_CD AS POL,SMSMI.POD_CD AS POD,
    SMSMI.DEST_CD AS DEST,SUBSTRING(SMSMI.DEST_CD,0,3) AS COUNTRY,
    (SELECT SUM(SMINPO.TTL_CBM) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS SM_CBM,
    (SELECT MIN(TTL_CBM) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS MINCBM,

    (SELECT SUM(SMINPO.TTL_GW) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS SM_GW,
    (SELECT MIN(TTL_GW) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS MINGW,
    (SELECT SUM(SMINPO.TTL_NW) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS SM_NW,
    (SELECT MIN(TTL_NW) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS MINNW,

    (SELECT SUM(SMINPO.AMT) FROM SMINPO WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
    (SELECT SHIPMENT_ID FROM SMSM B WHERE B.COMBIN_SHIPMENT={0} OR B.SHIPMENT_ID={0} OR B.SPLIT_SHIPMENT={0})) AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)) AS GVALUE,
    SMDN.FREIGHT_TERM AS FRT_TERM,'' BU,'' AS BG,(SELECT TOP 1 PARTY_NO FROM SMDNPT WHERE PARTY_TYPE='ZT' AND SMDNPT.DN_NO=SMDN.DN_NO) AS SUB_BG,
    (SELECT TOP 1 PARTY_NO FROM SMDNPT WHERE PARTY_TYPE='RG' AND SMDNPT.DN_NO=SMDN.DN_NO) AS RG_CD,
    (SELECT TOP 1 PARTY_NAME FROM SMDNPT WHERE PARTY_TYPE='RG' AND SMDNPT.DN_NO=SMDN.DN_NO) AS RG_NM,
    (SELECT TOP 1 PARTY_NAME FROM SMDNPT WHERE PARTY_TYPE='ZT' AND SMDNPT.DN_NO=SMDN.DN_NO) AS SUB_BG_NM,
    SMSMI.CBM AS TCBM,
    '' AS PROFIT_CENTER,'' AS REGION_GROUP,SMDN.FI_CUST_CD AS REF_KEY,SMDN.FI_CUST_NM AS ALLOCATION,
    SMDN.BU AS BU1,SMINPO.IPART_NO,SMINPO.TTL_CBM AS CBM,SMINPO.TTL_GW AS GW,SMINPO.TTL_NW AS NW,SMINPO.QTY,SMINPO.AMT AS VALUE1,SMBID.U_ID CHG_U_ID,SMSMI.ETD AS SM_ETD,SMINPO.U_FID AS U_ID,
    (SELECT TOP 1 INV_NO FROM SMIDN WHERE SMIDN.DN_NO=SMDN.DN_NO) AS INV_NO,
    0 AS CNTR_STD_QTY{1}{2}
  </col>
<col1>
  'I' AS IN_OUT,'UP' AS CHAIN,SMSMI.CMP LOCATION,
  '' AS QUARTER,SMSMI.WEEKLY AS WEEK,SMSMI.POL_CD AS POL,SMSMI.POD_CD AS POD,
  SMSMI.DEST_CD AS DEST    ,SUBSTRING(SMSMI.DEST_CD,0,3) AS COUNTRY,
  (SELECT SUM(SMBDD.CBM) FROM SMBDD WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
  (SELECT SHIPMENT_ID FROM SMSM B WHERE B.SHIPMENT_ID={0}))) AS SM_CBM,
  (SELECT MIN(CBM) FROM SMBDD WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
  (SELECT SHIPMENT_ID FROM SMSM B WHERE B.SHIPMENT_ID={0}))) AS MINCBM,

  (SELECT SUM(SMBDD.GW) FROM SMBDD WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
  (SELECT SHIPMENT_ID FROM SMSM B WHERE B.SHIPMENT_ID={0}))) AS SM_GW,
  (SELECT MIN(GW) FROM SMBDD WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
  (SELECT SHIPMENT_ID FROM SMSM B WHERE B.SHIPMENT_ID={0}))) AS MINGW,
  (SELECT SUM(SMBDD.NW) FROM SMBDD WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
  (SELECT SHIPMENT_ID FROM SMSM B WHERE B.SHIPMENT_ID={0}))) AS SM_NW,
  (SELECT MIN(NW) FROM SMBDD WHERE DN_NO IN (SELECT DN_NO FROM SMDN A WHERE A.SHIPMENT_ID IN
  (SELECT SHIPMENT_ID FROM SMSM B WHERE B.SHIPMENT_ID={0}))) AS MINNW,

  0 AS GVALUE,SMDN.FREIGHT_TERM AS FRT_TERM,'' BU,
  '' AS BG,(SELECT TOP 1 PARTY_NO FROM SMDNPT WHERE PARTY_TYPE='ZT' AND SMDNPT.DN_NO=SMDN.DN_NO) AS SUB_BG,
  (SELECT TOP 1 PARTY_NO FROM SMDNPT WHERE PARTY_TYPE='RG' AND SMDNPT.DN_NO=SMDN.DN_NO) AS RG_CD,
  (SELECT TOP 1 PARTY_NAME FROM SMDNPT WHERE PARTY_TYPE='RG' AND SMDNPT.DN_NO=SMDN.DN_NO) AS RG_NM,
  (SELECT TOP 1 PARTY_NAME FROM SMDNPT WHERE PARTY_TYPE='ZT' AND SMDNPT.DN_NO=SMDN.DN_NO) AS SUB_BG_NM,
  SMSMI.CBM AS TCBM,
  '' PROFIT_CENTER,'' AS REGION_GROUP,SMDN.FI_CUST_CD AS REF_KEY,SMDN.FI_CUST_NM AS ALLOCATION,
  SMDN.BU AS BU1,SMBDD.IPART_NO,SMBDD.CBM,SMBDD.GW,SMBDD.NW,SMBDD.QTY,0 VALUE1,SMBID.U_ID CHG_U_ID
  ,SMSMI.ETD AS SM_ETD,SMBDD.U_ID,
  (SELECT TOP 1 INV_NO FROM SMIDN WHERE SMIDN.DN_NO=SMDN.DN_NO) AS INV_NO,
  SMBDD.CNTR_STD_QTY{1}{2}
</col1>
  <DNcol>
	  ,SMDN.BAND_TYPE,SMDN.PORT_POL,SMDN.FEU,SMDN.RE_CD,SMDN.COST_CENTER,SMDN.DN_TYPE,SMDN.AMOUNT1,SMDN.STN,SMDN.FC_NM,SMDN.DEP,SMDN.FC_CD,
	  SMDN.TRADE_TERM,SMDN.INCOTERM,SMDN.DN_NO,SMDN.PLANT
  </DNcol>
		
  <SMcol>
	  ,SMSMI.TRAN_TYPE,SMSMI.CMP,SMSMI.YEAR,SMSMI.MONTH,SMSMI.REGION,SMSMI.DEST_NAME,SMSMI.POL_NAME,SMSMI.POD_NAME,SMSMI.CARRIER,SMSMI.SHIPMENT_ID,
	  SMSMI.GROUP_ID,'' AS CONTRACT_TYPE,SMSMI.DEP,'' AS COMBINE_OTHER,SMSMI.ATD,SMSMI.ETA,SMSMI.ATA,SMSMI.CNT_TYPE,
	  SMSMI.CNT_NUMBER,SMSMI.OCNT_TYPE,SMSMI.OCNT_NUMBER,SMSMI.CNT20,SMSMI.CNT40,SMSMI.CNT40HQ,SMSMI.CARGO_TYPE
  </SMcol>
	<combine>
    SELECT {1}
    FROM SMINPO INNER JOIN (SELECT SMDN.FREIGHT_TERM,
    SMDN.CNT_TYPE,SMDN.CNT_NUMBER,SMDN.OCNT_TYPE,SMDN.OCNT_NUMBER,SMDN.CNT20,SMDN.CNT40,SMDN.CNT40HQ,SMDN.FI_CUST_CD,SMDN.FI_CUST_NM,
    SMDN.BU,{0} AS SHIPMENT_ID,SMDN.U_ID{2} FROM SMDN WHERE SHIPMENT_ID IN (
    SELECT SHIPMENT_ID FROM SMSM WHERE COMBIN_SHIPMENT={0})) AS SMDN ON SMDN.DN_NO=SMINPO.DN_NO
    INNER JOIN DBO.SMSMI ON SMDN.SHIPMENT_ID = SMSMI.SHIPMENT_ID
    LEFT JOIN SMBID
    ON SMDN.SHIPMENT_ID = SMBID.SHIPMENT_ID  WHERE SMSMI.SHIPMENT_ID={0} AND SMSMI.CMP = SMBID.CMP AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)
  </combine>
	<split>
    SELECT {1}
    FROM SMINPO INNER JOIN SMDN ON SMDN.DN_NO=SMINPO.DN_NO
    INNER JOIN (select SMSMI.CMP LOCATION,SMSMI.WEEKLY,SMSMI.POL_CD,SMSMI.POD_CD,SMSMI.DEST_CD,SMSMI.COST_CENTER,SMSMI.GVALUE,
    SMSMI.CBM AS TCBM,SMSMI.CBM,SMSMI.ETD,(SELECT TOP 1 SPLIT_SHIPMENT FROM SMSM WHERE SHIPMENT_ID={0}) AS SPLIT_SHIPMENT{3} from
    SMSMI WHERE SHIPMENT_ID={0}) SMSMI ON SMDN.SHIPMENT_ID =(SELECT TOP 1 SPLIT_SHIPMENT FROM SMSM WHERE SHIPMENT_ID={0})
    LEFT JOIN SMBID
    ON SMSMI.SHIPMENT_ID = SMBID.SHIPMENT_ID  WHERE SMDN.DN_NO IN {2} AND SMSMI.CMP = SMBID.CMP
    AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)
  </split>
  <dnpsql>
    SELECT {1}
    FROM SMINPO INNER JOIN SMDN ON SMDN.DN_NO=SMINPO.DN_NO
    INNER JOIN DBO.SMSMI ON SMDN.SHIPMENT_ID = SMSMI.SHIPMENT_ID
    LEFT JOIN SMBID
    ON SMDN.SHIPMENT_ID = SMBID.SHIPMENT_ID AND SMSMI.GROUP_ID= SMBID.GROUP_ID AND SMSMI.CMP = SMBID.CMP  WHERE SMSMI.SHIPMENT_ID={0}  AND (SMINPO.CATEGORY !='TANN' OR SMINPO.CATEGORY IS NULL)
  </dnpsql>
	<bddsql>
		UNION SELECT {1}
		FROM SMBDD INNER JOIN SMDN ON SMDN.DN_NO=SMBDD.DN_NO
		INNER JOIN DBO.SMSMI ON SMBDD.SHIPMENT_ID = SMSMI.SHIPMENT_ID
		LEFT JOIN SMBID
		ON SMSMI.SHIPMENT_ID = SMBID.SHIPMENT_ID AND SMSMI.GROUP_ID= SMBID.GROUP_ID AND SMSMI.CMP = SMBID.CMP  WHERE SMSMI.SHIPMENT_ID={0}
	</bddsql>
</root>




