<?xml version="1.0" encoding="utf-8"?>
<root>
  <Table name="SMDNP"  sql="SELECT 
         (SELECT ISNULL(LTRUCK_NO,'')+';' FROM SMRV WHERE SMRV.SHIPMENT_ID=SMDN.SHIPMENT_ID  FOR XML PATH('')) AS LTRUCK_NO,
         (SELECT ISNULL(LDRIVER,'')+';' FROM SMRV WHERE SMRV.SHIPMENT_ID=SMDN.SHIPMENT_ID  FOR XML PATH('')) AS LDRIVER,
         SMSM.PKG_UNIT AS PKG_UNIT_UB,SMSM.PKG_NUM,SMSM.PKG_UNIT,SMSM.PKG_UNIT_DESC,
SMDN.TRAN_TYPE,POD AS POD_CD,POD_NM AS POD_NM,SMDN.SHIPMENT_ID,SMDN.DN_NO,SMDN.PORT_POL,SMDN.PORT_POLNM,SMDNP.*,SMRV.TRUCKER,SMRV.TRUCKER_NM,SMRV.CNTR_NO,SMRV.SEAL_NO1 ,
SMDN.CUSTOMER_INNUMBER, (SELECT TOP 1 CASE
                 WHEN PARTY_NAME IS NOT NULL THEN
                  PARTY_NAME + ' '
                 ELSE
                  ''
               END +CASE
                 WHEN (PARTY_NAME2 IS NOT NULL) THEN
                  PARTY_NAME2 + ' '
                 ELSE
                  ''
               END +CASE
                 WHEN (PARTY_NAME3 IS NOT NULL) THEN
                  PARTY_NAME3 + ' '
                 ELSE
                  ''
               END +CASE
                 WHEN (PARTY_NAME4 IS NOT NULL) THEN
                  PARTY_NAME4 + ' '
                 ELSE
                  ''
               END
                 FROM SMPTY
                WHERE SMPTY.STATUS='U' AND SMPTY.PARTY_NO =
                      (SELECT TOP 1 SMDN.PLANT
                         FROM SMDN
                        WHERE SMDN.PLANT IS NOT NULL
                          AND SMSM.SHIPMENT_ID = SMDN.SHIPMENT_ID)) AS P_NAME FROM SMDN LEFT JOIN SMSM ON SMDN.SHIPMENT_ID = SMSM.SHIPMENT_ID LEFT JOIN SMDNP ON SMDN.U_ID = SMDNP.U_FID LEFT JOIN SMRV ON SMDN.SHIPMENT_ID = SMRV.SHIPMENT_ID WHERE SMSM.SHIPMENT_ID=':=uid'">
  </Table>
  <Table name="PARTY"  sql=";with REF_DATA AS(
select SMDN.U_ID,SMDN.TRAN_TYPE,POD AS POD_CD,SMDN.POD_NM,SMDN.SHIPMENT_ID,SMDN.PORT_POL,SMDN.PORT_POLNM,SMDN.DN_NO,SMDN.DN_NO_CMP_REF,SMDN.COMBINE_INFO,SMDN.WE_NM,SMDN.PLANT,SMDN.ETD,SMDN.REF_NO from SMDN where DN_NO =':=val'
union all
select SMDN.U_ID,SMDN.TRAN_TYPE,POD AS POD_CD,SMDN.POD_NM,SMDN.SHIPMENT_ID,SMDN.PORT_POL,SMDN.PORT_POLNM,SMDN.DN_NO,SMDN.DN_NO_CMP_REF,SMDN.COMBINE_INFO,SMDN.WE_NM,SMDN.PLANT,SMDN.ETD,SMDN.REF_NO from SMDN inner join REF_DATA r on   r.REF_NO = SMDN.DN_NO
)
SELECT * FROM SMDNPT LEFT JOIN SMPTY ON SMDNPT.PARTY_NO=SMPTY.PARTY_NO WHERE DN_NO IN (SELECT DN_NO FROM REF_DATA WHERE REF_DATA.REF_NO IS NULL)">
  </Table>
<Table name="SMSMPT"  sql="SELECT *  FROM  SMSMPT WHERE  SHIPMENT_ID=':=uid'">
  </Table>
  <Paramter name="listNo"></Paramter>
</root>